/* Phaser Box2D Plugin by Photon Storm. Custom build, no touchy */
var COMPILED=!1;var goog=goog||{};goog.global=this;goog.global.CLOSURE_UNCOMPILED_DEFINES;goog.global.CLOSURE_DEFINES;goog.isDef=function(val){return val!==void 0};goog.exportPath_=function(name,opt_object,opt_objectToExportTo){var parts=name.split('.');var cur=opt_objectToExportTo||goog.global;if(!(parts[0]in cur)&&cur.execScript){cur.execScript('var '+parts[0])}
for(var part;parts.length&&(part=parts.shift());){if(!parts.length&&goog.isDef(opt_object)){cur[part]=opt_object}else if(cur[part]){cur=cur[part]}else{cur=cur[part]={}}}};goog.define=function(name,defaultValue){var value=defaultValue;if(!COMPILED){if(goog.global.CLOSURE_UNCOMPILED_DEFINES&&Object.prototype.hasOwnProperty.call(goog.global.CLOSURE_UNCOMPILED_DEFINES,name)){value=goog.global.CLOSURE_UNCOMPILED_DEFINES[name]}else if(goog.global.CLOSURE_DEFINES&&Object.prototype.hasOwnProperty.call(goog.global.CLOSURE_DEFINES,name)){value=goog.global.CLOSURE_DEFINES[name]}}
goog.exportPath_(name,value)};goog.DEBUG=!0;goog.define('goog.LOCALE','en');goog.define('goog.TRUSTED_SITE',!0);goog.define('goog.STRICT_MODE_COMPATIBLE',!1);goog.provide=function(name){if(!COMPILED){if(goog.isProvided_(name)){throw Error('Namespace "'+name+'" already declared.')}
delete goog.implicitNamespaces_[name];var namespace=name;while((namespace=namespace.substring(0,namespace.lastIndexOf('.')))){if(goog.getObjectByName(namespace)){break}
goog.implicitNamespaces_[namespace]=!0}}
goog.exportPath_(name)};goog.setTestOnly=function(opt_message){if(COMPILED&&!goog.DEBUG){opt_message=opt_message||'';throw Error('Importing test-only code into non-debug environment'+(opt_message?': '+opt_message:'.'))}};goog.forwardDeclare=function(name){};if(!COMPILED){goog.isProvided_=function(name){return !goog.implicitNamespaces_[name]&&goog.isDefAndNotNull(goog.getObjectByName(name))};goog.implicitNamespaces_={}}
goog.getObjectByName=function(name,opt_obj){var parts=name.split('.');var cur=opt_obj||goog.global;for(var part;part=parts.shift();){if(goog.isDefAndNotNull(cur[part])){cur=cur[part]}else{return null}}
return cur};goog.globalize=function(obj,opt_global){var global=opt_global||goog.global;for(var x in obj){global[x]=obj[x]}};goog.addDependency=function(relPath,provides,requires){if(goog.DEPENDENCIES_ENABLED){var provide,require;var path=relPath.replace(/\\/g,'/');var deps=goog.dependencies_;for(var i=0;provide=provides[i];i++){deps.nameToPath[provide]=path;if(!(path in deps.pathToNames)){deps.pathToNames[path]={}}
deps.pathToNames[path][provide]=!0}
for(var j=0;require=requires[j];j++){if(!(path in deps.requires)){deps.requires[path]={}}
deps.requires[path][require]=!0}}};goog.define('goog.ENABLE_DEBUG_LOADER',!0);goog.require=function(name){if(!COMPILED){if(goog.isProvided_(name)){return}
if(goog.ENABLE_DEBUG_LOADER){var path=goog.getPathFromDeps_(name);if(path){goog.included_[path]=!0;goog.writeScripts_();return}}
var errorMessage='goog.require could not find: '+name;if(goog.global.console){goog.global.console.error(errorMessage)}
throw Error(errorMessage)}};goog.basePath='';goog.global.CLOSURE_BASE_PATH;goog.global.CLOSURE_NO_DEPS;goog.global.CLOSURE_IMPORT_SCRIPT;goog.nullFunction=function(){};goog.identityFunction=function(opt_returnValue,var_args){return opt_returnValue};goog.abstractMethod=function(){throw Error('unimplemented abstract method')};goog.addSingletonGetter=function(ctor){ctor.getInstance=function(){if(ctor.instance_){return ctor.instance_}
if(goog.DEBUG){goog.instantiatedSingletons_[goog.instantiatedSingletons_.length]=ctor}
return ctor.instance_=new ctor}};goog.instantiatedSingletons_=[];goog.DEPENDENCIES_ENABLED=!COMPILED&&goog.ENABLE_DEBUG_LOADER;if(goog.DEPENDENCIES_ENABLED){goog.included_={};goog.dependencies_={pathToNames:{},nameToPath:{},requires:{},visited:{},written:{}};goog.inHtmlDocument_=function(){var doc=goog.global.document;return typeof doc!='undefined'&&'write' in doc};goog.findBasePath_=function(){if(goog.global.CLOSURE_BASE_PATH){goog.basePath=goog.global.CLOSURE_BASE_PATH;return}else if(!goog.inHtmlDocument_()){return}
var doc=goog.global.document;var scripts=doc.getElementsByTagName('script');for(var i=scripts.length-1;i>=0;--i){var src=scripts[i].src;var qmark=src.lastIndexOf('?');var l=qmark==-1?src.length:qmark;if(src.substr(l-7,7)=='base.js'){goog.basePath=src.substr(0,l-7);return}}};goog.importScript_=function(src){var importScript=goog.global.CLOSURE_IMPORT_SCRIPT||goog.writeScriptTag_;if(!goog.dependencies_.written[src]&&importScript(src)){goog.dependencies_.written[src]=!0}};goog.writeScriptTag_=function(src){if(goog.inHtmlDocument_()){var doc=goog.global.document;if(doc.readyState=='complete'){var isDeps=/\bdeps.js$/.test(src);if(isDeps){return !1}else{throw Error('Cannot write "'+src+'" after document load')}}
doc.write('<script type="text/javascript" src="'+src+'"></'+'script>');return !0}else{return !1}};goog.writeScripts_=function(){var scripts=[];var seenScript={};var deps=goog.dependencies_;function visitNode(path){if(path in deps.written){return}
if(path in deps.visited){if(!(path in seenScript)){seenScript[path]=!0;scripts.push(path)}
return}
deps.visited[path]=!0;if(path in deps.requires){for(var requireName in deps.requires[path]){if(!goog.isProvided_(requireName)){if(requireName in deps.nameToPath){visitNode(deps.nameToPath[requireName])}else{throw Error('Undefined nameToPath for '+requireName)}}}}
if(!(path in seenScript)){seenScript[path]=!0;scripts.push(path)}}
for(var path in goog.included_){if(!deps.written[path]){visitNode(path)}}
for(var i=0;i<scripts.length;i++){if(scripts[i]){goog.importScript_(goog.basePath+scripts[i])}else{throw Error('Undefined script input')}}};goog.getPathFromDeps_=function(rule){if(rule in goog.dependencies_.nameToPath){return goog.dependencies_.nameToPath[rule]}else{return null}};goog.findBasePath_()}
goog.typeOf=function(value){var s=typeof value;if(s=='object'){if(value){if(value instanceof Array){return 'array'}else if(value instanceof Object){return s}
var className=Object.prototype.toString.call((value));if(className=='[object Window]'){return 'object'}
if((className=='[object Array]'||typeof value.length=='number'&&typeof value.splice!='undefined'&&typeof value.propertyIsEnumerable!='undefined'&&!value.propertyIsEnumerable('splice'))){return 'array'}
if((className=='[object Function]'||typeof value.call!='undefined'&&typeof value.propertyIsEnumerable!='undefined'&&!value.propertyIsEnumerable('call'))){return 'function'}}else{return 'null'}}else if(s=='function'&&typeof value.call=='undefined'){return 'object'}
return s};goog.isNull=function(val){return val===null};goog.isDefAndNotNull=function(val){return val!=null};goog.isArray=function(val){return goog.typeOf(val)=='array'};goog.isArrayLike=function(val){var type=goog.typeOf(val);return type=='array'||type=='object'&&typeof val.length=='number'};goog.isDateLike=function(val){return goog.isObject(val)&&typeof val.getFullYear=='function'};goog.isString=function(val){return typeof val=='string'};goog.isBoolean=function(val){return typeof val=='boolean'};goog.isNumber=function(val){return typeof val=='number'};goog.isFunction=function(val){return goog.typeOf(val)=='function'};goog.isObject=function(val){var type=typeof val;return type=='object'&&val!=null||type=='function'};goog.getUid=function(obj){return obj[goog.UID_PROPERTY_]||(obj[goog.UID_PROPERTY_]=++goog.uidCounter_)};goog.hasUid=function(obj){return !!obj[goog.UID_PROPERTY_]};goog.removeUid=function(obj){if('removeAttribute' in obj){obj.removeAttribute(goog.UID_PROPERTY_)}
try{delete obj[goog.UID_PROPERTY_]}catch(ex){}};goog.UID_PROPERTY_='closure_uid_'+((Math.random()*1e9)>>>0);goog.uidCounter_=0;goog.getHashCode=goog.getUid;goog.removeHashCode=goog.removeUid;goog.cloneObject=function(obj){var type=goog.typeOf(obj);if(type=='object'||type=='array'){if(obj.clone){return obj.clone()}
var clone=type=='array'?[]:{};for(var key in obj){clone[key]=goog.cloneObject(obj[key])}
return clone}
return obj};goog.bindNative_=function(fn,selfObj,var_args){return(fn.call.apply(fn.bind,arguments))};goog.bindJs_=function(fn,selfObj,var_args){if(!fn){throw new Error()}
if(arguments.length>2){var boundArgs=Array.prototype.slice.call(arguments,2);return function(){var newArgs=Array.prototype.slice.call(arguments);Array.prototype.unshift.apply(newArgs,boundArgs);return fn.apply(selfObj,newArgs)}}else{return function(){return fn.apply(selfObj,arguments)}}};goog.bind=function(fn,selfObj,var_args){if(Function.prototype.bind&&Function.prototype.bind.toString().indexOf('native code')!=-1){goog.bind=goog.bindNative_}else{goog.bind=goog.bindJs_}
return goog.bind.apply(null,arguments)};goog.partial=function(fn,var_args){var args=Array.prototype.slice.call(arguments,1);return function(){var newArgs=args.slice();newArgs.push.apply(newArgs,arguments);return fn.apply(this,newArgs)}};goog.mixin=function(target,source){for(var x in source){target[x]=source[x]}};goog.now=(goog.TRUSTED_SITE&&Date.now)||(function(){return+new Date()});goog.globalEval=function(script){if(goog.global.execScript){goog.global.execScript(script,'JavaScript')}else if(goog.global.eval){if(goog.evalWorksForGlobals_==null){goog.global.eval('var _et_ = 1;');if(typeof goog.global._et_!='undefined'){delete goog.global._et_;goog.evalWorksForGlobals_=!0}else{goog.evalWorksForGlobals_=!1}}
if(goog.evalWorksForGlobals_){goog.global.eval(script)}else{var doc=goog.global.document;var scriptElt=doc.createElement('script');scriptElt.type='text/javascript';scriptElt.defer=!1;scriptElt.appendChild(doc.createTextNode(script));doc.body.appendChild(scriptElt);doc.body.removeChild(scriptElt)}}else{throw Error('goog.globalEval not available')}};goog.evalWorksForGlobals_=null;goog.cssNameMapping_;goog.cssNameMappingStyle_;goog.getCssName=function(className,opt_modifier){var getMapping=function(cssName){return goog.cssNameMapping_[cssName]||cssName};var renameByParts=function(cssName){var parts=cssName.split('-');var mapped=[];for(var i=0;i<parts.length;i++){mapped.push(getMapping(parts[i]))}
return mapped.join('-')};var rename;if(goog.cssNameMapping_){rename=goog.cssNameMappingStyle_=='BY_WHOLE'?getMapping:renameByParts}else{rename=function(a){return a}}
if(opt_modifier){return className+'-'+rename(opt_modifier)}else{return rename(className)}};goog.setCssNameMapping=function(mapping,opt_style){goog.cssNameMapping_=mapping;goog.cssNameMappingStyle_=opt_style};goog.global.CLOSURE_CSS_NAME_MAPPING;if(!COMPILED&&goog.global.CLOSURE_CSS_NAME_MAPPING){goog.cssNameMapping_=goog.global.CLOSURE_CSS_NAME_MAPPING}
goog.getMsg=function(str,opt_values){if(opt_values){str=str.replace(/\{\$([^}]+)}/g,function(match,key){return key in opt_values?opt_values[key]:match})}
return str};goog.getMsgWithFallback=function(a,b){return a};goog.exportSymbol=function(publicPath,object,opt_objectToExportTo){goog.exportPath_(publicPath,object,opt_objectToExportTo)};goog.exportProperty=function(object,publicName,symbol){object[publicName]=symbol};goog.inherits=function(childCtor,parentCtor){function tempCtor(){};tempCtor.prototype=parentCtor.prototype;childCtor.superClass_=parentCtor.prototype;childCtor.prototype=new tempCtor();childCtor.prototype.constructor=childCtor;childCtor.base=function(me,methodName,var_args){var args=Array.prototype.slice.call(arguments,2);return parentCtor.prototype[methodName].apply(me,args)}};goog.base=function(me,opt_methodName,var_args){var caller=arguments.callee.caller;if(goog.STRICT_MODE_COMPATIBLE||(goog.DEBUG&&!caller)){throw Error('arguments.caller not defined.  goog.base() cannot be used '+'with strict mode code. See '+'http://www.ecma-international.org/ecma-262/5.1/#sec-C')}
if(caller.superClass_){return caller.superClass_.constructor.apply(me,Array.prototype.slice.call(arguments,1))}
var args=Array.prototype.slice.call(arguments,2);var foundCaller=!1;for(var ctor=me.constructor;ctor;ctor=ctor.superClass_&&ctor.superClass_.constructor){if(ctor.prototype[opt_methodName]===caller){foundCaller=!0}else if(foundCaller){return ctor.prototype[opt_methodName].apply(me,args)}}
if(me[opt_methodName]===caller){return me.constructor.prototype[opt_methodName].apply(me,args)}else{throw Error('goog.base called from a method of one name '+'to a method of a different name')}};goog.scope=function(fn){fn.call(goog.global)};if(!COMPILED){goog.global.COMPILED=COMPILED}
goog.defineClass=function(superClass,def){var constructor=def.constructor;var statics=def.statics;if(!constructor||constructor==Object.prototype.constructor){constructor=function(){throw Error('cannot instantiate an interface (no constructor defined).')}}
var cls=goog.defineClass.createSealingConstructor_(constructor,superClass);if(superClass){goog.inherits(cls,superClass)}
delete def.constructor;delete def.statics;goog.defineClass.applyProperties_(cls.prototype,def);if(statics!=null){if(statics instanceof Function){statics(cls)}else{goog.defineClass.applyProperties_(cls,statics)}}
return cls};goog.defineClass.ClassDescriptor;goog.define('goog.defineClass.SEAL_CLASS_INSTANCES',goog.DEBUG);goog.defineClass.createSealingConstructor_=function(ctr,superClass){if(goog.defineClass.SEAL_CLASS_INSTANCES&&Object.seal instanceof Function){if(superClass&&superClass.prototype&&superClass.prototype[goog.UNSEALABLE_CONSTRUCTOR_PROPERTY_]){return ctr}
var wrappedCtr=function(){var instance=ctr.apply(this,arguments)||this;if(this.constructor===wrappedCtr){Object.seal(instance)}
return instance};return wrappedCtr}
return ctr};goog.defineClass.OBJECT_PROTOTYPE_FIELDS_=['constructor','hasOwnProperty','isPrototypeOf','propertyIsEnumerable','toLocaleString','toString','valueOf'];goog.defineClass.applyProperties_=function(target,source){var key;for(key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}
for(var i=0;i<goog.defineClass.OBJECT_PROTOTYPE_FIELDS_.length;i++){key=goog.defineClass.OBJECT_PROTOTYPE_FIELDS_[i];if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}};goog.tagUnsealableClass=function(ctr){if(!COMPILED&&goog.defineClass.SEAL_CLASS_INSTANCES){ctr.prototype[goog.UNSEALABLE_CONSTRUCTOR_PROPERTY_]=!0}};goog.UNSEALABLE_CONSTRUCTOR_PROPERTY_='goog_defineClass_legacy_unsealable';goog.provide('box2d.b2Settings');if(!Object.defineProperty){Object.defineProperty=function(obj,name,options){if(Object.__defineGetter__){if('get' in options){obj.__defineGetter__(name,options.get)}
else if('value' in options){obj.__defineGetter__(name,options.value)}}
if(Object.__defineSetter__){if('set' in options){obj.__defineSetter__(name,options.set)}
else if('value' in options){obj.__defineSetter__(name,options.value)}}}}
box2d.DEBUG=!1;box2d.ENABLE_ASSERTS=box2d.DEBUG;box2d.b2Assert=function(condition,opt_message,var_args){if(box2d.DEBUG){if(!condition){debugger}}}
box2d.b2_maxFloat=1E+37;box2d.b2_epsilon=1E-5;box2d.b2_epsilon_sq=(box2d.b2_epsilon*box2d.b2_epsilon);box2d.b2_pi=Math.PI;box2d.b2_maxManifoldPoints=2;box2d.b2_maxPolygonVertices=8;box2d.b2_aabbExtension=0.1;box2d.b2_aabbMultiplier=2;box2d.b2_linearSlop=0.008;box2d.b2_angularSlop=2/180*box2d.b2_pi;box2d.b2_polygonRadius=2*box2d.b2_linearSlop;box2d.b2_maxSubSteps=8;box2d.b2_maxTOIContacts=32;box2d.b2_velocityThreshold=1;box2d.b2_maxLinearCorrection=0.2;box2d.b2_maxAngularCorrection=8/180*box2d.b2_pi;box2d.b2_maxTranslation=2;box2d.b2_maxTranslationSquared=box2d.b2_maxTranslation*box2d.b2_maxTranslation;box2d.b2_maxRotation=0.5*box2d.b2_pi;box2d.b2_maxRotationSquared=box2d.b2_maxRotation*box2d.b2_maxRotation;box2d.b2_baumgarte=0.2;box2d.b2_toiBaumgarte=0.75;box2d.b2_timeToSleep=0.5;box2d.b2_linearSleepTolerance=0.01;box2d.b2_angularSleepTolerance=2/180*box2d.b2_pi;box2d.b2Alloc=function(size){return null}
box2d.b2Free=function(mem){}
box2d.b2Log=function(var_args){goog.global.console.log.apply(null,arguments)}
box2d.b2Version=function(major,minor,revision){this.major=major||0;this.minor=minor||0;this.revision=revision||0};box2d.b2Version.prototype.major=0;box2d.b2Version.prototype.minor=0;box2d.b2Version.prototype.revision=0;box2d.b2Version.prototype.toString=function(){return this.major+"."+this.minor+"."+this.revision}
box2d.b2_version=new box2d.b2Version(2,3,0);box2d.b2_changelist=278;box2d.b2ParseInt=function(v){return parseInt(v,10)}
box2d.b2ParseUInt=function(v){return box2d.b2Abs(parseInt(v,10))}
box2d.b2MakeArray=function(length,init){if(length===undefined)length=0;var a=new Array(length);if(init!==undefined){for(var i=0;i<length;++i){a[i]=init(i)}}
return a}
box2d.b2MakeNumberArray=function(length){return box2d.b2MakeArray(length,function(i){return 0})}
goog.provide('box2d.b2Math');goog.require('box2d.b2Settings');box2d.b2_pi_over_180=box2d.b2_pi/180.0;box2d.b2_180_over_pi=180.0/box2d.b2_pi;box2d.b2_two_pi=2.0*box2d.b2_pi;box2d.b2Abs=function(n){return(n<0)?(-n):(n)}
box2d.b2Min=function(a,b){return(a<b)?(a):(b)}
box2d.b2Max=function(a,b){return(a>b)?(a):(b)}
box2d.b2Clamp=function(a,lo,hi){return(a<lo)?(lo):((a>hi)?(hi):(a))}
box2d.b2Swap=function(a,b){if(box2d.ENABLE_ASSERTS){box2d.b2Assert(!1)}
var tmp=a[0];a[0]=b[0];b[0]=tmp}
box2d.b2IsValid=function(n){return isFinite(n)}
box2d.b2Sq=function(n){return n*n}
box2d.b2InvSqrt=function(n){return 1/Math.sqrt(n)}
box2d.b2Sqrt=function(n){return Math.sqrt(n)}
box2d.b2Pow=function(x,y){return Math.pow(x,y)}
box2d.b2DegToRad=function(degrees){return degrees*box2d.b2_pi_over_180}
box2d.b2RadToDeg=function(radians){return radians*box2d.b2_180_over_pi}
box2d.b2Cos=function(radians){return Math.cos(radians)}
box2d.b2Sin=function(radians){return Math.sin(radians)}
box2d.b2Acos=function(n){return Math.acos(n)}
box2d.b2Asin=function(n){return Math.asin(n)}
box2d.b2Atan2=function(y,x){return Math.atan2(y,x)}
box2d.b2NextPowerOfTwo=function(x){x|=(x>>1)&0x7FFFFFFF;x|=(x>>2)&0x3FFFFFFF;x|=(x>>4)&0x0FFFFFFF;x|=(x>>8)&0x00FFFFFF;x|=(x>>16)&0x0000FFFF;return x+1}
box2d.b2IsPowerOfTwo=function(x){return x>0&&(x&(x-1))===0}
box2d.b2Random=function(){return Math.random()*2.0-1.0}
box2d.b2RandomRange=function(lo,hi){return(hi-lo)*Math.random()+lo}
box2d.b2Vec2=function(x,y){this.x=x||0.0;this.y=y||0.0}
box2d.b2Vec2.prototype.x=0.0;box2d.b2Vec2.prototype.y=0.0;box2d.b2Vec2_zero=new box2d.b2Vec2();box2d.b2Vec2.ZERO=new box2d.b2Vec2();box2d.b2Vec2.UNITX=new box2d.b2Vec2(1.0,0.0);box2d.b2Vec2.UNITY=new box2d.b2Vec2(0.0,1.0);box2d.b2Vec2.s_t0=new box2d.b2Vec2();box2d.b2Vec2.s_t1=new box2d.b2Vec2();box2d.b2Vec2.s_t2=new box2d.b2Vec2();box2d.b2Vec2.s_t3=new box2d.b2Vec2();box2d.b2Vec2.MakeArray=function(length){return box2d.b2MakeArray(length,function(i){return new box2d.b2Vec2()})}
box2d.b2Vec2.prototype.Clone=function(){return new box2d.b2Vec2(this.x,this.y)}
box2d.b2Vec2.prototype.SetZero=function(){this.x=0.0;this.y=0.0;return this}
box2d.b2Vec2.prototype.SetXY=function(x,y){this.x=x;this.y=y;return this}
box2d.b2Vec2.prototype.Copy=function(other){this.x=other.x;this.y=other.y;return this}
box2d.b2Vec2.prototype.SelfAdd=function(v){this.x+=v.x;this.y+=v.y;return this}
box2d.b2Vec2.prototype.SelfAddXY=function(x,y){this.x+=x;this.y+=y;return this}
box2d.b2Vec2.prototype.SelfSub=function(v){this.x-=v.x;this.y-=v.y;return this}
box2d.b2Vec2.prototype.SelfSubXY=function(x,y){this.x-=x;this.y-=y;return this}
box2d.b2Vec2.prototype.SelfMul=function(s){this.x*=s;this.y*=s;return this}
box2d.b2Vec2.prototype.SelfMulAdd=function(s,v){this.x+=s*v.x;this.y+=s*v.y;return this}
box2d.b2Vec2.prototype.SelfMulSub=function(s,v){this.x-=s*v.x;this.y-=s*v.y;return this}
box2d.b2Vec2.prototype.Dot=function(v){return this.x*v.x+this.y*v.y}
box2d.b2Vec2.prototype.Cross=function(v){return this.x*v.y-this.y*v.x}
box2d.b2Vec2.prototype.Length=function(){var x=this.x,y=this.y;return Math.sqrt(x*x+y*y)}
box2d.b2Vec2.prototype.GetLength=box2d.b2Vec2.prototype.Length;box2d.b2Vec2.prototype.LengthSquared=function(){var x=this.x,y=this.y;return(x*x+y*y)}
box2d.b2Vec2.prototype.GetLengthSquared=box2d.b2Vec2.prototype.LengthSquared;box2d.b2Vec2.prototype.Normalize=function(){var length=this.GetLength();if(length>=box2d.b2_epsilon){var inv_length=1.0/length;this.x*=inv_length;this.y*=inv_length}
return length}
box2d.b2Vec2.prototype.SelfNormalize=function(){var length=this.GetLength();if(length>=box2d.b2_epsilon){var inv_length=1.0/length;this.x*=inv_length;this.y*=inv_length}
return this}
box2d.b2Vec2.prototype.SelfRotate=function(c,s){var x=this.x,y=this.y;this.x=c*x-s*y;this.y=s*x+c*y;return this}
box2d.b2Vec2.prototype.SelfRotateRadians=function(radians){return this.SelfRotate(Math.cos(radians),Math.sin(radians))}
box2d.b2Vec2.prototype.SelfRotateDegrees=function(degrees){return this.SelfRotateRadians(box2d.b2DegToRad(degrees))}
box2d.b2Vec2.prototype.IsValid=function(){return isFinite(this.x)&&isFinite(this.y)}
box2d.b2Vec2.prototype.SelfCrossVS=function(s){var x=this.x;this.x=s*this.y;this.y=-s*x;return this}
box2d.b2Vec2.prototype.SelfCrossSV=function(s){var x=this.x;this.x=-s*this.y;this.y=s*x;return this}
box2d.b2Vec2.prototype.SelfMinV=function(v){this.x=box2d.b2Min(this.x,v.x);this.y=box2d.b2Min(this.y,v.y);return this}
box2d.b2Vec2.prototype.SelfMaxV=function(v){this.x=box2d.b2Max(this.x,v.x);this.y=box2d.b2Max(this.y,v.y);return this}
box2d.b2Vec2.prototype.SelfAbs=function(){this.x=box2d.b2Abs(this.x);this.y=box2d.b2Abs(this.y);return this}
box2d.b2Vec2.prototype.SelfNeg=function(){this.x=(-this.x);this.y=(-this.y);return this}
box2d.b2Vec2.prototype.SelfSkew=function(){var x=this.x;this.x=-this.y;this.y=x;return this}
box2d.b2AbsV=function(v,out){out.x=box2d.b2Abs(v.x);out.y=box2d.b2Abs(v.y);return out}
box2d.b2MinV=function(a,b,out){out.x=box2d.b2Min(a.x,b.x);out.y=box2d.b2Min(a.y,b.y);return out}
box2d.b2MaxV=function(a,b,out){out.x=box2d.b2Max(a.x,b.x);out.y=box2d.b2Max(a.y,b.y);return out}
box2d.b2ClampV=function(v,lo,hi,out){out.x=box2d.b2Clamp(v.x,lo.x,hi.x);out.y=box2d.b2Clamp(v.y,lo.y,hi.y);return out}
box2d.b2RotateV=function(v,c,s,out){var v_x=v.x,v_y=v.y;out.x=c*v_x-s*v_y;out.y=s*v_x+c*v_y;return out}
box2d.b2RotateRadiansV=function(v,radians,out){return box2d.b2RotateV(v,Math.cos(radians),Math.sin(radians),out)}
box2d.b2RotateDegreesV=function(v,degrees,out){return box2d.b2RotateRadiansV(v,box2d.b2DegToRad(degrees),out)}
box2d.b2DotVV=function(a,b){return a.x*b.x+a.y*b.y}
box2d.b2CrossVV=function(a,b){return a.x*b.y-a.y*b.x}
box2d.b2CrossVS=function(v,s,out){var v_x=v.x;out.x=s*v.y;out.y=-s*v_x;return out}
box2d.b2CrossVOne=function(v,out){var v_x=v.x;out.x=v.y;out.y=-v_x;return out}
box2d.b2CrossSV=function(s,v,out){var v_x=v.x;out.x=-s*v.y;out.y=s*v_x;return out}
box2d.b2CrossOneV=function(v,out){var v_x=v.x;out.x=-v.y;out.y=v_x;return out}
box2d.b2AddVV=function(a,b,out){out.x=a.x+b.x;out.y=a.y+b.y;return out}
box2d.b2SubVV=function(a,b,out){out.x=a.x-b.x;out.y=a.y-b.y;return out}
box2d.b2MulSV=function(s,v,out){out.x=v.x*s;out.y=v.y*s;return out}
box2d.b2AddVMulSV=function(a,s,b,out){out.x=a.x+(s*b.x);out.y=a.y+(s*b.y);return out}
box2d.b2SubVMulSV=function(a,s,b,out){out.x=a.x-(s*b.x);out.y=a.y-(s*b.y);return out}
box2d.b2AddVCrossSV=function(a,s,v,out){var v_x=v.x;out.x=a.x-(s*v.y);out.y=a.y+(s*v_x);return out}
box2d.b2MidVV=function(a,b,out){out.x=(a.x+b.x)*0.5;out.y=(a.y+b.y)*0.5;return out}
box2d.b2ExtVV=function(a,b,out){out.x=(b.x-a.x)*0.5;out.y=(b.y-a.y)*0.5;return out}
box2d.b2IsEqualToV=function(a,b){return a.x===b.x&&a.y===b.y}
box2d.b2DistanceVV=function(a,b){var c_x=a.x-b.x;var c_y=a.y-b.y;return Math.sqrt(c_x*c_x+c_y*c_y)}
box2d.b2DistanceSquaredVV=function(a,b){var c_x=a.x-b.x;var c_y=a.y-b.y;return(c_x*c_x+c_y*c_y)}
box2d.b2NegV=function(v,out){out.x=-v.x;out.y=-v.y;return out}
box2d.b2Vec3=function(x,y,z){this.x=x||0.0;this.y=y||0.0;this.z=z||0.0}
box2d.b2Vec3.prototype.x=0.0;box2d.b2Vec3.prototype.y=0.0;box2d.b2Vec3.prototype.z=0.0;box2d.b2Vec3.ZERO=new box2d.b2Vec3();box2d.b2Vec3.s_t0=new box2d.b2Vec3();box2d.b2Vec3.prototype.Clone=function(){return new box2d.b2Vec3(this.x,this.y,this.z)}
box2d.b2Vec3.prototype.SetZero=function(){this.x=0.0;this.y=0.0;this.z=0.0;return this}
box2d.b2Vec3.prototype.SetXYZ=function(x,y,z){this.x=x;this.y=y;this.z=z;return this}
box2d.b2Vec3.prototype.Copy=function(other){this.x=other.x;this.y=other.y;this.z=other.z;return this}
box2d.b2Vec3.prototype.SelfNeg=function(){this.x=(-this.x);this.y=(-this.y);this.z=(-this.z);return this}
box2d.b2Vec3.prototype.SelfAdd=function(v){this.x+=v.x;this.y+=v.y;this.z+=v.z;return this}
box2d.b2Vec3.prototype.SelfAddXYZ=function(x,y,z){this.x+=x;this.y+=y;this.z+=z;return this}
box2d.b2Vec3.prototype.SelfSub=function(v){this.x-=v.x;this.y-=v.y;this.z-=v.z;return this}
box2d.b2Vec3.prototype.SelfSubXYZ=function(x,y,z){this.x-=x;this.y-=y;this.z-=z;return this}
box2d.b2Vec3.prototype.SelfMul=function(s){this.x*=s;this.y*=s;this.z*=s;return this}
box2d.b2DotV3V3=function(a,b){return a.x*b.x+a.y*b.y+a.z*b.z}
box2d.b2CrossV3V3=function(a,b,out){var a_x=a.x,a_y=a.y,a_z=a.z;var b_x=b.x,b_y=b.y,b_z=b.z;out.x=a_y*b_z-a_z*b_y;out.y=a_z*b_x-a_x*b_z;out.z=a_x*b_y-a_y*b_x;return out}
box2d.b2Mat22=function(){this.ex=new box2d.b2Vec2(1.0,0.0);this.ey=new box2d.b2Vec2(0.0,1.0)}
box2d.b2Mat22.prototype.ex=null;box2d.b2Mat22.prototype.ey=null;box2d.b2Mat22.IDENTITY=new box2d.b2Mat22();box2d.b2Mat22.prototype.Clone=function(){return new box2d.b2Mat22().Copy(this)}
box2d.b2Mat22.FromVV=function(c1,c2){return new box2d.b2Mat22().SetVV(c1,c2)}
box2d.b2Mat22.FromSSSS=function(r1c1,r1c2,r2c1,r2c2){return new box2d.b2Mat22().SetSSSS(r1c1,r1c2,r2c1,r2c2)}
box2d.b2Mat22.FromAngleRadians=function(radians){return new box2d.b2Mat22().SetAngleRadians(radians)}
box2d.b2Mat22.prototype.SetSSSS=function(r1c1,r1c2,r2c1,r2c2){this.ex.SetXY(r1c1,r2c1);this.ey.SetXY(r1c2,r2c2);return this}
box2d.b2Mat22.prototype.SetVV=function(c1,c2){this.ex.Copy(c1);this.ey.Copy(c2);return this}
box2d.b2Mat22.prototype.SetAngle=function(radians){var c=Math.cos(radians);var s=Math.sin(radians);this.ex.SetXY(c,s);this.ey.SetXY(-s,c);return this}
box2d.b2Mat22.prototype.SetAngleRadians=box2d.b2Mat22.prototype.SetAngle;box2d.b2Mat22.prototype.SetAngleDegrees=function(angle){return this.SetAngle(box2d.b2DegToRad(angle))}
box2d.b2Mat22.prototype.Copy=function(other){this.ex.Copy(other.ex);this.ey.Copy(other.ey);return this}
box2d.b2Mat22.prototype.SetIdentity=function(){this.ex.SetXY(1.0,0.0);this.ey.SetXY(0.0,1.0);return this}
box2d.b2Mat22.prototype.SetZero=function(){this.ex.SetZero();this.ey.SetZero();return this}
box2d.b2Mat22.prototype.GetAngle=function(){return Math.atan2(this.ex.y,this.ex.x)}
box2d.b2Mat22.prototype.GetAngleRadians=box2d.b2Mat22.prototype.GetAngle;box2d.b2Mat22.prototype.GetInverse=function(out){var a=this.ex.x;var b=this.ey.x;var c=this.ex.y;var d=this.ey.y;var det=a*d-b*c;if(det!==0.0){det=1.0/det}
out.ex.x=det*d;out.ey.x=(-det*b);out.ex.y=(-det*c);out.ey.y=det*a;return out}
box2d.b2Mat22.prototype.Solve=function(b_x,b_y,out){var a11=this.ex.x,a12=this.ey.x;var a21=this.ex.y,a22=this.ey.y;var det=a11*a22-a12*a21;if(det!==0.0){det=1.0/det}
out.x=det*(a22*b_x-a12*b_y);out.y=det*(a11*b_y-a21*b_x);return out}
box2d.b2Mat22.prototype.SelfAbs=function(){this.ex.SelfAbs();this.ey.SelfAbs();return this}
box2d.b2Mat22.prototype.SelfInv=function(){return this.GetInverse(this)}
box2d.b2Mat22.prototype.SelfAddM=function(M){this.ex.SelfAdd(M.ex);this.ey.SelfAdd(M.ey);return this}
box2d.b2Mat22.prototype.SelfSubM=function(M){this.ex.SelfSub(M.ex);this.ey.SelfSub(M.ey);return this}
box2d.b2AbsM=function(M,out){var M_ex=M.ex,M_ey=M.ey;out.ex.x=box2d.b2Abs(M_ex.x);out.ex.y=box2d.b2Abs(M_ex.y);out.ey.x=box2d.b2Abs(M_ey.x);out.ey.y=box2d.b2Abs(M_ey.y);return out}
box2d.b2MulMV=function(M,v,out){var M_ex=M.ex,M_ey=M.ey;var v_x=v.x,v_y=v.y;out.x=M_ex.x*v_x+M_ey.x*v_y;out.y=M_ex.y*v_x+M_ey.y*v_y;return out}
box2d.b2MulTMV=function(M,v,out){var M_ex=M.ex,M_ey=M.ey;var v_x=v.x,v_y=v.y;out.x=M_ex.x*v_x+M_ex.y*v_y;out.y=M_ey.x*v_x+M_ey.y*v_y;return out}
box2d.b2AddMM=function(A,B,out){var A_ex=A.ex,A_ey=A.ey;var B_ex=B.ex,B_ey=B.ey;out.ex.x=A_ex.x+B_ex.x;out.ex.y=A_ex.y+B_ex.y;out.ey.x=A_ey.x+B_ey.x;out.ey.y=A_ey.y+B_ey.y;return out}
box2d.b2MulMM=function(A,B,out){var A_ex_x=A.ex.x,A_ex_y=A.ex.y;var A_ey_x=A.ey.x,A_ey_y=A.ey.y;var B_ex_x=B.ex.x,B_ex_y=B.ex.y;var B_ey_x=B.ey.x,B_ey_y=B.ey.y;out.ex.x=A_ex_x*B_ex_x+A_ey_x*B_ex_y;out.ex.y=A_ex_y*B_ex_x+A_ey_y*B_ex_y;out.ey.x=A_ex_x*B_ey_x+A_ey_x*B_ey_y;out.ey.y=A_ex_y*B_ey_x+A_ey_y*B_ey_y;return out}
box2d.b2MulTMM=function(A,B,out){var A_ex_x=A.ex.x,A_ex_y=A.ex.y;var A_ey_x=A.ey.x,A_ey_y=A.ey.y;var B_ex_x=B.ex.x,B_ex_y=B.ex.y;var B_ey_x=B.ey.x,B_ey_y=B.ey.y;out.ex.x=A_ex_x*B_ex_x+A_ex_y*B_ex_y;out.ex.y=A_ey_x*B_ex_x+A_ey_y*B_ex_y;out.ey.x=A_ex_x*B_ey_x+A_ex_y*B_ey_y;out.ey.y=A_ey_x*B_ey_x+A_ey_y*B_ey_y;return out}
box2d.b2Mat33=function(){this.ex=new box2d.b2Vec3(1.0,0.0,0.0);this.ey=new box2d.b2Vec3(0.0,1.0,0.0);this.ez=new box2d.b2Vec3(0.0,0.0,1.0)}
box2d.b2Mat33.prototype.ex=null;box2d.b2Mat33.prototype.ey=null;box2d.b2Mat33.prototype.ez=null;box2d.b2Mat33.IDENTITY=new box2d.b2Mat33();box2d.b2Mat33.prototype.Clone=function(){return new box2d.b2Mat33().Copy(this)}
box2d.b2Mat33.prototype.SetVVV=function(c1,c2,c3){this.ex.Copy(c1);this.ey.Copy(c2);this.ez.Copy(c3);return this}
box2d.b2Mat33.prototype.Copy=function(other){this.ex.Copy(other.ex);this.ey.Copy(other.ey);this.ez.Copy(other.ez);return this}
box2d.b2Mat33.prototype.SetIdentity=function(){this.ex.SetXYZ(1.0,0.0,0.0);this.ey.SetXYZ(0.0,1.0,0.0);this.ez.SetXYZ(0.0,0.0,1.0);return this}
box2d.b2Mat33.prototype.SetZero=function(){this.ex.SetZero();this.ey.SetZero();this.ez.SetZero();return this}
box2d.b2Mat33.prototype.SelfAddM=function(M){this.ex.SelfAdd(M.ex);this.ey.SelfAdd(M.ey);this.ez.SelfAdd(M.ez);return this}
box2d.b2Mat33.prototype.Solve33=function(b_x,b_y,b_z,out){var a11=this.ex.x,a21=this.ex.y,a31=this.ex.z;var a12=this.ey.x,a22=this.ey.y,a32=this.ey.z;var a13=this.ez.x,a23=this.ez.y,a33=this.ez.z;var det=a11*(a22*a33-a32*a23)+a21*(a32*a13-a12*a33)+a31*(a12*a23-a22*a13);if(det!==0.0){det=1.0/det}
out.x=det*(b_x*(a22*a33-a32*a23)+b_y*(a32*a13-a12*a33)+b_z*(a12*a23-a22*a13));out.y=det*(a11*(b_y*a33-b_z*a23)+a21*(b_z*a13-b_x*a33)+a31*(b_x*a23-b_y*a13));out.z=det*(a11*(a22*b_z-a32*b_y)+a21*(a32*b_x-a12*b_z)+a31*(a12*b_y-a22*b_x));return out}
box2d.b2Mat33.prototype.Solve22=function(b_x,b_y,out){var a11=this.ex.x,a12=this.ey.x;var a21=this.ex.y,a22=this.ey.y;var det=a11*a22-a12*a21;if(det!==0.0){det=1.0/det}
out.x=det*(a22*b_x-a12*b_y);out.y=det*(a11*b_y-a21*b_x);return out}
box2d.b2Mat33.prototype.GetInverse22=function(M){var a=this.ex.x,b=this.ey.x,c=this.ex.y,d=this.ey.y;var det=a*d-b*c;if(det!==0.0){det=1.0/det}
M.ex.x=det*d;M.ey.x=-det*b;M.ex.z=0.0;M.ex.y=-det*c;M.ey.y=det*a;M.ey.z=0.0;M.ez.x=0.0;M.ez.y=0.0;M.ez.z=0.0}
box2d.b2Mat33.prototype.GetSymInverse33=function(M){var det=box2d.b2DotV3V3(this.ex,box2d.b2CrossV3V3(this.ey,this.ez,box2d.b2Vec3.s_t0));if(det!==0.0){det=1.0/det}
var a11=this.ex.x,a12=this.ey.x,a13=this.ez.x;var a22=this.ey.y,a23=this.ez.y;var a33=this.ez.z;M.ex.x=det*(a22*a33-a23*a23);M.ex.y=det*(a13*a23-a12*a33);M.ex.z=det*(a12*a23-a13*a22);M.ey.x=M.ex.y;M.ey.y=det*(a11*a33-a13*a13);M.ey.z=det*(a13*a12-a11*a23);M.ez.x=M.ex.z;M.ez.y=M.ey.z;M.ez.z=det*(a11*a22-a12*a12)}
box2d.b2MulM33V3=function(A,v,out){var v_x=v.x,v_y=v.y,v_z=v.z;out.x=A.ex.x*v_x+A.ey.x*v_y+A.ez.x*v_z;out.y=A.ex.y*v_x+A.ey.y*v_y+A.ez.y*v_z;out.z=A.ex.z*v_x+A.ey.z*v_y+A.ez.z*v_z;return out}
box2d.b2MulM33XYZ=function(A,x,y,z,out){out.x=A.ex.x*x+A.ey.x*y+A.ez.x*z;out.y=A.ex.y*x+A.ey.y*y+A.ez.y*z;out.z=A.ex.z*x+A.ey.z*y+A.ez.z*z;return out}
box2d.b2MulM33V2=function(A,v,out){var v_x=v.x,v_y=v.y;out.x=A.ex.x*v_x+A.ey.x*v_y;out.y=A.ex.y*v_x+A.ey.y*v_y;return out}
box2d.b2MulM33XY=function(A,x,y,out){out.x=A.ex.x*x+A.ey.x*y;out.y=A.ex.y*x+A.ey.y*y;return out}
box2d.b2Rot=function(angle){if(angle){this.angle=angle;this.s=Math.sin(angle);this.c=Math.cos(angle)}}
box2d.b2Rot.prototype.angle=0.0;box2d.b2Rot.prototype.s=0.0;box2d.b2Rot.prototype.c=1.0;box2d.b2Rot.IDENTITY=new box2d.b2Rot();box2d.b2Rot.prototype.Clone=function(){return new box2d.b2Rot().Copy(this)}
box2d.b2Rot.prototype.Copy=function(other){this.angle=other.angle;this.s=other.s;this.c=other.c;return this}
box2d.b2Rot.prototype.SetAngle=function(angle){if(this.angle!==angle){this.angle=angle;this.s=Math.sin(angle);this.c=Math.cos(angle)}
return this}
box2d.b2Rot.prototype.SetAngleRadians=box2d.b2Rot.prototype.SetAngle;box2d.b2Rot.prototype.SetAngleDegrees=function(angle){return this.SetAngle(box2d.b2DegToRad(angle))}
box2d.b2Rot.prototype.SetIdentity=function(){this.angle=0.0;this.s=0.0;this.c=1.0;return this}
box2d.b2Rot.prototype.GetAngle=function(){return this.angle}
box2d.b2Rot.prototype.GetAngleRadians=box2d.b2Rot.prototype.GetAngle;box2d.b2Rot.prototype.GetAngleDegrees=function(){return box2d.b2RadToDeg(this.GetAngle())}
box2d.b2Rot.prototype.GetXAxis=function(out){out.x=this.c;out.y=this.s;return out}
box2d.b2Rot.prototype.GetYAxis=function(out){out.x=-this.s;out.y=this.c;return out}
box2d.b2MulRR=function(q,r,out){var q_c=q.c,q_s=q.s;var r_c=r.c,r_s=r.s;out.s=q_s*r_c+q_c*r_s;out.c=q_c*r_c-q_s*r_s;out.angle=q.angle+r.angle;while(out.angle<-box2d.b2_pi){out.angle+=box2d.b2_two_pi}
while(out.angle>=box2d.b2_pi){out.angle-=box2d.b2_two_pi}
return out}
box2d.b2MulTRR=function(q,r,out){var q_c=q.c,q_s=q.s;var r_c=r.c,r_s=r.s;out.s=q_c*r_s-q_s*r_c;out.c=q_c*r_c+q_s*r_s;out.angle=q.angle-r.angle;while(out.angle<-box2d.b2_pi){out.angle+=box2d.b2_two_pi}
while(out.angle>=box2d.b2_pi){out.angle-=box2d.b2_two_pi}
return out}
box2d.b2MulRV=function(q,v,out){var q_c=q.c,q_s=q.s;var v_x=v.x,v_y=v.y;out.x=q_c*v_x-q_s*v_y;out.y=q_s*v_x+q_c*v_y;return out}
box2d.b2MulTRV=function(q,v,out){var q_c=q.c,q_s=q.s;var v_x=v.x,v_y=v.y;out.x=q_c*v_x+q_s*v_y;out.y=-q_s*v_x+q_c*v_y;return out}
box2d.b2Transform=function(){this.p=new box2d.b2Vec2();this.q=new box2d.b2Rot()}
box2d.b2Transform.prototype.p=null;box2d.b2Transform.prototype.q=null;box2d.b2Transform.IDENTITY=new box2d.b2Transform();box2d.b2Transform.prototype.Clone=function(){return new box2d.b2Transform().Copy(this)}
box2d.b2Transform.prototype.Copy=function(other){this.p.Copy(other.p);this.q.Copy(other.q);return this}
box2d.b2Transform.prototype.SetIdentity=function(){this.p.SetZero();this.q.SetIdentity();return this}
box2d.b2Transform.prototype.SetPositionRotation=function(position,q){this.p.Copy(position);this.q.Copy(q);return this}
box2d.b2Transform.prototype.SetPositionAngleRadians=function(pos,a){this.p.Copy(pos);this.q.SetAngleRadians(a);return this}
box2d.b2Transform.prototype.SetPosition=function(position){this.p.Copy(position);return this}
box2d.b2Transform.prototype.SetPositionXY=function(x,y){this.p.SetXY(x,y);return this}
box2d.b2Transform.prototype.SetRotation=function(rotation){this.q.Copy(rotation);return this}
box2d.b2Transform.prototype.SetRotationAngleRadians=function(radians){this.q.SetAngleRadians(radians);return this}
box2d.b2Transform.prototype.GetPosition=function(){return this.p}
box2d.b2Transform.prototype.GetRotation=function(){return this.q}
box2d.b2Transform.prototype.GetRotationAngle=function(){return this.q.GetAngle()}
box2d.b2Transform.prototype.GetRotationAngleRadians=box2d.b2Transform.prototype.GetRotationAngle;box2d.b2Transform.prototype.GetAngle=function(){return this.q.GetAngle()}
box2d.b2Transform.prototype.GetAngleRadians=box2d.b2Transform.prototype.GetAngle;box2d.b2MulXV=function(T,v,out){var T_q_c=T.q.c,T_q_s=T.q.s;var v_x=v.x,v_y=v.y;out.x=(T_q_c*v_x-T_q_s*v_y)+T.p.x;out.y=(T_q_s*v_x+T_q_c*v_y)+T.p.y;return out}
box2d.b2MulTXV=function(T,v,out){var T_q_c=T.q.c,T_q_s=T.q.s;var p_x=v.x-T.p.x;var p_y=v.y-T.p.y;out.x=(T_q_c*p_x+T_q_s*p_y);out.y=(-T_q_s*p_x+T_q_c*p_y);return out}
box2d.b2MulXX=function(A,B,out){box2d.b2MulRR(A.q,B.q,out.q);box2d.b2AddVV(box2d.b2MulRV(A.q,B.p,out.p),A.p,out.p);return out}
box2d.b2MulTXX=function(A,B,out){box2d.b2MulTRR(A.q,B.q,out.q);box2d.b2MulTRV(A.q,box2d.b2SubVV(B.p,A.p,out.p),out.p);return out}
box2d.b2Sweep=function(){this.localCenter=new box2d.b2Vec2();this.c0=new box2d.b2Vec2();this.c=new box2d.b2Vec2()};box2d.b2Sweep.prototype.localCenter=null;box2d.b2Sweep.prototype.c0=null;box2d.b2Sweep.prototype.c=null;box2d.b2Sweep.prototype.a0=0.0;box2d.b2Sweep.prototype.a=0.0;box2d.b2Sweep.prototype.alpha0=0.0;box2d.b2Sweep.prototype.Clone=function(){return new box2d.b2Sweep().Copy(this)}
box2d.b2Sweep.prototype.Copy=function(other){this.localCenter.Copy(other.localCenter);this.c0.Copy(other.c0);this.c.Copy(other.c);this.a0=other.a0;this.a=other.a;this.alpha0=other.alpha0;return this}
box2d.b2Sweep.prototype.GetTransform=function(xf,beta){var one_minus_beta=(1.0-beta);xf.p.x=one_minus_beta*this.c0.x+beta*this.c.x;xf.p.y=one_minus_beta*this.c0.y+beta*this.c.y;var angle=one_minus_beta*this.a0+beta*this.a;xf.q.SetAngleRadians(angle);xf.p.SelfSub(box2d.b2MulRV(xf.q,this.localCenter,box2d.b2Vec2.s_t0));return xf}
box2d.b2Sweep.prototype.Advance=function(alpha){if(box2d.ENABLE_ASSERTS){box2d.b2Assert(this.alpha0<1.0)}
var beta=(alpha-this.alpha0)/(1.0-this.alpha0);this.c0.x+=beta*(this.c.x-this.c0.x);this.c0.y+=beta*(this.c.y-this.c0.y);this.a0+=beta*(this.a-this.a0);this.alpha0=alpha}
box2d.b2Sweep.prototype.Normalize=function(){var d=box2d.b2_two_pi*Math.floor(this.a0/box2d.b2_two_pi);this.a0-=d;this.a-=d}
goog.provide('box2d.b2Controller');goog.require('box2d.b2Settings');box2d.b2ControllerEdge=function(){};box2d.b2ControllerEdge.prototype.controller=null;box2d.b2ControllerEdge.prototype.body=null;box2d.b2ControllerEdge.prototype.prevBody=null;box2d.b2ControllerEdge.prototype.nextBody=null;box2d.b2ControllerEdge.prototype.prevController=null;box2d.b2ControllerEdge.prototype.nextController=null;box2d.b2Controller=function(){};box2d.b2Controller.prototype.m_world=null;box2d.b2Controller.prototype.m_bodyList=null;box2d.b2Controller.prototype.m_bodyCount=0;box2d.b2Controller.prototype.m_prev=null;box2d.b2Controller.prototype.m_next=null;box2d.b2Controller.prototype.Step=function(step){}
box2d.b2Controller.prototype.Draw=function(debugDraw){}
box2d.b2Controller.prototype.GetNext=function(){return this.m_next}
box2d.b2Controller.prototype.GetPrev=function(){return this.m_prev}
box2d.b2Controller.prototype.GetWorld=function(){return this.m_world}
box2d.b2Controller.prototype.GetBodyList=function(){return this.m_bodyList}
box2d.b2Controller.prototype.AddBody=function(body){var edge=new box2d.b2ControllerEdge();edge.body=body;edge.controller=this;edge.nextBody=this.m_bodyList;edge.prevBody=null;if(this.m_bodyList)
this.m_bodyList.prevBody=edge;this.m_bodyList=edge;++this.m_bodyCount;edge.nextController=body.m_controllerList;edge.prevController=null;if(body.m_controllerList)
body.m_controllerList.prevController=edge;body.m_controllerList=edge;++body.m_controllerCount}
box2d.b2Controller.prototype.RemoveBody=function(body){if(box2d.ENABLE_ASSERTS){box2d.b2Assert(this.m_bodyCount>0)}
var edge=this.m_bodyList;while(edge&&edge.body!==body)
edge=edge.nextBody;if(box2d.ENABLE_ASSERTS){box2d.b2Assert(edge!==null)}
if(edge.prevBody)
edge.prevBody.nextBody=edge.nextBody;if(edge.nextBody)
edge.nextBody.prevBody=edge.prevBody;if(this.m_bodyList===edge)
this.m_bodyList=edge.nextBody;--this.m_bodyCount;if(edge.nextController)
edge.nextController.prevController=edge.prevController;if(edge.prevController)
edge.prevController.nextController=edge.nextController;if(body.m_controllerList===edge)
body.m_controllerList=edge.nextController;--body.m_controllerCount}
box2d.b2Controller.prototype.Clear=function(){while(this.m_bodyList){this.RemoveBody(this.m_bodyList.body)}
this.m_bodyCount=0}
goog.provide('box2d.b2ConstantAccelController');goog.require('box2d.b2Settings');goog.require('box2d.b2Controller');goog.require('box2d.b2Math');box2d.b2ConstantAccelController=function(){goog.base(this);this.A=new box2d.b2Vec2(0,0)};goog.inherits(box2d.b2ConstantAccelController,box2d.b2Controller);box2d.b2ConstantAccelController.prototype.A=null;box2d.b2ConstantAccelController.prototype.Step=function(step){var dtA=box2d.b2MulSV(step.dt,this.A,box2d.b2ConstantAccelController.prototype.Step.s_dtA);for(var i=this.m_bodyList;i;i=i.nextBody){var body=i.body;if(!body.IsAwake())
continue;body.SetLinearVelocity(box2d.b2AddVV(body.GetLinearVelocity(),dtA,box2d.b2Vec2.s_t0))}}
box2d.b2ConstantAccelController.prototype.Step.s_dtA=new box2d.b2Vec2();goog.provide('box2d.b2Joint');goog.require('box2d.b2Settings');goog.require('box2d.b2Math');box2d.b2JointType={e_unknownJoint:0,e_revoluteJoint:1,e_prismaticJoint:2,e_distanceJoint:3,e_pulleyJoint:4,e_mouseJoint:5,e_gearJoint:6,e_wheelJoint:7,e_weldJoint:8,e_frictionJoint:9,e_ropeJoint:10,e_motorJoint:11,e_areaJoint:12};goog.exportProperty(box2d.b2JointType,'e_unknownJoint',box2d.b2JointType.e_unknownJoint);goog.exportProperty(box2d.b2JointType,'e_revoluteJoint',box2d.b2JointType.e_revoluteJoint);goog.exportProperty(box2d.b2JointType,'e_prismaticJoint',box2d.b2JointType.e_prismaticJoint);goog.exportProperty(box2d.b2JointType,'e_distanceJoint',box2d.b2JointType.e_distanceJoint);goog.exportProperty(box2d.b2JointType,'e_pulleyJoint',box2d.b2JointType.e_pulleyJoint);goog.exportProperty(box2d.b2JointType,'e_mouseJoint',box2d.b2JointType.e_mouseJoint);goog.exportProperty(box2d.b2JointType,'e_gearJoint',box2d.b2JointType.e_gearJoint);goog.exportProperty(box2d.b2JointType,'e_wheelJoint',box2d.b2JointType.e_wheelJoint);goog.exportProperty(box2d.b2JointType,'e_weldJoint',box2d.b2JointType.e_weldJoint);goog.exportProperty(box2d.b2JointType,'e_frictionJoint',box2d.b2JointType.e_frictionJoint);goog.exportProperty(box2d.b2JointType,'e_ropeJoint',box2d.b2JointType.e_ropeJoint);goog.exportProperty(box2d.b2JointType,'e_motorJoint',box2d.b2JointType.e_motorJoint);goog.exportProperty(box2d.b2JointType,'e_areaJoint',box2d.b2JointType.e_areaJoint);box2d.b2LimitState={e_inactiveLimit:0,e_atLowerLimit:1,e_atUpperLimit:2,e_equalLimits:3};goog.exportProperty(box2d.b2LimitState,'e_inactiveLimit',box2d.b2LimitState.e_inactiveLimit);goog.exportProperty(box2d.b2LimitState,'e_atLowerLimit',box2d.b2LimitState.e_atLowerLimit);goog.exportProperty(box2d.b2LimitState,'e_atUpperLimit',box2d.b2LimitState.e_atUpperLimit);goog.exportProperty(box2d.b2LimitState,'e_equalLimits',box2d.b2LimitState.e_equalLimits);box2d.b2Jacobian=function(){this.linear=new box2d.b2Vec2()};box2d.b2Jacobian.prototype.linear=null;box2d.b2Jacobian.prototype.angularA=0;box2d.b2Jacobian.prototype.angularB=0;box2d.b2Jacobian.prototype.SetZero=function(){this.linear.SetZero();this.angularA=0;this.angularB=0;return this}
box2d.b2Jacobian.prototype.Set=function(x,a1,a2){this.linear.Copy(x);this.angularA=a1;this.angularB=a2;return this}
box2d.b2JointEdge=function(){};box2d.b2JointEdge.prototype.other=null;box2d.b2JointEdge.prototype.joint=null;box2d.b2JointEdge.prototype.prev=null;box2d.b2JointEdge.prototype.next=null;box2d.b2JointDef=function(type){this.type=type}
box2d.b2JointDef.prototype.type=box2d.b2JointType.e_unknownJoint;box2d.b2JointDef.prototype.userData=null;box2d.b2JointDef.prototype.bodyA=null;box2d.b2JointDef.prototype.bodyB=null;box2d.b2JointDef.prototype.collideConnected=!1;box2d.b2Joint=function(def){if(box2d.ENABLE_ASSERTS){box2d.b2Assert(def.bodyA!==def.bodyB)}
this.m_type=def.type;this.m_edgeA=new box2d.b2JointEdge();this.m_edgeB=new box2d.b2JointEdge();this.m_bodyA=def.bodyA;this.m_bodyB=def.bodyB;this.m_collideConnected=def.collideConnected;this.m_userData=def.userData}
box2d.b2Joint.prototype.m_type=box2d.b2JointType.e_unknownJoint;box2d.b2Joint.prototype.m_prev=null;box2d.b2Joint.prototype.m_next=null;box2d.b2Joint.prototype.m_edgeA=null;box2d.b2Joint.prototype.m_edgeB=null;box2d.b2Joint.prototype.m_bodyA=null;box2d.b2Joint.prototype.m_bodyB=null;box2d.b2Joint.prototype.m_index=0;box2d.b2Joint.prototype.m_islandFlag=!1;box2d.b2Joint.prototype.m_collideConnected=!1;box2d.b2Joint.prototype.m_userData=null;box2d.b2Joint.prototype.GetAnchorA=function(out){return out.SetZero()}
box2d.b2Joint.prototype.GetAnchorB=function(out){return out.SetZero()}
box2d.b2Joint.prototype.GetReactionForce=function(inv_dt,out){return out.SetZero()}
box2d.b2Joint.prototype.GetReactionTorque=function(inv_dt){return 0}
box2d.b2Joint.prototype.InitVelocityConstraints=function(data){}
box2d.b2Joint.prototype.SolveVelocityConstraints=function(data){}
box2d.b2Joint.prototype.SolvePositionConstraints=function(data){return !1}
box2d.b2Joint.prototype.GetType=function(){return this.m_type}
box2d.b2Joint.prototype.GetBodyA=function(){return this.m_bodyA}
box2d.b2Joint.prototype.GetBodyB=function(){return this.m_bodyB}
box2d.b2Joint.prototype.GetNext=function(){return this.m_next}
box2d.b2Joint.prototype.GetUserData=function(){return this.m_userData}
box2d.b2Joint.prototype.SetUserData=function(data){this.m_userData=data}
box2d.b2Joint.prototype.GetCollideConnected=function(){return this.m_collideConnected}
box2d.b2Joint.prototype.Dump=function(){if(box2d.DEBUG){box2d.b2Log("// Dump is not supported for this joint type.\n")}}
box2d.b2Joint.prototype.IsActive=function(){return this.m_bodyA.IsActive()&&this.m_bodyB.IsActive()}
box2d.b2Joint.prototype.ShiftOrigin=function(newOrigin){}
goog.provide('box2d.b2RevoluteJoint');goog.require('box2d.b2Settings');goog.require('box2d.b2Joint');goog.require('box2d.b2Math');box2d.b2RevoluteJointDef=function(){goog.base(this,box2d.b2JointType.e_revoluteJoint);this.localAnchorA=new box2d.b2Vec2(0,0);this.localAnchorB=new box2d.b2Vec2(0,0)}
goog.inherits(box2d.b2RevoluteJointDef,box2d.b2JointDef);box2d.b2RevoluteJointDef.prototype.localAnchorA=null;box2d.b2RevoluteJointDef.prototype.localAnchorB=null;box2d.b2RevoluteJointDef.prototype.referenceAngle=0;box2d.b2RevoluteJointDef.prototype.enableLimit=!1;box2d.b2RevoluteJointDef.prototype.lowerAngle=0;box2d.b2RevoluteJointDef.prototype.upperAngle=0;box2d.b2RevoluteJointDef.prototype.enableMotor=!1;box2d.b2RevoluteJointDef.prototype.motorSpeed=0;box2d.b2RevoluteJointDef.prototype.maxMotorTorque=0;box2d.b2RevoluteJointDef.prototype.Initialize=function(bA,bB,anchor){this.bodyA=bA;this.bodyB=bB;this.bodyA.GetLocalPoint(anchor,this.localAnchorA);this.bodyB.GetLocalPoint(anchor,this.localAnchorB);this.referenceAngle=this.bodyB.GetAngleRadians()-this.bodyA.GetAngleRadians()}
box2d.b2RevoluteJoint=function(def){goog.base(this,def);this.m_localAnchorA=new box2d.b2Vec2();this.m_localAnchorB=new box2d.b2Vec2();this.m_impulse=new box2d.b2Vec3();this.m_rA=new box2d.b2Vec2();this.m_rB=new box2d.b2Vec2();this.m_localCenterA=new box2d.b2Vec2();this.m_localCenterB=new box2d.b2Vec2();this.m_mass=new box2d.b2Mat33();this.m_qA=new box2d.b2Rot();this.m_qB=new box2d.b2Rot();this.m_lalcA=new box2d.b2Vec2();this.m_lalcB=new box2d.b2Vec2();this.m_K=new box2d.b2Mat22();this.m_localAnchorA.Copy(def.localAnchorA);this.m_localAnchorB.Copy(def.localAnchorB);this.m_referenceAngle=def.referenceAngle;this.m_impulse.SetZero();this.m_motorImpulse=0;this.m_lowerAngle=def.lowerAngle;this.m_upperAngle=def.upperAngle;this.m_maxMotorTorque=def.maxMotorTorque;this.m_motorSpeed=def.motorSpeed;this.m_enableLimit=def.enableLimit;this.m_enableMotor=def.enableMotor;this.m_limitState=box2d.b2LimitState.e_inactiveLimit}
goog.inherits(box2d.b2RevoluteJoint,box2d.b2Joint);box2d.b2RevoluteJoint.prototype.m_localAnchorA=null;box2d.b2RevoluteJoint.prototype.m_localAnchorB=null;box2d.b2RevoluteJoint.prototype.m_impulse=null;box2d.b2RevoluteJoint.prototype.m_motorImpulse=0;box2d.b2RevoluteJoint.prototype.m_enableMotor=!1;box2d.b2RevoluteJoint.prototype.m_maxMotorTorque=0;box2d.b2RevoluteJoint.prototype.m_motorSpeed=0;box2d.b2RevoluteJoint.prototype.m_enableLimit=!1;box2d.b2RevoluteJoint.prototype.m_referenceAngle=0;box2d.b2RevoluteJoint.prototype.m_lowerAngle=0;box2d.b2RevoluteJoint.prototype.m_upperAngle=0;box2d.b2RevoluteJoint.prototype.m_indexA=0;box2d.b2RevoluteJoint.prototype.m_indexB=0;box2d.b2RevoluteJoint.prototype.m_rA=null;box2d.b2RevoluteJoint.prototype.m_rB=null;box2d.b2RevoluteJoint.prototype.m_localCenterA=null;box2d.b2RevoluteJoint.prototype.m_localCenterB=null;box2d.b2RevoluteJoint.prototype.m_invMassA=0;box2d.b2RevoluteJoint.prototype.m_invMassB=0;box2d.b2RevoluteJoint.prototype.m_invIA=0;box2d.b2RevoluteJoint.prototype.m_invIB=0;box2d.b2RevoluteJoint.prototype.m_mass=null;box2d.b2RevoluteJoint.prototype.m_motorMass=0;box2d.b2RevoluteJoint.prototype.m_limitState=box2d.b2LimitState.e_inactiveLimit;box2d.b2RevoluteJoint.prototype.m_qA=null;box2d.b2RevoluteJoint.prototype.m_qB=null;box2d.b2RevoluteJoint.prototype.m_lalcA=null;box2d.b2RevoluteJoint.prototype.m_lalcB=null;box2d.b2RevoluteJoint.prototype.m_K=null;box2d.b2RevoluteJoint.prototype.InitVelocityConstraints=function(data){this.m_indexA=this.m_bodyA.m_islandIndex;this.m_indexB=this.m_bodyB.m_islandIndex;this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter);this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter);this.m_invMassA=this.m_bodyA.m_invMass;this.m_invMassB=this.m_bodyB.m_invMass;this.m_invIA=this.m_bodyA.m_invI;this.m_invIB=this.m_bodyB.m_invI;var aA=data.positions[this.m_indexA].a;var vA=data.velocities[this.m_indexA].v;var wA=data.velocities[this.m_indexA].w;var aB=data.positions[this.m_indexB].a;var vB=data.velocities[this.m_indexB].v;var wB=data.velocities[this.m_indexB].w;var qA=this.m_qA.SetAngleRadians(aA),qB=this.m_qB.SetAngleRadians(aB);box2d.b2SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);box2d.b2MulRV(qA,this.m_lalcA,this.m_rA);box2d.b2SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);box2d.b2MulRV(qB,this.m_lalcB,this.m_rB);var mA=this.m_invMassA,mB=this.m_invMassB;var iA=this.m_invIA,iB=this.m_invIB;var fixedRotation=(iA+iB===0);this.m_mass.ex.x=mA+mB+this.m_rA.y*this.m_rA.y*iA+this.m_rB.y*this.m_rB.y*iB;this.m_mass.ey.x=-this.m_rA.y*this.m_rA.x*iA-this.m_rB.y*this.m_rB.x*iB;this.m_mass.ez.x=-this.m_rA.y*iA-this.m_rB.y*iB;this.m_mass.ex.y=this.m_mass.ey.x;this.m_mass.ey.y=mA+mB+this.m_rA.x*this.m_rA.x*iA+this.m_rB.x*this.m_rB.x*iB;this.m_mass.ez.y=this.m_rA.x*iA+this.m_rB.x*iB;this.m_mass.ex.z=this.m_mass.ez.x;this.m_mass.ey.z=this.m_mass.ez.y;this.m_mass.ez.z=iA+iB;this.m_motorMass=iA+iB;if(this.m_motorMass>0){this.m_motorMass=1/this.m_motorMass}
if(this.m_enableMotor===!1||fixedRotation){this.m_motorImpulse=0}
if(this.m_enableLimit&&fixedRotation===!1){var jointAngle=aB-aA-this.m_referenceAngle;if(box2d.b2Abs(this.m_upperAngle-this.m_lowerAngle)<2*box2d.b2_angularSlop){this.m_limitState=box2d.b2LimitState.e_equalLimits}
else if(jointAngle<=this.m_lowerAngle){if(this.m_limitState!==box2d.b2LimitState.e_atLowerLimit){this.m_impulse.z=0}
this.m_limitState=box2d.b2LimitState.e_atLowerLimit}
else if(jointAngle>=this.m_upperAngle){if(this.m_limitState!==box2d.b2LimitState.e_atUpperLimit){this.m_impulse.z=0}
this.m_limitState=box2d.b2LimitState.e_atUpperLimit}
else{this.m_limitState=box2d.b2LimitState.e_inactiveLimit;this.m_impulse.z=0}}
else{this.m_limitState=box2d.b2LimitState.e_inactiveLimit}
if(data.step.warmStarting){this.m_impulse.SelfMul(data.step.dtRatio);this.m_motorImpulse*=data.step.dtRatio;var P=box2d.b2RevoluteJoint.prototype.InitVelocityConstraints.s_P.SetXY(this.m_impulse.x,this.m_impulse.y);vA.SelfMulSub(mA,P);wA-=iA*(box2d.b2CrossVV(this.m_rA,P)+this.m_motorImpulse+this.m_impulse.z);vB.SelfMulAdd(mB,P);wB+=iB*(box2d.b2CrossVV(this.m_rB,P)+this.m_motorImpulse+this.m_impulse.z)}
else{this.m_impulse.SetZero();this.m_motorImpulse=0}
data.velocities[this.m_indexA].w=wA;data.velocities[this.m_indexB].w=wB}
box2d.b2RevoluteJoint.prototype.InitVelocityConstraints.s_P=new box2d.b2Vec2();box2d.b2RevoluteJoint.prototype.SolveVelocityConstraints=function(data){var vA=data.velocities[this.m_indexA].v;var wA=data.velocities[this.m_indexA].w;var vB=data.velocities[this.m_indexB].v;var wB=data.velocities[this.m_indexB].w;var mA=this.m_invMassA,mB=this.m_invMassB;var iA=this.m_invIA,iB=this.m_invIB;var fixedRotation=(iA+iB===0);if(this.m_enableMotor&&this.m_limitState!==box2d.b2LimitState.e_equalLimits&&fixedRotation===!1){var Cdot=wB-wA-this.m_motorSpeed;var impulse=-this.m_motorMass*Cdot;var oldImpulse=this.m_motorImpulse;var maxImpulse=data.step.dt*this.m_maxMotorTorque;this.m_motorImpulse=box2d.b2Clamp(this.m_motorImpulse+impulse,-maxImpulse,maxImpulse);impulse=this.m_motorImpulse-oldImpulse;wA-=iA*impulse;wB+=iB*impulse}
if(this.m_enableLimit&&this.m_limitState!==box2d.b2LimitState.e_inactiveLimit&&fixedRotation===!1){var Cdot1=box2d.b2SubVV(box2d.b2AddVCrossSV(vB,wB,this.m_rB,box2d.b2Vec2.s_t0),box2d.b2AddVCrossSV(vA,wA,this.m_rA,box2d.b2Vec2.s_t1),box2d.b2RevoluteJoint.prototype.SolveVelocityConstraints.s_Cdot1)
var Cdot2=wB-wA;var impulse=this.m_mass.Solve33(Cdot1.x,Cdot1.y,Cdot2,box2d.b2RevoluteJoint.prototype.SolveVelocityConstraints.s_impulse3).SelfNeg();if(this.m_limitState===box2d.b2LimitState.e_equalLimits){this.m_impulse.SelfAdd(impulse)}
else if(this.m_limitState===box2d.b2LimitState.e_atLowerLimit){var newImpulse=this.m_impulse.z+impulse.z;if(newImpulse<0){var rhs_x=-Cdot1.x+this.m_impulse.z*this.m_mass.ez.x;var rhs_y=-Cdot1.y+this.m_impulse.z*this.m_mass.ez.y;var reduced=this.m_mass.Solve22(rhs_x,rhs_y,box2d.b2RevoluteJoint.prototype.SolveVelocityConstraints.s_reduced);impulse.x=reduced.x;impulse.y=reduced.y;impulse.z=-this.m_impulse.z;this.m_impulse.x+=reduced.x;this.m_impulse.y+=reduced.y;this.m_impulse.z=0}
else{this.m_impulse.SelfAdd(impulse)}}
else if(this.m_limitState===box2d.b2LimitState.e_atUpperLimit){var newImpulse=this.m_impulse.z+impulse.z;if(newImpulse>0){var rhs_x=-Cdot1.x+this.m_impulse.z*this.m_mass.ez.x;var rhs_y=-Cdot1.y+this.m_impulse.z*this.m_mass.ez.y;var reduced=this.m_mass.Solve22(rhs_x,rhs_y,box2d.b2RevoluteJoint.prototype.SolveVelocityConstraints.s_reduced);impulse.x=reduced.x;impulse.y=reduced.y;impulse.z=-this.m_impulse.z;this.m_impulse.x+=reduced.x;this.m_impulse.y+=reduced.y;this.m_impulse.z=0}
else{this.m_impulse.SelfAdd(impulse)}}
var P=box2d.b2RevoluteJoint.prototype.SolveVelocityConstraints.s_P.SetXY(impulse.x,impulse.y);vA.SelfMulSub(mA,P);wA-=iA*(box2d.b2CrossVV(this.m_rA,P)+impulse.z);vB.SelfMulAdd(mB,P);wB+=iB*(box2d.b2CrossVV(this.m_rB,P)+impulse.z)}
else{var Cdot=box2d.b2SubVV(box2d.b2AddVCrossSV(vB,wB,this.m_rB,box2d.b2Vec2.s_t0),box2d.b2AddVCrossSV(vA,wA,this.m_rA,box2d.b2Vec2.s_t1),box2d.b2RevoluteJoint.prototype.SolveVelocityConstraints.s_Cdot)
var impulse=this.m_mass.Solve22(-Cdot.x,-Cdot.y,box2d.b2RevoluteJoint.prototype.SolveVelocityConstraints.s_impulse2);this.m_impulse.x+=impulse.x;this.m_impulse.y+=impulse.y;vA.SelfMulSub(mA,impulse);wA-=iA*box2d.b2CrossVV(this.m_rA,impulse);vB.SelfMulAdd(mB,impulse);wB+=iB*box2d.b2CrossVV(this.m_rB,impulse)}
data.velocities[this.m_indexA].w=wA;data.velocities[this.m_indexB].w=wB}
box2d.b2RevoluteJoint.prototype.SolveVelocityConstraints.s_P=new box2d.b2Vec2();box2d.b2RevoluteJoint.prototype.SolveVelocityConstraints.s_Cdot=new box2d.b2Vec2();box2d.b2RevoluteJoint.prototype.SolveVelocityConstraints.s_Cdot1=new box2d.b2Vec2();box2d.b2RevoluteJoint.prototype.SolveVelocityConstraints.s_impulse3=new box2d.b2Vec3();box2d.b2RevoluteJoint.prototype.SolveVelocityConstraints.s_reduced=new box2d.b2Vec2();box2d.b2RevoluteJoint.prototype.SolveVelocityConstraints.s_impulse2=new box2d.b2Vec2();box2d.b2RevoluteJoint.prototype.SolvePositionConstraints=function(data){var cA=data.positions[this.m_indexA].c;var aA=data.positions[this.m_indexA].a;var cB=data.positions[this.m_indexB].c;var aB=data.positions[this.m_indexB].a;var qA=this.m_qA.SetAngleRadians(aA),qB=this.m_qB.SetAngleRadians(aB);var angularError=0;var positionError=0;var fixedRotation=(this.m_invIA+this.m_invIB===0);if(this.m_enableLimit&&this.m_limitState!==box2d.b2LimitState.e_inactiveLimit&&fixedRotation===!1){var angle=aB-aA-this.m_referenceAngle;var limitImpulse=0;if(this.m_limitState===box2d.b2LimitState.e_equalLimits){var C=box2d.b2Clamp(angle-this.m_lowerAngle,-box2d.b2_maxAngularCorrection,box2d.b2_maxAngularCorrection);limitImpulse=-this.m_motorMass*C;angularError=box2d.b2Abs(C)}
else if(this.m_limitState===box2d.b2LimitState.e_atLowerLimit){var C=angle-this.m_lowerAngle;angularError=-C;C=box2d.b2Clamp(C+box2d.b2_angularSlop,-box2d.b2_maxAngularCorrection,0);limitImpulse=-this.m_motorMass*C}
else if(this.m_limitState===box2d.b2LimitState.e_atUpperLimit){var C=angle-this.m_upperAngle;angularError=C;C=box2d.b2Clamp(C-box2d.b2_angularSlop,0,box2d.b2_maxAngularCorrection);limitImpulse=-this.m_motorMass*C}
aA-=this.m_invIA*limitImpulse;aB+=this.m_invIB*limitImpulse}{qA.SetAngleRadians(aA);qB.SetAngleRadians(aB);box2d.b2SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);var rA=box2d.b2MulRV(qA,this.m_lalcA,this.m_rA);box2d.b2SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);var rB=box2d.b2MulRV(qB,this.m_lalcB,this.m_rB);var C=box2d.b2SubVV(box2d.b2AddVV(cB,rB,box2d.b2Vec2.s_t0),box2d.b2AddVV(cA,rA,box2d.b2Vec2.s_t1),box2d.b2RevoluteJoint.prototype.SolvePositionConstraints.s_C);positionError=C.GetLength();var mA=this.m_invMassA,mB=this.m_invMassB;var iA=this.m_invIA,iB=this.m_invIB;var K=this.m_K;K.ex.x=mA+mB+iA*rA.y*rA.y+iB*rB.y*rB.y;K.ex.y=-iA*rA.x*rA.y-iB*rB.x*rB.y;K.ey.x=K.ex.y;K.ey.y=mA+mB+iA*rA.x*rA.x+iB*rB.x*rB.x;var impulse=K.Solve(C.x,C.y,box2d.b2RevoluteJoint.prototype.SolvePositionConstraints.s_impulse).SelfNeg();cA.SelfMulSub(mA,impulse);aA-=iA*box2d.b2CrossVV(rA,impulse);cB.SelfMulAdd(mB,impulse);aB+=iB*box2d.b2CrossVV(rB,impulse)}
data.positions[this.m_indexA].a=aA;data.positions[this.m_indexB].a=aB;return positionError<=box2d.b2_linearSlop&&angularError<=box2d.b2_angularSlop}
box2d.b2RevoluteJoint.prototype.SolvePositionConstraints.s_C=new box2d.b2Vec2();box2d.b2RevoluteJoint.prototype.SolvePositionConstraints.s_impulse=new box2d.b2Vec2();box2d.b2RevoluteJoint.prototype.GetAnchorA=function(out){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,out)}
box2d.b2RevoluteJoint.prototype.GetAnchorB=function(out){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,out)}
box2d.b2RevoluteJoint.prototype.GetReactionForce=function(inv_dt,out){return out.SetXY(inv_dt*this.m_impulse.x,inv_dt*this.m_impulse.y)}
box2d.b2RevoluteJoint.prototype.GetReactionTorque=function(inv_dt){return inv_dt*this.m_impulse.z}
box2d.b2RevoluteJoint.prototype.GetLocalAnchorA=function(out){return out.Copy(this.m_localAnchorA)}
box2d.b2RevoluteJoint.prototype.GetLocalAnchorB=function(out){return out.Copy(this.m_localAnchorB)}
box2d.b2RevoluteJoint.prototype.GetReferenceAngle=function(){return this.m_referenceAngle}
box2d.b2RevoluteJoint.prototype.GetJointAngleRadians=function(){return this.m_bodyB.m_sweep.a-this.m_bodyA.m_sweep.a-this.m_referenceAngle}
box2d.b2RevoluteJoint.prototype.GetJointSpeed=function(){return this.m_bodyB.m_angularVelocity-this.m_bodyA.m_angularVelocity}
box2d.b2RevoluteJoint.prototype.IsMotorEnabled=function(){return this.m_enableMotor}
box2d.b2RevoluteJoint.prototype.EnableMotor=function(flag){if(this.m_enableMotor!==flag){this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);this.m_enableMotor=flag}}
box2d.b2RevoluteJoint.prototype.GetMotorTorque=function(inv_dt){return inv_dt*this.m_motorImpulse}
box2d.b2RevoluteJoint.prototype.GetMotorSpeed=function(){return this.m_motorSpeed}
box2d.b2RevoluteJoint.prototype.SetMaxMotorTorque=function(torque){this.m_maxMotorTorque=torque}
box2d.b2RevoluteJoint.prototype.GetMaxMotorTorque=function(){return this.m_maxMotorTorque}
box2d.b2RevoluteJoint.prototype.IsLimitEnabled=function(){return this.m_enableLimit}
box2d.b2RevoluteJoint.prototype.EnableLimit=function(flag){if(flag!==this.m_enableLimit){this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);this.m_enableLimit=flag;this.m_impulse.z=0}}
box2d.b2RevoluteJoint.prototype.GetLowerLimit=function(){return this.m_lowerAngle}
box2d.b2RevoluteJoint.prototype.GetUpperLimit=function(){return this.m_upperAngle}
box2d.b2RevoluteJoint.prototype.SetLimits=function(lower,upper){if(lower!==this.m_lowerAngle||upper!==this.m_upperAngle){this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);this.m_impulse.z=0;this.m_lowerAngle=lower;this.m_upperAngle=upper}}
box2d.b2RevoluteJoint.prototype.SetMotorSpeed=function(speed){if(this.m_motorSpeed!==speed){this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);this.m_motorSpeed=speed}}
box2d.b2RevoluteJoint.prototype.Dump=function(){if(box2d.DEBUG){var indexA=this.m_bodyA.m_islandIndex;var indexB=this.m_bodyB.m_islandIndex;box2d.b2Log("  /*box2d.b2RevoluteJointDef*/ var jd = new box2d.b2RevoluteJointDef();\n");box2d.b2Log("  jd.bodyA = bodies[%d];\n",indexA);box2d.b2Log("  jd.bodyB = bodies[%d];\n",indexB);box2d.b2Log("  jd.collideConnected = %s;\n",(this.m_collideConnected)?('true'):('false'));box2d.b2Log("  jd.localAnchorA.SetXY(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y);box2d.b2Log("  jd.localAnchorB.SetXY(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y);box2d.b2Log("  jd.referenceAngle = %.15f;\n",this.m_referenceAngle);box2d.b2Log("  jd.enableLimit = %s;\n",(this.m_enableLimit)?('true'):('false'));box2d.b2Log("  jd.lowerAngle = %.15f;\n",this.m_lowerAngle);box2d.b2Log("  jd.upperAngle = %.15f;\n",this.m_upperAngle);box2d.b2Log("  jd.enableMotor = %s;\n",(this.m_enableMotor)?('true'):('false'));box2d.b2Log("  jd.motorSpeed = %.15f;\n",this.m_motorSpeed);box2d.b2Log("  jd.maxMotorTorque = %.15f;\n",this.m_maxMotorTorque);box2d.b2Log("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)}}
goog.provide('box2d.b2PrismaticJoint');goog.require('box2d.b2Settings');goog.require('box2d.b2Joint');goog.require('box2d.b2Math');box2d.b2PrismaticJointDef=function(){goog.base(this,box2d.b2JointType.e_prismaticJoint);this.localAnchorA=new box2d.b2Vec2();this.localAnchorB=new box2d.b2Vec2();this.localAxisA=new box2d.b2Vec2(1,0)}
goog.inherits(box2d.b2PrismaticJointDef,box2d.b2JointDef);box2d.b2PrismaticJointDef.prototype.localAnchorA=null;box2d.b2PrismaticJointDef.prototype.localAnchorB=null;box2d.b2PrismaticJointDef.prototype.localAxisA=null;box2d.b2PrismaticJointDef.prototype.referenceAngle=0;box2d.b2PrismaticJointDef.prototype.enableLimit=!1;box2d.b2PrismaticJointDef.prototype.lowerTranslation=0;box2d.b2PrismaticJointDef.prototype.upperTranslation=0;box2d.b2PrismaticJointDef.prototype.enableMotor=!1;box2d.b2PrismaticJointDef.prototype.maxMotorForce=0;box2d.b2PrismaticJointDef.prototype.motorSpeed=0;box2d.b2PrismaticJointDef.prototype.Initialize=function(bA,bB,anchor,axis){this.bodyA=bA;this.bodyB=bB;this.bodyA.GetLocalPoint(anchor,this.localAnchorA);this.bodyB.GetLocalPoint(anchor,this.localAnchorB);this.bodyA.GetLocalVector(axis,this.localAxisA);this.referenceAngle=this.bodyB.GetAngleRadians()-this.bodyA.GetAngleRadians()}
box2d.b2PrismaticJoint=function(def){goog.base(this,def);this.m_localAnchorA=def.localAnchorA.Clone();this.m_localAnchorB=def.localAnchorB.Clone();this.m_localXAxisA=def.localAxisA.Clone().SelfNormalize();this.m_localYAxisA=box2d.b2CrossOneV(this.m_localXAxisA,new box2d.b2Vec2());this.m_referenceAngle=def.referenceAngle;this.m_impulse=new box2d.b2Vec3(0,0,0);this.m_lowerTranslation=def.lowerTranslation;this.m_upperTranslation=def.upperTranslation;this.m_maxMotorForce=def.maxMotorForce;this.m_motorSpeed=def.motorSpeed;this.m_enableLimit=def.enableLimit;this.m_enableMotor=def.enableMotor;this.m_localCenterA=new box2d.b2Vec2();this.m_localCenterB=new box2d.b2Vec2();this.m_axis=new box2d.b2Vec2(0,0);this.m_perp=new box2d.b2Vec2(0,0);this.m_K=new box2d.b2Mat33();this.m_K3=new box2d.b2Mat33();this.m_K2=new box2d.b2Mat22();this.m_qA=new box2d.b2Rot();this.m_qB=new box2d.b2Rot();this.m_lalcA=new box2d.b2Vec2();this.m_lalcB=new box2d.b2Vec2();this.m_rA=new box2d.b2Vec2();this.m_rB=new box2d.b2Vec2()}
goog.inherits(box2d.b2PrismaticJoint,box2d.b2Joint);box2d.b2PrismaticJoint.prototype.m_localAnchorA=null;box2d.b2PrismaticJoint.prototype.m_localAnchorB=null;box2d.b2PrismaticJoint.prototype.m_localXAxisA=null;box2d.b2PrismaticJoint.prototype.m_localYAxisA=null;box2d.b2PrismaticJoint.prototype.m_referenceAngle=0;box2d.b2PrismaticJoint.prototype.m_impulse=null;box2d.b2PrismaticJoint.prototype.m_motorImpulse=0;box2d.b2PrismaticJoint.prototype.m_lowerTranslation=0;box2d.b2PrismaticJoint.prototype.m_upperTranslation=0;box2d.b2PrismaticJoint.prototype.m_maxMotorForce=0;box2d.b2PrismaticJoint.prototype.m_motorSpeed=0;box2d.b2PrismaticJoint.prototype.m_enableLimit=!1;box2d.b2PrismaticJoint.prototype.m_enableMotor=!1;box2d.b2PrismaticJoint.prototype.m_limitState=box2d.b2LimitState.e_inactiveLimit;box2d.b2PrismaticJoint.prototype.m_indexA=0;box2d.b2PrismaticJoint.prototype.m_indexB=0;box2d.b2PrismaticJoint.prototype.m_localCenterA=null;box2d.b2PrismaticJoint.prototype.m_localCenterB=null;box2d.b2PrismaticJoint.prototype.m_invMassA=0;box2d.b2PrismaticJoint.prototype.m_invMassB=0;box2d.b2PrismaticJoint.prototype.m_invIA=0;box2d.b2PrismaticJoint.prototype.m_invIB=0;box2d.b2PrismaticJoint.prototype.m_axis=null;box2d.b2PrismaticJoint.prototype.m_perp=null;box2d.b2PrismaticJoint.prototype.m_s1=0;box2d.b2PrismaticJoint.prototype.m_s2=0;box2d.b2PrismaticJoint.prototype.m_a1=0;box2d.b2PrismaticJoint.prototype.m_a2=0;box2d.b2PrismaticJoint.prototype.m_K=null;box2d.b2PrismaticJoint.prototype.m_K3=null;box2d.b2PrismaticJoint.prototype.m_K2=null;box2d.b2PrismaticJoint.prototype.m_motorMass=0;box2d.b2PrismaticJoint.prototype.m_qA=null;box2d.b2PrismaticJoint.prototype.m_qB=null;box2d.b2PrismaticJoint.prototype.m_lalcA=null;box2d.b2PrismaticJoint.prototype.m_lalcB=null;box2d.b2PrismaticJoint.prototype.m_rA=null;box2d.b2PrismaticJoint.prototype.m_rB=null;box2d.b2PrismaticJoint.prototype.InitVelocityConstraints=function(data){this.m_indexA=this.m_bodyA.m_islandIndex;this.m_indexB=this.m_bodyB.m_islandIndex;this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter);this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter);this.m_invMassA=this.m_bodyA.m_invMass;this.m_invMassB=this.m_bodyB.m_invMass;this.m_invIA=this.m_bodyA.m_invI;this.m_invIB=this.m_bodyB.m_invI;var cA=data.positions[this.m_indexA].c;var aA=data.positions[this.m_indexA].a;var vA=data.velocities[this.m_indexA].v;var wA=data.velocities[this.m_indexA].w;var cB=data.positions[this.m_indexB].c;var aB=data.positions[this.m_indexB].a;var vB=data.velocities[this.m_indexB].v;var wB=data.velocities[this.m_indexB].w;var qA=this.m_qA.SetAngleRadians(aA),qB=this.m_qB.SetAngleRadians(aB);box2d.b2SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);var rA=box2d.b2MulRV(qA,this.m_lalcA,this.m_rA);box2d.b2SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);var rB=box2d.b2MulRV(qB,this.m_lalcB,this.m_rB);var d=box2d.b2AddVV(box2d.b2SubVV(cB,cA,box2d.b2Vec2.s_t0),box2d.b2SubVV(rB,rA,box2d.b2Vec2.s_t1),box2d.b2PrismaticJoint.prototype.InitVelocityConstraints.s_d);var mA=this.m_invMassA,mB=this.m_invMassB;var iA=this.m_invIA,iB=this.m_invIB;{box2d.b2MulRV(qA,this.m_localXAxisA,this.m_axis);this.m_a1=box2d.b2CrossVV(box2d.b2AddVV(d,rA,box2d.b2Vec2.s_t0),this.m_axis);this.m_a2=box2d.b2CrossVV(rB,this.m_axis);this.m_motorMass=mA+mB+iA*this.m_a1*this.m_a1+iB*this.m_a2*this.m_a2;if(this.m_motorMass>0){this.m_motorMass=1/this.m_motorMass}}{box2d.b2MulRV(qA,this.m_localYAxisA,this.m_perp);this.m_s1=box2d.b2CrossVV(box2d.b2AddVV(d,rA,box2d.b2Vec2.s_t0),this.m_perp);this.m_s2=box2d.b2CrossVV(rB,this.m_perp);this.m_K.ex.x=mA+mB+iA*this.m_s1*this.m_s1+iB*this.m_s2*this.m_s2;this.m_K.ex.y=iA*this.m_s1+iB*this.m_s2;this.m_K.ex.z=iA*this.m_s1*this.m_a1+iB*this.m_s2*this.m_a2;this.m_K.ey.x=this.m_K.ex.y;this.m_K.ey.y=iA+iB;if(this.m_K.ey.y===0){this.m_K.ey.y=1}
this.m_K.ey.z=iA*this.m_a1+iB*this.m_a2;this.m_K.ez.x=this.m_K.ex.z;this.m_K.ez.y=this.m_K.ey.z;this.m_K.ez.z=mA+mB+iA*this.m_a1*this.m_a1+iB*this.m_a2*this.m_a2}
if(this.m_enableLimit){var jointTranslation=box2d.b2DotVV(this.m_axis,d);if(box2d.b2Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*box2d.b2_linearSlop){this.m_limitState=box2d.b2LimitState.e_equalLimits}
else if(jointTranslation<=this.m_lowerTranslation){if(this.m_limitState!==box2d.b2LimitState.e_atLowerLimit){this.m_limitState=box2d.b2LimitState.e_atLowerLimit;this.m_impulse.z=0}}
else if(jointTranslation>=this.m_upperTranslation){if(this.m_limitState!==box2d.b2LimitState.e_atUpperLimit){this.m_limitState=box2d.b2LimitState.e_atUpperLimit;this.m_impulse.z=0}}
else{this.m_limitState=box2d.b2LimitState.e_inactiveLimit;this.m_impulse.z=0}}
else{this.m_limitState=box2d.b2LimitState.e_inactiveLimit;this.m_impulse.z=0}
if(this.m_enableMotor===!1){this.m_motorImpulse=0}
if(data.step.warmStarting){this.m_impulse.SelfMul(data.step.dtRatio);this.m_motorImpulse*=data.step.dtRatio;var P=box2d.b2AddVV(box2d.b2MulSV(this.m_impulse.x,this.m_perp,box2d.b2Vec2.s_t0),box2d.b2MulSV((this.m_motorImpulse+this.m_impulse.z),this.m_axis,box2d.b2Vec2.s_t1),box2d.b2PrismaticJoint.prototype.InitVelocityConstraints.s_P);var LA=this.m_impulse.x*this.m_s1+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a1;var LB=this.m_impulse.x*this.m_s2+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a2;vA.SelfMulSub(mA,P);wA-=iA*LA;vB.SelfMulAdd(mB,P);wB+=iB*LB}
else{this.m_impulse.SetZero();this.m_motorImpulse=0}
data.velocities[this.m_indexA].w=wA;data.velocities[this.m_indexB].w=wB}
box2d.b2PrismaticJoint.prototype.InitVelocityConstraints.s_d=new box2d.b2Vec2();box2d.b2PrismaticJoint.prototype.InitVelocityConstraints.s_P=new box2d.b2Vec2();box2d.b2PrismaticJoint.prototype.SolveVelocityConstraints=function(data){var vA=data.velocities[this.m_indexA].v;var wA=data.velocities[this.m_indexA].w;var vB=data.velocities[this.m_indexB].v;var wB=data.velocities[this.m_indexB].w;var mA=this.m_invMassA,mB=this.m_invMassB;var iA=this.m_invIA,iB=this.m_invIB;if(this.m_enableMotor&&this.m_limitState!==box2d.b2LimitState.e_equalLimits){var Cdot=box2d.b2DotVV(this.m_axis,box2d.b2SubVV(vB,vA,box2d.b2Vec2.s_t0))+this.m_a2*wB-this.m_a1*wA;var impulse=this.m_motorMass*(this.m_motorSpeed-Cdot);var oldImpulse=this.m_motorImpulse;var maxImpulse=data.step.dt*this.m_maxMotorForce;this.m_motorImpulse=box2d.b2Clamp(this.m_motorImpulse+impulse,(-maxImpulse),maxImpulse);impulse=this.m_motorImpulse-oldImpulse;var P=box2d.b2MulSV(impulse,this.m_axis,box2d.b2PrismaticJoint.prototype.SolveVelocityConstraints.s_P);var LA=impulse*this.m_a1;var LB=impulse*this.m_a2;vA.SelfMulSub(mA,P);wA-=iA*LA;vB.SelfMulAdd(mB,P);wB+=iB*LB}
var Cdot1_x=box2d.b2DotVV(this.m_perp,box2d.b2SubVV(vB,vA,box2d.b2Vec2.s_t0))+this.m_s2*wB-this.m_s1*wA;var Cdot1_y=wB-wA;if(this.m_enableLimit&&this.m_limitState!==box2d.b2LimitState.e_inactiveLimit){var Cdot2=box2d.b2DotVV(this.m_axis,box2d.b2SubVV(vB,vA,box2d.b2Vec2.s_t0))+this.m_a2*wB-this.m_a1*wA;var f1=box2d.b2PrismaticJoint.prototype.SolveVelocityConstraints.s_f1.Copy(this.m_impulse);var df=this.m_K.Solve33((-Cdot1_x),(-Cdot1_y),(-Cdot2),box2d.b2PrismaticJoint.prototype.SolveVelocityConstraints.s_df3);this.m_impulse.SelfAdd(df);if(this.m_limitState===box2d.b2LimitState.e_atLowerLimit){this.m_impulse.z=box2d.b2Max(this.m_impulse.z,0)}
else if(this.m_limitState===box2d.b2LimitState.e_atUpperLimit){this.m_impulse.z=box2d.b2Min(this.m_impulse.z,0)}
var b_x=(-Cdot1_x)-(this.m_impulse.z-f1.z)*this.m_K.ez.x;var b_y=(-Cdot1_y)-(this.m_impulse.z-f1.z)*this.m_K.ez.y;var f2r=this.m_K.Solve22(b_x,b_y,box2d.b2PrismaticJoint.prototype.SolveVelocityConstraints.s_f2r);f2r.x+=f1.x;f2r.y+=f1.y;this.m_impulse.x=f2r.x;this.m_impulse.y=f2r.y;df.x=this.m_impulse.x-f1.x;df.y=this.m_impulse.y-f1.y;df.z=this.m_impulse.z-f1.z;var P=box2d.b2AddVV(box2d.b2MulSV(df.x,this.m_perp,box2d.b2Vec2.s_t0),box2d.b2MulSV(df.z,this.m_axis,box2d.b2Vec2.s_t1),box2d.b2PrismaticJoint.prototype.SolveVelocityConstraints.s_P);var LA=df.x*this.m_s1+df.y+df.z*this.m_a1;var LB=df.x*this.m_s2+df.y+df.z*this.m_a2;vA.SelfMulSub(mA,P);wA-=iA*LA;vB.SelfMulAdd(mB,P);wB+=iB*LB}
else{var df=this.m_K.Solve22((-Cdot1_x),(-Cdot1_y),box2d.b2PrismaticJoint.prototype.SolveVelocityConstraints.s_df2);this.m_impulse.x+=df.x;this.m_impulse.y+=df.y;var P=box2d.b2MulSV(df.x,this.m_perp,box2d.b2PrismaticJoint.prototype.SolveVelocityConstraints.s_P);var LA=df.x*this.m_s1+df.y;var LB=df.x*this.m_s2+df.y;vA.SelfMulSub(mA,P);wA-=iA*LA;vB.SelfMulAdd(mB,P);wB+=iB*LB}
data.velocities[this.m_indexA].w=wA;data.velocities[this.m_indexB].w=wB}
box2d.b2PrismaticJoint.prototype.SolveVelocityConstraints.s_P=new box2d.b2Vec2();box2d.b2PrismaticJoint.prototype.SolveVelocityConstraints.s_f2r=new box2d.b2Vec2();box2d.b2PrismaticJoint.prototype.SolveVelocityConstraints.s_f1=new box2d.b2Vec3();box2d.b2PrismaticJoint.prototype.SolveVelocityConstraints.s_df3=new box2d.b2Vec3();box2d.b2PrismaticJoint.prototype.SolveVelocityConstraints.s_df2=new box2d.b2Vec2();box2d.b2PrismaticJoint.prototype.SolvePositionConstraints=function(data){var cA=data.positions[this.m_indexA].c;var aA=data.positions[this.m_indexA].a;var cB=data.positions[this.m_indexB].c;var aB=data.positions[this.m_indexB].a;var qA=this.m_qA.SetAngleRadians(aA),qB=this.m_qB.SetAngleRadians(aB);var mA=this.m_invMassA,mB=this.m_invMassB;var iA=this.m_invIA,iB=this.m_invIB;var rA=box2d.b2MulRV(qA,this.m_lalcA,this.m_rA);var rB=box2d.b2MulRV(qB,this.m_lalcB,this.m_rB);var d=box2d.b2SubVV(box2d.b2AddVV(cB,rB,box2d.b2Vec2.s_t0),box2d.b2AddVV(cA,rA,box2d.b2Vec2.s_t1),box2d.b2PrismaticJoint.prototype.SolvePositionConstraints.s_d);var axis=box2d.b2MulRV(qA,this.m_localXAxisA,this.m_axis);var a1=box2d.b2CrossVV(box2d.b2AddVV(d,rA,box2d.b2Vec2.s_t0),axis);var a2=box2d.b2CrossVV(rB,axis);var perp=box2d.b2MulRV(qA,this.m_localYAxisA,this.m_perp);var s1=box2d.b2CrossVV(box2d.b2AddVV(d,rA,box2d.b2Vec2.s_t0),perp);var s2=box2d.b2CrossVV(rB,perp);var impulse=box2d.b2PrismaticJoint.prototype.SolvePositionConstraints.s_impulse;var C1_x=box2d.b2DotVV(perp,d);var C1_y=aB-aA-this.m_referenceAngle;var linearError=box2d.b2Abs(C1_x);var angularError=box2d.b2Abs(C1_y);var active=!1;var C2=0;if(this.m_enableLimit){var translation=box2d.b2DotVV(axis,d);if(box2d.b2Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*box2d.b2_linearSlop){C2=box2d.b2Clamp(translation,(-box2d.b2_maxLinearCorrection),box2d.b2_maxLinearCorrection);linearError=box2d.b2Max(linearError,box2d.b2Abs(translation));active=!0}
else if(translation<=this.m_lowerTranslation){C2=box2d.b2Clamp(translation-this.m_lowerTranslation+box2d.b2_linearSlop,(-box2d.b2_maxLinearCorrection),0);linearError=box2d.b2Max(linearError,this.m_lowerTranslation-translation);active=!0}
else if(translation>=this.m_upperTranslation){C2=box2d.b2Clamp(translation-this.m_upperTranslation-box2d.b2_linearSlop,0,box2d.b2_maxLinearCorrection);linearError=box2d.b2Max(linearError,translation-this.m_upperTranslation);active=!0}}
if(active){var k11=mA+mB+iA*s1*s1+iB*s2*s2;var k12=iA*s1+iB*s2;var k13=iA*s1*a1+iB*s2*a2;var k22=iA+iB;if(k22===0){k22=1}
var k23=iA*a1+iB*a2;var k33=mA+mB+iA*a1*a1+iB*a2*a2;var K=this.m_K3;K.ex.SetXYZ(k11,k12,k13);K.ey.SetXYZ(k12,k22,k23);K.ez.SetXYZ(k13,k23,k33);impulse=K.Solve33((-C1_x),(-C1_y),(-C2),impulse)}
else{var k11=mA+mB+iA*s1*s1+iB*s2*s2;var k12=iA*s1+iB*s2;var k22=iA+iB;if(k22===0){k22=1}
var K2=this.m_K2;K2.ex.SetXY(k11,k12);K2.ey.SetXY(k12,k22);var impulse1=K2.Solve((-C1_x),(-C1_y),box2d.b2PrismaticJoint.prototype.SolvePositionConstraints.s_impulse1);impulse.x=impulse1.x;impulse.y=impulse1.y;impulse.z=0}
var P=box2d.b2AddVV(box2d.b2MulSV(impulse.x,perp,box2d.b2Vec2.s_t0),box2d.b2MulSV(impulse.z,axis,box2d.b2Vec2.s_t1),box2d.b2PrismaticJoint.prototype.SolvePositionConstraints.s_P);var LA=impulse.x*s1+impulse.y+impulse.z*a1;var LB=impulse.x*s2+impulse.y+impulse.z*a2;cA.SelfMulSub(mA,P);aA-=iA*LA;cB.SelfMulAdd(mB,P);aB+=iB*LB;data.positions[this.m_indexA].a=aA;data.positions[this.m_indexB].a=aB;return linearError<=box2d.b2_linearSlop&&angularError<=box2d.b2_angularSlop}
box2d.b2PrismaticJoint.prototype.SolvePositionConstraints.s_d=new box2d.b2Vec2();box2d.b2PrismaticJoint.prototype.SolvePositionConstraints.s_impulse=new box2d.b2Vec3();box2d.b2PrismaticJoint.prototype.SolvePositionConstraints.s_impulse1=new box2d.b2Vec2();box2d.b2PrismaticJoint.prototype.SolvePositionConstraints.s_P=new box2d.b2Vec2();box2d.b2PrismaticJoint.prototype.GetAnchorA=function(out){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,out)}
box2d.b2PrismaticJoint.prototype.GetAnchorB=function(out){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,out)}
box2d.b2PrismaticJoint.prototype.GetReactionForce=function(inv_dt,out){return out.SetXY(inv_dt*(this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.x),inv_dt*(this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.y))}
box2d.b2PrismaticJoint.prototype.GetReactionTorque=function(inv_dt){return inv_dt*this.m_impulse.y}
box2d.b2PrismaticJoint.prototype.GetLocalAnchorA=function(out){return out.Copy(this.m_localAnchorA)}
box2d.b2PrismaticJoint.prototype.GetLocalAnchorB=function(out){return out.Copy(this.m_localAnchorB)}
box2d.b2PrismaticJoint.prototype.GetLocalAxisA=function(out){return out.Copy(this.m_localXAxisA)}
box2d.b2PrismaticJoint.prototype.GetReferenceAngle=function(){return this.m_referenceAngle}
box2d.b2PrismaticJoint.prototype.GetJointTranslation=function(){var pA=this.m_bodyA.GetWorldPoint(this.m_localAnchorA,box2d.b2PrismaticJoint.prototype.GetJointTranslation.s_pA);var pB=this.m_bodyB.GetWorldPoint(this.m_localAnchorB,box2d.b2PrismaticJoint.prototype.GetJointTranslation.s_pB);var d=box2d.b2SubVV(pB,pA,box2d.b2PrismaticJoint.prototype.GetJointTranslation.s_d);var axis=this.m_bodyA.GetWorldVector(this.m_localXAxisA,box2d.b2PrismaticJoint.prototype.GetJointTranslation.s_axis);var translation=box2d.b2DotVV(d,axis);return translation}
box2d.b2PrismaticJoint.prototype.GetJointTranslation.s_pA=new box2d.b2Vec2();box2d.b2PrismaticJoint.prototype.GetJointTranslation.s_pB=new box2d.b2Vec2();box2d.b2PrismaticJoint.prototype.GetJointTranslation.s_d=new box2d.b2Vec2();box2d.b2PrismaticJoint.prototype.GetJointTranslation.s_axis=new box2d.b2Vec2();box2d.b2PrismaticJoint.prototype.GetJointSpeed=function(){var bA=this.m_bodyA;var bB=this.m_bodyB;box2d.b2SubVV(this.m_localAnchorA,bA.m_sweep.localCenter,this.m_lalcA);var rA=box2d.b2MulRV(bA.m_xf.q,this.m_lalcA,this.m_rA);box2d.b2SubVV(this.m_localAnchorB,bB.m_sweep.localCenter,this.m_lalcB);var rB=box2d.b2MulRV(bB.m_xf.q,this.m_lalcB,this.m_rB);var pA=box2d.b2AddVV(bA.m_sweep.c,rA,box2d.b2Vec2.s_t0);var pB=box2d.b2AddVV(bB.m_sweep.c,rB,box2d.b2Vec2.s_t1);var d=box2d.b2SubVV(pB,pA,box2d.b2Vec2.s_t2);var axis=bA.GetWorldVector(this.m_localXAxisA,this.m_axis);var vA=bA.m_linearVelocity;var vB=bB.m_linearVelocity;var wA=bA.m_angularVelocity;var wB=bB.m_angularVelocity;var speed=box2d.b2DotVV(d,box2d.b2CrossSV(wA,axis,box2d.b2Vec2.s_t0))+box2d.b2DotVV(axis,box2d.b2SubVV(box2d.b2AddVCrossSV(vB,wB,rB,box2d.b2Vec2.s_t0),box2d.b2AddVCrossSV(vA,wA,rA,box2d.b2Vec2.s_t1),box2d.b2Vec2.s_t0));return speed}
box2d.b2PrismaticJoint.prototype.IsLimitEnabled=function(){return this.m_enableLimit}
box2d.b2PrismaticJoint.prototype.EnableLimit=function(flag){if(flag!==this.m_enableLimit){this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);this.m_enableLimit=flag;this.m_impulse.z=0}}
box2d.b2PrismaticJoint.prototype.GetLowerLimit=function(){return this.m_lowerTranslation}
box2d.b2PrismaticJoint.prototype.GetUpperLimit=function(){return this.m_upperTranslation}
box2d.b2PrismaticJoint.prototype.SetLimits=function(lower,upper){if(lower!==this.m_lowerTranslation||upper!==this.m_upperTranslation){this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);this.m_lowerTranslation=lower;this.m_upperTranslation=upper;this.m_impulse.z=0}}
box2d.b2PrismaticJoint.prototype.IsMotorEnabled=function(){return this.m_enableMotor}
box2d.b2PrismaticJoint.prototype.EnableMotor=function(flag){this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);this.m_enableMotor=flag}
box2d.b2PrismaticJoint.prototype.SetMotorSpeed=function(speed){this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);this.m_motorSpeed=speed}
box2d.b2PrismaticJoint.prototype.GetMotorSpeed=function(){return this.m_motorSpeed}
box2d.b2PrismaticJoint.prototype.SetMaxMotorForce=function(force){this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);this.m_maxMotorForce=force}
box2d.b2PrismaticJoint.prototype.GetMaxMotorForce=function(){return this.m_maxMotorForce}
box2d.b2PrismaticJoint.prototype.GetMotorForce=function(inv_dt){return inv_dt*this.m_motorImpulse}
box2d.b2PrismaticJoint.prototype.Dump=function(){if(box2d.DEBUG){var indexA=this.m_bodyA.m_islandIndex;var indexB=this.m_bodyB.m_islandIndex;box2d.b2Log("  /*box2d.b2PrismaticJointDef*/ var jd = new box2d.b2PrismaticJointDef();\n");box2d.b2Log("  jd.bodyA = bodies[%d];\n",indexA);box2d.b2Log("  jd.bodyB = bodies[%d];\n",indexB);box2d.b2Log("  jd.collideConnected = %s;\n",(this.m_collideConnected)?('true'):('false'));box2d.b2Log("  jd.localAnchorA.SetXY(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y);box2d.b2Log("  jd.localAnchorB.SetXY(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y);box2d.b2Log("  jd.localAxisA.SetXY(%.15f, %.15f);\n",this.m_localXAxisA.x,this.m_localXAxisA.y);box2d.b2Log("  jd.referenceAngle = %.15f;\n",this.m_referenceAngle);box2d.b2Log("  jd.enableLimit = %s;\n",(this.m_enableLimit)?('true'):('false'));box2d.b2Log("  jd.lowerTranslation = %.15f;\n",this.m_lowerTranslation);box2d.b2Log("  jd.upperTranslation = %.15f;\n",this.m_upperTranslation);box2d.b2Log("  jd.enableMotor = %s;\n",(this.m_enableMotor)?('true'):('false'));box2d.b2Log("  jd.motorSpeed = %.15f;\n",this.m_motorSpeed);box2d.b2Log("  jd.maxMotorForce = %.15f;\n",this.m_maxMotorForce);box2d.b2Log("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)}}
goog.provide('box2d.b2GearJoint');goog.require('box2d.b2Settings');goog.require('box2d.b2Joint');goog.require('box2d.b2Math');goog.require('box2d.b2RevoluteJoint');goog.require('box2d.b2PrismaticJoint');box2d.b2GearJointDef=function(){goog.base(this,box2d.b2JointType.e_gearJoint)}
goog.inherits(box2d.b2GearJointDef,box2d.b2JointDef);box2d.b2GearJointDef.prototype.joint1=null;box2d.b2GearJointDef.prototype.joint2=null;box2d.b2GearJointDef.prototype.ratio=1;box2d.b2GearJoint=function(def){goog.base(this,def);this.m_joint1=def.joint1;this.m_joint2=def.joint2;this.m_localAnchorA=new box2d.b2Vec2();this.m_localAnchorB=new box2d.b2Vec2();this.m_localAnchorC=new box2d.b2Vec2();this.m_localAnchorD=new box2d.b2Vec2();this.m_localAxisC=new box2d.b2Vec2();this.m_localAxisD=new box2d.b2Vec2();this.m_lcA=new box2d.b2Vec2(),this.m_lcB=new box2d.b2Vec2(),this.m_lcC=new box2d.b2Vec2(),this.m_lcD=new box2d.b2Vec2();this.m_JvAC=new box2d.b2Vec2(),this.m_JvBD=new box2d.b2Vec2();this.m_qA=new box2d.b2Rot(),this.m_qB=new box2d.b2Rot(),this.m_qC=new box2d.b2Rot(),this.m_qD=new box2d.b2Rot();this.m_lalcA=new box2d.b2Vec2(),this.m_lalcB=new box2d.b2Vec2(),this.m_lalcC=new box2d.b2Vec2(),this.m_lalcD=new box2d.b2Vec2();this.m_typeA=this.m_joint1.GetType();this.m_typeB=this.m_joint2.GetType();if(box2d.ENABLE_ASSERTS){box2d.b2Assert(this.m_typeA===box2d.b2JointType.e_revoluteJoint||this.m_typeA===box2d.b2JointType.e_prismaticJoint)}
if(box2d.ENABLE_ASSERTS){box2d.b2Assert(this.m_typeB===box2d.b2JointType.e_revoluteJoint||this.m_typeB===box2d.b2JointType.e_prismaticJoint)}
var coordinateA,coordinateB;this.m_bodyC=this.m_joint1.GetBodyA();this.m_bodyA=this.m_joint1.GetBodyB();var xfA=this.m_bodyA.m_xf;var aA=this.m_bodyA.m_sweep.a;var xfC=this.m_bodyC.m_xf;var aC=this.m_bodyC.m_sweep.a;if(this.m_typeA===box2d.b2JointType.e_revoluteJoint){var revolute=def.joint1;this.m_localAnchorC.Copy(revolute.m_localAnchorA);this.m_localAnchorA.Copy(revolute.m_localAnchorB);this.m_referenceAngleA=revolute.m_referenceAngle;this.m_localAxisC.SetZero();coordinateA=aA-aC-this.m_referenceAngleA}
else{var prismatic=def.joint1;this.m_localAnchorC.Copy(prismatic.m_localAnchorA);this.m_localAnchorA.Copy(prismatic.m_localAnchorB);this.m_referenceAngleA=prismatic.m_referenceAngle;this.m_localAxisC.Copy(prismatic.m_localXAxisA);var pC=this.m_localAnchorC;var pA=box2d.b2MulTRV(xfC.q,box2d.b2AddVV(box2d.b2MulRV(xfA.q,this.m_localAnchorA,box2d.b2Vec2.s_t0),box2d.b2SubVV(xfA.p,xfC.p,box2d.b2Vec2.s_t1),box2d.b2Vec2.s_t0),box2d.b2Vec2.s_t0);coordinateA=box2d.b2DotVV(box2d.b2SubVV(pA,pC,box2d.b2Vec2.s_t0),this.m_localAxisC)}
this.m_bodyD=this.m_joint2.GetBodyA();this.m_bodyB=this.m_joint2.GetBodyB();var xfB=this.m_bodyB.m_xf;var aB=this.m_bodyB.m_sweep.a;var xfD=this.m_bodyD.m_xf;var aD=this.m_bodyD.m_sweep.a;if(this.m_typeB===box2d.b2JointType.e_revoluteJoint){var revolute=def.joint2;this.m_localAnchorD.Copy(revolute.m_localAnchorA);this.m_localAnchorB.Copy(revolute.m_localAnchorB);this.m_referenceAngleB=revolute.m_referenceAngle;this.m_localAxisD.SetZero();coordinateB=aB-aD-this.m_referenceAngleB}
else{var prismatic=def.joint2;this.m_localAnchorD.Copy(prismatic.m_localAnchorA);this.m_localAnchorB.Copy(prismatic.m_localAnchorB);this.m_referenceAngleB=prismatic.m_referenceAngle;this.m_localAxisD.Copy(prismatic.m_localXAxisA);var pD=this.m_localAnchorD;var pB=box2d.b2MulTRV(xfD.q,box2d.b2AddVV(box2d.b2MulRV(xfB.q,this.m_localAnchorB,box2d.b2Vec2.s_t0),box2d.b2SubVV(xfB.p,xfD.p,box2d.b2Vec2.s_t1),box2d.b2Vec2.s_t0),box2d.b2Vec2.s_t0);coordinateB=box2d.b2DotVV(box2d.b2SubVV(pB,pD,box2d.b2Vec2.s_t0),this.m_localAxisD)}
this.m_ratio=def.ratio;this.m_constant=coordinateA+this.m_ratio*coordinateB;this.m_impulse=0}
goog.inherits(box2d.b2GearJoint,box2d.b2Joint);box2d.b2GearJoint.prototype.m_joint1=null;box2d.b2GearJoint.prototype.m_joint2=null;box2d.b2GearJoint.prototype.m_typeA=box2d.b2JointType.e_unknownJoint;box2d.b2GearJoint.prototype.m_typeB=box2d.b2JointType.e_unknownJoint;box2d.b2GearJoint.prototype.m_bodyC=null;box2d.b2GearJoint.prototype.m_bodyD=null;box2d.b2GearJoint.prototype.m_localAnchorA=null;box2d.b2GearJoint.prototype.m_localAnchorB=null;box2d.b2GearJoint.prototype.m_localAnchorC=null;box2d.b2GearJoint.prototype.m_localAnchorD=null;box2d.b2GearJoint.prototype.m_localAxisC=null;box2d.b2GearJoint.prototype.m_localAxisD=null;box2d.b2GearJoint.prototype.m_referenceAngleA=0;box2d.b2GearJoint.prototype.m_referenceAngleB=0;box2d.b2GearJoint.prototype.m_constant=0;box2d.b2GearJoint.prototype.m_ratio=0;box2d.b2GearJoint.prototype.m_impulse=0;box2d.b2GearJoint.prototype.m_indexA=0;box2d.b2GearJoint.prototype.m_indexB=0;box2d.b2GearJoint.prototype.m_indexC=0;box2d.b2GearJoint.prototype.m_indexD=0;box2d.b2GearJoint.prototype.m_lcA=null;box2d.b2GearJoint.prototype.m_lcB=null;box2d.b2GearJoint.prototype.m_lcC=null;box2d.b2GearJoint.prototype.m_lcD=null;box2d.b2GearJoint.prototype.m_mA=0;box2d.b2GearJoint.prototype.m_mB=0;box2d.b2GearJoint.prototype.m_mC=0;box2d.b2GearJoint.prototype.m_mD=0;box2d.b2GearJoint.prototype.m_iA=0;box2d.b2GearJoint.prototype.m_iB=0;box2d.b2GearJoint.prototype.m_iC=0;box2d.b2GearJoint.prototype.m_iD=0;box2d.b2GearJoint.prototype.m_JvAC=null;box2d.b2GearJoint.prototype.m_JvBD=null;box2d.b2GearJoint.prototype.m_JwA=0;box2d.b2GearJoint.prototype.m_JwB=0;box2d.b2GearJoint.prototype.m_JwC=0;box2d.b2GearJoint.prototype.m_JwD=0;box2d.b2GearJoint.prototype.m_mass=0;box2d.b2GearJoint.prototype.m_qA=null;box2d.b2GearJoint.prototype.m_qB=null;box2d.b2GearJoint.prototype.m_qC=null;box2d.b2GearJoint.prototype.m_qD=null;box2d.b2GearJoint.prototype.m_lalcA=null;box2d.b2GearJoint.prototype.m_lalcB=null;box2d.b2GearJoint.prototype.m_lalcC=null;box2d.b2GearJoint.prototype.m_lalcD=null;box2d.b2GearJoint.prototype.InitVelocityConstraints=function(data){this.m_indexA=this.m_bodyA.m_islandIndex;this.m_indexB=this.m_bodyB.m_islandIndex;this.m_indexC=this.m_bodyC.m_islandIndex;this.m_indexD=this.m_bodyD.m_islandIndex;this.m_lcA.Copy(this.m_bodyA.m_sweep.localCenter);this.m_lcB.Copy(this.m_bodyB.m_sweep.localCenter);this.m_lcC.Copy(this.m_bodyC.m_sweep.localCenter);this.m_lcD.Copy(this.m_bodyD.m_sweep.localCenter);this.m_mA=this.m_bodyA.m_invMass;this.m_mB=this.m_bodyB.m_invMass;this.m_mC=this.m_bodyC.m_invMass;this.m_mD=this.m_bodyD.m_invMass;this.m_iA=this.m_bodyA.m_invI;this.m_iB=this.m_bodyB.m_invI;this.m_iC=this.m_bodyC.m_invI;this.m_iD=this.m_bodyD.m_invI;var aA=data.positions[this.m_indexA].a;var vA=data.velocities[this.m_indexA].v;var wA=data.velocities[this.m_indexA].w;var aB=data.positions[this.m_indexB].a;var vB=data.velocities[this.m_indexB].v;var wB=data.velocities[this.m_indexB].w;var aC=data.positions[this.m_indexC].a;var vC=data.velocities[this.m_indexC].v;var wC=data.velocities[this.m_indexC].w;var aD=data.positions[this.m_indexD].a;var vD=data.velocities[this.m_indexD].v;var wD=data.velocities[this.m_indexD].w;var qA=this.m_qA.SetAngleRadians(aA),qB=this.m_qB.SetAngleRadians(aB),qC=this.m_qC.SetAngleRadians(aC),qD=this.m_qD.SetAngleRadians(aD);this.m_mass=0;if(this.m_typeA===box2d.b2JointType.e_revoluteJoint){this.m_JvAC.SetZero();this.m_JwA=1;this.m_JwC=1;this.m_mass+=this.m_iA+this.m_iC}
else{var u=box2d.b2MulRV(qC,this.m_localAxisC,box2d.b2GearJoint.prototype.InitVelocityConstraints.s_u);box2d.b2SubVV(this.m_localAnchorC,this.m_lcC,this.m_lalcC);var rC=box2d.b2MulRV(qC,this.m_lalcC,box2d.b2GearJoint.prototype.InitVelocityConstraints.s_rC);box2d.b2SubVV(this.m_localAnchorA,this.m_lcA,this.m_lalcA);var rA=box2d.b2MulRV(qA,this.m_lalcA,box2d.b2GearJoint.prototype.InitVelocityConstraints.s_rA);this.m_JvAC.Copy(u);this.m_JwC=box2d.b2CrossVV(rC,u);this.m_JwA=box2d.b2CrossVV(rA,u);this.m_mass+=this.m_mC+this.m_mA+this.m_iC*this.m_JwC*this.m_JwC+this.m_iA*this.m_JwA*this.m_JwA}
if(this.m_typeB===box2d.b2JointType.e_revoluteJoint){this.m_JvBD.SetZero();this.m_JwB=this.m_ratio;this.m_JwD=this.m_ratio;this.m_mass+=this.m_ratio*this.m_ratio*(this.m_iB+this.m_iD)}
else{var u=box2d.b2MulRV(qD,this.m_localAxisD,box2d.b2GearJoint.prototype.InitVelocityConstraints.s_u);box2d.b2SubVV(this.m_localAnchorD,this.m_lcD,this.m_lalcD);var rD=box2d.b2MulRV(qD,this.m_lalcD,box2d.b2GearJoint.prototype.InitVelocityConstraints.s_rD);box2d.b2SubVV(this.m_localAnchorB,this.m_lcB,this.m_lalcB);var rB=box2d.b2MulRV(qB,this.m_lalcB,box2d.b2GearJoint.prototype.InitVelocityConstraints.s_rB);box2d.b2MulSV(this.m_ratio,u,this.m_JvBD);this.m_JwD=this.m_ratio*box2d.b2CrossVV(rD,u);this.m_JwB=this.m_ratio*box2d.b2CrossVV(rB,u);this.m_mass+=this.m_ratio*this.m_ratio*(this.m_mD+this.m_mB)+this.m_iD*this.m_JwD*this.m_JwD+this.m_iB*this.m_JwB*this.m_JwB}
this.m_mass=this.m_mass>0?1/this.m_mass:0;if(data.step.warmStarting){vA.SelfMulAdd(this.m_mA*this.m_impulse,this.m_JvAC);wA+=this.m_iA*this.m_impulse*this.m_JwA;vB.SelfMulAdd(this.m_mB*this.m_impulse,this.m_JvBD);wB+=this.m_iB*this.m_impulse*this.m_JwB;vC.SelfMulSub(this.m_mC*this.m_impulse,this.m_JvAC);wC-=this.m_iC*this.m_impulse*this.m_JwC;vD.SelfMulSub(this.m_mD*this.m_impulse,this.m_JvBD);wD-=this.m_iD*this.m_impulse*this.m_JwD}
else{this.m_impulse=0}
data.velocities[this.m_indexA].w=wA;data.velocities[this.m_indexB].w=wB;data.velocities[this.m_indexC].w=wC;data.velocities[this.m_indexD].w=wD}
box2d.b2GearJoint.prototype.InitVelocityConstraints.s_u=new box2d.b2Vec2();box2d.b2GearJoint.prototype.InitVelocityConstraints.s_rA=new box2d.b2Vec2();box2d.b2GearJoint.prototype.InitVelocityConstraints.s_rB=new box2d.b2Vec2();box2d.b2GearJoint.prototype.InitVelocityConstraints.s_rC=new box2d.b2Vec2();box2d.b2GearJoint.prototype.InitVelocityConstraints.s_rD=new box2d.b2Vec2();box2d.b2GearJoint.prototype.SolveVelocityConstraints=function(data){var vA=data.velocities[this.m_indexA].v;var wA=data.velocities[this.m_indexA].w;var vB=data.velocities[this.m_indexB].v;var wB=data.velocities[this.m_indexB].w;var vC=data.velocities[this.m_indexC].v;var wC=data.velocities[this.m_indexC].w;var vD=data.velocities[this.m_indexD].v;var wD=data.velocities[this.m_indexD].w;var Cdot=box2d.b2DotVV(this.m_JvAC,box2d.b2SubVV(vA,vC,box2d.b2Vec2.s_t0))+box2d.b2DotVV(this.m_JvBD,box2d.b2SubVV(vB,vD,box2d.b2Vec2.s_t0));Cdot+=(this.m_JwA*wA-this.m_JwC*wC)+(this.m_JwB*wB-this.m_JwD*wD);var impulse=-this.m_mass*Cdot;this.m_impulse+=impulse;vA.SelfMulAdd((this.m_mA*impulse),this.m_JvAC);wA+=this.m_iA*impulse*this.m_JwA;vB.SelfMulAdd((this.m_mB*impulse),this.m_JvBD);wB+=this.m_iB*impulse*this.m_JwB;vC.SelfMulSub((this.m_mC*impulse),this.m_JvAC);wC-=this.m_iC*impulse*this.m_JwC;vD.SelfMulSub((this.m_mD*impulse),this.m_JvBD);wD-=this.m_iD*impulse*this.m_JwD;data.velocities[this.m_indexA].w=wA;data.velocities[this.m_indexB].w=wB;data.velocities[this.m_indexC].w=wC;data.velocities[this.m_indexD].w=wD}
box2d.b2GearJoint.prototype.SolvePositionConstraints=function(data){var cA=data.positions[this.m_indexA].c;var aA=data.positions[this.m_indexA].a;var cB=data.positions[this.m_indexB].c;var aB=data.positions[this.m_indexB].a;var cC=data.positions[this.m_indexC].c;var aC=data.positions[this.m_indexC].a;var cD=data.positions[this.m_indexD].c;var aD=data.positions[this.m_indexD].a;var qA=this.m_qA.SetAngleRadians(aA),qB=this.m_qB.SetAngleRadians(aB),qC=this.m_qC.SetAngleRadians(aC),qD=this.m_qD.SetAngleRadians(aD);var linearError=0;var coordinateA,coordinateB;var JvAC=this.m_JvAC,JvBD=this.m_JvBD;var JwA,JwB,JwC,JwD;var mass=0;if(this.m_typeA===box2d.b2JointType.e_revoluteJoint){JvAC.SetZero();JwA=1;JwC=1;mass+=this.m_iA+this.m_iC;coordinateA=aA-aC-this.m_referenceAngleA}
else{var u=box2d.b2MulRV(qC,this.m_localAxisC,box2d.b2GearJoint.prototype.SolvePositionConstraints.s_u);var rC=box2d.b2MulRV(qC,this.m_lalcC,box2d.b2GearJoint.prototype.SolvePositionConstraints.s_rC);var rA=box2d.b2MulRV(qA,this.m_lalcA,box2d.b2GearJoint.prototype.SolvePositionConstraints.s_rA);JvAC.Copy(u);JwC=box2d.b2CrossVV(rC,u);JwA=box2d.b2CrossVV(rA,u);mass+=this.m_mC+this.m_mA+this.m_iC*JwC*JwC+this.m_iA*JwA*JwA;var pC=this.m_lalcC;var pA=box2d.b2MulTRV(qC,box2d.b2AddVV(rA,box2d.b2SubVV(cA,cC,box2d.b2Vec2.s_t0),box2d.b2Vec2.s_t0),box2d.b2Vec2.s_t0);coordinateA=box2d.b2DotVV(box2d.b2SubVV(pA,pC,box2d.b2Vec2.s_t0),this.m_localAxisC)}
if(this.m_typeB===box2d.b2JointType.e_revoluteJoint){JvBD.SetZero();JwB=this.m_ratio;JwD=this.m_ratio;mass+=this.m_ratio*this.m_ratio*(this.m_iB+this.m_iD);coordinateB=aB-aD-this.m_referenceAngleB}
else{var u=box2d.b2MulRV(qD,this.m_localAxisD,box2d.b2GearJoint.prototype.SolvePositionConstraints.s_u);var rD=box2d.b2MulRV(qD,this.m_lalcD,box2d.b2GearJoint.prototype.SolvePositionConstraints.s_rD);var rB=box2d.b2MulRV(qB,this.m_lalcB,box2d.b2GearJoint.prototype.SolvePositionConstraints.s_rB);box2d.b2MulSV(this.m_ratio,u,JvBD);JwD=this.m_ratio*box2d.b2CrossVV(rD,u);JwB=this.m_ratio*box2d.b2CrossVV(rB,u);mass+=this.m_ratio*this.m_ratio*(this.m_mD+this.m_mB)+this.m_iD*JwD*JwD+this.m_iB*JwB*JwB;var pD=this.m_lalcD;var pB=box2d.b2MulTRV(qD,box2d.b2AddVV(rB,box2d.b2SubVV(cB,cD,box2d.b2Vec2.s_t0),box2d.b2Vec2.s_t0),box2d.b2Vec2.s_t0);coordinateB=box2d.b2DotVV(box2d.b2SubVV(pB,pD,box2d.b2Vec2.s_t0),this.m_localAxisD)}
var C=(coordinateA+this.m_ratio*coordinateB)-this.m_constant;var impulse=0;if(mass>0){impulse=-C/mass}
cA.SelfMulAdd(this.m_mA*impulse,JvAC);aA+=this.m_iA*impulse*JwA;cB.SelfMulAdd(this.m_mB*impulse,JvBD);aB+=this.m_iB*impulse*JwB;cC.SelfMulSub(this.m_mC*impulse,JvAC);aC-=this.m_iC*impulse*JwC;cD.SelfMulSub(this.m_mD*impulse,JvBD);aD-=this.m_iD*impulse*JwD;data.positions[this.m_indexA].a=aA;data.positions[this.m_indexB].a=aB;data.positions[this.m_indexC].a=aC;data.positions[this.m_indexD].a=aD;return linearError<box2d.b2_linearSlop}
box2d.b2GearJoint.prototype.SolvePositionConstraints.s_u=new box2d.b2Vec2();box2d.b2GearJoint.prototype.SolvePositionConstraints.s_rA=new box2d.b2Vec2();box2d.b2GearJoint.prototype.SolvePositionConstraints.s_rB=new box2d.b2Vec2();box2d.b2GearJoint.prototype.SolvePositionConstraints.s_rC=new box2d.b2Vec2();box2d.b2GearJoint.prototype.SolvePositionConstraints.s_rD=new box2d.b2Vec2();box2d.b2GearJoint.prototype.GetAnchorA=function(out){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,out)}
box2d.b2GearJoint.prototype.GetAnchorB=function(out){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,out)}
box2d.b2GearJoint.prototype.GetReactionForce=function(inv_dt,out){return box2d.b2MulSV(inv_dt*this.m_impulse,this.m_JvAC,out)}
box2d.b2GearJoint.prototype.GetReactionTorque=function(inv_dt){return inv_dt*this.m_impulse*this.m_JwA}
box2d.b2GearJoint.prototype.GetJoint1=function(){return this.m_joint1}
box2d.b2GearJoint.prototype.GetJoint2=function(){return this.m_joint2}
box2d.b2GearJoint.prototype.GetRatio=function(){return this.m_ratio}
box2d.b2GearJoint.prototype.SetRatio=function(ratio){if(box2d.ENABLE_ASSERTS){box2d.b2Assert(box2d.b2IsValid(ratio))}
this.m_ratio=ratio}
box2d.b2GearJoint.prototype.Dump=function(){if(box2d.DEBUG){var indexA=this.m_bodyA.m_islandIndex;var indexB=this.m_bodyB.m_islandIndex;var index1=this.m_joint1.m_index;var index2=this.m_joint2.m_index;box2d.b2Log("  /*box2d.b2GearJointDef*/ var jd = new box2d.b2GearJointDef();\n");box2d.b2Log("  jd.bodyA = bodies[%d];\n",indexA);box2d.b2Log("  jd.bodyB = bodies[%d];\n",indexB);box2d.b2Log("  jd.collideConnected = %s;\n",(this.m_collideConnected)?('true'):('false'));box2d.b2Log("  jd.joint1 = joints[%d];\n",index1);box2d.b2Log("  jd.joint2 = joints[%d];\n",index2);box2d.b2Log("  jd.ratio = %.15f;\n",this.m_ratio);box2d.b2Log("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)}}
goog.provide('box2d.b2Distance');goog.require('box2d.b2Settings');goog.require('box2d.b2Math');box2d.b2DistanceProxy=function(){this.m_buffer=box2d.b2Vec2.MakeArray(2)};box2d.b2DistanceProxy.prototype.m_buffer=null;box2d.b2DistanceProxy.prototype.m_vertices=null;box2d.b2DistanceProxy.prototype.m_count=0;box2d.b2DistanceProxy.prototype.m_radius=0;box2d.b2DistanceProxy.prototype.Reset=function(){this.m_vertices=null;this.m_count=0;this.m_radius=0;return this}
box2d.b2DistanceProxy.prototype.SetShape=function(shape,index){shape.SetupDistanceProxy(this,index)}
box2d.b2DistanceProxy.prototype.GetSupport=function(d){var bestIndex=0;var bestValue=box2d.b2DotVV(this.m_vertices[0],d);for(var i=1;i<this.m_count;++i){var value=box2d.b2DotVV(this.m_vertices[i],d);if(value>bestValue){bestIndex=i;bestValue=value}}
return bestIndex}
box2d.b2DistanceProxy.prototype.GetSupportVertex=function(d,out){var bestIndex=0;var bestValue=box2d.b2DotVV(this.m_vertices[0],d);for(var i=1;i<this.m_count;++i){var value=box2d.b2DotVV(this.m_vertices[i],d);if(value>bestValue){bestIndex=i;bestValue=value}}
return out.Copy(this.m_vertices[bestIndex])}
box2d.b2DistanceProxy.prototype.GetVertexCount=function(){return this.m_count}
box2d.b2DistanceProxy.prototype.GetVertex=function(index){if(box2d.ENABLE_ASSERTS){box2d.b2Assert(0<=index&&index<this.m_count)}
return this.m_vertices[index]}
box2d.b2SimplexCache=function(){this.indexA=box2d.b2MakeNumberArray(3);this.indexB=box2d.b2MakeNumberArray(3)};box2d.b2SimplexCache.prototype.metric=0;box2d.b2SimplexCache.prototype.count=0;box2d.b2SimplexCache.prototype.indexA=null;box2d.b2SimplexCache.prototype.indexB=null;box2d.b2SimplexCache.prototype.Reset=function(){this.metric=0;this.count=0;return this}
box2d.b2DistanceInput=function(){this.proxyA=new box2d.b2DistanceProxy();this.proxyB=new box2d.b2DistanceProxy();this.transformA=new box2d.b2Transform();this.transformB=new box2d.b2Transform()};box2d.b2DistanceInput.prototype.proxyA=null;box2d.b2DistanceInput.prototype.proxyB=null;box2d.b2DistanceInput.prototype.transformA=null;box2d.b2DistanceInput.prototype.transformB=null;box2d.b2DistanceInput.prototype.useRadii=!1;box2d.b2DistanceInput.prototype.Reset=function(){this.proxyA.Reset();this.proxyB.Reset();this.transformA.SetIdentity();this.transformB.SetIdentity();this.useRadii=!1;return this}
box2d.b2DistanceOutput=function(){this.pointA=new box2d.b2Vec2();this.pointB=new box2d.b2Vec2()};box2d.b2DistanceOutput.prototype.pointA=null;box2d.b2DistanceOutput.prototype.pointB=null;box2d.b2DistanceOutput.prototype.distance=0;box2d.b2DistanceOutput.prototype.iterations=0;box2d.b2DistanceOutput.prototype.Reset=function(){this.pointA.SetZero();this.pointB.SetZero();this.distance=0;this.iterations=0;return this}
box2d.b2_gjkCalls=0;box2d.b2_gjkIters=0;box2d.b2_gjkMaxIters=0;box2d.b2SimplexVertex=function(){this.wA=new box2d.b2Vec2();this.wB=new box2d.b2Vec2();this.w=new box2d.b2Vec2()};box2d.b2SimplexVertex.prototype.wA=null;box2d.b2SimplexVertex.prototype.wB=null;box2d.b2SimplexVertex.prototype.w=null;box2d.b2SimplexVertex.prototype.a=0;box2d.b2SimplexVertex.prototype.indexA=0;box2d.b2SimplexVertex.prototype.indexB=0;box2d.b2SimplexVertex.prototype.Copy=function(other){this.wA.Copy(other.wA);this.wB.Copy(other.wB);this.w.Copy(other.w);this.a=other.a;this.indexA=other.indexA;this.indexB=other.indexB;return this}
box2d.b2Simplex=function(){this.m_v1=new box2d.b2SimplexVertex();this.m_v2=new box2d.b2SimplexVertex();this.m_v3=new box2d.b2SimplexVertex();this.m_vertices=new Array(3);this.m_vertices[0]=this.m_v1;this.m_vertices[1]=this.m_v2;this.m_vertices[2]=this.m_v3}
box2d.b2Simplex.prototype.m_v1=null;box2d.b2Simplex.prototype.m_v2=null;box2d.b2Simplex.prototype.m_v3=null;box2d.b2Simplex.prototype.m_vertices=null;box2d.b2Simplex.prototype.m_count=0;box2d.b2Simplex.prototype.ReadCache=function(cache,proxyA,transformA,proxyB,transformB){if(box2d.ENABLE_ASSERTS){box2d.b2Assert(0<=cache.count&&cache.count<=3)}
this.m_count=cache.count;var vertices=this.m_vertices;for(var i=0;i<this.m_count;++i){var v=vertices[i];v.indexA=cache.indexA[i];v.indexB=cache.indexB[i];var wALocal=proxyA.GetVertex(v.indexA);var wBLocal=proxyB.GetVertex(v.indexB);box2d.b2MulXV(transformA,wALocal,v.wA);box2d.b2MulXV(transformB,wBLocal,v.wB);box2d.b2SubVV(v.wB,v.wA,v.w);v.a=0}
if(this.m_count>1){var metric1=cache.metric;var metric2=this.GetMetric();if(metric2<0.5*metric1||2*metric1<metric2||metric2<box2d.b2_epsilon){this.m_count=0}}
if(this.m_count===0){var v=vertices[0];v.indexA=0;v.indexB=0;var wALocal=proxyA.GetVertex(0);var wBLocal=proxyB.GetVertex(0);box2d.b2MulXV(transformA,wALocal,v.wA);box2d.b2MulXV(transformB,wBLocal,v.wB);box2d.b2SubVV(v.wB,v.wA,v.w);v.a=1;this.m_count=1}}
box2d.b2Simplex.prototype.WriteCache=function(cache){cache.metric=this.GetMetric();cache.count=this.m_count;var vertices=this.m_vertices;for(var i=0;i<this.m_count;++i){cache.indexA[i]=vertices[i].indexA;cache.indexB[i]=vertices[i].indexB}}
box2d.b2Simplex.prototype.GetSearchDirection=function(out){switch(this.m_count){case 1:return box2d.b2NegV(this.m_v1.w,out);case 2:{var e12=box2d.b2SubVV(this.m_v2.w,this.m_v1.w,out);var sgn=box2d.b2CrossVV(e12,box2d.b2NegV(this.m_v1.w,box2d.b2Vec2.s_t0));if(sgn>0){return box2d.b2CrossOneV(e12,out)}
else{return box2d.b2CrossVOne(e12,out)}}
default:if(box2d.ENABLE_ASSERTS){box2d.b2Assert(!1)}
return out.SetZero()}}
box2d.b2Simplex.prototype.GetClosestPoint=function(out){switch(this.m_count){case 0:if(box2d.ENABLE_ASSERTS){box2d.b2Assert(!1)}
return out.SetZero();case 1:return out.Copy(this.m_v1.w);case 2:return out.SetXY(this.m_v1.a*this.m_v1.w.x+this.m_v2.a*this.m_v2.w.x,this.m_v1.a*this.m_v1.w.y+this.m_v2.a*this.m_v2.w.y);case 3:return out.SetZero();default:if(box2d.ENABLE_ASSERTS){box2d.b2Assert(!1)}
return out.SetZero()}}
box2d.b2Simplex.prototype.GetWitnessPoints=function(pA,pB){switch(this.m_count){case 0:if(box2d.ENABLE_ASSERTS){box2d.b2Assert(!1)}
break;case 1:pA.Copy(this.m_v1.wA);pB.Copy(this.m_v1.wB);break;case 2:pA.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x;pA.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y;pB.x=this.m_v1.a*this.m_v1.wB.x+this.m_v2.a*this.m_v2.wB.x;pB.y=this.m_v1.a*this.m_v1.wB.y+this.m_v2.a*this.m_v2.wB.y;break;case 3:pB.x=pA.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x+this.m_v3.a*this.m_v3.wA.x;pB.y=pA.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y+this.m_v3.a*this.m_v3.wA.y;break;default:if(box2d.ENABLE_ASSERTS){box2d.b2Assert(!1)}
break}}
box2d.b2Simplex.prototype.GetMetric=function(){switch(this.m_count){case 0:if(box2d.ENABLE_ASSERTS){box2d.b2Assert(!1)}
return 0;case 1:return 0;case 2:return box2d.b2DistanceVV(this.m_v1.w,this.m_v2.w);case 3:return box2d.b2CrossVV(box2d.b2SubVV(this.m_v2.w,this.m_v1.w,box2d.b2Vec2.s_t0),box2d.b2SubVV(this.m_v3.w,this.m_v1.w,box2d.b2Vec2.s_t1));default:if(box2d.ENABLE_ASSERTS){box2d.b2Assert(!1)}
return 0}}
box2d.b2Simplex.prototype.Solve2=function(){var w1=this.m_v1.w;var w2=this.m_v2.w;var e12=box2d.b2SubVV(w2,w1,box2d.b2Simplex.s_e12);var d12_2=(-box2d.b2DotVV(w1,e12));if(d12_2<=0){this.m_v1.a=1;this.m_count=1;return}
var d12_1=box2d.b2DotVV(w2,e12);if(d12_1<=0){this.m_v2.a=1;this.m_count=1;this.m_v1.Copy(this.m_v2);return}
var inv_d12=1/(d12_1+d12_2);this.m_v1.a=d12_1*inv_d12;this.m_v2.a=d12_2*inv_d12;this.m_count=2}
box2d.b2Simplex.prototype.Solve3=function(){var w1=this.m_v1.w;var w2=this.m_v2.w;var w3=this.m_v3.w;var e12=box2d.b2SubVV(w2,w1,box2d.b2Simplex.s_e12);var w1e12=box2d.b2DotVV(w1,e12);var w2e12=box2d.b2DotVV(w2,e12);var d12_1=w2e12;var d12_2=(-w1e12);var e13=box2d.b2SubVV(w3,w1,box2d.b2Simplex.s_e13);var w1e13=box2d.b2DotVV(w1,e13);var w3e13=box2d.b2DotVV(w3,e13);var d13_1=w3e13;var d13_2=(-w1e13);var e23=box2d.b2SubVV(w3,w2,box2d.b2Simplex.s_e23);var w2e23=box2d.b2DotVV(w2,e23);var w3e23=box2d.b2DotVV(w3,e23);var d23_1=w3e23;var d23_2=(-w2e23);var n123=box2d.b2CrossVV(e12,e13);var d123_1=n123*box2d.b2CrossVV(w2,w3);var d123_2=n123*box2d.b2CrossVV(w3,w1);var d123_3=n123*box2d.b2CrossVV(w1,w2);if(d12_2<=0&&d13_2<=0){this.m_v1.a=1;this.m_count=1;return}
if(d12_1>0&&d12_2>0&&d123_3<=0){var inv_d12=1/(d12_1+d12_2);this.m_v1.a=d12_1*inv_d12;this.m_v2.a=d12_2*inv_d12;this.m_count=2;return}
if(d13_1>0&&d13_2>0&&d123_2<=0){var inv_d13=1/(d13_1+d13_2);this.m_v1.a=d13_1*inv_d13;this.m_v3.a=d13_2*inv_d13;this.m_count=2;this.m_v2.Copy(this.m_v3);return}
if(d12_1<=0&&d23_2<=0){this.m_v2.a=1;this.m_count=1;this.m_v1.Copy(this.m_v2);return}
if(d13_1<=0&&d23_1<=0){this.m_v3.a=1;this.m_count=1;this.m_v1.Copy(this.m_v3);return}
if(d23_1>0&&d23_2>0&&d123_1<=0){var inv_d23=1/(d23_1+d23_2);this.m_v2.a=d23_1*inv_d23;this.m_v3.a=d23_2*inv_d23;this.m_count=2;this.m_v1.Copy(this.m_v3);return}
var inv_d123=1/(d123_1+d123_2+d123_3);this.m_v1.a=d123_1*inv_d123;this.m_v2.a=d123_2*inv_d123;this.m_v3.a=d123_3*inv_d123;this.m_count=3}
box2d.b2Simplex.s_e12=new box2d.b2Vec2();box2d.b2Simplex.s_e13=new box2d.b2Vec2();box2d.b2Simplex.s_e23=new box2d.b2Vec2();box2d.b2Distance=function(output,cache,input){++box2d.b2_gjkCalls;var proxyA=input.proxyA;var proxyB=input.proxyB;var transformA=input.transformA;var transformB=input.transformB;var simplex=box2d.b2Distance.s_simplex;simplex.ReadCache(cache,proxyA,transformA,proxyB,transformB);var vertices=simplex.m_vertices;var k_maxIters=20;var saveA=box2d.b2Distance.s_saveA;var saveB=box2d.b2Distance.s_saveB;var saveCount=0;var distanceSqr1=box2d.b2_maxFloat;var distanceSqr2=distanceSqr1;var iter=0;while(iter<k_maxIters){saveCount=simplex.m_count;for(var i=0;i<saveCount;++i){saveA[i]=vertices[i].indexA;saveB[i]=vertices[i].indexB}
switch(simplex.m_count){case 1:break;case 2:simplex.Solve2();break;case 3:simplex.Solve3();break;default:if(box2d.ENABLE_ASSERTS){box2d.b2Assert(!1)}}
if(simplex.m_count===3){break}
var p=simplex.GetClosestPoint(box2d.b2Distance.s_p);distanceSqr2=p.GetLengthSquared();distanceSqr1=distanceSqr2;var d=simplex.GetSearchDirection(box2d.b2Distance.s_d);if(d.GetLengthSquared()<box2d.b2_epsilon_sq){break}
var vertex=vertices[simplex.m_count];vertex.indexA=proxyA.GetSupport(box2d.b2MulTRV(transformA.q,box2d.b2NegV(d,box2d.b2Vec2.s_t0),box2d.b2Distance.s_supportA));box2d.b2MulXV(transformA,proxyA.GetVertex(vertex.indexA),vertex.wA);vertex.indexB=proxyB.GetSupport(box2d.b2MulTRV(transformB.q,d,box2d.b2Distance.s_supportB));box2d.b2MulXV(transformB,proxyB.GetVertex(vertex.indexB),vertex.wB);box2d.b2SubVV(vertex.wB,vertex.wA,vertex.w);++iter;++box2d.b2_gjkIters;var duplicate=!1;for(var i=0;i<saveCount;++i){if(vertex.indexA===saveA[i]&&vertex.indexB===saveB[i]){duplicate=!0;break}}
if(duplicate){break}
++simplex.m_count}
box2d.b2_gjkMaxIters=box2d.b2Max(box2d.b2_gjkMaxIters,iter);simplex.GetWitnessPoints(output.pointA,output.pointB);output.distance=box2d.b2DistanceVV(output.pointA,output.pointB);output.iterations=iter;simplex.WriteCache(cache);if(input.useRadii){var rA=proxyA.m_radius;var rB=proxyB.m_radius;if(output.distance>(rA+rB)&&output.distance>box2d.b2_epsilon){output.distance-=rA+rB;var normal=box2d.b2SubVV(output.pointB,output.pointA,box2d.b2Distance.s_normal);normal.Normalize();output.pointA.SelfMulAdd(rA,normal);output.pointB.SelfMulSub(rB,normal)}
else{var p=box2d.b2MidVV(output.pointA,output.pointB,box2d.b2Distance.s_p);output.pointA.Copy(p);output.pointB.Copy(p);output.distance=0}}}
box2d.b2Distance.s_simplex=new box2d.b2Simplex();box2d.b2Distance.s_saveA=box2d.b2MakeNumberArray(3);box2d.b2Distance.s_saveB=box2d.b2MakeNumberArray(3);box2d.b2Distance.s_p=new box2d.b2Vec2();box2d.b2Distance.s_d=new box2d.b2Vec2();box2d.b2Distance.s_normal=new box2d.b2Vec2();box2d.b2Distance.s_supportA=new box2d.b2Vec2();box2d.b2Distance.s_supportB=new box2d.b2Vec2();goog.provide('box2d.b2WeldJoint');goog.require('box2d.b2Settings');goog.require('box2d.b2Joint');goog.require('box2d.b2Math');box2d.b2WeldJointDef=function(){goog.base(this,box2d.b2JointType.e_weldJoint);this.localAnchorA=new box2d.b2Vec2();this.localAnchorB=new box2d.b2Vec2()}
goog.inherits(box2d.b2WeldJointDef,box2d.b2JointDef);box2d.b2WeldJointDef.prototype.localAnchorA=null;box2d.b2WeldJointDef.prototype.localAnchorB=null;box2d.b2WeldJointDef.prototype.referenceAngle=0;box2d.b2WeldJointDef.prototype.frequencyHz=0;box2d.b2WeldJointDef.prototype.dampingRatio=0;box2d.b2WeldJointDef.prototype.Initialize=function(bA,bB,anchor){this.bodyA=bA;this.bodyB=bB;this.bodyA.GetLocalPoint(anchor,this.localAnchorA);this.bodyB.GetLocalPoint(anchor,this.localAnchorB);this.referenceAngle=this.bodyB.GetAngleRadians()-this.bodyA.GetAngleRadians()}
box2d.b2WeldJoint=function(def){goog.base(this,def);this.m_frequencyHz=def.frequencyHz;this.m_dampingRatio=def.dampingRatio;this.m_localAnchorA=def.localAnchorA.Clone();this.m_localAnchorB=def.localAnchorB.Clone();this.m_referenceAngle=def.referenceAngle;this.m_impulse=new box2d.b2Vec3(0,0,0);this.m_rA=new box2d.b2Vec2();this.m_rB=new box2d.b2Vec2();this.m_localCenterA=new box2d.b2Vec2();this.m_localCenterB=new box2d.b2Vec2();this.m_mass=new box2d.b2Mat33();this.m_qA=new box2d.b2Rot();this.m_qB=new box2d.b2Rot();this.m_lalcA=new box2d.b2Vec2();this.m_lalcB=new box2d.b2Vec2();this.m_K=new box2d.b2Mat33()}
goog.inherits(box2d.b2WeldJoint,box2d.b2Joint);box2d.b2WeldJoint.prototype.m_frequencyHz=0;box2d.b2WeldJoint.prototype.m_dampingRatio=0;box2d.b2WeldJoint.prototype.m_bias=0;box2d.b2WeldJoint.prototype.m_localAnchorA=null;box2d.b2WeldJoint.prototype.m_localAnchorB=null;box2d.b2WeldJoint.prototype.m_referenceAngle=0;box2d.b2WeldJoint.prototype.m_gamma=0;box2d.b2WeldJoint.prototype.m_impulse=null;box2d.b2WeldJoint.prototype.m_indexA=0;box2d.b2WeldJoint.prototype.m_indexB=0;box2d.b2WeldJoint.prototype.m_rA=null;box2d.b2WeldJoint.prototype.m_rB=null;box2d.b2WeldJoint.prototype.m_localCenterA=null;box2d.b2WeldJoint.prototype.m_localCenterB=null;box2d.b2WeldJoint.prototype.m_invMassA=0;box2d.b2WeldJoint.prototype.m_invMassB=0;box2d.b2WeldJoint.prototype.m_invIA=0;box2d.b2WeldJoint.prototype.m_invIB=0;box2d.b2WeldJoint.prototype.m_mass=null;box2d.b2WeldJoint.prototype.m_qA=null;box2d.b2WeldJoint.prototype.m_qB=null;box2d.b2WeldJoint.prototype.m_lalcA=null;box2d.b2WeldJoint.prototype.m_lalcB=null;box2d.b2WeldJoint.prototype.m_K=null;box2d.b2WeldJoint.prototype.InitVelocityConstraints=function(data){this.m_indexA=this.m_bodyA.m_islandIndex;this.m_indexB=this.m_bodyB.m_islandIndex;this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter);this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter);this.m_invMassA=this.m_bodyA.m_invMass;this.m_invMassB=this.m_bodyB.m_invMass;this.m_invIA=this.m_bodyA.m_invI;this.m_invIB=this.m_bodyB.m_invI;var aA=data.positions[this.m_indexA].a;var vA=data.velocities[this.m_indexA].v;var wA=data.velocities[this.m_indexA].w;var aB=data.positions[this.m_indexB].a;var vB=data.velocities[this.m_indexB].v;var wB=data.velocities[this.m_indexB].w;var qA=this.m_qA.SetAngleRadians(aA),qB=this.m_qB.SetAngleRadians(aB);box2d.b2SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);box2d.b2MulRV(qA,this.m_lalcA,this.m_rA);box2d.b2SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);box2d.b2MulRV(qB,this.m_lalcB,this.m_rB);var mA=this.m_invMassA,mB=this.m_invMassB;var iA=this.m_invIA,iB=this.m_invIB;var K=this.m_K;K.ex.x=mA+mB+this.m_rA.y*this.m_rA.y*iA+this.m_rB.y*this.m_rB.y*iB;K.ey.x=-this.m_rA.y*this.m_rA.x*iA-this.m_rB.y*this.m_rB.x*iB;K.ez.x=-this.m_rA.y*iA-this.m_rB.y*iB;K.ex.y=K.ey.x;K.ey.y=mA+mB+this.m_rA.x*this.m_rA.x*iA+this.m_rB.x*this.m_rB.x*iB;K.ez.y=this.m_rA.x*iA+this.m_rB.x*iB;K.ex.z=K.ez.x;K.ey.z=K.ez.y;K.ez.z=iA+iB;if(this.m_frequencyHz>0){K.GetInverse22(this.m_mass);var invM=iA+iB;var m=invM>0?1/invM:0;var C=aB-aA-this.m_referenceAngle;var omega=2*box2d.b2_pi*this.m_frequencyHz;var d=2*m*this.m_dampingRatio*omega;var k=m*omega*omega;var h=data.step.dt;this.m_gamma=h*(d+h*k);this.m_gamma=this.m_gamma!==0?1/this.m_gamma:0;this.m_bias=C*h*k*this.m_gamma;invM+=this.m_gamma;this.m_mass.ez.z=invM!==0?1/invM:0}
else{K.GetSymInverse33(this.m_mass);this.m_gamma=0;this.m_bias=0}
if(data.step.warmStarting){this.m_impulse.SelfMul(data.step.dtRatio);var P=box2d.b2WeldJoint.prototype.InitVelocityConstraints.s_P.SetXY(this.m_impulse.x,this.m_impulse.y);vA.SelfMulSub(mA,P);wA-=iA*(box2d.b2CrossVV(this.m_rA,P)+this.m_impulse.z);vB.SelfMulAdd(mB,P);wB+=iB*(box2d.b2CrossVV(this.m_rB,P)+this.m_impulse.z)}
else{this.m_impulse.SetZero()}
data.velocities[this.m_indexA].w=wA;data.velocities[this.m_indexB].w=wB}
box2d.b2WeldJoint.prototype.InitVelocityConstraints.s_P=new box2d.b2Vec2();box2d.b2WeldJoint.prototype.SolveVelocityConstraints=function(data){var vA=data.velocities[this.m_indexA].v;var wA=data.velocities[this.m_indexA].w;var vB=data.velocities[this.m_indexB].v;var wB=data.velocities[this.m_indexB].w;var mA=this.m_invMassA,mB=this.m_invMassB;var iA=this.m_invIA,iB=this.m_invIB;if(this.m_frequencyHz>0){var Cdot2=wB-wA;var impulse2=-this.m_mass.ez.z*(Cdot2+this.m_bias+this.m_gamma*this.m_impulse.z);this.m_impulse.z+=impulse2;wA-=iA*impulse2;wB+=iB*impulse2;var Cdot1=box2d.b2SubVV(box2d.b2AddVCrossSV(vB,wB,this.m_rB,box2d.b2Vec2.s_t0),box2d.b2AddVCrossSV(vA,wA,this.m_rA,box2d.b2Vec2.s_t1),box2d.b2WeldJoint.prototype.SolveVelocityConstraints.s_Cdot1)
var impulse1=box2d.b2MulM33XY(this.m_mass,Cdot1.x,Cdot1.y,box2d.b2WeldJoint.prototype.SolveVelocityConstraints.s_impulse1).SelfNeg();this.m_impulse.x+=impulse1.x;this.m_impulse.y+=impulse1.y;var P=impulse1;vA.SelfMulSub(mA,P);wA-=iA*box2d.b2CrossVV(this.m_rA,P);vB.SelfMulAdd(mB,P);wB+=iB*box2d.b2CrossVV(this.m_rB,P)}
else{var Cdot1=box2d.b2SubVV(box2d.b2AddVCrossSV(vB,wB,this.m_rB,box2d.b2Vec2.s_t0),box2d.b2AddVCrossSV(vA,wA,this.m_rA,box2d.b2Vec2.s_t1),box2d.b2WeldJoint.prototype.SolveVelocityConstraints.s_Cdot1)
var Cdot2=wB-wA;var impulse=box2d.b2MulM33XYZ(this.m_mass,Cdot1.x,Cdot1.y,Cdot2,box2d.b2WeldJoint.prototype.SolveVelocityConstraints.s_impulse).SelfNeg();this.m_impulse.SelfAdd(impulse);var P=box2d.b2WeldJoint.prototype.SolveVelocityConstraints.s_P.SetXY(impulse.x,impulse.y);vA.SelfMulSub(mA,P);wA-=iA*(box2d.b2CrossVV(this.m_rA,P)+impulse.z);vB.SelfMulAdd(mB,P);wB+=iB*(box2d.b2CrossVV(this.m_rB,P)+impulse.z)}
data.velocities[this.m_indexA].w=wA;data.velocities[this.m_indexB].w=wB}
box2d.b2WeldJoint.prototype.SolveVelocityConstraints.s_Cdot1=new box2d.b2Vec2();box2d.b2WeldJoint.prototype.SolveVelocityConstraints.s_impulse1=new box2d.b2Vec2();box2d.b2WeldJoint.prototype.SolveVelocityConstraints.s_impulse=new box2d.b2Vec3();box2d.b2WeldJoint.prototype.SolveVelocityConstraints.s_P=new box2d.b2Vec2();box2d.b2WeldJoint.prototype.SolvePositionConstraints=function(data){var cA=data.positions[this.m_indexA].c;var aA=data.positions[this.m_indexA].a;var cB=data.positions[this.m_indexB].c;var aB=data.positions[this.m_indexB].a;var qA=this.m_qA.SetAngleRadians(aA),qB=this.m_qB.SetAngleRadians(aB);var mA=this.m_invMassA,mB=this.m_invMassB;var iA=this.m_invIA,iB=this.m_invIB;box2d.b2SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);var rA=box2d.b2MulRV(qA,this.m_lalcA,this.m_rA);box2d.b2SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);var rB=box2d.b2MulRV(qB,this.m_lalcB,this.m_rB);var positionError,angularError;var K=this.m_K;K.ex.x=mA+mB+rA.y*rA.y*iA+rB.y*rB.y*iB;K.ey.x=-rA.y*rA.x*iA-rB.y*rB.x*iB;K.ez.x=-rA.y*iA-rB.y*iB;K.ex.y=K.ey.x;K.ey.y=mA+mB+rA.x*rA.x*iA+rB.x*rB.x*iB;K.ez.y=rA.x*iA+rB.x*iB;K.ex.z=K.ez.x;K.ey.z=K.ez.y;K.ez.z=iA+iB;if(this.m_frequencyHz>0){var C1=box2d.b2SubVV(box2d.b2AddVV(cB,rB,box2d.b2Vec2.s_t0),box2d.b2AddVV(cA,rA,box2d.b2Vec2.s_t1),box2d.b2WeldJoint.prototype.SolvePositionConstraints.s_C1);positionError=C1.GetLength();angularError=0;var P=K.Solve22(C1.x,C1.y,box2d.b2WeldJoint.prototype.SolvePositionConstraints.s_P).SelfNeg();cA.SelfMulSub(mA,P);aA-=iA*box2d.b2CrossVV(rA,P);cB.SelfMulAdd(mB,P);aB+=iB*box2d.b2CrossVV(rB,P)}
else{var C1=box2d.b2SubVV(box2d.b2AddVV(cB,rB,box2d.b2Vec2.s_t0),box2d.b2AddVV(cA,rA,box2d.b2Vec2.s_t1),box2d.b2WeldJoint.prototype.SolvePositionConstraints.s_C1);var C2=aB-aA-this.m_referenceAngle;positionError=C1.GetLength();angularError=box2d.b2Abs(C2);var impulse=K.Solve33(C1.x,C1.y,C2,box2d.b2WeldJoint.prototype.SolvePositionConstraints.s_impulse).SelfNeg();var P=box2d.b2WeldJoint.prototype.SolvePositionConstraints.s_P.SetXY(impulse.x,impulse.y);cA.SelfMulSub(mA,P);aA-=iA*(box2d.b2CrossVV(this.m_rA,P)+impulse.z);cB.SelfMulAdd(mB,P);aB+=iB*(box2d.b2CrossVV(this.m_rB,P)+impulse.z)}
data.positions[this.m_indexA].a=aA;data.positions[this.m_indexB].a=aB;return positionError<=box2d.b2_linearSlop&&angularError<=box2d.b2_angularSlop}
box2d.b2WeldJoint.prototype.SolvePositionConstraints.s_C1=new box2d.b2Vec2();box2d.b2WeldJoint.prototype.SolvePositionConstraints.s_P=new box2d.b2Vec2();box2d.b2WeldJoint.prototype.SolvePositionConstraints.s_impulse=new box2d.b2Vec3();box2d.b2WeldJoint.prototype.GetAnchorA=function(out){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,out)}
box2d.b2WeldJoint.prototype.GetAnchorB=function(out){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,out)}
box2d.b2WeldJoint.prototype.GetReactionForce=function(inv_dt,out){return out.SetXY(inv_dt*this.m_impulse.x,inv_dt*this.m_impulse.y)}
box2d.b2WeldJoint.prototype.GetReactionTorque=function(inv_dt){return inv_dt*this.m_impulse.z}
box2d.b2WeldJoint.prototype.GetLocalAnchorA=function(out){return out.Copy(this.m_localAnchorA)}
box2d.b2WeldJoint.prototype.GetLocalAnchorB=function(out){return out.Copy(this.m_localAnchorB)}
box2d.b2WeldJoint.prototype.GetReferenceAngle=function(){return this.m_referenceAngle}
box2d.b2WeldJoint.prototype.SetFrequency=function(hz){this.m_frequencyHz=hz}
box2d.b2WeldJoint.prototype.GetFrequency=function(){return this.m_frequencyHz}
box2d.b2WeldJoint.prototype.SetDampingRatio=function(ratio){this.m_dampingRatio=ratio}
box2d.b2WeldJoint.prototype.GetDampingRatio=function(){return this.m_dampingRatio}
box2d.b2WeldJoint.prototype.Dump=function(){if(box2d.DEBUG){var indexA=this.m_bodyA.m_islandIndex;var indexB=this.m_bodyB.m_islandIndex;box2d.b2Log("  /*box2d.b2WeldJointDef*/ var jd = new box2d.b2WeldJointDef();\n");box2d.b2Log("  jd.bodyA = bodies[%d];\n",indexA);box2d.b2Log("  jd.bodyB = bodies[%d];\n",indexB);box2d.b2Log("  jd.collideConnected = %s;\n",(this.m_collideConnected)?('true'):('false'));box2d.b2Log("  jd.localAnchorA.SetXY(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y);box2d.b2Log("  jd.localAnchorB.SetXY(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y);box2d.b2Log("  jd.referenceAngle = %.15f;\n",this.m_referenceAngle);box2d.b2Log("  jd.frequencyHz = %.15f;\n",this.m_frequencyHz);box2d.b2Log("  jd.dampingRatio = %.15f;\n",this.m_dampingRatio);box2d.b2Log("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)}}
goog.provide('box2d.b2RopeJoint');goog.require('box2d.b2Settings');goog.require('box2d.b2Joint');goog.require('box2d.b2Math');box2d.b2RopeJointDef=function(){goog.base(this,box2d.b2JointType.e_ropeJoint);this.localAnchorA=new box2d.b2Vec2(-1,0);this.localAnchorB=new box2d.b2Vec2(1,0)}
goog.inherits(box2d.b2RopeJointDef,box2d.b2JointDef);box2d.b2RopeJointDef.prototype.localAnchorA=null;box2d.b2RopeJointDef.prototype.localAnchorB=null;box2d.b2RopeJointDef.prototype.maxLength=0;box2d.b2RopeJoint=function(def){goog.base(this,def);this.m_localAnchorA=def.localAnchorA.Clone();this.m_localAnchorB=def.localAnchorB.Clone();this.m_maxLength=def.maxLength;this.m_u=new box2d.b2Vec2();this.m_rA=new box2d.b2Vec2();this.m_rB=new box2d.b2Vec2();this.m_localCenterA=new box2d.b2Vec2();this.m_localCenterB=new box2d.b2Vec2();this.m_qA=new box2d.b2Rot();this.m_qB=new box2d.b2Rot();this.m_lalcA=new box2d.b2Vec2();this.m_lalcB=new box2d.b2Vec2()}
goog.inherits(box2d.b2RopeJoint,box2d.b2Joint);box2d.b2RopeJoint.prototype.m_localAnchorA=null;box2d.b2RopeJoint.prototype.m_localAnchorB=null;box2d.b2RopeJoint.prototype.m_maxLength=0;box2d.b2RopeJoint.prototype.m_length=0;box2d.b2RopeJoint.prototype.m_impulse=0;box2d.b2RopeJoint.prototype.m_indexA=0;box2d.b2RopeJoint.prototype.m_indexB=0;box2d.b2RopeJoint.prototype.m_u=null;box2d.b2RopeJoint.prototype.m_rA=null;box2d.b2RopeJoint.prototype.m_rB=null;box2d.b2RopeJoint.prototype.m_localCenterA=null;box2d.b2RopeJoint.prototype.m_localCenterB=null;box2d.b2RopeJoint.prototype.m_invMassA=0;box2d.b2RopeJoint.prototype.m_invMassB=0;box2d.b2RopeJoint.prototype.m_invIA=0;box2d.b2RopeJoint.prototype.m_invIB=0;box2d.b2RopeJoint.prototype.m_mass=0;box2d.b2RopeJoint.prototype.m_state=box2d.b2LimitState.e_inactiveLimit;box2d.b2RopeJoint.prototype.m_qA=null;box2d.b2RopeJoint.prototype.m_qB=null;box2d.b2RopeJoint.prototype.m_lalcA=null;box2d.b2RopeJoint.prototype.m_lalcB=null;box2d.b2RopeJoint.prototype.InitVelocityConstraints=function(data){this.m_indexA=this.m_bodyA.m_islandIndex;this.m_indexB=this.m_bodyB.m_islandIndex;this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter);this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter);this.m_invMassA=this.m_bodyA.m_invMass;this.m_invMassB=this.m_bodyB.m_invMass;this.m_invIA=this.m_bodyA.m_invI;this.m_invIB=this.m_bodyB.m_invI;var cA=data.positions[this.m_indexA].c;var aA=data.positions[this.m_indexA].a;var vA=data.velocities[this.m_indexA].v;var wA=data.velocities[this.m_indexA].w;var cB=data.positions[this.m_indexB].c;var aB=data.positions[this.m_indexB].a;var vB=data.velocities[this.m_indexB].v;var wB=data.velocities[this.m_indexB].w;var qA=this.m_qA.SetAngleRadians(aA),qB=this.m_qB.SetAngleRadians(aB);box2d.b2SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);box2d.b2MulRV(qA,this.m_lalcA,this.m_rA);box2d.b2SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);box2d.b2MulRV(qB,this.m_lalcB,this.m_rB);this.m_u.Copy(cB).SelfAdd(this.m_rB).SelfSub(cA).SelfSub(this.m_rA);this.m_length=this.m_u.GetLength();var C=this.m_length-this.m_maxLength;if(C>0){this.m_state=box2d.b2LimitState.e_atUpperLimit}
else{this.m_state=box2d.b2LimitState.e_inactiveLimit}
if(this.m_length>box2d.b2_linearSlop){this.m_u.SelfMul(1/this.m_length)}
else{this.m_u.SetZero();this.m_mass=0;this.m_impulse=0;return}
var crA=box2d.b2CrossVV(this.m_rA,this.m_u);var crB=box2d.b2CrossVV(this.m_rB,this.m_u);var invMass=this.m_invMassA+this.m_invIA*crA*crA+this.m_invMassB+this.m_invIB*crB*crB;this.m_mass=invMass!==0?1/invMass:0;if(data.step.warmStarting){this.m_impulse*=data.step.dtRatio;var P=box2d.b2MulSV(this.m_impulse,this.m_u,box2d.b2RopeJoint.prototype.InitVelocityConstraints.s_P);vA.SelfMulSub(this.m_invMassA,P);wA-=this.m_invIA*box2d.b2CrossVV(this.m_rA,P);vB.SelfMulAdd(this.m_invMassB,P);wB+=this.m_invIB*box2d.b2CrossVV(this.m_rB,P)}
else{this.m_impulse=0}
data.velocities[this.m_indexA].w=wA;data.velocities[this.m_indexB].w=wB}
box2d.b2RopeJoint.prototype.InitVelocityConstraints.s_P=new box2d.b2Vec2();box2d.b2RopeJoint.prototype.SolveVelocityConstraints=function(data){var vA=data.velocities[this.m_indexA].v;var wA=data.velocities[this.m_indexA].w;var vB=data.velocities[this.m_indexB].v;var wB=data.velocities[this.m_indexB].w;var vpA=box2d.b2AddVCrossSV(vA,wA,this.m_rA,box2d.b2RopeJoint.prototype.SolveVelocityConstraints.s_vpA);var vpB=box2d.b2AddVCrossSV(vB,wB,this.m_rB,box2d.b2RopeJoint.prototype.SolveVelocityConstraints.s_vpB);var C=this.m_length-this.m_maxLength;var Cdot=box2d.b2DotVV(this.m_u,box2d.b2SubVV(vpB,vpA,box2d.b2Vec2.s_t0));if(C<0){Cdot+=data.step.inv_dt*C}
var impulse=-this.m_mass*Cdot;var oldImpulse=this.m_impulse;this.m_impulse=box2d.b2Min(0,this.m_impulse+impulse);impulse=this.m_impulse-oldImpulse;var P=box2d.b2MulSV(impulse,this.m_u,box2d.b2RopeJoint.prototype.SolveVelocityConstraints.s_P);vA.SelfMulSub(this.m_invMassA,P);wA-=this.m_invIA*box2d.b2CrossVV(this.m_rA,P);vB.SelfMulAdd(this.m_invMassB,P);wB+=this.m_invIB*box2d.b2CrossVV(this.m_rB,P);data.velocities[this.m_indexA].w=wA;data.velocities[this.m_indexB].w=wB}
box2d.b2RopeJoint.prototype.SolveVelocityConstraints.s_vpA=new box2d.b2Vec2();box2d.b2RopeJoint.prototype.SolveVelocityConstraints.s_vpB=new box2d.b2Vec2();box2d.b2RopeJoint.prototype.SolveVelocityConstraints.s_P=new box2d.b2Vec2();box2d.b2RopeJoint.prototype.SolvePositionConstraints=function(data){var cA=data.positions[this.m_indexA].c;var aA=data.positions[this.m_indexA].a;var cB=data.positions[this.m_indexB].c;var aB=data.positions[this.m_indexB].a;var qA=this.m_qA.SetAngleRadians(aA),qB=this.m_qB.SetAngleRadians(aB);box2d.b2SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);var rA=box2d.b2MulRV(qA,this.m_lalcA,this.m_rA);box2d.b2SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);var rB=box2d.b2MulRV(qB,this.m_lalcB,this.m_rB);var u=this.m_u.Copy(cB).SelfAdd(rB).SelfSub(cA).SelfSub(rA);var length=u.Normalize();var C=length-this.m_maxLength;C=box2d.b2Clamp(C,0,box2d.b2_maxLinearCorrection);var impulse=-this.m_mass*C;var P=box2d.b2MulSV(impulse,u,box2d.b2RopeJoint.prototype.SolvePositionConstraints.s_P);cA.SelfMulSub(this.m_invMassA,P);aA-=this.m_invIA*box2d.b2CrossVV(rA,P);cB.SelfMulAdd(this.m_invMassB,P);aB+=this.m_invIB*box2d.b2CrossVV(rB,P);data.positions[this.m_indexA].a=aA;data.positions[this.m_indexB].a=aB;return length-this.m_maxLength<box2d.b2_linearSlop}
box2d.b2RopeJoint.prototype.SolvePositionConstraints.s_P=new box2d.b2Vec2();box2d.b2RopeJoint.prototype.GetAnchorA=function(out){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,out)}
box2d.b2RopeJoint.prototype.GetAnchorB=function(out){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,out)}
box2d.b2RopeJoint.prototype.GetReactionForce=function(inv_dt,out){var F=box2d.b2MulSV((inv_dt*this.m_impulse),this.m_u,out);return F}
box2d.b2RopeJoint.prototype.GetReactionTorque=function(inv_dt){return 0}
box2d.b2RopeJoint.prototype.GetLocalAnchorA=function(out){return out.Copy(this.m_localAnchorA)}
box2d.b2RopeJoint.prototype.GetLocalAnchorB=function(out){return out.Copy(this.m_localAnchorB)}
box2d.b2RopeJoint.prototype.SetMaxLength=function(length){this.m_maxLength=length}
box2d.b2RopeJoint.prototype.GetMaxLength=function(){return this.m_maxLength}
box2d.b2RopeJoint.prototype.GetLimitState=function(){return this.m_state}
box2d.b2RopeJoint.prototype.Dump=function(){if(box2d.DEBUG){var indexA=this.m_bodyA.m_islandIndex;var indexB=this.m_bodyB.m_islandIndex;box2d.b2Log("  /*box2d.b2RopeJointDef*/ var jd = new box2d.b2RopeJointDef();\n");box2d.b2Log("  jd.bodyA = bodies[%d];\n",indexA);box2d.b2Log("  jd.bodyB = bodies[%d];\n",indexB);box2d.b2Log("  jd.collideConnected = %s;\n",(this.m_collideConnected)?('true'):('false'));box2d.b2Log("  jd.localAnchorA.SetXY(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y);box2d.b2Log("  jd.localAnchorB.SetXY(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y);box2d.b2Log("  jd.maxLength = %.15f;\n",this.m_maxLength);box2d.b2Log("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)}}
goog.provide('box2d.b2GravityController');goog.require('box2d.b2Settings');goog.require('box2d.b2Controller');goog.require('box2d.b2Math');box2d.b2GravityController=function(){goog.base(this)};goog.inherits(box2d.b2GravityController,box2d.b2Controller);box2d.b2GravityController.prototype.G=1;box2d.b2GravityController.prototype.invSqr=!0;box2d.b2GravityController.prototype.Step=function(step){if(this.invSqr){for(var i=this.m_bodyList;i;i=i.nextBody){var body1=i.body;var p1=body1.GetWorldCenter();var mass1=body1.GetMass();for(var j=this.m_bodyList;j!==i;j=j.nextBody){var body2=j.body;var p2=body2.GetWorldCenter();var mass2=body2.GetMass();var dx=p2.x-p1.x;var dy=p2.y-p1.y;var r2=dx*dx+dy*dy;if(r2<box2d.b2_epsilon)
continue;var f=box2d.b2GravityController.prototype.Step.s_f.SetXY(dx,dy);f.SelfMul(this.G/r2/box2d.b2Sqrt(r2)*mass1*mass2);if(body1.IsAwake())
body1.ApplyForce(f,p1);if(body2.IsAwake())
body2.ApplyForce(f.SelfMul(-1),p2)}}}
else{for(var i=this.m_bodyList;i;i=i.nextBody){var body1=i.body;var p1=body1.GetWorldCenter();var mass1=body1.GetMass();for(var j=this.m_bodyList;j!==i;j=j.nextBody){var body2=j.body;var p2=body2.GetWorldCenter();var mass2=body2.GetMass();var dx=p2.x-p1.x;var dy=p2.y-p1.y;var r2=dx*dx+dy*dy;if(r2<box2d.b2_epsilon)
continue;var f=box2d.b2GravityController.prototype.Step.s_f.SetXY(dx,dy);f.SelfMul(this.G/r2*mass1*mass2);if(body1.IsAwake())
body1.ApplyForce(f,p1);if(body2.IsAwake())
body2.ApplyForce(f.SelfMul(-1),p2)}}}}
box2d.b2GravityController.prototype.Step.s_f=new box2d.b2Vec2();goog.provide('box2d.b2TimeStep');goog.require('box2d.b2Settings');box2d.b2Profile=function(){};box2d.b2Profile.prototype.step=0;box2d.b2Profile.prototype.collide=0;box2d.b2Profile.prototype.solve=0;box2d.b2Profile.prototype.solveInit=0;box2d.b2Profile.prototype.solveVelocity=0;box2d.b2Profile.prototype.solvePosition=0;box2d.b2Profile.prototype.broadphase=0;box2d.b2Profile.prototype.solveTOI=0;box2d.b2Profile.prototype.Reset=function(){this.step=0;this.collide=0;this.solve=0;this.solveInit=0;this.solveVelocity=0;this.solvePosition=0;this.broadphase=0;this.solveTOI=0;return this}
box2d.b2TimeStep=function(){};box2d.b2TimeStep.prototype.dt=0;box2d.b2TimeStep.prototype.inv_dt=0;box2d.b2TimeStep.prototype.dtRatio=0;box2d.b2TimeStep.prototype.velocityIterations=0;box2d.b2TimeStep.prototype.positionIterations=0;box2d.b2TimeStep.prototype.warmStarting=!1;box2d.b2TimeStep.prototype.Copy=function(step){this.dt=step.dt;this.inv_dt=step.inv_dt;this.dtRatio=step.dtRatio;this.positionIterations=step.positionIterations;this.velocityIterations=step.velocityIterations;this.warmStarting=step.warmStarting;return this}
box2d.b2Position=function(){this.c=new box2d.b2Vec2()};box2d.b2Position.prototype.c=null;box2d.b2Position.prototype.a=0;box2d.b2Position.MakeArray=function(length){return box2d.b2MakeArray(length,function(i){return new box2d.b2Position()})}
box2d.b2Velocity=function(){this.v=new box2d.b2Vec2()};box2d.b2Velocity.prototype.v=null;box2d.b2Velocity.prototype.w=0;box2d.b2Velocity.MakeArray=function(length){return box2d.b2MakeArray(length,function(i){return new box2d.b2Velocity()})}
box2d.b2SolverData=function(){this.step=new box2d.b2TimeStep()};box2d.b2SolverData.prototype.step=null;box2d.b2SolverData.prototype.positions=null;box2d.b2SolverData.prototype.velocities=null;goog.provide('box2d.b2Collision');goog.require('box2d.b2Settings');goog.require('box2d.b2Math');goog.require('box2d.b2Distance');box2d.b2ContactFeatureType={e_vertex:0,e_face:1};goog.exportProperty(box2d.b2ContactFeatureType,'e_vertex',box2d.b2ContactFeatureType.e_vertex);goog.exportProperty(box2d.b2ContactFeatureType,'e_face',box2d.b2ContactFeatureType.e_face);box2d.b2ContactFeature=function(id){this._id=id};box2d.b2ContactFeature.prototype._id=null;box2d.b2ContactFeature.prototype._indexA=0;box2d.b2ContactFeature.prototype._indexB=0;box2d.b2ContactFeature.prototype._typeA=0;box2d.b2ContactFeature.prototype._typeB=0;Object.defineProperty(box2d.b2ContactFeature.prototype,'indexA',{enumerable:!1,configurable:!0,get:function(){return this._indexA},set:function(value){this._indexA=value;this._id._key=(this._id._key&0xffffff00)|(this._indexA&0x000000ff)}});Object.defineProperty(box2d.b2ContactFeature.prototype,'indexB',{enumerable:!1,configurable:!0,get:function(){return this._indexB},set:function(value){this._indexB=value;this._id._key=(this._id._key&0xffff00ff)|((this._indexB<<8)&0x0000ff00)}});Object.defineProperty(box2d.b2ContactFeature.prototype,'typeA',{enumerable:!1,configurable:!0,get:function(){return this._typeA},set:function(value){this._typeA=value;this._id._key=(this._id._key&0xff00ffff)|((this._typeA<<16)&0x00ff0000)}});Object.defineProperty(box2d.b2ContactFeature.prototype,'typeB',{enumerable:!1,configurable:!0,get:function(){return this._typeB},set:function(value){this._typeB=value;this._id._key=(this._id._key&0x00ffffff)|((this._typeB<<24)&0xff000000)}});box2d.b2ContactID=function(){this.cf=new box2d.b2ContactFeature(this)}
box2d.b2ContactID.prototype.cf=null;box2d.b2ContactID.prototype.key=0;box2d.b2ContactID.prototype.Copy=function(o){this.key=o.key;return this}
box2d.b2ContactID.prototype.Clone=function(){return new box2d.b2ContactID().Copy(this)}
Object.defineProperty(box2d.b2ContactID.prototype,'key',{enumerable:!1,configurable:!0,get:function(){return this._key},set:function(value){this._key=value;this.cf._indexA=this._key&0x000000ff;this.cf._indexB=(this._key>>8)&0x000000ff;this.cf._typeA=(this._key>>16)&0x000000ff;this.cf._typeB=(this._key>>24)&0x000000ff}});box2d.b2ManifoldPoint=function(){this.localPoint=new box2d.b2Vec2();this.id=new box2d.b2ContactID()}
box2d.b2ManifoldPoint.prototype.localPoint=null;box2d.b2ManifoldPoint.prototype.normalImpulse=0;box2d.b2ManifoldPoint.prototype.tangentImpulse=0;box2d.b2ManifoldPoint.prototype.id=null;box2d.b2ManifoldPoint.MakeArray=function(length){return box2d.b2MakeArray(length,function(i){return new box2d.b2ManifoldPoint()})}
box2d.b2ManifoldPoint.prototype.Reset=function(){this.localPoint.SetZero();this.normalImpulse=0;this.tangentImpulse=0;this.id.key=0}
box2d.b2ManifoldPoint.prototype.Copy=function(o){this.localPoint.Copy(o.localPoint);this.normalImpulse=o.normalImpulse;this.tangentImpulse=o.tangentImpulse;this.id.Copy(o.id);return this}
box2d.b2ManifoldType={e_unknown:-1,e_circles:0,e_faceA:1,e_faceB:2};goog.exportProperty(box2d.b2ManifoldType,'e_unknown',box2d.b2ManifoldType.e_unknown);goog.exportProperty(box2d.b2ManifoldType,'e_circles',box2d.b2ManifoldType.e_circles);goog.exportProperty(box2d.b2ManifoldType,'e_faceA',box2d.b2ManifoldType.e_faceA);goog.exportProperty(box2d.b2ManifoldType,'e_faceB',box2d.b2ManifoldType.e_faceB);box2d.b2Manifold=function(){this.points=box2d.b2ManifoldPoint.MakeArray(box2d.b2_maxManifoldPoints);this.localNormal=new box2d.b2Vec2();this.localPoint=new box2d.b2Vec2();this.type=box2d.b2ManifoldType.e_unknown;this.pointCount=0}
box2d.b2Manifold.prototype.points=null;box2d.b2Manifold.prototype.localNormal=null;box2d.b2Manifold.prototype.localPoint=null;box2d.b2Manifold.prototype.type=box2d.b2ManifoldType.e_unknown;box2d.b2Manifold.prototype.pointCount=0;box2d.b2Manifold.prototype.Reset=function(){for(var i=0,ict=box2d.b2_maxManifoldPoints;i<ict;++i){this.points[i].Reset()}
this.localNormal.SetZero();this.localPoint.SetZero();this.type=box2d.b2ManifoldType.e_unknown;this.pointCount=0}
box2d.b2Manifold.prototype.Copy=function(o){this.pointCount=o.pointCount;for(var i=0,ict=box2d.b2_maxManifoldPoints;i<ict;++i){this.points[i].Copy(o.points[i])}
this.localNormal.Copy(o.localNormal);this.localPoint.Copy(o.localPoint);this.type=o.type;return this}
box2d.b2Manifold.prototype.Clone=function(){return new box2d.b2Manifold().Copy(this)}
box2d.b2WorldManifold=function(){this.normal=new box2d.b2Vec2();this.points=box2d.b2Vec2.MakeArray(box2d.b2_maxManifoldPoints);this.separations=box2d.b2MakeNumberArray(box2d.b2_maxManifoldPoints)}
box2d.b2WorldManifold.prototype.normal=null;box2d.b2WorldManifold.prototype.points=null;box2d.b2WorldManifold.prototype.separations=null;box2d.b2WorldManifold.prototype.Initialize=function(manifold,xfA,radiusA,xfB,radiusB){if(manifold.pointCount===0){return}
switch(manifold.type){case box2d.b2ManifoldType.e_circles:{this.normal.SetXY(1,0);var pointA=box2d.b2MulXV(xfA,manifold.localPoint,box2d.b2WorldManifold.prototype.Initialize.s_pointA);var pointB=box2d.b2MulXV(xfB,manifold.points[0].localPoint,box2d.b2WorldManifold.prototype.Initialize.s_pointB);if(box2d.b2DistanceSquaredVV(pointA,pointB)>box2d.b2_epsilon_sq){box2d.b2SubVV(pointB,pointA,this.normal).SelfNormalize()}
var cA=box2d.b2AddVMulSV(pointA,radiusA,this.normal,box2d.b2WorldManifold.prototype.Initialize.s_cA);var cB=box2d.b2SubVMulSV(pointB,radiusB,this.normal,box2d.b2WorldManifold.prototype.Initialize.s_cB);box2d.b2MidVV(cA,cB,this.points[0]);this.separations[0]=box2d.b2DotVV(box2d.b2SubVV(cB,cA,box2d.b2Vec2.s_t0),this.normal)}
break;case box2d.b2ManifoldType.e_faceA:{box2d.b2MulRV(xfA.q,manifold.localNormal,this.normal);var planePoint=box2d.b2MulXV(xfA,manifold.localPoint,box2d.b2WorldManifold.prototype.Initialize.s_planePoint);for(var i=0,ict=manifold.pointCount;i<ict;++i){var clipPoint=box2d.b2MulXV(xfB,manifold.points[i].localPoint,box2d.b2WorldManifold.prototype.Initialize.s_clipPoint);var s=radiusA-box2d.b2DotVV(box2d.b2SubVV(clipPoint,planePoint,box2d.b2Vec2.s_t0),this.normal);var cA=box2d.b2AddVMulSV(clipPoint,s,this.normal,box2d.b2WorldManifold.prototype.Initialize.s_cA);var cB=box2d.b2SubVMulSV(clipPoint,radiusB,this.normal,box2d.b2WorldManifold.prototype.Initialize.s_cB);box2d.b2MidVV(cA,cB,this.points[i]);this.separations[i]=box2d.b2DotVV(box2d.b2SubVV(cB,cA,box2d.b2Vec2.s_t0),this.normal)}}
break;case box2d.b2ManifoldType.e_faceB:{box2d.b2MulRV(xfB.q,manifold.localNormal,this.normal);var planePoint=box2d.b2MulXV(xfB,manifold.localPoint,box2d.b2WorldManifold.prototype.Initialize.s_planePoint);for(var i=0,ict=manifold.pointCount;i<ict;++i){var clipPoint=box2d.b2MulXV(xfA,manifold.points[i].localPoint,box2d.b2WorldManifold.prototype.Initialize.s_clipPoint);var s=radiusB-box2d.b2DotVV(box2d.b2SubVV(clipPoint,planePoint,box2d.b2Vec2.s_t0),this.normal);var cB=box2d.b2AddVMulSV(clipPoint,s,this.normal,box2d.b2WorldManifold.prototype.Initialize.s_cB);var cA=box2d.b2SubVMulSV(clipPoint,radiusA,this.normal,box2d.b2WorldManifold.prototype.Initialize.s_cA);box2d.b2MidVV(cA,cB,this.points[i]);this.separations[i]=box2d.b2DotVV(box2d.b2SubVV(cA,cB,box2d.b2Vec2.s_t0),this.normal)}
this.normal.SelfNeg()}
break}}
box2d.b2WorldManifold.prototype.Initialize.s_pointA=new box2d.b2Vec2();box2d.b2WorldManifold.prototype.Initialize.s_pointB=new box2d.b2Vec2();box2d.b2WorldManifold.prototype.Initialize.s_cA=new box2d.b2Vec2();box2d.b2WorldManifold.prototype.Initialize.s_cB=new box2d.b2Vec2();box2d.b2WorldManifold.prototype.Initialize.s_planePoint=new box2d.b2Vec2();box2d.b2WorldManifold.prototype.Initialize.s_clipPoint=new box2d.b2Vec2();box2d.b2PointState={b2_nullState:0,b2_addState:1,b2_persistState:2,b2_removeState:3};goog.exportProperty(box2d.b2PointState,'b2_nullState   ',box2d.b2PointState.b2_nullState);goog.exportProperty(box2d.b2PointState,'b2_addState    ',box2d.b2PointState.b2_addState);goog.exportProperty(box2d.b2PointState,'b2_persistState',box2d.b2PointState.b2_persistState);goog.exportProperty(box2d.b2PointState,'b2_removeState ',box2d.b2PointState.b2_removeState);box2d.b2GetPointStates=function(state1,state2,manifold1,manifold2){for(var i=0,ict=manifold1.pointCount;i<ict;++i){var id=manifold1.points[i].id;var key=id.key;state1[i]=box2d.b2PointState.b2_removeState;for(var j=0,jct=manifold2.pointCount;j<jct;++j){if(manifold2.points[j].id.key===key){state1[i]=box2d.b2PointState.b2_persistState;break}}}
for(var ict=box2d.b2_maxManifoldPoints;i<ict;++i){state1[i]=box2d.b2PointState.b2_nullState}
for(var i=0,ict=manifold2.pointCount;i<ict;++i){var id=manifold2.points[i].id;var key=id.key;state2[i]=box2d.b2PointState.b2_addState;for(var j=0,jct=manifold1.pointCount;j<jct;++j){if(manifold1.points[j].id.key===key){state2[i]=box2d.b2PointState.b2_persistState;break}}}
for(var ict=box2d.b2_maxManifoldPoints;i<ict;++i){state2[i]=box2d.b2PointState.b2_nullState}}
box2d.b2ClipVertex=function(){this.v=new box2d.b2Vec2();this.id=new box2d.b2ContactID()};box2d.b2ClipVertex.prototype.v=null;box2d.b2ClipVertex.prototype.id=null;box2d.b2ClipVertex.MakeArray=function(length){return box2d.b2MakeArray(length,function(i){return new box2d.b2ClipVertex()})}
box2d.b2ClipVertex.prototype.Copy=function(other){this.v.Copy(other.v);this.id.Copy(other.id);return this}
box2d.b2RayCastInput=function(){this.p1=new box2d.b2Vec2();this.p2=new box2d.b2Vec2();this.maxFraction=1}
box2d.b2RayCastInput.prototype.p1=null;box2d.b2RayCastInput.prototype.p2=null;box2d.b2RayCastInput.prototype.maxFraction=1;box2d.b2RayCastInput.prototype.Copy=function(o){this.p1.Copy(o.p1);this.p2.Copy(o.p2);this.maxFraction=o.maxFraction;return this}
box2d.b2RayCastOutput=function(){this.normal=new box2d.b2Vec2();this.fraction=0};box2d.b2RayCastOutput.prototype.normal=null;box2d.b2RayCastOutput.prototype.fraction=0;box2d.b2RayCastOutput.prototype.Copy=function(o){this.normal.Copy(o.normal);this.fraction=o.fraction;return this}
box2d.b2AABB=function(){this.lowerBound=new box2d.b2Vec2();this.upperBound=new box2d.b2Vec2();this.m_out_center=new box2d.b2Vec2();this.m_out_extent=new box2d.b2Vec2()};box2d.b2AABB.prototype.lowerBound=null;box2d.b2AABB.prototype.upperBound=null;box2d.b2AABB.prototype.m_out_center=null;box2d.b2AABB.prototype.m_out_extent=null;box2d.b2AABB.prototype.Copy=function(o){this.lowerBound.Copy(o.lowerBound);this.upperBound.Copy(o.upperBound);return this}
box2d.b2AABB.prototype.IsValid=function(){var d_x=this.upperBound.x-this.lowerBound.x;var d_y=this.upperBound.y-this.lowerBound.y;var valid=d_x>=0&&d_y>=0;valid=valid&&this.lowerBound.IsValid()&&this.upperBound.IsValid();return valid}
box2d.b2AABB.prototype.GetCenter=function(){return box2d.b2MidVV(this.lowerBound,this.upperBound,this.m_out_center)}
box2d.b2AABB.prototype.GetExtents=function(){return box2d.b2ExtVV(this.lowerBound,this.upperBound,this.m_out_extent)}
box2d.b2AABB.prototype.GetPerimeter=function(){var wx=this.upperBound.x-this.lowerBound.x;var wy=this.upperBound.y-this.lowerBound.y;return 2*(wx+wy)}
box2d.b2AABB.prototype.Combine1=function(aabb){this.lowerBound.x=box2d.b2Min(this.lowerBound.x,aabb.lowerBound.x);this.lowerBound.y=box2d.b2Min(this.lowerBound.y,aabb.lowerBound.y);this.upperBound.x=box2d.b2Max(this.upperBound.x,aabb.upperBound.x);this.upperBound.y=box2d.b2Max(this.upperBound.y,aabb.upperBound.y);return this}
box2d.b2AABB.prototype.Combine2=function(aabb1,aabb2){this.lowerBound.x=box2d.b2Min(aabb1.lowerBound.x,aabb2.lowerBound.x);this.lowerBound.y=box2d.b2Min(aabb1.lowerBound.y,aabb2.lowerBound.y);this.upperBound.x=box2d.b2Max(aabb1.upperBound.x,aabb2.upperBound.x);this.upperBound.y=box2d.b2Max(aabb1.upperBound.y,aabb2.upperBound.y);return this}
box2d.b2AABB.Combine=function(aabb1,aabb2,out){out.Combine2(aabb1,aabb2);return out}
box2d.b2AABB.prototype.Contains=function(aabb){var result=!0;result=result&&this.lowerBound.x<=aabb.lowerBound.x;result=result&&this.lowerBound.y<=aabb.lowerBound.y;result=result&&aabb.upperBound.x<=this.upperBound.x;result=result&&aabb.upperBound.y<=this.upperBound.y;return result}
box2d.b2AABB.prototype.RayCast=function(output,input){var tmin=(-box2d.b2_maxFloat);var tmax=box2d.b2_maxFloat;var p_x=input.p1.x;var p_y=input.p1.y;var d_x=input.p2.x-input.p1.x;var d_y=input.p2.y-input.p1.y;var absD_x=box2d.b2Abs(d_x);var absD_y=box2d.b2Abs(d_y);var normal=output.normal;if(absD_x<box2d.b2_epsilon){if(p_x<this.lowerBound.x||this.upperBound.x<p_x){return !1}}
else{var inv_d=1/d_x;var t1=(this.lowerBound.x-p_x)*inv_d;var t2=(this.upperBound.x-p_x)*inv_d;var s=(-1);if(t1>t2){var t3=t1;t1=t2;t2=t3;s=1}
if(t1>tmin){normal.x=s;normal.y=0;tmin=t1}
tmax=box2d.b2Min(tmax,t2);if(tmin>tmax){return !1}}
if(absD_y<box2d.b2_epsilon){if(p_y<this.lowerBound.y||this.upperBound.y<p_y){return !1}}
else{var inv_d=1/d_y;var t1=(this.lowerBound.y-p_y)*inv_d;var t2=(this.upperBound.y-p_y)*inv_d;var s=(-1);if(t1>t2){var t3=t1;t1=t2;t2=t3;s=1}
if(t1>tmin){normal.x=0;normal.y=s;tmin=t1}
tmax=box2d.b2Min(tmax,t2);if(tmin>tmax){return !1}}
if(tmin<0||input.maxFraction<tmin){return !1}
output.fraction=tmin;return !0}
box2d.b2AABB.prototype.TestOverlap=function(other){var d1_x=other.lowerBound.x-this.upperBound.x;var d1_y=other.lowerBound.y-this.upperBound.y;var d2_x=this.lowerBound.x-other.upperBound.x;var d2_y=this.lowerBound.y-other.upperBound.y;if(d1_x>0||d1_y>0)
return !1;if(d2_x>0||d2_y>0)
return !1;return !0}
box2d.b2TestOverlapAABB=function(a,b){var d1_x=b.lowerBound.x-a.upperBound.x;var d1_y=b.lowerBound.y-a.upperBound.y;var d2_x=a.lowerBound.x-b.upperBound.x;var d2_y=a.lowerBound.y-b.upperBound.y;if(d1_x>0||d1_y>0)
return !1;if(d2_x>0||d2_y>0)
return !1;return !0}
box2d.b2ClipSegmentToLine=function(vOut,vIn,normal,offset,vertexIndexA){var numOut=0;var vIn0=vIn[0];var vIn1=vIn[1];var distance0=box2d.b2DotVV(normal,vIn0.v)-offset;var distance1=box2d.b2DotVV(normal,vIn1.v)-offset;if(distance0<=0)vOut[numOut++].Copy(vIn0);if(distance1<=0)vOut[numOut++].Copy(vIn1);if(distance0*distance1<0){var interp=distance0/(distance0-distance1);var v=vOut[numOut].v;v.x=vIn0.v.x+interp*(vIn1.v.x-vIn0.v.x);v.y=vIn0.v.y+interp*(vIn1.v.y-vIn0.v.y);var id=vOut[numOut].id;id.cf.indexA=vertexIndexA;id.cf.indexB=vIn0.id.cf.indexB;id.cf.typeA=box2d.b2ContactFeatureType.e_vertex;id.cf.typeB=box2d.b2ContactFeatureType.e_face;++numOut}
return numOut}
box2d.b2TestOverlapShape=function(shapeA,indexA,shapeB,indexB,xfA,xfB){var input=box2d.b2TestOverlapShape.s_input.Reset();input.proxyA.SetShape(shapeA,indexA);input.proxyB.SetShape(shapeB,indexB);input.transformA.Copy(xfA);input.transformB.Copy(xfB);input.useRadii=!0;var simplexCache=box2d.b2TestOverlapShape.s_simplexCache.Reset();simplexCache.count=0;var output=box2d.b2TestOverlapShape.s_output.Reset();box2d.b2Distance(output,simplexCache,input);return output.distance<10*box2d.b2_epsilon}
box2d.b2TestOverlapShape.s_input=new box2d.b2DistanceInput();box2d.b2TestOverlapShape.s_simplexCache=new box2d.b2SimplexCache();box2d.b2TestOverlapShape.s_output=new box2d.b2DistanceOutput();goog.provide('box2d.b2Timer');goog.require('box2d.b2Settings');box2d.b2Timer=function(){this.m_start=new Date().getTime()}
box2d.b2Timer.prototype.m_start=0;box2d.b2Timer.prototype.Reset=function(){this.m_start=new Date().getTime();return this}
box2d.b2Timer.prototype.GetMilliseconds=function(){return new Date().getTime()-this.m_start}
box2d.b2Counter=function(){}
box2d.b2Counter.prototype.m_count=0;box2d.b2Counter.prototype.m_min_count=0;box2d.b2Counter.prototype.m_max_count=0;box2d.b2Counter.prototype.GetCount=function(){return this.m_count}
box2d.b2Counter.prototype.GetMinCount=function(){return this.m_min_count}
box2d.b2Counter.prototype.GetMaxCount=function(){return this.m_max_count}
box2d.b2Counter.prototype.ResetCount=function(){var count=this.m_count;this.m_count=0;return count}
box2d.b2Counter.prototype.ResetMinCount=function(){this.m_min_count=0}
box2d.b2Counter.prototype.ResetMaxCount=function(){this.m_max_count=0}
box2d.b2Counter.prototype.Increment=function(){this.m_count++;if(this.m_max_count<this.m_count){this.m_max_count=this.m_count}}
box2d.b2Counter.prototype.Decrement=function(){this.m_count--;if(this.m_min_count>this.m_count){this.m_min_count=this.m_count}}
goog.provide('box2d.b2TimeOfImpact');goog.require('box2d.b2Settings');goog.require('box2d.b2Distance');goog.require('box2d.b2Math');goog.require('box2d.b2Timer');box2d.b2_toiTime=0.0;box2d.b2_toiMaxTime=0.0;box2d.b2_toiCalls=0;box2d.b2_toiIters=0;box2d.b2_toiMaxIters=0;box2d.b2_toiRootIters=0;box2d.b2_toiMaxRootIters=0;box2d.b2TOIInput=function(){this.proxyA=new box2d.b2DistanceProxy();this.proxyB=new box2d.b2DistanceProxy();this.sweepA=new box2d.b2Sweep();this.sweepB=new box2d.b2Sweep()};box2d.b2TOIInput.prototype.proxyA=null;box2d.b2TOIInput.prototype.proxyB=null;box2d.b2TOIInput.prototype.sweepA=null;box2d.b2TOIInput.prototype.sweepB=null;box2d.b2TOIInput.prototype.tMax=0;box2d.b2TOIOutputState={e_unknown:0,e_failed:1,e_overlapped:2,e_touching:3,e_separated:4};goog.exportProperty(box2d.b2TOIOutputState,'e_unknown',box2d.b2TOIOutputState.e_unknown);goog.exportProperty(box2d.b2TOIOutputState,'e_failed',box2d.b2TOIOutputState.e_failed);goog.exportProperty(box2d.b2TOIOutputState,'e_overlapped',box2d.b2TOIOutputState.e_overlapped);goog.exportProperty(box2d.b2TOIOutputState,'e_touching',box2d.b2TOIOutputState.e_touching);goog.exportProperty(box2d.b2TOIOutputState,'e_separated',box2d.b2TOIOutputState.e_separated);box2d.b2TOIOutput=function(){};box2d.b2TOIOutput.prototype.state=box2d.b2TOIOutputState.e_unknown;box2d.b2TOIOutput.prototype.t=0;box2d.b2SeparationFunctionType={e_unknown:-1,e_points:0,e_faceA:1,e_faceB:2};goog.exportProperty(box2d.b2SeparationFunctionType,'e_unknown',box2d.b2SeparationFunctionType.e_unknown);goog.exportProperty(box2d.b2SeparationFunctionType,'e_points',box2d.b2SeparationFunctionType.e_points);goog.exportProperty(box2d.b2SeparationFunctionType,'e_faceA',box2d.b2SeparationFunctionType.e_faceA);goog.exportProperty(box2d.b2SeparationFunctionType,'e_faceB',box2d.b2SeparationFunctionType.e_faceB);box2d.b2SeparationFunction=function(){this.m_sweepA=new box2d.b2Sweep();this.m_sweepB=new box2d.b2Sweep();this.m_localPoint=new box2d.b2Vec2();this.m_axis=new box2d.b2Vec2()};box2d.b2SeparationFunction.prototype.m_proxyA=null;box2d.b2SeparationFunction.prototype.m_proxyB=null;box2d.b2SeparationFunction.prototype.m_sweepA=null;box2d.b2SeparationFunction.prototype.m_sweepB=null;box2d.b2SeparationFunction.prototype.m_type=box2d.b2SeparationFunctionType.e_unknown;box2d.b2SeparationFunction.prototype.m_localPoint=null;box2d.b2SeparationFunction.prototype.m_axis=null;box2d.b2SeparationFunction.prototype.Initialize=function(cache,proxyA,sweepA,proxyB,sweepB,t1){this.m_proxyA=proxyA;this.m_proxyB=proxyB;var count=cache.count;if(box2d.ENABLE_ASSERTS){box2d.b2Assert(0<count&&count<3)}
this.m_sweepA.Copy(sweepA);this.m_sweepB.Copy(sweepB);var xfA=box2d.b2TimeOfImpact.s_xfA;var xfB=box2d.b2TimeOfImpact.s_xfB;this.m_sweepA.GetTransform(xfA,t1);this.m_sweepB.GetTransform(xfB,t1);if(count===1){this.m_type=box2d.b2SeparationFunctionType.e_points;var localPointA=this.m_proxyA.GetVertex(cache.indexA[0]);var localPointB=this.m_proxyB.GetVertex(cache.indexB[0]);var pointA=box2d.b2MulXV(xfA,localPointA,box2d.b2TimeOfImpact.s_pointA);var pointB=box2d.b2MulXV(xfB,localPointB,box2d.b2TimeOfImpact.s_pointB);box2d.b2SubVV(pointB,pointA,this.m_axis);var s=this.m_axis.Normalize();return s}
else if(cache.indexA[0]===cache.indexA[1]){this.m_type=box2d.b2SeparationFunctionType.e_faceB;var localPointB1=this.m_proxyB.GetVertex(cache.indexB[0]);var localPointB2=this.m_proxyB.GetVertex(cache.indexB[1]);box2d.b2CrossVOne(box2d.b2SubVV(localPointB2,localPointB1,box2d.b2Vec2.s_t0),this.m_axis).SelfNormalize();var normal=box2d.b2MulRV(xfB.q,this.m_axis,box2d.b2TimeOfImpact.s_normal);box2d.b2MidVV(localPointB1,localPointB2,this.m_localPoint);var pointB=box2d.b2MulXV(xfB,this.m_localPoint,box2d.b2TimeOfImpact.s_pointB);var localPointA=this.m_proxyA.GetVertex(cache.indexA[0]);var pointA=box2d.b2MulXV(xfA,localPointA,box2d.b2TimeOfImpact.s_pointA);var s=box2d.b2DotVV(box2d.b2SubVV(pointA,pointB,box2d.b2Vec2.s_t0),normal);if(s<0){this.m_axis.SelfNeg();s=-s}
return s}
else{this.m_type=box2d.b2SeparationFunctionType.e_faceA;var localPointA1=this.m_proxyA.GetVertex(cache.indexA[0]);var localPointA2=this.m_proxyA.GetVertex(cache.indexA[1]);box2d.b2CrossVOne(box2d.b2SubVV(localPointA2,localPointA1,box2d.b2Vec2.s_t0),this.m_axis).SelfNormalize();var normal=box2d.b2MulRV(xfA.q,this.m_axis,box2d.b2TimeOfImpact.s_normal);box2d.b2MidVV(localPointA1,localPointA2,this.m_localPoint);var pointA=box2d.b2MulXV(xfA,this.m_localPoint,box2d.b2TimeOfImpact.s_pointA);var localPointB=this.m_proxyB.GetVertex(cache.indexB[0]);var pointB=box2d.b2MulXV(xfB,localPointB,box2d.b2TimeOfImpact.s_pointB);var s=box2d.b2DotVV(box2d.b2SubVV(pointB,pointA,box2d.b2Vec2.s_t0),normal);if(s<0){this.m_axis.SelfNeg();s=-s}
return s}}
box2d.b2SeparationFunction.prototype.FindMinSeparation=function(indexA,indexB,t){var xfA=box2d.b2TimeOfImpact.s_xfA;var xfB=box2d.b2TimeOfImpact.s_xfB;this.m_sweepA.GetTransform(xfA,t);this.m_sweepB.GetTransform(xfB,t);switch(this.m_type){case box2d.b2SeparationFunctionType.e_points:{var axisA=box2d.b2MulTRV(xfA.q,this.m_axis,box2d.b2TimeOfImpact.s_axisA);var axisB=box2d.b2MulTRV(xfB.q,box2d.b2NegV(this.m_axis,box2d.b2Vec2.s_t0),box2d.b2TimeOfImpact.s_axisB);indexA[0]=this.m_proxyA.GetSupport(axisA);indexB[0]=this.m_proxyB.GetSupport(axisB);var localPointA=this.m_proxyA.GetVertex(indexA[0]);var localPointB=this.m_proxyB.GetVertex(indexB[0]);var pointA=box2d.b2MulXV(xfA,localPointA,box2d.b2TimeOfImpact.s_pointA);var pointB=box2d.b2MulXV(xfB,localPointB,box2d.b2TimeOfImpact.s_pointB);var separation=box2d.b2DotVV(box2d.b2SubVV(pointB,pointA,box2d.b2Vec2.s_t0),this.m_axis)
return separation}
case box2d.b2SeparationFunctionType.e_faceA:{var normal=box2d.b2MulRV(xfA.q,this.m_axis,box2d.b2TimeOfImpact.s_normal);var pointA=box2d.b2MulXV(xfA,this.m_localPoint,box2d.b2TimeOfImpact.s_pointA);var axisB=box2d.b2MulTRV(xfB.q,box2d.b2NegV(normal,box2d.b2Vec2.s_t0),box2d.b2TimeOfImpact.s_axisB);indexA[0]=-1;indexB[0]=this.m_proxyB.GetSupport(axisB);var localPointB=this.m_proxyB.GetVertex(indexB[0]);var pointB=box2d.b2MulXV(xfB,localPointB,box2d.b2TimeOfImpact.s_pointB);var separation=box2d.b2DotVV(box2d.b2SubVV(pointB,pointA,box2d.b2Vec2.s_t0),normal)
return separation}
case box2d.b2SeparationFunctionType.e_faceB:{var normal=box2d.b2MulRV(xfB.q,this.m_axis,box2d.b2TimeOfImpact.s_normal);var pointB=box2d.b2MulXV(xfB,this.m_localPoint,box2d.b2TimeOfImpact.s_pointB);var axisA=box2d.b2MulTRV(xfA.q,box2d.b2NegV(normal,box2d.b2Vec2.s_t0),box2d.b2TimeOfImpact.s_axisA);indexB[0]=-1;indexA[0]=this.m_proxyA.GetSupport(axisA);var localPointA=this.m_proxyA.GetVertex(indexA[0]);var pointA=box2d.b2MulXV(xfA,localPointA,box2d.b2TimeOfImpact.s_pointA);var separation=box2d.b2DotVV(box2d.b2SubVV(pointA,pointB,box2d.b2Vec2.s_t0),normal)
return separation}
default:if(box2d.ENABLE_ASSERTS){box2d.b2Assert(!1)}
indexA[0]=-1;indexB[0]=-1;return 0}}
box2d.b2SeparationFunction.prototype.Evaluate=function(indexA,indexB,t){var xfA=box2d.b2TimeOfImpact.s_xfA;var xfB=box2d.b2TimeOfImpact.s_xfB;this.m_sweepA.GetTransform(xfA,t);this.m_sweepB.GetTransform(xfB,t);switch(this.m_type){case box2d.b2SeparationFunctionType.e_points:{var localPointA=this.m_proxyA.GetVertex(indexA);var localPointB=this.m_proxyB.GetVertex(indexB);var pointA=box2d.b2MulXV(xfA,localPointA,box2d.b2TimeOfImpact.s_pointA);var pointB=box2d.b2MulXV(xfB,localPointB,box2d.b2TimeOfImpact.s_pointB);var separation=box2d.b2DotVV(box2d.b2SubVV(pointB,pointA,box2d.b2Vec2.s_t0),this.m_axis)
return separation}
case box2d.b2SeparationFunctionType.e_faceA:{var normal=box2d.b2MulRV(xfA.q,this.m_axis,box2d.b2TimeOfImpact.s_normal);var pointA=box2d.b2MulXV(xfA,this.m_localPoint,box2d.b2TimeOfImpact.s_pointA);var localPointB=this.m_proxyB.GetVertex(indexB);var pointB=box2d.b2MulXV(xfB,localPointB,box2d.b2TimeOfImpact.s_pointB);var separation=box2d.b2DotVV(box2d.b2SubVV(pointB,pointA,box2d.b2Vec2.s_t0),normal)
return separation}
case box2d.b2SeparationFunctionType.e_faceB:{var normal=box2d.b2MulRV(xfB.q,this.m_axis,box2d.b2TimeOfImpact.s_normal);var pointB=box2d.b2MulXV(xfB,this.m_localPoint,box2d.b2TimeOfImpact.s_pointB);var localPointA=this.m_proxyA.GetVertex(indexA);var pointA=box2d.b2MulXV(xfA,localPointA,box2d.b2TimeOfImpact.s_pointA);var separation=box2d.b2DotVV(box2d.b2SubVV(pointA,pointB,box2d.b2Vec2.s_t0),normal)
return separation}
default:if(box2d.ENABLE_ASSERTS){box2d.b2Assert(!1)}
return 0}}
box2d.b2TimeOfImpact=function(output,input){var timer=box2d.b2TimeOfImpact.s_timer.Reset();++box2d.b2_toiCalls;output.state=box2d.b2TOIOutputState.e_unknown;output.t=input.tMax;var proxyA=input.proxyA;var proxyB=input.proxyB;var sweepA=box2d.b2TimeOfImpact.s_sweepA.Copy(input.sweepA);var sweepB=box2d.b2TimeOfImpact.s_sweepB.Copy(input.sweepB);sweepA.Normalize();sweepB.Normalize();var tMax=input.tMax;var totalRadius=proxyA.m_radius+proxyB.m_radius;var target=box2d.b2Max(box2d.b2_linearSlop,totalRadius-3*box2d.b2_linearSlop);var tolerance=0.25*box2d.b2_linearSlop;if(box2d.ENABLE_ASSERTS){box2d.b2Assert(target>tolerance)}
var t1=0;var k_maxIterations=20;var iter=0;var cache=box2d.b2TimeOfImpact.s_cache;cache.count=0;var distanceInput=box2d.b2TimeOfImpact.s_distanceInput;distanceInput.proxyA=input.proxyA;distanceInput.proxyB=input.proxyB;distanceInput.useRadii=!1;for(;;){var xfA=box2d.b2TimeOfImpact.s_xfA;var xfB=box2d.b2TimeOfImpact.s_xfB;sweepA.GetTransform(xfA,t1);sweepB.GetTransform(xfB,t1);distanceInput.transformA.Copy(xfA);distanceInput.transformB.Copy(xfB);var distanceOutput=box2d.b2TimeOfImpact.s_distanceOutput;box2d.b2Distance(distanceOutput,cache,distanceInput);if(distanceOutput.distance<=0){output.state=box2d.b2TOIOutputState.e_overlapped;output.t=0;break}
if(distanceOutput.distance<target+tolerance){output.state=box2d.b2TOIOutputState.e_touching;output.t=t1;break}
var fcn=box2d.b2TimeOfImpact.s_fcn;fcn.Initialize(cache,proxyA,sweepA,proxyB,sweepB,t1);var done=!1;var t2=tMax;var pushBackIter=0;for(;;){var indexA=box2d.b2TimeOfImpact.s_indexA;var indexB=box2d.b2TimeOfImpact.s_indexB;var s2=fcn.FindMinSeparation(indexA,indexB,t2);if(s2>(target+tolerance)){output.state=box2d.b2TOIOutputState.e_separated;output.t=tMax;done=!0;break}
if(s2>(target-tolerance)){t1=t2;break}
var s1=fcn.Evaluate(indexA[0],indexB[0],t1);if(s1<(target-tolerance)){output.state=box2d.b2TOIOutputState.e_failed;output.t=t1;done=!0;break}
if(s1<=(target+tolerance)){output.state=box2d.b2TOIOutputState.e_touching;output.t=t1;done=!0;break}
var rootIterCount=0;var a1=t1;var a2=t2;for(;;){var t=0;if(rootIterCount&1){t=a1+(target-s1)*(a2-a1)/(s2-s1)}
else{t=0.5*(a1+a2)}
++rootIterCount;++box2d.b2_toiRootIters;var s=fcn.Evaluate(indexA[0],indexB[0],t);if(box2d.b2Abs(s-target)<tolerance){t2=t;break}
if(s>target){a1=t;s1=s}
else{a2=t;s2=s}
if(rootIterCount===50){break}}
box2d.b2_toiMaxRootIters=box2d.b2Max(box2d.b2_toiMaxRootIters,rootIterCount);++pushBackIter;if(pushBackIter===box2d.b2_maxPolygonVertices){break}}
++iter;++box2d.b2_toiIters;if(done){break}
if(iter===k_maxIterations){output.state=box2d.b2TOIOutputState.e_failed;output.t=t1;break}}
box2d.b2_toiMaxIters=box2d.b2Max(box2d.b2_toiMaxIters,iter);var time=timer.GetMilliseconds();box2d.b2_toiMaxTime=box2d.b2Max(box2d.b2_toiMaxTime,time);box2d.b2_toiTime+=time}
box2d.b2TimeOfImpact.s_timer=new box2d.b2Timer();box2d.b2TimeOfImpact.s_cache=new box2d.b2SimplexCache();box2d.b2TimeOfImpact.s_distanceInput=new box2d.b2DistanceInput();box2d.b2TimeOfImpact.s_distanceOutput=new box2d.b2DistanceOutput();box2d.b2TimeOfImpact.s_xfA=new box2d.b2Transform();box2d.b2TimeOfImpact.s_xfB=new box2d.b2Transform();box2d.b2TimeOfImpact.s_indexA=box2d.b2MakeNumberArray(1);box2d.b2TimeOfImpact.s_indexB=box2d.b2MakeNumberArray(1);box2d.b2TimeOfImpact.s_fcn=new box2d.b2SeparationFunction();box2d.b2TimeOfImpact.s_sweepA=new box2d.b2Sweep();box2d.b2TimeOfImpact.s_sweepB=new box2d.b2Sweep();box2d.b2TimeOfImpact.s_pointA=new box2d.b2Vec2();box2d.b2TimeOfImpact.s_pointB=new box2d.b2Vec2();box2d.b2TimeOfImpact.s_normal=new box2d.b2Vec2();box2d.b2TimeOfImpact.s_axisA=new box2d.b2Vec2();box2d.b2TimeOfImpact.s_axisB=new box2d.b2Vec2();goog.provide('box2d.b2Contact');goog.require('box2d.b2Settings');goog.require('box2d.b2Collision');goog.require('box2d.b2TimeOfImpact');box2d.b2MixFriction=function(friction1,friction2){return box2d.b2Sqrt(friction1*friction2)}
box2d.b2MixRestitution=function(restitution1,restitution2){return restitution1>restitution2?restitution1:restitution2}
box2d.b2ContactEdge=function(){};box2d.b2ContactEdge.prototype.other=null;box2d.b2ContactEdge.prototype.contact=null;box2d.b2ContactEdge.prototype.prev=null;box2d.b2ContactEdge.prototype.next=null;box2d.b2ContactFlag={e_none:0,e_islandFlag:0x0001,e_touchingFlag:0x0002,e_enabledFlag:0x0004,e_filterFlag:0x0008,e_bulletHitFlag:0x0010,e_toiFlag:0x0020};goog.exportProperty(box2d.b2ContactFlag,'e_none',box2d.b2ContactFlag.e_none);goog.exportProperty(box2d.b2ContactFlag,'e_islandFlag',box2d.b2ContactFlag.e_islandFlag);goog.exportProperty(box2d.b2ContactFlag,'e_touchingFlag',box2d.b2ContactFlag.e_touchingFlag);goog.exportProperty(box2d.b2ContactFlag,'e_enabledFlag',box2d.b2ContactFlag.e_enabledFlag);goog.exportProperty(box2d.b2ContactFlag,'e_filterFlag',box2d.b2ContactFlag.e_filterFlag);goog.exportProperty(box2d.b2ContactFlag,'e_bulletHitFlag',box2d.b2ContactFlag.e_bulletHitFlag);goog.exportProperty(box2d.b2ContactFlag,'e_toiFlag',box2d.b2ContactFlag.e_toiFlag);box2d.b2Contact=function(){this.m_nodeA=new box2d.b2ContactEdge();this.m_nodeB=new box2d.b2ContactEdge();this.m_manifold=new box2d.b2Manifold();this.m_oldManifold=new box2d.b2Manifold()}
box2d.b2Contact.prototype.m_flags=box2d.b2ContactFlag.e_none;box2d.b2Contact.prototype.m_prev=null;box2d.b2Contact.prototype.m_next=null;box2d.b2Contact.prototype.m_nodeA=null;box2d.b2Contact.prototype.m_nodeB=null;box2d.b2Contact.prototype.m_fixtureA=null;box2d.b2Contact.prototype.m_fixtureB=null;box2d.b2Contact.prototype.m_indexA=0;box2d.b2Contact.prototype.m_indexB=0;box2d.b2Contact.prototype.m_manifold=null;box2d.b2Contact.prototype.m_toiCount=0;box2d.b2Contact.prototype.m_toi=0;box2d.b2Contact.prototype.m_friction=0;box2d.b2Contact.prototype.m_restitution=0;box2d.b2Contact.prototype.m_tangentSpeed=0;box2d.b2Contact.prototype.m_oldManifold=null;box2d.b2Contact.prototype.GetManifold=function(){return this.m_manifold}
box2d.b2Contact.prototype.GetWorldManifold=function(worldManifold){var bodyA=this.m_fixtureA.GetBody();var bodyB=this.m_fixtureB.GetBody();var shapeA=this.m_fixtureA.GetShape();var shapeB=this.m_fixtureB.GetShape();worldManifold.Initialize(this.m_manifold,bodyA.GetTransform(),shapeA.m_radius,bodyB.GetTransform(),shapeB.m_radius)}
box2d.b2Contact.prototype.IsTouching=function(){return(this.m_flags&box2d.b2ContactFlag.e_touchingFlag)===box2d.b2ContactFlag.e_touchingFlag}
box2d.b2Contact.prototype.SetEnabled=function(flag){if(flag){this.m_flags|=box2d.b2ContactFlag.e_enabledFlag}
else{this.m_flags&=~box2d.b2ContactFlag.e_enabledFlag}}
box2d.b2Contact.prototype.IsEnabled=function(){return(this.m_flags&box2d.b2ContactFlag.e_enabledFlag)===box2d.b2ContactFlag.e_enabledFlag}
box2d.b2Contact.prototype.GetNext=function(){return this.m_next}
box2d.b2Contact.prototype.GetFixtureA=function(){return this.m_fixtureA}
box2d.b2Contact.prototype.GetChildIndexA=function(){return this.m_indexA}
box2d.b2Contact.prototype.GetFixtureB=function(){return this.m_fixtureB}
box2d.b2Contact.prototype.GetChildIndexB=function(){return this.m_indexB}
box2d.b2Contact.prototype.Evaluate=function(manifold,xfA,xfB){}
box2d.b2Contact.prototype.FlagForFiltering=function(){this.m_flags|=box2d.b2ContactFlag.e_filterFlag}
box2d.b2Contact.prototype.SetFriction=function(friction){this.m_friction=friction}
box2d.b2Contact.prototype.GetFriction=function(){return this.m_friction}
box2d.b2Contact.prototype.ResetFriction=function(){this.m_friction=box2d.b2MixFriction(this.m_fixtureA.m_friction,this.m_fixtureB.m_friction)}
box2d.b2Contact.prototype.SetRestitution=function(restitution){this.m_restitution=restitution}
box2d.b2Contact.prototype.GetRestitution=function(){return this.m_restitution}
box2d.b2Contact.prototype.ResetRestitution=function(){this.m_restitution=box2d.b2MixRestitution(this.m_fixtureA.m_restitution,this.m_fixtureB.m_restitution)}
box2d.b2Contact.prototype.SetTangentSpeed=function(speed){this.m_tangentSpeed=speed}
box2d.b2Contact.prototype.GetTangentSpeed=function(){return this.m_tangentSpeed}
box2d.b2Contact.prototype.Reset=function(fixtureA,indexA,fixtureB,indexB){this.m_flags=box2d.b2ContactFlag.e_enabledFlag;this.m_fixtureA=fixtureA;this.m_fixtureB=fixtureB;this.m_indexA=indexA;this.m_indexB=indexB;this.m_manifold.pointCount=0;this.m_prev=null;this.m_next=null;this.m_nodeA.contact=null;this.m_nodeA.prev=null;this.m_nodeA.next=null;this.m_nodeA.other=null;this.m_nodeB.contact=null;this.m_nodeB.prev=null;this.m_nodeB.next=null;this.m_nodeB.other=null;this.m_toiCount=0;this.m_friction=box2d.b2MixFriction(this.m_fixtureA.m_friction,this.m_fixtureB.m_friction);this.m_restitution=box2d.b2MixRestitution(this.m_fixtureA.m_restitution,this.m_fixtureB.m_restitution)}
box2d.b2Contact.prototype.Update=function(listener){var tManifold=this.m_oldManifold;this.m_oldManifold=this.m_manifold;this.m_manifold=tManifold;this.m_flags|=box2d.b2ContactFlag.e_enabledFlag;var touching=!1;var wasTouching=(this.m_flags&box2d.b2ContactFlag.e_touchingFlag)===box2d.b2ContactFlag.e_touchingFlag;var sensorA=this.m_fixtureA.IsSensor();var sensorB=this.m_fixtureB.IsSensor();var sensor=sensorA||sensorB;var bodyA=this.m_fixtureA.GetBody();var bodyB=this.m_fixtureB.GetBody();var xfA=bodyA.GetTransform();var xfB=bodyB.GetTransform();if(sensor){var shapeA=this.m_fixtureA.GetShape();var shapeB=this.m_fixtureB.GetShape();touching=box2d.b2TestOverlapShape(shapeA,this.m_indexA,shapeB,this.m_indexB,xfA,xfB);this.m_manifold.pointCount=0}
else{this.Evaluate(this.m_manifold,xfA,xfB);touching=this.m_manifold.pointCount>0;for(var i=0;i<this.m_manifold.pointCount;++i){var mp2=this.m_manifold.points[i];mp2.normalImpulse=0;mp2.tangentImpulse=0;var id2=mp2.id;for(var j=0;j<this.m_oldManifold.pointCount;++j){var mp1=this.m_oldManifold.points[j];if(mp1.id.key===id2.key){mp2.normalImpulse=mp1.normalImpulse;mp2.tangentImpulse=mp1.tangentImpulse;break}}}
if(touching!==wasTouching){bodyA.SetAwake(!0);bodyB.SetAwake(!0)}}
if(touching){this.m_flags|=box2d.b2ContactFlag.e_touchingFlag}
else{this.m_flags&=~box2d.b2ContactFlag.e_touchingFlag}
if(wasTouching===!1&&touching===!0&&listener){listener.BeginContact(this)}
if(wasTouching===!0&&touching===!1&&listener){listener.EndContact(this)}
if(sensor===!1&&touching&&listener){listener.PreSolve(this,this.m_oldManifold)}}
box2d.b2Contact.prototype.ComputeTOI=function(sweepA,sweepB){var input=box2d.b2Contact.prototype.ComputeTOI.s_input;input.proxyA.SetShape(this.m_fixtureA.GetShape(),this.m_indexA);input.proxyB.SetShape(this.m_fixtureB.GetShape(),this.m_indexB);input.sweepA.Copy(sweepA);input.sweepB.Copy(sweepB);input.tMax=box2d.b2_linearSlop;var output=box2d.b2Contact.prototype.ComputeTOI.s_output;box2d.b2TimeOfImpact(output,input);return output.t}
box2d.b2Contact.prototype.ComputeTOI.s_input=new box2d.b2TOIInput();box2d.b2Contact.prototype.ComputeTOI.s_output=new box2d.b2TOIOutput();goog.provide('box2d.b2PolygonAndCircleContact');goog.require('box2d.b2Settings');goog.require('box2d.b2Contact');box2d.b2PolygonAndCircleContact=function(){goog.base(this)};goog.inherits(box2d.b2PolygonAndCircleContact,box2d.b2Contact);box2d.b2PolygonAndCircleContact.Create=function(allocator){return new box2d.b2PolygonAndCircleContact()}
box2d.b2PolygonAndCircleContact.Destroy=function(contact,allocator){}
box2d.b2PolygonAndCircleContact.prototype.Reset=function(fixtureA,indexA,fixtureB,indexB){goog.base(this,'Reset',fixtureA,indexA,fixtureB,indexB);if(box2d.ENABLE_ASSERTS){box2d.b2Assert(fixtureA.GetType()===box2d.b2ShapeType.e_polygonShape)}
if(box2d.ENABLE_ASSERTS){box2d.b2Assert(fixtureB.GetType()===box2d.b2ShapeType.e_circleShape)}}
box2d.b2PolygonAndCircleContact.prototype.Evaluate=function(manifold,xfA,xfB){var shapeA=this.m_fixtureA.GetShape();var shapeB=this.m_fixtureB.GetShape();if(box2d.ENABLE_ASSERTS){box2d.b2Assert(shapeA instanceof box2d.b2PolygonShape)}
if(box2d.ENABLE_ASSERTS){box2d.b2Assert(shapeB instanceof box2d.b2CircleShape)}
box2d.b2CollidePolygonAndCircle(manifold,(shapeA instanceof box2d.b2PolygonShape)?shapeA:null,xfA,(shapeB instanceof box2d.b2CircleShape)?shapeB:null,xfB)}
goog.provide('box2d.b2EdgeAndPolygonContact');goog.require('box2d.b2Settings');goog.require('box2d.b2Contact');box2d.b2EdgeAndPolygonContact=function(){goog.base(this)};goog.inherits(box2d.b2EdgeAndPolygonContact,box2d.b2Contact);box2d.b2EdgeAndPolygonContact.Create=function(allocator){return new box2d.b2EdgeAndPolygonContact()}
box2d.b2EdgeAndPolygonContact.Destroy=function(contact,allocator){}
box2d.b2EdgeAndPolygonContact.prototype.Reset=function(fixtureA,indexA,fixtureB,indexB){goog.base(this,'Reset',fixtureA,indexA,fixtureB,indexB);if(box2d.ENABLE_ASSERTS){box2d.b2Assert(fixtureA.GetType()===box2d.b2ShapeType.e_edgeShape)}
if(box2d.ENABLE_ASSERTS){box2d.b2Assert(fixtureB.GetType()===box2d.b2ShapeType.e_polygonShape)}}
box2d.b2EdgeAndPolygonContact.prototype.Evaluate=function(manifold,xfA,xfB){var shapeA=this.m_fixtureA.GetShape();var shapeB=this.m_fixtureB.GetShape();if(box2d.ENABLE_ASSERTS){box2d.b2Assert(shapeA instanceof box2d.b2EdgeShape)}
if(box2d.ENABLE_ASSERTS){box2d.b2Assert(shapeB instanceof box2d.b2PolygonShape)}
box2d.b2CollideEdgeAndPolygon(manifold,(shapeA instanceof box2d.b2EdgeShape)?shapeA:null,xfA,(shapeB instanceof box2d.b2PolygonShape)?shapeB:null,xfB)}
goog.provide('box2d.b2Shape');goog.require('box2d.b2Settings');goog.require('box2d.b2Math');goog.require('box2d.b2Distance');box2d.b2MassData=function(){this.center=new box2d.b2Vec2(0,0)};box2d.b2MassData.prototype.mass=0;box2d.b2MassData.prototype.center=null;box2d.b2MassData.prototype.I=0;box2d.b2ShapeType={e_unknown:-1,e_circleShape:0,e_edgeShape:1,e_polygonShape:2,e_chainShape:3,e_shapeTypeCount:4};goog.exportProperty(box2d.b2ShapeType,'e_unknown',box2d.b2ShapeType.e_unknown);goog.exportProperty(box2d.b2ShapeType,'e_circleShape',box2d.b2ShapeType.e_circleShape);goog.exportProperty(box2d.b2ShapeType,'e_edgeShape',box2d.b2ShapeType.e_edgeShape);goog.exportProperty(box2d.b2ShapeType,'e_polygonShape',box2d.b2ShapeType.e_polygonShape);goog.exportProperty(box2d.b2ShapeType,'e_chainShape',box2d.b2ShapeType.e_chainShape);goog.exportProperty(box2d.b2ShapeType,'e_shapeTypeCount',box2d.b2ShapeType.e_shapeTypeCount);box2d.b2Shape=function(type,radius){this.m_type=type;this.m_radius=radius}
box2d.b2Shape.prototype.m_type=box2d.b2ShapeType.e_unknown;box2d.b2Shape.prototype.m_radius=0;box2d.b2Shape.prototype.Clone=function(){if(box2d.ENABLE_ASSERTS){box2d.b2Assert(!1)}
return null}
box2d.b2Shape.prototype.Copy=function(other){if(box2d.ENABLE_ASSERTS){box2d.b2Assert(this.m_type===other.m_type)}
this.m_radius=other.m_radius;return this}
box2d.b2Shape.prototype.GetType=function(){return this.m_type}
box2d.b2Shape.prototype.GetChildCount=function(){if(box2d.ENABLE_ASSERTS){box2d.b2Assert(!1,"pure virtual")}
return 0}
box2d.b2Shape.prototype.TestPoint=function(xf,p){if(box2d.ENABLE_ASSERTS){box2d.b2Assert(!1,"pure virtual")}
return !1}
box2d.b2Shape.prototype.RayCast=function(output,input,transform,childIndex){if(box2d.ENABLE_ASSERTS){box2d.b2Assert(!1,"pure virtual")}
return !1}
box2d.b2Shape.prototype.ComputeAABB=function(aabb,xf,childIndex){if(box2d.ENABLE_ASSERTS){box2d.b2Assert(!1,"pure virtual")}}
box2d.b2Shape.prototype.ComputeMass=function(massData,density){if(box2d.ENABLE_ASSERTS){box2d.b2Assert(!1,"pure virtual")}}
box2d.b2Shape.prototype.SetupDistanceProxy=function(proxy,index){if(box2d.ENABLE_ASSERTS){box2d.b2Assert(!1,"pure virtual")}}
box2d.b2Shape.prototype.ComputeSubmergedArea=function(normal,offset,xf,c){if(box2d.ENABLE_ASSERTS){box2d.b2Assert(!1,"pure virtual")}
return 0}
box2d.b2Shape.prototype.Dump=function(){if(box2d.ENABLE_ASSERTS){box2d.b2Assert(!1,"pure virtual")}}
goog.provide('box2d.b2PolygonShape');goog.require('box2d.b2Shape');box2d.b2PolygonShape=function(){goog.base(this,box2d.b2ShapeType.e_polygonShape,box2d.b2_polygonRadius);this.m_centroid=new box2d.b2Vec2(0,0);this.m_vertices=box2d.b2Vec2.MakeArray(box2d.b2_maxPolygonVertices);this.m_normals=box2d.b2Vec2.MakeArray(box2d.b2_maxPolygonVertices)}
goog.inherits(box2d.b2PolygonShape,box2d.b2Shape);box2d.b2PolygonShape.prototype.m_centroid=null;box2d.b2PolygonShape.prototype.m_vertices=null;box2d.b2PolygonShape.prototype.m_normals=null;box2d.b2PolygonShape.prototype.m_count=0;box2d.b2PolygonShape.prototype.Clone=function(){return new box2d.b2PolygonShape().Copy(this)}
box2d.b2PolygonShape.prototype.Copy=function(other){goog.base(this,'Copy',other);if(box2d.ENABLE_ASSERTS){box2d.b2Assert(other instanceof box2d.b2PolygonShape)}
this.m_centroid.Copy(other.m_centroid);this.m_count=other.m_count;for(var i=0,ict=this.m_count;i<ict;++i){this.m_vertices[i].Copy(other.m_vertices[i]);this.m_normals[i].Copy(other.m_normals[i])}
return this}
box2d.b2PolygonShape.prototype.SetAsBox=function(hx,hy){this.m_count=4;this.m_vertices[0].SetXY((-hx),(-hy));this.m_vertices[1].SetXY(hx,(-hy));this.m_vertices[2].SetXY(hx,hy);this.m_vertices[3].SetXY((-hx),hy);this.m_normals[0].SetXY(0,(-1));this.m_normals[1].SetXY(1,0);this.m_normals[2].SetXY(0,1);this.m_normals[3].SetXY((-1),0);this.m_centroid.SetZero();return this}
box2d.b2PolygonShape.prototype.SetAsOrientedBox=function(hx,hy,center,angle){this.m_count=4;this.m_vertices[0].SetXY((-hx),(-hy));this.m_vertices[1].SetXY(hx,(-hy));this.m_vertices[2].SetXY(hx,hy);this.m_vertices[3].SetXY((-hx),hy);this.m_normals[0].SetXY(0,(-1));this.m_normals[1].SetXY(1,0);this.m_normals[2].SetXY(0,1);this.m_normals[3].SetXY((-1),0);this.m_centroid.Copy(center);var xf=new box2d.b2Transform();xf.SetPosition(center);xf.SetRotationAngleRadians(angle);for(var i=0,ict=this.m_count;i<ict;++i){box2d.b2MulXV(xf,this.m_vertices[i],this.m_vertices[i]);box2d.b2MulRV(xf.q,this.m_normals[i],this.m_normals[i])}
return this}
box2d.b2PolygonShape.prototype.Set=function(vertices,count){if(count===undefined)count=vertices.length;if(box2d.ENABLE_ASSERTS){box2d.b2Assert(3<=count&&count<=box2d.b2_maxPolygonVertices)}
if(count<3){return this.SetAsBox(1,1)}
var n=box2d.b2Min(count,box2d.b2_maxPolygonVertices);var ps=box2d.b2PolygonShape.prototype.Set.s_ps;var tempCount=0;for(var i=0;i<n;++i){var v=vertices[i];var unique=!0;for(var j=0;j<tempCount;++j){if(box2d.b2DistanceSquaredVV(v,ps[j])<0.5*box2d.b2_linearSlop){unique=!1;break}}
if(unique){ps[tempCount++].Copy(v)}}
n=tempCount;if(n<3){if(box2d.ENABLE_ASSERTS){box2d.b2Assert(!1)}
return this.SetAsBox(1.0,1.0)}
var i0=0;var x0=ps[0].x;for(var i=1;i<n;++i){var x=ps[i].x;if(x>x0||(x===x0&&ps[i].y<ps[i0].y)){i0=i;x0=x}}
var hull=box2d.b2PolygonShape.prototype.Set.s_hull;var m=0;var ih=i0;for(;;){hull[m]=ih;var ie=0;for(var j=1;j<n;++j){if(ie===ih){ie=j;continue}
var r=box2d.b2SubVV(ps[ie],ps[hull[m]],box2d.b2PolygonShape.prototype.Set.s_r);var v=box2d.b2SubVV(ps[j],ps[hull[m]],box2d.b2PolygonShape.prototype.Set.s_v);var c=box2d.b2CrossVV(r,v);if(c<0){ie=j}
if(c===0&&v.GetLengthSquared()>r.GetLengthSquared()){ie=j}}
++m;ih=ie;if(ie===i0){break}}
this.m_count=m;for(var i=0;i<m;++i){this.m_vertices[i].Copy(ps[hull[i]])}
for(var i=0,ict=m;i<ict;++i){var vertexi1=this.m_vertices[i];var vertexi2=this.m_vertices[(i+1)%ict];var edge=box2d.b2SubVV(vertexi2,vertexi1,box2d.b2Vec2.s_t0);if(box2d.ENABLE_ASSERTS){box2d.b2Assert(edge.GetLengthSquared()>box2d.b2_epsilon_sq)}
box2d.b2CrossVOne(edge,this.m_normals[i]).SelfNormalize()}
box2d.b2PolygonShape.ComputeCentroid(this.m_vertices,m,this.m_centroid);return this}
box2d.b2PolygonShape.prototype.Set.s_ps=box2d.b2Vec2.MakeArray(box2d.b2_maxPolygonVertices);box2d.b2PolygonShape.prototype.Set.s_hull=box2d.b2MakeNumberArray(box2d.b2_maxPolygonVertices);box2d.b2PolygonShape.prototype.Set.s_r=new box2d.b2Vec2();box2d.b2PolygonShape.prototype.Set.s_v=new box2d.b2Vec2();box2d.b2PolygonShape.prototype.SetAsVector=function(vertices,count){this.Set(vertices,count);return this}
box2d.b2PolygonShape.prototype.SetAsArray=function(vertices,count){this.Set(vertices,count);return this}
box2d.b2PolygonShape.prototype.GetChildCount=function(){return 1}
box2d.b2PolygonShape.prototype.TestPoint=function(xf,p){var pLocal=box2d.b2MulTXV(xf,p,box2d.b2PolygonShape.prototype.TestPoint.s_pLocal);for(var i=0,ict=this.m_count;i<ict;++i){var dot=box2d.b2DotVV(this.m_normals[i],box2d.b2SubVV(pLocal,this.m_vertices[i],box2d.b2Vec2.s_t0));if(dot>0){return !1}}
return !0}
box2d.b2PolygonShape.prototype.TestPoint.s_pLocal=new box2d.b2Vec2();box2d.b2PolygonShape.prototype.RayCast=function(output,input,xf,childIndex){var p1=box2d.b2MulTXV(xf,input.p1,box2d.b2PolygonShape.prototype.RayCast.s_p1);var p2=box2d.b2MulTXV(xf,input.p2,box2d.b2PolygonShape.prototype.RayCast.s_p2);var d=box2d.b2SubVV(p2,p1,box2d.b2PolygonShape.prototype.RayCast.s_d);var lower=0,upper=input.maxFraction;var index=-1;for(var i=0,ict=this.m_count;i<ict;++i){var numerator=box2d.b2DotVV(this.m_normals[i],box2d.b2SubVV(this.m_vertices[i],p1,box2d.b2Vec2.s_t0));var denominator=box2d.b2DotVV(this.m_normals[i],d);if(denominator===0){if(numerator<0){return !1}}
else{if(denominator<0&&numerator<lower*denominator){lower=numerator/denominator;index=i}
else if(denominator>0&&numerator<upper*denominator){upper=numerator/denominator}}
if(upper<lower){return !1}}
if(box2d.ENABLE_ASSERTS){box2d.b2Assert(0<=lower&&lower<=input.maxFraction)}
if(index>=0){output.fraction=lower;box2d.b2MulRV(xf.q,this.m_normals[index],output.normal);return !0}
return !1}
box2d.b2PolygonShape.prototype.RayCast.s_p1=new box2d.b2Vec2();box2d.b2PolygonShape.prototype.RayCast.s_p2=new box2d.b2Vec2();box2d.b2PolygonShape.prototype.RayCast.s_d=new box2d.b2Vec2();box2d.b2PolygonShape.prototype.ComputeAABB=function(aabb,xf,childIndex){var lower=box2d.b2MulXV(xf,this.m_vertices[0],aabb.lowerBound);var upper=aabb.upperBound.Copy(lower);for(var i=0,ict=this.m_count;i<ict;++i){var v=box2d.b2MulXV(xf,this.m_vertices[i],box2d.b2PolygonShape.prototype.ComputeAABB.s_v);box2d.b2MinV(v,lower,lower);box2d.b2MaxV(v,upper,upper)}
var r=this.m_radius;lower.SelfSubXY(r,r);upper.SelfAddXY(r,r)}
box2d.b2PolygonShape.prototype.ComputeAABB.s_v=new box2d.b2Vec2();box2d.b2PolygonShape.prototype.ComputeMass=function(massData,density){if(box2d.ENABLE_ASSERTS){box2d.b2Assert(this.m_count>=3)}
var center=box2d.b2PolygonShape.prototype.ComputeMass.s_center.SetZero();var area=0;var I=0;var s=box2d.b2PolygonShape.prototype.ComputeMass.s_s.SetZero();for(var i=0,ict=this.m_count;i<ict;++i){s.SelfAdd(this.m_vertices[i])}
s.SelfMul(1/this.m_count);var k_inv3=1/3;for(var i=0,ict=this.m_count;i<ict;++i){var e1=box2d.b2SubVV(this.m_vertices[i],s,box2d.b2PolygonShape.prototype.ComputeMass.s_e1);var e2=box2d.b2SubVV(this.m_vertices[(i+1)%ict],s,box2d.b2PolygonShape.prototype.ComputeMass.s_e2);var D=box2d.b2CrossVV(e1,e2);var triangleArea=0.5*D;area+=triangleArea;center.SelfAdd(box2d.b2MulSV(triangleArea*k_inv3,box2d.b2AddVV(e1,e2,box2d.b2Vec2.s_t0),box2d.b2Vec2.s_t1));var ex1=e1.x;var ey1=e1.y;var ex2=e2.x;var ey2=e2.y;var intx2=ex1*ex1+ex2*ex1+ex2*ex2;var inty2=ey1*ey1+ey2*ey1+ey2*ey2;I+=(0.25*k_inv3*D)*(intx2+inty2)}
massData.mass=density*area;if(box2d.ENABLE_ASSERTS){box2d.b2Assert(area>box2d.b2_epsilon)}
center.SelfMul(1/area);box2d.b2AddVV(center,s,massData.center);massData.I=density*I;massData.I+=massData.mass*(box2d.b2DotVV(massData.center,massData.center)-box2d.b2DotVV(center,center))}
box2d.b2PolygonShape.prototype.ComputeMass.s_center=new box2d.b2Vec2();box2d.b2PolygonShape.prototype.ComputeMass.s_s=new box2d.b2Vec2();box2d.b2PolygonShape.prototype.ComputeMass.s_e1=new box2d.b2Vec2();box2d.b2PolygonShape.prototype.ComputeMass.s_e2=new box2d.b2Vec2();box2d.b2PolygonShape.prototype.Validate=function(){for(var i=0;i<this.m_count;++i){var i1=i;var i2=(i+1)%this.m_count;var p=this.m_vertices[i1];var e=box2d.b2SubVV(this.m_vertices[i2],p,box2d.b2PolygonShape.prototype.Validate.s_e);for(var j=0;j<this.m_count;++j){if(j===i1||j===i2){continue}
var v=box2d.b2SubVV(this.m_vertices[j],p,box2d.b2PolygonShape.prototype.Validate.s_v);var c=box2d.b2CrossVV(e,v);if(c<0){return !1}}}
return !0}
box2d.b2PolygonShape.prototype.Validate.s_e=new box2d.b2Vec2();box2d.b2PolygonShape.prototype.Validate.s_v=new box2d.b2Vec2();box2d.b2PolygonShape.prototype.SetupDistanceProxy=function(proxy,index){proxy.m_vertices=this.m_vertices;proxy.m_count=this.m_count;proxy.m_radius=this.m_radius}
box2d.b2PolygonShape.prototype.ComputeSubmergedArea=function(normal,offset,xf,c){var normalL=box2d.b2MulTRV(xf.q,normal,box2d.b2PolygonShape.prototype.ComputeSubmergedArea.s_normalL);var offsetL=offset-box2d.b2DotVV(normal,xf.p);var depths=box2d.b2PolygonShape.prototype.ComputeSubmergedArea.s_depths;var diveCount=0;var intoIndex=-1;var outoIndex=-1;var lastSubmerged=!1;for(var i=0,ict=this.m_count;i<ict;++i){depths[i]=box2d.b2DotVV(normalL,this.m_vertices[i])-offsetL;var isSubmerged=depths[i]<(-box2d.b2_epsilon);if(i>0){if(isSubmerged){if(!lastSubmerged){intoIndex=i-1;diveCount++}}
else{if(lastSubmerged){outoIndex=i-1;diveCount++}}}
lastSubmerged=isSubmerged}
switch(diveCount){case 0:if(lastSubmerged){var md=box2d.b2PolygonShape.prototype.ComputeSubmergedArea.s_md;this.ComputeMass(md,1);box2d.b2MulXV(xf,md.center,c);return md.mass}
else{return 0}
break;case 1:if(intoIndex===(-1)){intoIndex=this.m_count-1}
else{outoIndex=this.m_count-1}
break}
var intoIndex2=((intoIndex+1)%this.m_count);var outoIndex2=((outoIndex+1)%this.m_count);var intoLamdda=(0-depths[intoIndex])/(depths[intoIndex2]-depths[intoIndex]);var outoLamdda=(0-depths[outoIndex])/(depths[outoIndex2]-depths[outoIndex]);var intoVec=box2d.b2PolygonShape.prototype.ComputeSubmergedArea.s_intoVec.SetXY(this.m_vertices[intoIndex].x*(1-intoLamdda)+this.m_vertices[intoIndex2].x*intoLamdda,this.m_vertices[intoIndex].y*(1-intoLamdda)+this.m_vertices[intoIndex2].y*intoLamdda);var outoVec=box2d.b2PolygonShape.prototype.ComputeSubmergedArea.s_outoVec.SetXY(this.m_vertices[outoIndex].x*(1-outoLamdda)+this.m_vertices[outoIndex2].x*outoLamdda,this.m_vertices[outoIndex].y*(1-outoLamdda)+this.m_vertices[outoIndex2].y*outoLamdda);var area=0;var center=box2d.b2PolygonShape.prototype.ComputeSubmergedArea.s_center.SetZero();var p2=this.m_vertices[intoIndex2];var p3=null;var i=intoIndex2;while(i!==outoIndex2){i=(i+1)%this.m_count;if(i===outoIndex2)
p3=outoVec;else p3=this.m_vertices[i];var triangleArea=0.5*((p2.x-intoVec.x)*(p3.y-intoVec.y)-(p2.y-intoVec.y)*(p3.x-intoVec.x));area+=triangleArea;center.x+=triangleArea*(intoVec.x+p2.x+p3.x)/3;center.y+=triangleArea*(intoVec.y+p2.y+p3.y)/3;p2=p3}
center.SelfMul(1/area);box2d.b2MulXV(xf,center,c);return area}
box2d.b2PolygonShape.prototype.ComputeSubmergedArea.s_normalL=new box2d.b2Vec2();box2d.b2PolygonShape.prototype.ComputeSubmergedArea.s_depths=box2d.b2MakeNumberArray(box2d.b2_maxPolygonVertices);box2d.b2PolygonShape.prototype.ComputeSubmergedArea.s_md=new box2d.b2MassData();box2d.b2PolygonShape.prototype.ComputeSubmergedArea.s_intoVec=new box2d.b2Vec2();box2d.b2PolygonShape.prototype.ComputeSubmergedArea.s_outoVec=new box2d.b2Vec2();box2d.b2PolygonShape.prototype.ComputeSubmergedArea.s_center=new box2d.b2Vec2();box2d.b2PolygonShape.prototype.Dump=function(){box2d.b2Log("    /*box2d.b2PolygonShape*/ var shape = new box2d.b2PolygonShape();\n");box2d.b2Log("    /*box2d.b2Vec2[]*/ var vs = box2d.b2Vec2.MakeArray(%d);\n",box2d.b2_maxPolygonVertices);for(var i=0;i<this.m_count;++i){box2d.b2Log("    vs[%d].SetXY(%.15f, %.15f);\n",i,this.m_vertices[i].x,this.m_vertices[i].y)}
box2d.b2Log("    shape.Set(vs, %d);\n",this.m_count)}
box2d.b2PolygonShape.ComputeCentroid=function(vs,count,out){if(box2d.ENABLE_ASSERTS){box2d.b2Assert(count>=3)}
var c=out;c.SetZero();var area=0;var pRef=box2d.b2PolygonShape.ComputeCentroid.s_pRef.SetZero();var inv3=1/3;for(var i=0;i<count;++i){var p1=pRef;var p2=vs[i];var p3=vs[(i+1)%count];var e1=box2d.b2SubVV(p2,p1,box2d.b2PolygonShape.ComputeCentroid.s_e1);var e2=box2d.b2SubVV(p3,p1,box2d.b2PolygonShape.ComputeCentroid.s_e2);var D=box2d.b2CrossVV(e1,e2);var triangleArea=0.5*D;area+=triangleArea;c.x+=triangleArea*inv3*(p1.x+p2.x+p3.x);c.y+=triangleArea*inv3*(p1.y+p2.y+p3.y)}
if(box2d.ENABLE_ASSERTS){box2d.b2Assert(area>box2d.b2_epsilon)}
c.SelfMul(1/area);return c}
box2d.b2PolygonShape.ComputeCentroid.s_pRef=new box2d.b2Vec2();box2d.b2PolygonShape.ComputeCentroid.s_e1=new box2d.b2Vec2();box2d.b2PolygonShape.ComputeCentroid.s_e2=new box2d.b2Vec2();goog.provide('box2d.b2CollideEdge');goog.require('box2d.b2Collision');box2d.b2CollideEdgeAndCircle=function(manifold,edgeA,xfA,circleB,xfB){manifold.pointCount=0;var Q=box2d.b2MulTXV(xfA,box2d.b2MulXV(xfB,circleB.m_p,box2d.b2Vec2.s_t0),box2d.b2CollideEdgeAndCircle.s_Q);var A=edgeA.m_vertex1;var B=edgeA.m_vertex2;var e=box2d.b2SubVV(B,A,box2d.b2CollideEdgeAndCircle.s_e);var u=box2d.b2DotVV(e,box2d.b2SubVV(B,Q,box2d.b2Vec2.s_t0));var v=box2d.b2DotVV(e,box2d.b2SubVV(Q,A,box2d.b2Vec2.s_t0));var radius=edgeA.m_radius+circleB.m_radius;var id=box2d.b2CollideEdgeAndCircle.s_id;id.cf.indexB=0;id.cf.typeB=box2d.b2ContactFeatureType.e_vertex;if(v<=0){var P=A;var d=box2d.b2SubVV(Q,P,box2d.b2CollideEdgeAndCircle.s_d);var dd=box2d.b2DotVV(d,d);if(dd>radius*radius){return}
if(edgeA.m_hasVertex0){var A1=edgeA.m_vertex0;var B1=A;var e1=box2d.b2SubVV(B1,A1,box2d.b2CollideEdgeAndCircle.s_e1);var u1=box2d.b2DotVV(e1,box2d.b2SubVV(B1,Q,box2d.b2Vec2.s_t0));if(u1>0){return}}
id.cf.indexA=0;id.cf.typeA=box2d.b2ContactFeatureType.e_vertex;manifold.pointCount=1;manifold.type=box2d.b2ManifoldType.e_circles;manifold.localNormal.SetZero();manifold.localPoint.Copy(P);manifold.points[0].id.Copy(id);manifold.points[0].localPoint.Copy(circleB.m_p);return}
if(u<=0){var P=B;var d=box2d.b2SubVV(Q,P,box2d.b2CollideEdgeAndCircle.s_d);var dd=box2d.b2DotVV(d,d);if(dd>radius*radius){return}
if(edgeA.m_hasVertex3){var B2=edgeA.m_vertex3;var A2=B;var e2=box2d.b2SubVV(B2,A2,box2d.b2CollideEdgeAndCircle.s_e2);var v2=box2d.b2DotVV(e2,box2d.b2SubVV(Q,A2,box2d.b2Vec2.s_t0));if(v2>0){return}}
id.cf.indexA=1;id.cf.typeA=box2d.b2ContactFeatureType.e_vertex;manifold.pointCount=1;manifold.type=box2d.b2ManifoldType.e_circles;manifold.localNormal.SetZero();manifold.localPoint.Copy(P);manifold.points[0].id.Copy(id);manifold.points[0].localPoint.Copy(circleB.m_p);return}
var den=box2d.b2DotVV(e,e);if(box2d.ENABLE_ASSERTS){box2d.b2Assert(den>0)}
var P=box2d.b2CollideEdgeAndCircle.s_P;P.x=(1/den)*(u*A.x+v*B.x);P.y=(1/den)*(u*A.y+v*B.y);var d=box2d.b2SubVV(Q,P,box2d.b2CollideEdgeAndCircle.s_d);var dd=box2d.b2DotVV(d,d);if(dd>radius*radius){return}
var n=box2d.b2CollideEdgeAndCircle.s_n.SetXY(-e.y,e.x);if(box2d.b2DotVV(n,box2d.b2SubVV(Q,A,box2d.b2Vec2.s_t0))<0){n.SetXY(-n.x,-n.y)}
n.Normalize();id.cf.indexA=0;id.cf.typeA=box2d.b2ContactFeatureType.e_face;manifold.pointCount=1;manifold.type=box2d.b2ManifoldType.e_faceA;manifold.localNormal.Copy(n);manifold.localPoint.Copy(A);manifold.points[0].id.Copy(id);manifold.points[0].localPoint.Copy(circleB.m_p)}
box2d.b2CollideEdgeAndCircle.s_Q=new box2d.b2Vec2();box2d.b2CollideEdgeAndCircle.s_e=new box2d.b2Vec2();box2d.b2CollideEdgeAndCircle.s_d=new box2d.b2Vec2();box2d.b2CollideEdgeAndCircle.s_e1=new box2d.b2Vec2();box2d.b2CollideEdgeAndCircle.s_e2=new box2d.b2Vec2();box2d.b2CollideEdgeAndCircle.s_P=new box2d.b2Vec2();box2d.b2CollideEdgeAndCircle.s_n=new box2d.b2Vec2();box2d.b2CollideEdgeAndCircle.s_id=new box2d.b2ContactID();box2d.b2EPAxisType={e_unknown:0,e_edgeA:1,e_edgeB:2};goog.exportProperty(box2d.b2EPAxisType,'e_unknown',box2d.b2EPAxisType.e_unknown);goog.exportProperty(box2d.b2EPAxisType,'e_edgeA',box2d.b2EPAxisType.e_edgeA);goog.exportProperty(box2d.b2EPAxisType,'e_edgeB',box2d.b2EPAxisType.e_edgeB);box2d.b2EPAxis=function(){};box2d.b2EPAxis.prototype.type=box2d.b2EPAxisType.e_unknown;box2d.b2EPAxis.prototype.index=0;box2d.b2EPAxis.prototype.separation=0;box2d.b2TempPolygon=function(){this.vertices=box2d.b2Vec2.MakeArray(box2d.b2_maxPolygonVertices);this.normals=box2d.b2Vec2.MakeArray(box2d.b2_maxPolygonVertices);this.count=0};box2d.b2TempPolygon.prototype.vertices=null;box2d.b2TempPolygon.prototype.normals=null;box2d.b2TempPolygon.prototype.count=0;box2d.b2ReferenceFace=function(){this.i1=0;this.i2=0;this.v1=new box2d.b2Vec2();this.v2=new box2d.b2Vec2();this.normal=new box2d.b2Vec2();this.sideNormal1=new box2d.b2Vec2();this.sideOffset1=0;this.sideNormal2=new box2d.b2Vec2();this.sideOffset2=0};box2d.b2ReferenceFace.prototype.i1=0;box2d.b2ReferenceFace.prototype.i2=0;box2d.b2ReferenceFace.prototype.v1=null;box2d.b2ReferenceFace.prototype.v2=null;box2d.b2ReferenceFace.prototype.normal=null;box2d.b2ReferenceFace.prototype.sideNormal1=null;box2d.b2ReferenceFace.prototype.sideOffset1=0;box2d.b2ReferenceFace.prototype.sideNormal2=null;box2d.b2ReferenceFace.prototype.sideOffset2=0;box2d.b2EPColliderVertexType={e_isolated:0,e_concave:1,e_convex:2};goog.exportProperty(box2d.b2EPColliderVertexType,'e_isolated',box2d.b2EPColliderVertexType.e_isolated);goog.exportProperty(box2d.b2EPColliderVertexType,'e_concave',box2d.b2EPColliderVertexType.e_concave);goog.exportProperty(box2d.b2EPColliderVertexType,'e_convex',box2d.b2EPColliderVertexType.e_convex);box2d.b2EPCollider=function(){this.m_polygonB=new box2d.b2TempPolygon();this.m_xf=new box2d.b2Transform();this.m_centroidB=new box2d.b2Vec2();this.m_v0=new box2d.b2Vec2(),this.m_v1=new box2d.b2Vec2(),this.m_v2=new box2d.b2Vec2(),this.m_v3=new box2d.b2Vec2();this.m_normal0=new box2d.b2Vec2(),this.m_normal1=new box2d.b2Vec2(),this.m_normal2=new box2d.b2Vec2();this.m_normal=new box2d.b2Vec2();this.m_type1=box2d.b2EPColliderVertexType.e_isolated,this.m_type2=box2d.b2EPColliderVertexType.e_isolated;this.m_lowerLimit=new box2d.b2Vec2(),this.m_upperLimit=new box2d.b2Vec2();this.m_radius=0;this.m_front=!1};box2d.b2EPCollider.prototype.m_polygonB=null;box2d.b2EPCollider.prototype.m_xf=null;box2d.b2EPCollider.prototype.m_centroidB=null;box2d.b2EPCollider.prototype.m_v0=null;box2d.b2EPCollider.prototype.m_v1=null;box2d.b2EPCollider.prototype.m_v2=null;box2d.b2EPCollider.prototype.m_v3=null;box2d.b2EPCollider.prototype.m_normal0=null;box2d.b2EPCollider.prototype.m_normal1=null;box2d.b2EPCollider.prototype.m_normal2=null;box2d.b2EPCollider.prototype.m_normal=null;box2d.b2EPCollider.prototype.m_type1=box2d.b2EPColliderVertexType.e_isolated;box2d.b2EPCollider.prototype.m_type2=box2d.b2EPColliderVertexType.e_isolated;box2d.b2EPCollider.prototype.m_lowerLimit=null;box2d.b2EPCollider.prototype.m_upperLimit=null;box2d.b2EPCollider.prototype.m_radius=0;box2d.b2EPCollider.prototype.m_front=!1;box2d.b2EPCollider.prototype.Collide=function(manifold,edgeA,xfA,polygonB,xfB){box2d.b2MulTXX(xfA,xfB,this.m_xf);box2d.b2MulXV(this.m_xf,polygonB.m_centroid,this.m_centroidB);this.m_v0.Copy(edgeA.m_vertex0);this.m_v1.Copy(edgeA.m_vertex1);this.m_v2.Copy(edgeA.m_vertex2);this.m_v3.Copy(edgeA.m_vertex3);var hasVertex0=edgeA.m_hasVertex0;var hasVertex3=edgeA.m_hasVertex3;var edge1=box2d.b2SubVV(this.m_v2,this.m_v1,box2d.b2EPCollider.s_edge1);edge1.Normalize();this.m_normal1.SetXY(edge1.y,-edge1.x);var offset1=box2d.b2DotVV(this.m_normal1,box2d.b2SubVV(this.m_centroidB,this.m_v1,box2d.b2Vec2.s_t0));var offset0=0;var offset2=0;var convex1=!1;var convex2=!1;if(hasVertex0){var edge0=box2d.b2SubVV(this.m_v1,this.m_v0,box2d.b2EPCollider.s_edge0);edge0.Normalize();this.m_normal0.SetXY(edge0.y,-edge0.x);convex1=box2d.b2CrossVV(edge0,edge1)>=0;offset0=box2d.b2DotVV(this.m_normal0,box2d.b2SubVV(this.m_centroidB,this.m_v0,box2d.b2Vec2.s_t0))}
if(hasVertex3){var edge2=box2d.b2SubVV(this.m_v3,this.m_v2,box2d.b2EPCollider.s_edge2);edge2.Normalize();this.m_normal2.SetXY(edge2.y,-edge2.x);convex2=box2d.b2CrossVV(edge1,edge2)>0;offset2=box2d.b2DotVV(this.m_normal2,box2d.b2SubVV(this.m_centroidB,this.m_v2,box2d.b2Vec2.s_t0))}
if(hasVertex0&&hasVertex3){if(convex1&&convex2){this.m_front=offset0>=0||offset1>=0||offset2>=0;if(this.m_front){this.m_normal.Copy(this.m_normal1);this.m_lowerLimit.Copy(this.m_normal0);this.m_upperLimit.Copy(this.m_normal2)}
else{this.m_normal.Copy(this.m_normal1).SelfNeg();this.m_lowerLimit.Copy(this.m_normal1).SelfNeg();this.m_upperLimit.Copy(this.m_normal1).SelfNeg()}}
else if(convex1){this.m_front=offset0>=0||(offset1>=0&&offset2>=0);if(this.m_front){this.m_normal.Copy(this.m_normal1);this.m_lowerLimit.Copy(this.m_normal0);this.m_upperLimit.Copy(this.m_normal1)}
else{this.m_normal.Copy(this.m_normal1).SelfNeg();this.m_lowerLimit.Copy(this.m_normal2).SelfNeg();this.m_upperLimit.Copy(this.m_normal1).SelfNeg()}}
else if(convex2){this.m_front=offset2>=0||(offset0>=0&&offset1>=0);if(this.m_front){this.m_normal.Copy(this.m_normal1);this.m_lowerLimit.Copy(this.m_normal1);this.m_upperLimit.Copy(this.m_normal2)}
else{this.m_normal.Copy(this.m_normal1).SelfNeg();this.m_lowerLimit.Copy(this.m_normal1).SelfNeg();this.m_upperLimit.Copy(this.m_normal0).SelfNeg()}}
else{this.m_front=offset0>=0&&offset1>=0&&offset2>=0;if(this.m_front){this.m_normal.Copy(this.m_normal1);this.m_lowerLimit.Copy(this.m_normal1);this.m_upperLimit.Copy(this.m_normal1)}
else{this.m_normal.Copy(this.m_normal1).SelfNeg();this.m_lowerLimit.Copy(this.m_normal2).SelfNeg();this.m_upperLimit.Copy(this.m_normal0).SelfNeg()}}}
else if(hasVertex0){if(convex1){this.m_front=offset0>=0||offset1>=0;if(this.m_front){this.m_normal.Copy(this.m_normal1);this.m_lowerLimit.Copy(this.m_normal0);this.m_upperLimit.Copy(this.m_normal1).SelfNeg()}
else{this.m_normal.Copy(this.m_normal1).SelfNeg();this.m_lowerLimit.Copy(this.m_normal1);this.m_upperLimit.Copy(this.m_normal1).SelfNeg()}}
else{this.m_front=offset0>=0&&offset1>=0;if(this.m_front){this.m_normal.Copy(this.m_normal1);this.m_lowerLimit.Copy(this.m_normal1);this.m_upperLimit.Copy(this.m_normal1).SelfNeg()}
else{this.m_normal.Copy(this.m_normal1).SelfNeg();this.m_lowerLimit.Copy(this.m_normal1);this.m_upperLimit.Copy(this.m_normal0).SelfNeg()}}}
else if(hasVertex3){if(convex2){this.m_front=offset1>=0||offset2>=0;if(this.m_front){this.m_normal.Copy(this.m_normal1);this.m_lowerLimit.Copy(this.m_normal1).SelfNeg();this.m_upperLimit.Copy(this.m_normal2)}
else{this.m_normal.Copy(this.m_normal1).SelfNeg();this.m_lowerLimit.Copy(this.m_normal1).SelfNeg();this.m_upperLimit.Copy(this.m_normal1)}}
else{this.m_front=offset1>=0&&offset2>=0;if(this.m_front){this.m_normal.Copy(this.m_normal1);this.m_lowerLimit.Copy(this.m_normal1).SelfNeg();this.m_upperLimit.Copy(this.m_normal1)}
else{this.m_normal.Copy(this.m_normal1).SelfNeg();this.m_lowerLimit.Copy(this.m_normal2).SelfNeg();this.m_upperLimit.Copy(this.m_normal1)}}}
else{this.m_front=offset1>=0;if(this.m_front){this.m_normal.Copy(this.m_normal1);this.m_lowerLimit.Copy(this.m_normal1).SelfNeg();this.m_upperLimit.Copy(this.m_normal1).SelfNeg()}
else{this.m_normal.Copy(this.m_normal1).SelfNeg();this.m_lowerLimit.Copy(this.m_normal1);this.m_upperLimit.Copy(this.m_normal1)}}
this.m_polygonB.count=polygonB.m_count;for(var i=0,ict=polygonB.m_count;i<ict;++i){box2d.b2MulXV(this.m_xf,polygonB.m_vertices[i],this.m_polygonB.vertices[i]);box2d.b2MulRV(this.m_xf.q,polygonB.m_normals[i],this.m_polygonB.normals[i])}
this.m_radius=2*box2d.b2_polygonRadius;manifold.pointCount=0;var edgeAxis=this.ComputeEdgeSeparation(box2d.b2EPCollider.s_edgeAxis);if(edgeAxis.type===box2d.b2EPAxisType.e_unknown){return}
if(edgeAxis.separation>this.m_radius){return}
var polygonAxis=this.ComputePolygonSeparation(box2d.b2EPCollider.s_polygonAxis);if(polygonAxis.type!==box2d.b2EPAxisType.e_unknown&&polygonAxis.separation>this.m_radius){return}
var k_relativeTol=0.98;var k_absoluteTol=0.001;var primaryAxis;if(polygonAxis.type===box2d.b2EPAxisType.e_unknown){primaryAxis=edgeAxis}
else if(polygonAxis.separation>k_relativeTol*edgeAxis.separation+k_absoluteTol){primaryAxis=polygonAxis}
else{primaryAxis=edgeAxis}
var ie=box2d.b2EPCollider.s_ie;var rf=box2d.b2EPCollider.s_rf;if(primaryAxis.type===box2d.b2EPAxisType.e_edgeA){manifold.type=box2d.b2ManifoldType.e_faceA;var bestIndex=0;var bestValue=box2d.b2DotVV(this.m_normal,this.m_polygonB.normals[0]);for(var i=1,ict=this.m_polygonB.count;i<ict;++i){var value=box2d.b2DotVV(this.m_normal,this.m_polygonB.normals[i]);if(value<bestValue){bestValue=value;bestIndex=i}}
var i1=bestIndex;var i2=(i1+1)%this.m_polygonB.count;var ie0=ie[0];ie0.v.Copy(this.m_polygonB.vertices[i1]);ie0.id.cf.indexA=0;ie0.id.cf.indexB=i1;ie0.id.cf.typeA=box2d.b2ContactFeatureType.e_face;ie0.id.cf.typeB=box2d.b2ContactFeatureType.e_vertex;var ie1=ie[1];ie1.v.Copy(this.m_polygonB.vertices[i2]);ie1.id.cf.indexA=0;ie1.id.cf.indexB=i2;ie1.id.cf.typeA=box2d.b2ContactFeatureType.e_face;ie1.id.cf.typeB=box2d.b2ContactFeatureType.e_vertex;if(this.m_front){rf.i1=0;rf.i2=1;rf.v1.Copy(this.m_v1);rf.v2.Copy(this.m_v2);rf.normal.Copy(this.m_normal1)}
else{rf.i1=1;rf.i2=0;rf.v1.Copy(this.m_v2);rf.v2.Copy(this.m_v1);rf.normal.Copy(this.m_normal1).SelfNeg()}}
else{manifold.type=box2d.b2ManifoldType.e_faceB;var ie0=ie[0];ie0.v.Copy(this.m_v1);ie0.id.cf.indexA=0;ie0.id.cf.indexB=primaryAxis.index;ie0.id.cf.typeA=box2d.b2ContactFeatureType.e_vertex;ie0.id.cf.typeB=box2d.b2ContactFeatureType.e_face;var ie1=ie[1];ie1.v.Copy(this.m_v2);ie1.id.cf.indexA=0;ie1.id.cf.indexB=primaryAxis.index;ie1.id.cf.typeA=box2d.b2ContactFeatureType.e_vertex;ie1.id.cf.typeB=box2d.b2ContactFeatureType.e_face;rf.i1=primaryAxis.index;rf.i2=(rf.i1+1)%this.m_polygonB.count;rf.v1.Copy(this.m_polygonB.vertices[rf.i1]);rf.v2.Copy(this.m_polygonB.vertices[rf.i2]);rf.normal.Copy(this.m_polygonB.normals[rf.i1])}
rf.sideNormal1.SetXY(rf.normal.y,-rf.normal.x);rf.sideNormal2.Copy(rf.sideNormal1).SelfNeg();rf.sideOffset1=box2d.b2DotVV(rf.sideNormal1,rf.v1);rf.sideOffset2=box2d.b2DotVV(rf.sideNormal2,rf.v2);var clipPoints1=box2d.b2EPCollider.s_clipPoints1;var clipPoints2=box2d.b2EPCollider.s_clipPoints2;var np=0;np=box2d.b2ClipSegmentToLine(clipPoints1,ie,rf.sideNormal1,rf.sideOffset1,rf.i1);if(np<box2d.b2_maxManifoldPoints){return}
np=box2d.b2ClipSegmentToLine(clipPoints2,clipPoints1,rf.sideNormal2,rf.sideOffset2,rf.i2);if(np<box2d.b2_maxManifoldPoints){return}
if(primaryAxis.type===box2d.b2EPAxisType.e_edgeA){manifold.localNormal.Copy(rf.normal);manifold.localPoint.Copy(rf.v1)}
else{manifold.localNormal.Copy(polygonB.m_normals[rf.i1]);manifold.localPoint.Copy(polygonB.m_vertices[rf.i1])}
var pointCount=0;for(var i=0,ict=box2d.b2_maxManifoldPoints;i<ict;++i){var separation;separation=box2d.b2DotVV(rf.normal,box2d.b2SubVV(clipPoints2[i].v,rf.v1,box2d.b2Vec2.s_t0));if(separation<=this.m_radius){var cp=manifold.points[pointCount];if(primaryAxis.type===box2d.b2EPAxisType.e_edgeA){box2d.b2MulTXV(this.m_xf,clipPoints2[i].v,cp.localPoint);cp.id=clipPoints2[i].id}
else{cp.localPoint.Copy(clipPoints2[i].v);cp.id.cf.typeA=clipPoints2[i].id.cf.typeB;cp.id.cf.typeB=clipPoints2[i].id.cf.typeA;cp.id.cf.indexA=clipPoints2[i].id.cf.indexB;cp.id.cf.indexB=clipPoints2[i].id.cf.indexA}
++pointCount}}
manifold.pointCount=pointCount}
box2d.b2EPCollider.s_edge1=new box2d.b2Vec2();box2d.b2EPCollider.s_edge0=new box2d.b2Vec2();box2d.b2EPCollider.s_edge2=new box2d.b2Vec2();box2d.b2EPCollider.s_ie=box2d.b2ClipVertex.MakeArray(2);box2d.b2EPCollider.s_rf=new box2d.b2ReferenceFace();box2d.b2EPCollider.s_clipPoints1=box2d.b2ClipVertex.MakeArray(2);box2d.b2EPCollider.s_clipPoints2=box2d.b2ClipVertex.MakeArray(2);box2d.b2EPCollider.s_edgeAxis=new box2d.b2EPAxis();box2d.b2EPCollider.s_polygonAxis=new box2d.b2EPAxis();box2d.b2EPCollider.prototype.ComputeEdgeSeparation=function(out){var axis=out;axis.type=box2d.b2EPAxisType.e_edgeA;axis.index=this.m_front?0:1;axis.separation=box2d.b2_maxFloat;for(var i=0,ict=this.m_polygonB.count;i<ict;++i){var s=box2d.b2DotVV(this.m_normal,box2d.b2SubVV(this.m_polygonB.vertices[i],this.m_v1,box2d.b2Vec2.s_t0));if(s<axis.separation){axis.separation=s}}
return axis}
box2d.b2EPCollider.prototype.ComputePolygonSeparation=function(out){var axis=out;axis.type=box2d.b2EPAxisType.e_unknown;axis.index=-1;axis.separation=-box2d.b2_maxFloat;var perp=box2d.b2EPCollider.s_perp.SetXY(-this.m_normal.y,this.m_normal.x);for(var i=0,ict=this.m_polygonB.count;i<ict;++i){var n=box2d.b2NegV(this.m_polygonB.normals[i],box2d.b2EPCollider.s_n);var s1=box2d.b2DotVV(n,box2d.b2SubVV(this.m_polygonB.vertices[i],this.m_v1,box2d.b2Vec2.s_t0));var s2=box2d.b2DotVV(n,box2d.b2SubVV(this.m_polygonB.vertices[i],this.m_v2,box2d.b2Vec2.s_t0));var s=box2d.b2Min(s1,s2);if(s>this.m_radius){axis.type=box2d.b2EPAxisType.e_edgeB;axis.index=i;axis.separation=s;return axis}
if(box2d.b2DotVV(n,perp)>=0){if(box2d.b2DotVV(box2d.b2SubVV(n,this.m_upperLimit,box2d.b2Vec2.s_t0),this.m_normal)<-box2d.b2_angularSlop){continue}}
else{if(box2d.b2DotVV(box2d.b2SubVV(n,this.m_lowerLimit,box2d.b2Vec2.s_t0),this.m_normal)<-box2d.b2_angularSlop){continue}}
if(s>axis.separation){axis.type=box2d.b2EPAxisType.e_edgeB;axis.index=i;axis.separation=s}}
return axis}
box2d.b2EPCollider.s_n=new box2d.b2Vec2();box2d.b2EPCollider.s_perp=new box2d.b2Vec2();box2d.b2CollideEdgeAndPolygon=function(manifold,edgeA,xfA,polygonB,xfB){var collider=box2d.b2CollideEdgeAndPolygon.s_collider;collider.Collide(manifold,edgeA,xfA,polygonB,xfB)}
box2d.b2CollideEdgeAndPolygon.s_collider=new box2d.b2EPCollider();goog.provide('box2d.b2EdgeShape');goog.require('box2d.b2Shape');box2d.b2EdgeShape=function(){goog.base(this,box2d.b2ShapeType.e_edgeShape,box2d.b2_polygonRadius);this.m_vertex1=new box2d.b2Vec2();this.m_vertex2=new box2d.b2Vec2();this.m_vertex0=new box2d.b2Vec2();this.m_vertex3=new box2d.b2Vec2()}
goog.inherits(box2d.b2EdgeShape,box2d.b2Shape);box2d.b2EdgeShape.prototype.m_vertex1=null;box2d.b2EdgeShape.prototype.m_vertex2=null;box2d.b2EdgeShape.prototype.m_vertex0=null;box2d.b2EdgeShape.prototype.m_vertex3=null;box2d.b2EdgeShape.prototype.m_hasVertex0=!1;box2d.b2EdgeShape.prototype.m_hasVertex3=!1;box2d.b2EdgeShape.prototype.Set=function(v1,v2){this.m_vertex1.Copy(v1);this.m_vertex2.Copy(v2);this.m_hasVertex0=!1;this.m_hasVertex3=!1;return this}
box2d.b2EdgeShape.prototype.SetAsEdge=box2d.b2EdgeShape.prototype.Set;box2d.b2EdgeShape.prototype.Clone=function(){return new box2d.b2EdgeShape().Copy(this)}
box2d.b2EdgeShape.prototype.Copy=function(other){goog.base(this,'Copy',other);if(box2d.ENABLE_ASSERTS){box2d.b2Assert(other instanceof box2d.b2EdgeShape)}
this.m_vertex1.Copy(other.m_vertex1);this.m_vertex2.Copy(other.m_vertex2);this.m_vertex0.Copy(other.m_vertex0);this.m_vertex3.Copy(other.m_vertex3);this.m_hasVertex0=other.m_hasVertex0;this.m_hasVertex3=other.m_hasVertex3;return this}
box2d.b2EdgeShape.prototype.GetChildCount=function(){return 1}
box2d.b2EdgeShape.prototype.TestPoint=function(xf,p){return !1}
box2d.b2EdgeShape.prototype.RayCast=function(output,input,xf,childIndex){var p1=box2d.b2MulTXV(xf,input.p1,box2d.b2EdgeShape.prototype.RayCast.s_p1);var p2=box2d.b2MulTXV(xf,input.p2,box2d.b2EdgeShape.prototype.RayCast.s_p2);var d=box2d.b2SubVV(p2,p1,box2d.b2EdgeShape.prototype.RayCast.s_d);var v1=this.m_vertex1;var v2=this.m_vertex2;var e=box2d.b2SubVV(v2,v1,box2d.b2EdgeShape.prototype.RayCast.s_e);var normal=output.normal.SetXY(e.y,-e.x).SelfNormalize();var numerator=box2d.b2DotVV(normal,box2d.b2SubVV(v1,p1,box2d.b2Vec2.s_t0));var denominator=box2d.b2DotVV(normal,d);if(denominator===0){return !1}
var t=numerator/denominator;if(t<0||input.maxFraction<t){return !1}
var q=box2d.b2AddVMulSV(p1,t,d,box2d.b2EdgeShape.prototype.RayCast.s_q);var r=box2d.b2SubVV(v2,v1,box2d.b2EdgeShape.prototype.RayCast.s_r);var rr=box2d.b2DotVV(r,r);if(rr===0){return !1}
var s=box2d.b2DotVV(box2d.b2SubVV(q,v1,box2d.b2Vec2.s_t0),r)/rr;if(s<0||1<s){return !1}
output.fraction=t;box2d.b2MulRV(xf.q,output.normal,output.normal);if(numerator>0){output.normal.SelfNeg()}
return !0}
box2d.b2EdgeShape.prototype.RayCast.s_p1=new box2d.b2Vec2();box2d.b2EdgeShape.prototype.RayCast.s_p2=new box2d.b2Vec2();box2d.b2EdgeShape.prototype.RayCast.s_d=new box2d.b2Vec2();box2d.b2EdgeShape.prototype.RayCast.s_e=new box2d.b2Vec2();box2d.b2EdgeShape.prototype.RayCast.s_q=new box2d.b2Vec2();box2d.b2EdgeShape.prototype.RayCast.s_r=new box2d.b2Vec2();box2d.b2EdgeShape.prototype.ComputeAABB=function(aabb,xf,childIndex){var v1=box2d.b2MulXV(xf,this.m_vertex1,box2d.b2EdgeShape.prototype.ComputeAABB.s_v1);var v2=box2d.b2MulXV(xf,this.m_vertex2,box2d.b2EdgeShape.prototype.ComputeAABB.s_v2);box2d.b2MinV(v1,v2,aabb.lowerBound);box2d.b2MaxV(v1,v2,aabb.upperBound);var r=this.m_radius;aabb.lowerBound.SelfSubXY(r,r);aabb.upperBound.SelfAddXY(r,r)}
box2d.b2EdgeShape.prototype.ComputeAABB.s_v1=new box2d.b2Vec2();box2d.b2EdgeShape.prototype.ComputeAABB.s_v2=new box2d.b2Vec2();box2d.b2EdgeShape.prototype.ComputeMass=function(massData,density){massData.mass=0;box2d.b2MidVV(this.m_vertex1,this.m_vertex2,massData.center);massData.I=0}
box2d.b2EdgeShape.prototype.SetupDistanceProxy=function(proxy,index){proxy.m_vertices=new Array(2);proxy.m_vertices[0]=this.m_vertex1;proxy.m_vertices[1]=this.m_vertex2;proxy.m_count=2;proxy.m_radius=this.m_radius}
box2d.b2EdgeShape.prototype.ComputeSubmergedArea=function(normal,offset,xf,c){c.SetZero();return 0}
box2d.b2EdgeShape.prototype.Dump=function(){box2d.b2Log("    /*box2d.b2EdgeShape*/ var shape = new box2d.b2EdgeShape();\n");box2d.b2Log("    shape.m_radius = %.15f;\n",this.m_radius);box2d.b2Log("    shape.m_vertex0.SetXY(%.15f, %.15f);\n",this.m_vertex0.x,this.m_vertex0.y);box2d.b2Log("    shape.m_vertex1.SetXY(%.15f, %.15f);\n",this.m_vertex1.x,this.m_vertex1.y);box2d.b2Log("    shape.m_vertex2.SetXY(%.15f, %.15f);\n",this.m_vertex2.x,this.m_vertex2.y);box2d.b2Log("    shape.m_vertex3.SetXY(%.15f, %.15f);\n",this.m_vertex3.x,this.m_vertex3.y);box2d.b2Log("    shape.m_hasVertex0 = %s;\n",this.m_hasVertex0);box2d.b2Log("    shape.m_hasVertex3 = %s;\n",this.m_hasVertex3)}
goog.provide('box2d.b2ChainShape');goog.require('box2d.b2Shape');goog.require('box2d.b2EdgeShape');box2d.b2ChainShape=function(){goog.base(this,box2d.b2ShapeType.e_chainShape,box2d.b2_polygonRadius);this.m_prevVertex=new box2d.b2Vec2();this.m_nextVertex=new box2d.b2Vec2()}
goog.inherits(box2d.b2ChainShape,box2d.b2Shape);box2d.b2ChainShape.prototype.m_vertices=null;box2d.b2ChainShape.prototype.m_count=0;box2d.b2ChainShape.prototype.m_prevVertex=null;box2d.b2ChainShape.prototype.m_nextVertex=null;box2d.b2ChainShape.prototype.m_hasPrevVertex=!1;box2d.b2ChainShape.prototype.m_hasNextVertex=!1;box2d.b2ChainShape.prototype.CreateLoop=function(vertices,count){count=count||vertices.length;if(box2d.ENABLE_ASSERTS){box2d.b2Assert(this.m_vertices===null&&this.m_count===0)}
if(box2d.ENABLE_ASSERTS){box2d.b2Assert(count>=3)}
if(box2d.ENABLE_ASSERTS){for(var i=1;i<count;++i){var v1=vertices[i-1];var v2=vertices[i];box2d.b2Assert(box2d.b2DistanceSquaredVV(v1,v2)>box2d.b2_linearSlop*box2d.b2_linearSlop)}}
this.m_count=count+1;this.m_vertices=box2d.b2Vec2.MakeArray(this.m_count);for(var i=0;i<count;++i){this.m_vertices[i].Copy(vertices[i])}
this.m_vertices[count].Copy(this.m_vertices[0]);this.m_prevVertex.Copy(this.m_vertices[this.m_count-2]);this.m_nextVertex.Copy(this.m_vertices[1]);this.m_hasPrevVertex=!0;this.m_hasNextVertex=!0;return this}
box2d.b2ChainShape.prototype.CreateChain=function(vertices,count){count=count||vertices.length;if(box2d.ENABLE_ASSERTS){box2d.b2Assert(this.m_vertices===null&&this.m_count===0)}
if(box2d.ENABLE_ASSERTS){box2d.b2Assert(count>=2)}
if(box2d.ENABLE_ASSERTS){for(var i=1;i<count;++i){var v1=vertices[i-1];var v2=vertices[i];box2d.b2Assert(box2d.b2DistanceSquaredVV(v1,v2)>box2d.b2_linearSlop*box2d.b2_linearSlop)}}
this.m_count=count;this.m_vertices=box2d.b2Vec2.MakeArray(count);for(var i=0;i<count;++i){this.m_vertices[i].Copy(vertices[i])}
this.m_hasPrevVertex=!1;this.m_hasNextVertex=!1;this.m_prevVertex.SetZero();this.m_nextVertex.SetZero();return this}
box2d.b2ChainShape.prototype.SetPrevVertex=function(prevVertex){this.m_prevVertex.Copy(prevVertex);this.m_hasPrevVertex=!0;return this}
box2d.b2ChainShape.prototype.SetNextVertex=function(nextVertex){this.m_nextVertex.Copy(nextVertex);this.m_hasNextVertex=!0;return this}
box2d.b2ChainShape.prototype.Clone=function(){return new box2d.b2ChainShape().Copy(this)}
box2d.b2ChainShape.prototype.Copy=function(other){goog.base(this,'Copy',other);if(box2d.ENABLE_ASSERTS){box2d.b2Assert(other instanceof box2d.b2ChainShape)}
this.CreateChain(other.m_vertices,other.m_count);this.m_prevVertex.Copy(other.m_prevVertex);this.m_nextVertex.Copy(other.m_nextVertex);this.m_hasPrevVertex=other.m_hasPrevVertex;this.m_hasNextVertex=other.m_hasNextVertex;return this}
box2d.b2ChainShape.prototype.GetChildCount=function(){return this.m_count-1}
box2d.b2ChainShape.prototype.GetChildEdge=function(edge,index){if(box2d.ENABLE_ASSERTS){box2d.b2Assert(0<=index&&index<this.m_count-1)}
edge.m_type=box2d.b2ShapeType.e_edgeShape;edge.m_radius=this.m_radius;edge.m_vertex1.Copy(this.m_vertices[index]);edge.m_vertex2.Copy(this.m_vertices[index+1]);if(index>0){edge.m_vertex0.Copy(this.m_vertices[index-1]);edge.m_hasVertex0=!0}
else{edge.m_vertex0.Copy(this.m_prevVertex);edge.m_hasVertex0=this.m_hasPrevVertex}
if(index<this.m_count-2){edge.m_vertex3.Copy(this.m_vertices[index+2]);edge.m_hasVertex3=!0}
else{edge.m_vertex3.Copy(this.m_nextVertex);edge.m_hasVertex3=this.m_hasNextVertex}}
box2d.b2ChainShape.prototype.TestPoint=function(xf,p){return !1}
box2d.b2ChainShape.prototype.RayCast=function(output,input,xf,childIndex){if(box2d.ENABLE_ASSERTS){box2d.b2Assert(childIndex<this.m_count)}
var edgeShape=box2d.b2ChainShape.s_edgeShape;edgeShape.m_vertex1.Copy(this.m_vertices[childIndex]);edgeShape.m_vertex2.Copy(this.m_vertices[(childIndex+1)%this.m_count]);return edgeShape.RayCast(output,input,xf,0)}
box2d.b2ChainShape.s_edgeShape=new box2d.b2EdgeShape();box2d.b2ChainShape.prototype.ComputeAABB=function(aabb,xf,childIndex){if(box2d.ENABLE_ASSERTS){box2d.b2Assert(childIndex<this.m_count)}
var vertexi1=this.m_vertices[childIndex];var vertexi2=this.m_vertices[(childIndex+1)%this.m_count];var v1=box2d.b2MulXV(xf,vertexi1,box2d.b2ChainShape.prototype.ComputeAABB.s_v1);var v2=box2d.b2MulXV(xf,vertexi2,box2d.b2ChainShape.prototype.ComputeAABB.s_v2);box2d.b2MinV(v1,v2,aabb.lowerBound);box2d.b2MaxV(v1,v2,aabb.upperBound)}
box2d.b2ChainShape.prototype.ComputeAABB.s_v1=new box2d.b2Vec2();box2d.b2ChainShape.prototype.ComputeAABB.s_v2=new box2d.b2Vec2();box2d.b2ChainShape.prototype.ComputeMass=function(massData,density){massData.mass=0;massData.center.SetZero();massData.I=0}
box2d.b2ChainShape.prototype.SetupDistanceProxy=function(proxy,index){if(box2d.ENABLE_ASSERTS){box2d.b2Assert(0<=index&&index<this.m_count)}
proxy.m_buffer[0].Copy(this.m_vertices[index]);if(index+1<this.m_count){proxy.m_buffer[1].Copy(this.m_vertices[index+1])}
else{proxy.m_buffer[1].Copy(this.m_vertices[0])}
proxy.m_vertices=proxy.m_buffer;proxy.m_count=2;proxy.m_radius=this.m_radius}
box2d.b2ChainShape.prototype.ComputeSubmergedArea=function(normal,offset,xf,c){c.SetZero();return 0}
box2d.b2ChainShape.prototype.Dump=function(){box2d.b2Log("    /*box2d.b2ChainShape*/ var shape = new box2d.b2ChainShape();\n");box2d.b2Log("    /*box2d.b2Vec2[]*/ var vs = box2d.b2Vec2.MakeArray(%d);\n",box2d.b2_maxPolygonVertices);for(var i=0;i<this.m_count;++i){box2d.b2Log("    vs[%d].SetXY(%.15f, %.15f);\n",i,this.m_vertices[i].x,this.m_vertices[i].y)}
box2d.b2Log("    shape.CreateChain(vs, %d);\n",this.m_count);box2d.b2Log("    shape.m_prevVertex.SetXY(%.15f, %.15f);\n",this.m_prevVertex.x,this.m_prevVertex.y);box2d.b2Log("    shape.m_nextVertex.SetXY(%.15f, %.15f);\n",this.m_nextVertex.x,this.m_nextVertex.y);box2d.b2Log("    shape.m_hasPrevVertex = %s;\n",(this.m_hasPrevVertex)?('true'):('false'));box2d.b2Log("    shape.m_hasNextVertex = %s;\n",(this.m_hasNextVertex)?('true'):('false'))}
goog.provide('box2d.b2ChainAndPolygonContact');goog.require('box2d.b2Settings');goog.require('box2d.b2Contact');goog.require('box2d.b2CollideEdge');goog.require('box2d.b2ChainShape');goog.require('box2d.b2PolygonShape');box2d.b2ChainAndPolygonContact=function(){goog.base(this)};goog.inherits(box2d.b2ChainAndPolygonContact,box2d.b2Contact);box2d.b2ChainAndPolygonContact.Create=function(allocator){return new box2d.b2ChainAndPolygonContact()}
box2d.b2ChainAndPolygonContact.Destroy=function(contact,allocator){}
box2d.b2ChainAndPolygonContact.prototype.Reset=function(fixtureA,indexA,fixtureB,indexB){goog.base(this,'Reset',fixtureA,indexA,fixtureB,indexB);if(box2d.ENABLE_ASSERTS){box2d.b2Assert(fixtureA.GetType()===box2d.b2ShapeType.e_chainShape)}
if(box2d.ENABLE_ASSERTS){box2d.b2Assert(fixtureB.GetType()===box2d.b2ShapeType.e_polygonShape)}}
box2d.b2ChainAndPolygonContact.prototype.Evaluate=function(manifold,xfA,xfB){var shapeA=this.m_fixtureA.GetShape();var shapeB=this.m_fixtureB.GetShape();if(box2d.ENABLE_ASSERTS){box2d.b2Assert(shapeA instanceof box2d.b2ChainShape)}
if(box2d.ENABLE_ASSERTS){box2d.b2Assert(shapeB instanceof box2d.b2PolygonShape)}
var chain=(shapeA instanceof box2d.b2ChainShape)?shapeA:null;var edge=box2d.b2ChainAndPolygonContact.prototype.Evaluate.s_edge;chain.GetChildEdge(edge,this.m_indexA);box2d.b2CollideEdgeAndPolygon(manifold,edge,xfA,(shapeB instanceof box2d.b2PolygonShape)?shapeB:null,xfB)}
box2d.b2ChainAndPolygonContact.prototype.Evaluate.s_edge=new box2d.b2EdgeShape();goog.provide('box2d.b2CollidePolygon');goog.require('box2d.b2Collision');box2d.b2FindMaxSeparation=function(edgeIndex,poly1,xf1,poly2,xf2){var count1=poly1.m_count;var count2=poly2.m_count;var n1s=poly1.m_normals;var v1s=poly1.m_vertices;var v2s=poly2.m_vertices;var xf=box2d.b2MulTXX(xf2,xf1,box2d.b2FindMaxSeparation.s_xf);var bestIndex=0;var maxSeparation=-box2d.b2_maxFloat;for(var i=0;i<count1;++i){var n=box2d.b2MulRV(xf.q,n1s[i],box2d.b2FindMaxSeparation.s_n);var v1=box2d.b2MulXV(xf,v1s[i],box2d.b2FindMaxSeparation.s_v1);var si=box2d.b2_maxFloat;for(var j=0;j<count2;++j){var sij=box2d.b2DotVV(n,box2d.b2SubVV(v2s[j],v1,box2d.b2Vec2.s_t0));if(sij<si){si=sij}}
if(si>maxSeparation){maxSeparation=si;bestIndex=i}}
edgeIndex[0]=bestIndex;return maxSeparation}
box2d.b2FindMaxSeparation.s_xf=new box2d.b2Transform();box2d.b2FindMaxSeparation.s_n=new box2d.b2Vec2();box2d.b2FindMaxSeparation.s_v1=new box2d.b2Vec2();box2d.b2FindIncidentEdge=function(c,poly1,xf1,edge1,poly2,xf2){var count1=poly1.m_count;var normals1=poly1.m_normals;var count2=poly2.m_count;var vertices2=poly2.m_vertices;var normals2=poly2.m_normals;if(box2d.ENABLE_ASSERTS){box2d.b2Assert(0<=edge1&&edge1<count1)}
var normal1=box2d.b2MulTRV(xf2.q,box2d.b2MulRV(xf1.q,normals1[edge1],box2d.b2Vec2.s_t0),box2d.b2FindIncidentEdge.s_normal1);var index=0;var minDot=box2d.b2_maxFloat;for(var i=0;i<count2;++i){var dot=box2d.b2DotVV(normal1,normals2[i]);if(dot<minDot){minDot=dot;index=i}}
var i1=index;var i2=(i1+1)%count2;var c0=c[0];box2d.b2MulXV(xf2,vertices2[i1],c0.v);var cf0=c0.id.cf;cf0.indexA=edge1;cf0.indexB=i1;cf0.typeA=box2d.b2ContactFeatureType.e_face;cf0.typeB=box2d.b2ContactFeatureType.e_vertex;var c1=c[1];box2d.b2MulXV(xf2,vertices2[i2],c1.v);var cf1=c1.id.cf;cf1.indexA=edge1;cf1.indexB=i2;cf1.typeA=box2d.b2ContactFeatureType.e_face;cf1.typeB=box2d.b2ContactFeatureType.e_vertex}
box2d.b2FindIncidentEdge.s_normal1=new box2d.b2Vec2();box2d.b2CollidePolygons=function(manifold,polyA,xfA,polyB,xfB){manifold.pointCount=0;var totalRadius=polyA.m_radius+polyB.m_radius;var edgeA=box2d.b2CollidePolygons.s_edgeA;edgeA[0]=0;var separationA=box2d.b2FindMaxSeparation(edgeA,polyA,xfA,polyB,xfB);if(separationA>totalRadius)
return;var edgeB=box2d.b2CollidePolygons.s_edgeB;edgeB[0]=0;var separationB=box2d.b2FindMaxSeparation(edgeB,polyB,xfB,polyA,xfA);if(separationB>totalRadius)
return;var poly1;var poly2;var xf1,xf2;var edge1=0;var flip=0;var k_relativeTol=0.98;var k_absoluteTol=0.001;if(separationB>k_relativeTol*separationA+k_absoluteTol){poly1=polyB;poly2=polyA;xf1=xfB;xf2=xfA;edge1=edgeB[0];manifold.type=box2d.b2ManifoldType.e_faceB;flip=1}
else{poly1=polyA;poly2=polyB;xf1=xfA;xf2=xfB;edge1=edgeA[0];manifold.type=box2d.b2ManifoldType.e_faceA;flip=0}
var incidentEdge=box2d.b2CollidePolygons.s_incidentEdge;box2d.b2FindIncidentEdge(incidentEdge,poly1,xf1,edge1,poly2,xf2);var count1=poly1.m_count;var vertices1=poly1.m_vertices;var iv1=edge1;var iv2=(edge1+1)%count1;var local_v11=vertices1[iv1];var local_v12=vertices1[iv2];var localTangent=box2d.b2SubVV(local_v12,local_v11,box2d.b2CollidePolygons.s_localTangent);localTangent.Normalize();var localNormal=box2d.b2CrossVOne(localTangent,box2d.b2CollidePolygons.s_localNormal);var planePoint=box2d.b2MidVV(local_v11,local_v12,box2d.b2CollidePolygons.s_planePoint);var tangent=box2d.b2MulRV(xf1.q,localTangent,box2d.b2CollidePolygons.s_tangent);var normal=box2d.b2CrossVOne(tangent,box2d.b2CollidePolygons.s_normal);var v11=box2d.b2MulXV(xf1,local_v11,box2d.b2CollidePolygons.s_v11);var v12=box2d.b2MulXV(xf1,local_v12,box2d.b2CollidePolygons.s_v12);var frontOffset=box2d.b2DotVV(normal,v11);var sideOffset1=-box2d.b2DotVV(tangent,v11)+totalRadius;var sideOffset2=box2d.b2DotVV(tangent,v12)+totalRadius;var clipPoints1=box2d.b2CollidePolygons.s_clipPoints1;var clipPoints2=box2d.b2CollidePolygons.s_clipPoints2;var np;var ntangent=box2d.b2NegV(tangent,box2d.b2CollidePolygons.s_ntangent);np=box2d.b2ClipSegmentToLine(clipPoints1,incidentEdge,ntangent,sideOffset1,iv1);if(np<2)
return;np=box2d.b2ClipSegmentToLine(clipPoints2,clipPoints1,tangent,sideOffset2,iv2);if(np<2){return}
manifold.localNormal.Copy(localNormal);manifold.localPoint.Copy(planePoint);var pointCount=0;for(var i=0;i<box2d.b2_maxManifoldPoints;++i){var cv=clipPoints2[i];var separation=box2d.b2DotVV(normal,cv.v)-frontOffset;if(separation<=totalRadius){var cp=manifold.points[pointCount];box2d.b2MulTXV(xf2,cv.v,cp.localPoint);cp.id.Copy(cv.id);if(flip){var cf=cp.id.cf;cp.id.cf.indexA=cf.indexB;cp.id.cf.indexB=cf.indexA;cp.id.cf.typeA=cf.typeB;cp.id.cf.typeB=cf.typeA}
++pointCount}}
manifold.pointCount=pointCount}
box2d.b2CollidePolygons.s_incidentEdge=box2d.b2ClipVertex.MakeArray(2);box2d.b2CollidePolygons.s_clipPoints1=box2d.b2ClipVertex.MakeArray(2);box2d.b2CollidePolygons.s_clipPoints2=box2d.b2ClipVertex.MakeArray(2);box2d.b2CollidePolygons.s_edgeA=box2d.b2MakeNumberArray(1);box2d.b2CollidePolygons.s_edgeB=box2d.b2MakeNumberArray(1);box2d.b2CollidePolygons.s_localTangent=new box2d.b2Vec2();box2d.b2CollidePolygons.s_localNormal=new box2d.b2Vec2();box2d.b2CollidePolygons.s_planePoint=new box2d.b2Vec2();box2d.b2CollidePolygons.s_normal=new box2d.b2Vec2();box2d.b2CollidePolygons.s_tangent=new box2d.b2Vec2();box2d.b2CollidePolygons.s_ntangent=new box2d.b2Vec2();box2d.b2CollidePolygons.s_v11=new box2d.b2Vec2();box2d.b2CollidePolygons.s_v12=new box2d.b2Vec2();goog.provide('box2d.b2PolygonContact');goog.require('box2d.b2Settings');goog.require('box2d.b2Contact');goog.require('box2d.b2CollidePolygon');box2d.b2PolygonContact=function(){goog.base(this)};goog.inherits(box2d.b2PolygonContact,box2d.b2Contact);box2d.b2PolygonContact.Create=function(allocator){return new box2d.b2PolygonContact()}
box2d.b2PolygonContact.Destroy=function(contact,allocator){}
box2d.b2PolygonContact.prototype.Reset=function(fixtureA,indexA,fixtureB,indexB){goog.base(this,'Reset',fixtureA,indexA,fixtureB,indexB)}
box2d.b2PolygonContact.prototype.Evaluate=function(manifold,xfA,xfB){var shapeA=this.m_fixtureA.GetShape();var shapeB=this.m_fixtureB.GetShape();if(box2d.ENABLE_ASSERTS){box2d.b2Assert(shapeA instanceof box2d.b2PolygonShape)}
if(box2d.ENABLE_ASSERTS){box2d.b2Assert(shapeB instanceof box2d.b2PolygonShape)}
box2d.b2CollidePolygons(manifold,(shapeA instanceof box2d.b2PolygonShape)?shapeA:null,xfA,(shapeB instanceof box2d.b2PolygonShape)?shapeB:null,xfB)}
goog.provide('box2d.b2CollideCircle');goog.require('box2d.b2Collision');box2d.b2CollideCircles=function(manifold,circleA,xfA,circleB,xfB){manifold.pointCount=0;var pA=box2d.b2MulXV(xfA,circleA.m_p,box2d.b2CollideCircles.s_pA);var pB=box2d.b2MulXV(xfB,circleB.m_p,box2d.b2CollideCircles.s_pB);var distSqr=box2d.b2DistanceSquaredVV(pA,pB);var radius=circleA.m_radius+circleB.m_radius;if(distSqr>radius*radius){return}
manifold.type=box2d.b2ManifoldType.e_circles;manifold.localPoint.Copy(circleA.m_p);manifold.localNormal.SetZero();manifold.pointCount=1;manifold.points[0].localPoint.Copy(circleB.m_p);manifold.points[0].id.key=0}
box2d.b2CollideCircles.s_pA=new box2d.b2Vec2();box2d.b2CollideCircles.s_pB=new box2d.b2Vec2();box2d.b2CollidePolygonAndCircle=function(manifold,polygonA,xfA,circleB,xfB){manifold.pointCount=0;var c=box2d.b2MulXV(xfB,circleB.m_p,box2d.b2CollidePolygonAndCircle.s_c);var cLocal=box2d.b2MulTXV(xfA,c,box2d.b2CollidePolygonAndCircle.s_cLocal);var normalIndex=0;var separation=(-box2d.b2_maxFloat);var radius=polygonA.m_radius+circleB.m_radius;var vertexCount=polygonA.m_count;var vertices=polygonA.m_vertices;var normals=polygonA.m_normals;for(var i=0;i<vertexCount;++i){var s=box2d.b2DotVV(normals[i],box2d.b2SubVV(cLocal,vertices[i],box2d.b2Vec2.s_t0));if(s>radius){return}
if(s>separation){separation=s;normalIndex=i}}
var vertIndex1=normalIndex;var vertIndex2=(vertIndex1+1)%vertexCount;var v1=vertices[vertIndex1];var v2=vertices[vertIndex2];if(separation<box2d.b2_epsilon){manifold.pointCount=1;manifold.type=box2d.b2ManifoldType.e_faceA;manifold.localNormal.Copy(normals[normalIndex]);box2d.b2MidVV(v1,v2,manifold.localPoint);manifold.points[0].localPoint.Copy(circleB.m_p);manifold.points[0].id.key=0;return}
var u1=box2d.b2DotVV(box2d.b2SubVV(cLocal,v1,box2d.b2Vec2.s_t0),box2d.b2SubVV(v2,v1,box2d.b2Vec2.s_t1));var u2=box2d.b2DotVV(box2d.b2SubVV(cLocal,v2,box2d.b2Vec2.s_t0),box2d.b2SubVV(v1,v2,box2d.b2Vec2.s_t1));if(u1<=0){if(box2d.b2DistanceSquaredVV(cLocal,v1)>radius*radius){return}
manifold.pointCount=1;manifold.type=box2d.b2ManifoldType.e_faceA;box2d.b2SubVV(cLocal,v1,manifold.localNormal).SelfNormalize();manifold.localPoint.Copy(v1);manifold.points[0].localPoint.Copy(circleB.m_p);manifold.points[0].id.key=0}
else if(u2<=0){if(box2d.b2DistanceSquaredVV(cLocal,v2)>radius*radius){return}
manifold.pointCount=1;manifold.type=box2d.b2ManifoldType.e_faceA;box2d.b2SubVV(cLocal,v2,manifold.localNormal).SelfNormalize();manifold.localPoint.Copy(v2);manifold.points[0].localPoint.Copy(circleB.m_p);manifold.points[0].id.key=0}
else{var faceCenter=box2d.b2MidVV(v1,v2,box2d.b2CollidePolygonAndCircle.s_faceCenter);separation=box2d.b2DotVV(box2d.b2SubVV(cLocal,faceCenter,box2d.b2Vec2.s_t1),normals[vertIndex1]);if(separation>radius){return}
manifold.pointCount=1;manifold.type=box2d.b2ManifoldType.e_faceA;manifold.localNormal.Copy(normals[vertIndex1]).SelfNormalize();manifold.localPoint.Copy(faceCenter);manifold.points[0].localPoint.Copy(circleB.m_p);manifold.points[0].id.key=0}}
box2d.b2CollidePolygonAndCircle.s_c=new box2d.b2Vec2();box2d.b2CollidePolygonAndCircle.s_cLocal=new box2d.b2Vec2();box2d.b2CollidePolygonAndCircle.s_faceCenter=new box2d.b2Vec2();goog.provide('box2d.b2CircleContact');goog.require('box2d.b2Settings');goog.require('box2d.b2Contact');goog.require('box2d.b2CollideCircle');box2d.b2CircleContact=function(){goog.base(this)};goog.inherits(box2d.b2CircleContact,box2d.b2Contact);box2d.b2CircleContact.Create=function(allocator){return new box2d.b2CircleContact()}
box2d.b2CircleContact.Destroy=function(contact,allocator){}
box2d.b2CircleContact.prototype.Reset=function(fixtureA,indexA,fixtureB,indexB){goog.base(this,'Reset',fixtureA,indexA,fixtureB,indexB)}
box2d.b2CircleContact.prototype.Evaluate=function(manifold,xfA,xfB){var shapeA=this.m_fixtureA.GetShape();var shapeB=this.m_fixtureB.GetShape();if(box2d.ENABLE_ASSERTS){box2d.b2Assert(shapeA instanceof box2d.b2CircleShape)}
if(box2d.ENABLE_ASSERTS){box2d.b2Assert(shapeB instanceof box2d.b2CircleShape)}
box2d.b2CollideCircles(manifold,(shapeA instanceof box2d.b2CircleShape)?shapeA:null,xfA,(shapeB instanceof box2d.b2CircleShape)?shapeB:null,xfB)}
goog.provide('box2d.b2ChainAndCircleContact');goog.require('box2d.b2Settings');goog.require('box2d.b2Contact');goog.require('box2d.b2CollideEdge');box2d.b2ChainAndCircleContact=function(){goog.base(this)};goog.inherits(box2d.b2ChainAndCircleContact,box2d.b2Contact);box2d.b2ChainAndCircleContact.Create=function(allocator){return new box2d.b2ChainAndCircleContact()}
box2d.b2ChainAndCircleContact.Destroy=function(contact,allocator){}
box2d.b2ChainAndCircleContact.prototype.Reset=function(fixtureA,indexA,fixtureB,indexB){goog.base(this,'Reset',fixtureA,indexA,fixtureB,indexB);if(box2d.ENABLE_ASSERTS){box2d.b2Assert(fixtureA.GetType()===box2d.b2ShapeType.e_chainShape)}
if(box2d.ENABLE_ASSERTS){box2d.b2Assert(fixtureB.GetType()===box2d.b2ShapeType.e_circleShape)}}
box2d.b2ChainAndCircleContact.prototype.Evaluate=function(manifold,xfA,xfB){var shapeA=this.m_fixtureA.GetShape();var shapeB=this.m_fixtureB.GetShape();if(box2d.ENABLE_ASSERTS){box2d.b2Assert(shapeA instanceof box2d.b2ChainShape)}
if(box2d.ENABLE_ASSERTS){box2d.b2Assert(shapeB instanceof box2d.b2CircleShape)}
var chain=(shapeA instanceof box2d.b2ChainShape)?shapeA:null;var edge=box2d.b2ChainAndCircleContact.prototype.Evaluate.s_edge;chain.GetChildEdge(edge,this.m_indexA);box2d.b2CollideEdgeAndCircle(manifold,edge,xfA,(shapeB instanceof box2d.b2CircleShape)?shapeB:null,xfB)}
box2d.b2ChainAndCircleContact.prototype.Evaluate.s_edge=new box2d.b2EdgeShape();goog.provide('box2d.b2EdgeAndCircleContact');goog.require('box2d.b2Settings');goog.require('box2d.b2Contact');goog.require('box2d.b2CollideEdge');box2d.b2EdgeAndCircleContact=function(){goog.base(this)};goog.inherits(box2d.b2EdgeAndCircleContact,box2d.b2Contact);box2d.b2EdgeAndCircleContact.Create=function(allocator){return new box2d.b2EdgeAndCircleContact()}
box2d.b2EdgeAndCircleContact.Destroy=function(contact,allocator){}
box2d.b2EdgeAndCircleContact.prototype.Reset=function(fixtureA,indexA,fixtureB,indexB){goog.base(this,'Reset',fixtureA,indexA,fixtureB,indexB);if(box2d.ENABLE_ASSERTS){box2d.b2Assert(fixtureA.GetType()===box2d.b2ShapeType.e_edgeShape)}
if(box2d.ENABLE_ASSERTS){box2d.b2Assert(fixtureB.GetType()===box2d.b2ShapeType.e_circleShape)}}
box2d.b2EdgeAndCircleContact.prototype.Evaluate=function(manifold,xfA,xfB){var shapeA=this.m_fixtureA.GetShape();var shapeB=this.m_fixtureB.GetShape();if(box2d.ENABLE_ASSERTS){box2d.b2Assert(shapeA instanceof box2d.b2EdgeShape)}
if(box2d.ENABLE_ASSERTS){box2d.b2Assert(shapeB instanceof box2d.b2CircleShape)}
box2d.b2CollideEdgeAndCircle(manifold,(shapeA instanceof box2d.b2EdgeShape)?shapeA:null,xfA,(shapeB instanceof box2d.b2CircleShape)?shapeB:null,xfB)}
goog.provide('box2d.b2ContactSolver');goog.require('box2d.b2Settings');goog.require('box2d.b2Math');goog.require('box2d.b2Collision');goog.require('box2d.b2CircleContact');goog.require('box2d.b2PolygonAndCircleContact');goog.require('box2d.b2PolygonContact');goog.require('box2d.b2EdgeAndCircleContact');goog.require('box2d.b2EdgeAndPolygonContact');goog.require('box2d.b2ChainAndCircleContact');goog.require('box2d.b2ChainAndPolygonContact');box2d.b2VelocityConstraintPoint=function(){this.rA=new box2d.b2Vec2();this.rB=new box2d.b2Vec2()};box2d.b2VelocityConstraintPoint.prototype.rA=null;box2d.b2VelocityConstraintPoint.prototype.rB=null;box2d.b2VelocityConstraintPoint.prototype.normalImpulse=0;box2d.b2VelocityConstraintPoint.prototype.tangentImpulse=0;box2d.b2VelocityConstraintPoint.prototype.normalMass=0;box2d.b2VelocityConstraintPoint.prototype.tangentMass=0;box2d.b2VelocityConstraintPoint.prototype.velocityBias=0;box2d.b2VelocityConstraintPoint.MakeArray=function(length){return box2d.b2MakeArray(length,function(i){return new box2d.b2VelocityConstraintPoint()})}
box2d.b2ContactVelocityConstraint=function(){this.points=box2d.b2VelocityConstraintPoint.MakeArray(box2d.b2_maxManifoldPoints);this.normal=new box2d.b2Vec2();this.tangent=new box2d.b2Vec2();this.normalMass=new box2d.b2Mat22();this.K=new box2d.b2Mat22()}
box2d.b2ContactVelocityConstraint.prototype.points=null;box2d.b2ContactVelocityConstraint.prototype.normal=null;box2d.b2ContactVelocityConstraint.prototype.tangent=null;box2d.b2ContactVelocityConstraint.prototype.normalMass=null;box2d.b2ContactVelocityConstraint.prototype.K=null;box2d.b2ContactVelocityConstraint.prototype.indexA=0;box2d.b2ContactVelocityConstraint.prototype.indexB=0;box2d.b2ContactVelocityConstraint.prototype.invMassA=0;box2d.b2ContactVelocityConstraint.prototype.invMassB=0;box2d.b2ContactVelocityConstraint.prototype.invIA=0;box2d.b2ContactVelocityConstraint.prototype.invIB=0;box2d.b2ContactVelocityConstraint.prototype.friction=0;box2d.b2ContactVelocityConstraint.prototype.restitution=0;box2d.b2ContactVelocityConstraint.prototype.tangentSpeed=0;box2d.b2ContactVelocityConstraint.prototype.pointCount=0;box2d.b2ContactVelocityConstraint.prototype.contactIndex=0;box2d.b2ContactVelocityConstraint.MakeArray=function(length){return box2d.b2MakeArray(length,function(i){return new box2d.b2ContactVelocityConstraint()})}
box2d.b2ContactPositionConstraint=function(){this.localPoints=box2d.b2Vec2.MakeArray(box2d.b2_maxManifoldPoints);this.localNormal=new box2d.b2Vec2();this.localPoint=new box2d.b2Vec2();this.localCenterA=new box2d.b2Vec2();this.localCenterB=new box2d.b2Vec2()};box2d.b2ContactPositionConstraint.prototype.localPoints=null;box2d.b2ContactPositionConstraint.prototype.localNormal=null;box2d.b2ContactPositionConstraint.prototype.localPoint=null;box2d.b2ContactPositionConstraint.prototype.indexA=0;box2d.b2ContactPositionConstraint.prototype.indexB=0;box2d.b2ContactPositionConstraint.prototype.invMassA=0;box2d.b2ContactPositionConstraint.prototype.invMassB=0;box2d.b2ContactPositionConstraint.prototype.localCenterA=null;box2d.b2ContactPositionConstraint.prototype.localCenterB=null;box2d.b2ContactPositionConstraint.prototype.invIA=0;box2d.b2ContactPositionConstraint.prototype.invIB=0;box2d.b2ContactPositionConstraint.prototype.type=box2d.b2ManifoldType.e_unknown;box2d.b2ContactPositionConstraint.prototype.radiusA=0;box2d.b2ContactPositionConstraint.prototype.radiusB=0;box2d.b2ContactPositionConstraint.prototype.pointCount=0;box2d.b2ContactPositionConstraint.MakeArray=function(length){return box2d.b2MakeArray(length,function(i){return new box2d.b2ContactPositionConstraint()})}
box2d.b2ContactSolverDef=function(){this.step=new box2d.b2TimeStep()};box2d.b2ContactSolverDef.prototype.step=null;box2d.b2ContactSolverDef.prototype.contacts=null;box2d.b2ContactSolverDef.prototype.count=0;box2d.b2ContactSolverDef.prototype.positions=null;box2d.b2ContactSolverDef.prototype.velocities=null;box2d.b2ContactSolverDef.prototype.allocator=null;box2d.b2ContactSolver=function(){this.m_step=new box2d.b2TimeStep();this.m_positionConstraints=box2d.b2ContactPositionConstraint.MakeArray(1024);this.m_velocityConstraints=box2d.b2ContactVelocityConstraint.MakeArray(1024)}
box2d.b2ContactSolver.prototype.m_step=null;box2d.b2ContactSolver.prototype.m_positions=null;box2d.b2ContactSolver.prototype.m_velocities=null;box2d.b2ContactSolver.prototype.m_allocator=null;box2d.b2ContactSolver.prototype.m_positionConstraints=null;box2d.b2ContactSolver.prototype.m_velocityConstraints=null;box2d.b2ContactSolver.prototype.m_contacts=null;box2d.b2ContactSolver.prototype.m_count=0;box2d.b2ContactSolver.prototype.Initialize=function(def){this.m_step.Copy(def.step);this.m_allocator=def.allocator;this.m_count=def.count;if(this.m_positionConstraints.length<this.m_count){var new_length=box2d.b2Max(this.m_positionConstraints.length*2,this.m_count);if(box2d.DEBUG){window.console.log("box2d.b2ContactSolver.m_positionConstraints: "+new_length)}
while(this.m_positionConstraints.length<new_length){this.m_positionConstraints[this.m_positionConstraints.length]=new box2d.b2ContactPositionConstraint()}}
if(this.m_velocityConstraints.length<this.m_count){var new_length=box2d.b2Max(this.m_velocityConstraints.length*2,this.m_count);if(box2d.DEBUG){window.console.log("box2d.b2ContactSolver.m_velocityConstraints: "+new_length)}
while(this.m_velocityConstraints.length<new_length){this.m_velocityConstraints[this.m_velocityConstraints.length]=new box2d.b2ContactVelocityConstraint()}}
this.m_positions=def.positions;this.m_velocities=def.velocities;this.m_contacts=def.contacts;var i;var ict;var j;var jct;var contact;var fixtureA;var fixtureB;var shapeA;var shapeB;var radiusA;var radiusB;var bodyA;var bodyB;var manifold;var pointCount;var vc;var pc;var cp;var vcp;for(i=0,ict=this.m_count;i<ict;++i){contact=this.m_contacts[i];fixtureA=contact.m_fixtureA;fixtureB=contact.m_fixtureB;shapeA=fixtureA.GetShape();shapeB=fixtureB.GetShape();radiusA=shapeA.m_radius;radiusB=shapeB.m_radius;bodyA=fixtureA.GetBody();bodyB=fixtureB.GetBody();manifold=contact.GetManifold();pointCount=manifold.pointCount;if(box2d.ENABLE_ASSERTS){box2d.b2Assert(pointCount>0)}
vc=this.m_velocityConstraints[i];vc.friction=contact.m_friction;vc.restitution=contact.m_restitution;vc.tangentSpeed=contact.m_tangentSpeed;vc.indexA=bodyA.m_islandIndex;vc.indexB=bodyB.m_islandIndex;vc.invMassA=bodyA.m_invMass;vc.invMassB=bodyB.m_invMass;vc.invIA=bodyA.m_invI;vc.invIB=bodyB.m_invI;vc.contactIndex=i;vc.pointCount=pointCount;vc.K.SetZero();vc.normalMass.SetZero();pc=this.m_positionConstraints[i];pc.indexA=bodyA.m_islandIndex;pc.indexB=bodyB.m_islandIndex;pc.invMassA=bodyA.m_invMass;pc.invMassB=bodyB.m_invMass;pc.localCenterA.Copy(bodyA.m_sweep.localCenter);pc.localCenterB.Copy(bodyB.m_sweep.localCenter);pc.invIA=bodyA.m_invI;pc.invIB=bodyB.m_invI;pc.localNormal.Copy(manifold.localNormal);pc.localPoint.Copy(manifold.localPoint);pc.pointCount=pointCount;pc.radiusA=radiusA;pc.radiusB=radiusB;pc.type=manifold.type;for(j=0,jct=pointCount;j<jct;++j){cp=manifold.points[j];vcp=vc.points[j];if(this.m_step.warmStarting){vcp.normalImpulse=this.m_step.dtRatio*cp.normalImpulse;vcp.tangentImpulse=this.m_step.dtRatio*cp.tangentImpulse}
else{vcp.normalImpulse=0;vcp.tangentImpulse=0}
vcp.rA.SetZero();vcp.rB.SetZero();vcp.normalMass=0;vcp.tangentMass=0;vcp.velocityBias=0;pc.localPoints[j].Copy(cp.localPoint)}}
return this}
box2d.b2ContactSolver.prototype.InitializeVelocityConstraints=function(){var i;var ict;var j;var jct;var vc;var pc;var radiusA;var radiusB;var manifold;var indexA;var indexB;var mA;var mB;var iA;var iB;var localCenterA;var localCenterB;var cA;var aA;var vA;var wA;var cB;var aB;var vB;var wB;var xfA=box2d.b2ContactSolver.prototype.InitializeVelocityConstraints.s_xfA;var xfB=box2d.b2ContactSolver.prototype.InitializeVelocityConstraints.s_xfB;var worldManifold=box2d.b2ContactSolver.prototype.InitializeVelocityConstraints.s_worldManifold;var pointCount;var vcp;var rnA;var rnB;var kNormal;var tangent;var rtA;var rtB;var kTangent;var vRel;var vcp1;var vcp2;var rn1A;var rn1B;var rn2A;var rn2B;var k11;var k22;var k12;var k_maxConditionNumber=1000;for(i=0,ict=this.m_count;i<ict;++i){vc=this.m_velocityConstraints[i];pc=this.m_positionConstraints[i];radiusA=pc.radiusA;radiusB=pc.radiusB;manifold=this.m_contacts[vc.contactIndex].GetManifold();indexA=vc.indexA;indexB=vc.indexB;mA=vc.invMassA;mB=vc.invMassB;iA=vc.invIA;iB=vc.invIB;localCenterA=pc.localCenterA;localCenterB=pc.localCenterB;cA=this.m_positions[indexA].c;aA=this.m_positions[indexA].a;vA=this.m_velocities[indexA].v;wA=this.m_velocities[indexA].w;cB=this.m_positions[indexB].c;aB=this.m_positions[indexB].a;vB=this.m_velocities[indexB].v;wB=this.m_velocities[indexB].w;if(box2d.ENABLE_ASSERTS){box2d.b2Assert(manifold.pointCount>0)}
xfA.q.SetAngleRadians(aA);xfB.q.SetAngleRadians(aB);box2d.b2SubVV(cA,box2d.b2MulRV(xfA.q,localCenterA,box2d.b2Vec2.s_t0),xfA.p);box2d.b2SubVV(cB,box2d.b2MulRV(xfB.q,localCenterB,box2d.b2Vec2.s_t0),xfB.p);worldManifold.Initialize(manifold,xfA,radiusA,xfB,radiusB);vc.normal.Copy(worldManifold.normal);box2d.b2CrossVOne(vc.normal,vc.tangent);pointCount=vc.pointCount;for(j=0,jct=pointCount;j<jct;++j){vcp=vc.points[j];box2d.b2SubVV(worldManifold.points[j],cA,vcp.rA);box2d.b2SubVV(worldManifold.points[j],cB,vcp.rB);rnA=box2d.b2CrossVV(vcp.rA,vc.normal);rnB=box2d.b2CrossVV(vcp.rB,vc.normal);kNormal=mA+mB+iA*rnA*rnA+iB*rnB*rnB;vcp.normalMass=kNormal>0?1/kNormal:0;tangent=vc.tangent;rtA=box2d.b2CrossVV(vcp.rA,tangent);rtB=box2d.b2CrossVV(vcp.rB,tangent);kTangent=mA+mB+iA*rtA*rtA+iB*rtB*rtB;vcp.tangentMass=kTangent>0?1/kTangent:0;vcp.velocityBias=0;vRel=box2d.b2DotVV(vc.normal,box2d.b2SubVV(box2d.b2AddVCrossSV(vB,wB,vcp.rB,box2d.b2Vec2.s_t0),box2d.b2AddVCrossSV(vA,wA,vcp.rA,box2d.b2Vec2.s_t1),box2d.b2Vec2.s_t0));if(vRel<(-box2d.b2_velocityThreshold)){vcp.velocityBias+=(-vc.restitution*vRel)}}
if(vc.pointCount===2){vcp1=vc.points[0];vcp2=vc.points[1];rn1A=box2d.b2CrossVV(vcp1.rA,vc.normal);rn1B=box2d.b2CrossVV(vcp1.rB,vc.normal);rn2A=box2d.b2CrossVV(vcp2.rA,vc.normal);rn2B=box2d.b2CrossVV(vcp2.rB,vc.normal);k11=mA+mB+iA*rn1A*rn1A+iB*rn1B*rn1B;k22=mA+mB+iA*rn2A*rn2A+iB*rn2B*rn2B;k12=mA+mB+iA*rn1A*rn2A+iB*rn1B*rn2B;if(k11*k11<k_maxConditionNumber*(k11*k22-k12*k12)){vc.K.ex.SetXY(k11,k12);vc.K.ey.SetXY(k12,k22);vc.K.GetInverse(vc.normalMass)}
else{vc.pointCount=1}}}}
box2d.b2ContactSolver.prototype.InitializeVelocityConstraints.s_xfA=new box2d.b2Transform();box2d.b2ContactSolver.prototype.InitializeVelocityConstraints.s_xfB=new box2d.b2Transform();box2d.b2ContactSolver.prototype.InitializeVelocityConstraints.s_worldManifold=new box2d.b2WorldManifold();box2d.b2ContactSolver.prototype.WarmStart=function(){var i;var ict;var j;var jct;var vc;var indexA;var indexB;var mA;var iA;var mB;var iB;var pointCount;var vA;var wA;var vB;var wB;var normal;var tangent;var vcp;var P=box2d.b2ContactSolver.prototype.WarmStart.s_P;for(i=0,ict=this.m_count;i<ict;++i){vc=this.m_velocityConstraints[i];indexA=vc.indexA;indexB=vc.indexB;mA=vc.invMassA;iA=vc.invIA;mB=vc.invMassB;iB=vc.invIB;pointCount=vc.pointCount;vA=this.m_velocities[indexA].v;wA=this.m_velocities[indexA].w;vB=this.m_velocities[indexB].v;wB=this.m_velocities[indexB].w;normal=vc.normal;tangent=vc.tangent;for(j=0,jct=pointCount;j<jct;++j){vcp=vc.points[j];box2d.b2AddVV(box2d.b2MulSV(vcp.normalImpulse,normal,box2d.b2Vec2.s_t0),box2d.b2MulSV(vcp.tangentImpulse,tangent,box2d.b2Vec2.s_t1),P);wA-=iA*box2d.b2CrossVV(vcp.rA,P);vA.SelfMulSub(mA,P);wB+=iB*box2d.b2CrossVV(vcp.rB,P);vB.SelfMulAdd(mB,P)}
this.m_velocities[indexA].w=wA;this.m_velocities[indexB].w=wB}}
box2d.b2ContactSolver.prototype.WarmStart.s_P=new box2d.b2Vec2();box2d.b2ContactSolver.prototype.SolveVelocityConstraints=function(){var i;var ict;var j;var jct;var vc;var indexA;var indexB;var mA;var iA;var mB;var iB;var pointCount;var vA;var wA;var vB;var wB;var normal;var tangent;var friction;var vcp;var dv=box2d.b2ContactSolver.prototype.SolveVelocityConstraints.s_dv;var dv1=box2d.b2ContactSolver.prototype.SolveVelocityConstraints.s_dv1;var dv2=box2d.b2ContactSolver.prototype.SolveVelocityConstraints.s_dv2;var vt;var vn;var lambda;var maxFriction;var newImpulse;var P=box2d.b2ContactSolver.prototype.SolveVelocityConstraints.s_P;var cp1;var cp2;var a=box2d.b2ContactSolver.prototype.SolveVelocityConstraints.s_a;var b=box2d.b2ContactSolver.prototype.SolveVelocityConstraints.s_b;var vn1;var vn2;var x=box2d.b2ContactSolver.prototype.SolveVelocityConstraints.s_x;var d=box2d.b2ContactSolver.prototype.SolveVelocityConstraints.s_d;var P1=box2d.b2ContactSolver.prototype.SolveVelocityConstraints.s_P1;var P2=box2d.b2ContactSolver.prototype.SolveVelocityConstraints.s_P2;var P1P2=box2d.b2ContactSolver.prototype.SolveVelocityConstraints.s_P1P2;for(i=0,ict=this.m_count;i<ict;++i){vc=this.m_velocityConstraints[i];indexA=vc.indexA;indexB=vc.indexB;mA=vc.invMassA;iA=vc.invIA;mB=vc.invMassB;iB=vc.invIB;pointCount=vc.pointCount;vA=this.m_velocities[indexA].v;wA=this.m_velocities[indexA].w;vB=this.m_velocities[indexB].v;wB=this.m_velocities[indexB].w;normal=vc.normal;tangent=vc.tangent;friction=vc.friction;if(box2d.ENABLE_ASSERTS){box2d.b2Assert(pointCount===1||pointCount===2)}
for(j=0,jct=pointCount;j<jct;++j){vcp=vc.points[j];box2d.b2SubVV(box2d.b2AddVCrossSV(vB,wB,vcp.rB,box2d.b2Vec2.s_t0),box2d.b2AddVCrossSV(vA,wA,vcp.rA,box2d.b2Vec2.s_t1),dv);vt=box2d.b2DotVV(dv,tangent)-vc.tangentSpeed;lambda=vcp.tangentMass*(-vt);maxFriction=friction*vcp.normalImpulse;newImpulse=box2d.b2Clamp(vcp.tangentImpulse+lambda,(-maxFriction),maxFriction);lambda=newImpulse-vcp.tangentImpulse;vcp.tangentImpulse=newImpulse;box2d.b2MulSV(lambda,tangent,P);vA.SelfMulSub(mA,P);wA-=iA*box2d.b2CrossVV(vcp.rA,P);vB.SelfMulAdd(mB,P);wB+=iB*box2d.b2CrossVV(vcp.rB,P)}
if(vc.pointCount===1){vcp=vc.points[0];box2d.b2SubVV(box2d.b2AddVCrossSV(vB,wB,vcp.rB,box2d.b2Vec2.s_t0),box2d.b2AddVCrossSV(vA,wA,vcp.rA,box2d.b2Vec2.s_t1),dv);vn=box2d.b2DotVV(dv,normal);lambda=(-vcp.normalMass*(vn-vcp.velocityBias));newImpulse=box2d.b2Max(vcp.normalImpulse+lambda,0);lambda=newImpulse-vcp.normalImpulse;vcp.normalImpulse=newImpulse;box2d.b2MulSV(lambda,normal,P);vA.SelfMulSub(mA,P);wA-=iA*box2d.b2CrossVV(vcp.rA,P);vB.SelfMulAdd(mB,P);wB+=iB*box2d.b2CrossVV(vcp.rB,P)}
else{cp1=vc.points[0];cp2=vc.points[1];a.SetXY(cp1.normalImpulse,cp2.normalImpulse);if(box2d.ENABLE_ASSERTS){box2d.b2Assert(a.x>=0&&a.y>=0)}
box2d.b2SubVV(box2d.b2AddVCrossSV(vB,wB,cp1.rB,box2d.b2Vec2.s_t0),box2d.b2AddVCrossSV(vA,wA,cp1.rA,box2d.b2Vec2.s_t1),dv1);box2d.b2SubVV(box2d.b2AddVCrossSV(vB,wB,cp2.rB,box2d.b2Vec2.s_t0),box2d.b2AddVCrossSV(vA,wA,cp2.rA,box2d.b2Vec2.s_t1),dv2);vn1=box2d.b2DotVV(dv1,normal);vn2=box2d.b2DotVV(dv2,normal);b.x=vn1-cp1.velocityBias;b.y=vn2-cp2.velocityBias;b.SelfSub(box2d.b2MulMV(vc.K,a,box2d.b2Vec2.s_t0));for(;;){box2d.b2MulMV(vc.normalMass,b,x).SelfNeg();if(x.x>=0&&x.y>=0){box2d.b2SubVV(x,a,d);box2d.b2MulSV(d.x,normal,P1);box2d.b2MulSV(d.y,normal,P2);box2d.b2AddVV(P1,P2,P1P2);vA.SelfMulSub(mA,P1P2);wA-=iA*(box2d.b2CrossVV(cp1.rA,P1)+box2d.b2CrossVV(cp2.rA,P2));vB.SelfMulAdd(mB,P1P2);wB+=iB*(box2d.b2CrossVV(cp1.rB,P1)+box2d.b2CrossVV(cp2.rB,P2));cp1.normalImpulse=x.x;cp2.normalImpulse=x.y;break}
x.x=(-cp1.normalMass*b.x);x.y=0;vn1=0;vn2=vc.K.ex.y*x.x+b.y;if(x.x>=0&&vn2>=0){box2d.b2SubVV(x,a,d);box2d.b2MulSV(d.x,normal,P1);box2d.b2MulSV(d.y,normal,P2);box2d.b2AddVV(P1,P2,P1P2);vA.SelfMulSub(mA,P1P2);wA-=iA*(box2d.b2CrossVV(cp1.rA,P1)+box2d.b2CrossVV(cp2.rA,P2));vB.SelfMulAdd(mB,P1P2);wB+=iB*(box2d.b2CrossVV(cp1.rB,P1)+box2d.b2CrossVV(cp2.rB,P2));cp1.normalImpulse=x.x;cp2.normalImpulse=x.y;break}
x.x=0;x.y=(-cp2.normalMass*b.y);vn1=vc.K.ey.x*x.y+b.x;vn2=0;if(x.y>=0&&vn1>=0){box2d.b2SubVV(x,a,d);box2d.b2MulSV(d.x,normal,P1);box2d.b2MulSV(d.y,normal,P2);box2d.b2AddVV(P1,P2,P1P2);vA.SelfMulSub(mA,P1P2);wA-=iA*(box2d.b2CrossVV(cp1.rA,P1)+box2d.b2CrossVV(cp2.rA,P2));vB.SelfMulAdd(mB,P1P2);wB+=iB*(box2d.b2CrossVV(cp1.rB,P1)+box2d.b2CrossVV(cp2.rB,P2));cp1.normalImpulse=x.x;cp2.normalImpulse=x.y;break}
x.x=0;x.y=0;vn1=b.x;vn2=b.y;if(vn1>=0&&vn2>=0){box2d.b2SubVV(x,a,d);box2d.b2MulSV(d.x,normal,P1);box2d.b2MulSV(d.y,normal,P2);box2d.b2AddVV(P1,P2,P1P2);vA.SelfMulSub(mA,P1P2);wA-=iA*(box2d.b2CrossVV(cp1.rA,P1)+box2d.b2CrossVV(cp2.rA,P2));vB.SelfMulAdd(mB,P1P2);wB+=iB*(box2d.b2CrossVV(cp1.rB,P1)+box2d.b2CrossVV(cp2.rB,P2));cp1.normalImpulse=x.x;cp2.normalImpulse=x.y;break}
break}}
this.m_velocities[indexA].w=wA;this.m_velocities[indexB].w=wB}}
box2d.b2ContactSolver.prototype.SolveVelocityConstraints.s_dv=new box2d.b2Vec2();box2d.b2ContactSolver.prototype.SolveVelocityConstraints.s_dv1=new box2d.b2Vec2();box2d.b2ContactSolver.prototype.SolveVelocityConstraints.s_dv2=new box2d.b2Vec2();box2d.b2ContactSolver.prototype.SolveVelocityConstraints.s_P=new box2d.b2Vec2();box2d.b2ContactSolver.prototype.SolveVelocityConstraints.s_a=new box2d.b2Vec2();box2d.b2ContactSolver.prototype.SolveVelocityConstraints.s_b=new box2d.b2Vec2();box2d.b2ContactSolver.prototype.SolveVelocityConstraints.s_x=new box2d.b2Vec2();box2d.b2ContactSolver.prototype.SolveVelocityConstraints.s_d=new box2d.b2Vec2();box2d.b2ContactSolver.prototype.SolveVelocityConstraints.s_P1=new box2d.b2Vec2();box2d.b2ContactSolver.prototype.SolveVelocityConstraints.s_P2=new box2d.b2Vec2();box2d.b2ContactSolver.prototype.SolveVelocityConstraints.s_P1P2=new box2d.b2Vec2();box2d.b2ContactSolver.prototype.StoreImpulses=function(){var i;var ict;var j;var jct;var vc;var manifold;for(i=0,ict=this.m_count;i<ict;++i){vc=this.m_velocityConstraints[i];manifold=this.m_contacts[vc.contactIndex].GetManifold();for(j=0,jct=vc.pointCount;j<jct;++j){manifold.points[j].normalImpulse=vc.points[j].normalImpulse;manifold.points[j].tangentImpulse=vc.points[j].tangentImpulse}}}
box2d.b2PositionSolverManifold=function(){this.normal=new box2d.b2Vec2();this.point=new box2d.b2Vec2()}
box2d.b2PositionSolverManifold.prototype.normal=null;box2d.b2PositionSolverManifold.prototype.point=null;box2d.b2PositionSolverManifold.prototype.separation=0;box2d.b2PositionSolverManifold.prototype.Initialize=function(pc,xfA,xfB,index){var pointA=box2d.b2PositionSolverManifold.prototype.Initialize.s_pointA;var pointB=box2d.b2PositionSolverManifold.prototype.Initialize.s_pointB;var planePoint=box2d.b2PositionSolverManifold.prototype.Initialize.s_planePoint;var clipPoint=box2d.b2PositionSolverManifold.prototype.Initialize.s_clipPoint;if(box2d.ENABLE_ASSERTS){box2d.b2Assert(pc.pointCount>0)}
switch(pc.type){case box2d.b2ManifoldType.e_circles:{box2d.b2MulXV(xfA,pc.localPoint,pointA);box2d.b2MulXV(xfB,pc.localPoints[0],pointB);box2d.b2SubVV(pointB,pointA,this.normal).SelfNormalize();box2d.b2MidVV(pointA,pointB,this.point);this.separation=box2d.b2DotVV(box2d.b2SubVV(pointB,pointA,box2d.b2Vec2.s_t0),this.normal)-pc.radiusA-pc.radiusB}
break;case box2d.b2ManifoldType.e_faceA:{box2d.b2MulRV(xfA.q,pc.localNormal,this.normal);box2d.b2MulXV(xfA,pc.localPoint,planePoint);box2d.b2MulXV(xfB,pc.localPoints[index],clipPoint);this.separation=box2d.b2DotVV(box2d.b2SubVV(clipPoint,planePoint,box2d.b2Vec2.s_t0),this.normal)-pc.radiusA-pc.radiusB;this.point.Copy(clipPoint)}
break;case box2d.b2ManifoldType.e_faceB:{box2d.b2MulRV(xfB.q,pc.localNormal,this.normal);box2d.b2MulXV(xfB,pc.localPoint,planePoint);box2d.b2MulXV(xfA,pc.localPoints[index],clipPoint);this.separation=box2d.b2DotVV(box2d.b2SubVV(clipPoint,planePoint,box2d.b2Vec2.s_t0),this.normal)-pc.radiusA-pc.radiusB;this.point.Copy(clipPoint);this.normal.SelfNeg()}
break}}
box2d.b2PositionSolverManifold.prototype.Initialize.s_pointA=new box2d.b2Vec2();box2d.b2PositionSolverManifold.prototype.Initialize.s_pointB=new box2d.b2Vec2();box2d.b2PositionSolverManifold.prototype.Initialize.s_planePoint=new box2d.b2Vec2();box2d.b2PositionSolverManifold.prototype.Initialize.s_clipPoint=new box2d.b2Vec2();box2d.b2ContactSolver.prototype.SolvePositionConstraints=function(){var i;var ict;var j;var jct;var pc;var indexA;var indexB;var localCenterA;var mA;var iA;var localCenterB;var mB;var iB;var pointCount;var cA;var aA;var cB;var aB;var xfA=box2d.b2ContactSolver.prototype.SolvePositionConstraints.s_xfA;var xfB=box2d.b2ContactSolver.prototype.SolvePositionConstraints.s_xfB;var psm=box2d.b2ContactSolver.prototype.SolvePositionConstraints.s_psm;var normal;var point;var separation;var rA=box2d.b2ContactSolver.prototype.SolvePositionConstraints.s_rA;var rB=box2d.b2ContactSolver.prototype.SolvePositionConstraints.s_rB;var C;var rnA;var rnB;var K;var impulse;var P=box2d.b2ContactSolver.prototype.SolvePositionConstraints.s_P;var minSeparation=0;for(i=0,ict=this.m_count;i<ict;++i){pc=this.m_positionConstraints[i];indexA=pc.indexA;indexB=pc.indexB;localCenterA=pc.localCenterA;mA=pc.invMassA;iA=pc.invIA;localCenterB=pc.localCenterB;mB=pc.invMassB;iB=pc.invIB;pointCount=pc.pointCount;cA=this.m_positions[indexA].c;aA=this.m_positions[indexA].a;cB=this.m_positions[indexB].c;aB=this.m_positions[indexB].a;for(j=0,jct=pointCount;j<jct;++j){xfA.q.SetAngleRadians(aA);xfB.q.SetAngleRadians(aB);box2d.b2SubVV(cA,box2d.b2MulRV(xfA.q,localCenterA,box2d.b2Vec2.s_t0),xfA.p);box2d.b2SubVV(cB,box2d.b2MulRV(xfB.q,localCenterB,box2d.b2Vec2.s_t0),xfB.p);psm.Initialize(pc,xfA,xfB,j);normal=psm.normal;point=psm.point;separation=psm.separation;box2d.b2SubVV(point,cA,rA);box2d.b2SubVV(point,cB,rB);minSeparation=box2d.b2Min(minSeparation,separation);C=box2d.b2Clamp(box2d.b2_baumgarte*(separation+box2d.b2_linearSlop),(-box2d.b2_maxLinearCorrection),0);rnA=box2d.b2CrossVV(rA,normal);rnB=box2d.b2CrossVV(rB,normal);K=mA+mB+iA*rnA*rnA+iB*rnB*rnB;impulse=K>0?-C/K:0;box2d.b2MulSV(impulse,normal,P);cA.SelfMulSub(mA,P);aA-=iA*box2d.b2CrossVV(rA,P);cB.SelfMulAdd(mB,P);aB+=iB*box2d.b2CrossVV(rB,P)}
this.m_positions[indexA].a=aA;this.m_positions[indexB].a=aB}
return minSeparation>(-3*box2d.b2_linearSlop)}
box2d.b2ContactSolver.prototype.SolvePositionConstraints.s_xfA=new box2d.b2Transform();box2d.b2ContactSolver.prototype.SolvePositionConstraints.s_xfB=new box2d.b2Transform();box2d.b2ContactSolver.prototype.SolvePositionConstraints.s_psm=new box2d.b2PositionSolverManifold();box2d.b2ContactSolver.prototype.SolvePositionConstraints.s_rA=new box2d.b2Vec2();box2d.b2ContactSolver.prototype.SolvePositionConstraints.s_rB=new box2d.b2Vec2();box2d.b2ContactSolver.prototype.SolvePositionConstraints.s_P=new box2d.b2Vec2();box2d.b2ContactSolver.prototype.SolveTOIPositionConstraints=function(toiIndexA,toiIndexB){var i;var ict;var j;var jct;var pc;var indexA;var indexB;var localCenterA;var localCenterB;var pointCount;var mA;var iA;var mB;var iB;var cA;var aA;var cB;var aB;var xfA=box2d.b2ContactSolver.prototype.SolveTOIPositionConstraints.s_xfA;var xfB=box2d.b2ContactSolver.prototype.SolveTOIPositionConstraints.s_xfB;var psm=box2d.b2ContactSolver.prototype.SolveTOIPositionConstraints.s_psm;var normal;var point;var separation;var rA=box2d.b2ContactSolver.prototype.SolveTOIPositionConstraints.s_rA;var rB=box2d.b2ContactSolver.prototype.SolveTOIPositionConstraints.s_rB;var C;var rnA;var rnB;var K;var impulse;var P=box2d.b2ContactSolver.prototype.SolveTOIPositionConstraints.s_P;var minSeparation=0;for(i=0,ict=this.m_count;i<ict;++i){pc=this.m_positionConstraints[i];indexA=pc.indexA;indexB=pc.indexB;localCenterA=pc.localCenterA;localCenterB=pc.localCenterB;pointCount=pc.pointCount;mA=0;iA=0;if(indexA===toiIndexA||indexA===toiIndexB){mA=pc.invMassA;iA=pc.invIA}
mB=0;iB=0;if(indexB===toiIndexA||indexB===toiIndexB){mB=pc.invMassB;iB=pc.invIB}
cA=this.m_positions[indexA].c;aA=this.m_positions[indexA].a;cB=this.m_positions[indexB].c;aB=this.m_positions[indexB].a;for(j=0,jct=pointCount;j<jct;++j){xfA.q.SetAngleRadians(aA);xfB.q.SetAngleRadians(aB);box2d.b2SubVV(cA,box2d.b2MulRV(xfA.q,localCenterA,box2d.b2Vec2.s_t0),xfA.p);box2d.b2SubVV(cB,box2d.b2MulRV(xfB.q,localCenterB,box2d.b2Vec2.s_t0),xfB.p);psm.Initialize(pc,xfA,xfB,j);normal=psm.normal;point=psm.point;separation=psm.separation;box2d.b2SubVV(point,cA,rA);box2d.b2SubVV(point,cB,rB);minSeparation=box2d.b2Min(minSeparation,separation);C=box2d.b2Clamp(box2d.b2_toiBaumgarte*(separation+box2d.b2_linearSlop),(-box2d.b2_maxLinearCorrection),0);rnA=box2d.b2CrossVV(rA,normal);rnB=box2d.b2CrossVV(rB,normal);K=mA+mB+iA*rnA*rnA+iB*rnB*rnB;impulse=K>0?-C/K:0;box2d.b2MulSV(impulse,normal,P);cA.SelfMulSub(mA,P);aA-=iA*box2d.b2CrossVV(rA,P);cB.SelfMulAdd(mB,P);aB+=iB*box2d.b2CrossVV(rB,P)}
this.m_positions[indexA].a=aA;this.m_positions[indexB].a=aB}
return minSeparation>=-1.5*box2d.b2_linearSlop}
box2d.b2ContactSolver.prototype.SolveTOIPositionConstraints.s_xfA=new box2d.b2Transform();box2d.b2ContactSolver.prototype.SolveTOIPositionConstraints.s_xfB=new box2d.b2Transform();box2d.b2ContactSolver.prototype.SolveTOIPositionConstraints.s_psm=new box2d.b2PositionSolverManifold();box2d.b2ContactSolver.prototype.SolveTOIPositionConstraints.s_rA=new box2d.b2Vec2();box2d.b2ContactSolver.prototype.SolveTOIPositionConstraints.s_rB=new box2d.b2Vec2();box2d.b2ContactSolver.prototype.SolveTOIPositionConstraints.s_P=new box2d.b2Vec2();goog.provide('box2d.b2WorldCallbacks');goog.require('box2d.b2Settings');box2d.b2DestructionListener=function(){};box2d.b2DestructionListener.prototype.SayGoodbyeJoint=function(joint){}
box2d.b2DestructionListener.prototype.SayGoodbyeFixture=function(fixture){}
box2d.b2ContactFilter=function(){};box2d.b2ContactFilter.prototype.ShouldCollide=function(fixtureA,fixtureB){var filter1=fixtureA.GetFilterData();var filter2=fixtureB.GetFilterData();if(filter1.groupIndex===filter2.groupIndex&&filter1.groupIndex!==0){return(filter1.groupIndex>0)}
var collide=(((filter1.maskBits&filter2.categoryBits)!==0)&&((filter1.categoryBits&filter2.maskBits)!==0));return collide}
box2d.b2ContactFilter.b2_defaultFilter=new box2d.b2ContactFilter();box2d.b2ContactImpulse=function(){this.normalImpulses=box2d.b2MakeNumberArray(box2d.b2_maxManifoldPoints);this.tangentImpulses=box2d.b2MakeNumberArray(box2d.b2_maxManifoldPoints)};box2d.b2ContactImpulse.prototype.normalImpulses=null;box2d.b2ContactImpulse.prototype.tangentImpulses=null;box2d.b2ContactImpulse.prototype.count=0;box2d.b2ContactListener=function(){};box2d.b2ContactListener.prototype.BeginContact=function(contact){}
box2d.b2ContactListener.prototype.EndContact=function(contact){}
box2d.b2ContactListener.prototype.PreSolve=function(contact,oldManifold){}
box2d.b2ContactListener.prototype.PostSolve=function(contact,impulse){}
box2d.b2ContactListener.b2_defaultListener=new box2d.b2ContactListener();box2d.b2QueryCallback=function(){}
box2d.b2QueryCallback.prototype.ReportFixture=function(fixture){return !0}
box2d.b2RayCastCallback=function(){}
box2d.b2RayCastCallback.prototype.ReportFixture=function(fixture,point,normal,fraction){return fraction}
goog.provide('box2d.b2Island');goog.require('box2d.b2Settings');goog.require('box2d.b2Timer');goog.require('box2d.b2TimeStep');goog.require('box2d.b2WorldCallbacks');goog.require('box2d.b2ContactSolver');box2d.b2Island=function(){this.m_bodies=new Array(1024);this.m_contacts=new Array(1024);this.m_joints=new Array(1024);this.m_positions=box2d.b2Position.MakeArray(1024);this.m_velocities=box2d.b2Velocity.MakeArray(1024)}
box2d.b2Island.prototype.m_allocator=null;box2d.b2Island.prototype.m_listener=null;box2d.b2Island.prototype.m_bodies=null;box2d.b2Island.prototype.m_contacts=null;box2d.b2Island.prototype.m_joints=null;box2d.b2Island.prototype.m_positions=null;box2d.b2Island.prototype.m_velocities=null;box2d.b2Island.prototype.m_bodyCount=0;box2d.b2Island.prototype.m_jointCount=0;box2d.b2Island.prototype.m_contactCount=0;box2d.b2Island.prototype.m_bodyCapacity=0;box2d.b2Island.prototype.m_contactCapacity=0;box2d.b2Island.prototype.m_jointCapacity=0;box2d.b2Island.prototype.Initialize=function(bodyCapacity,contactCapacity,jointCapacity,allocator,listener){this.m_bodyCapacity=bodyCapacity;this.m_contactCapacity=contactCapacity;this.m_jointCapacity=jointCapacity;this.m_bodyCount=0;this.m_contactCount=0;this.m_jointCount=0;this.m_allocator=allocator;this.m_listener=listener;while(this.m_bodies.length<bodyCapacity){this.m_bodies[this.m_bodies.length]=null}
while(this.m_contacts.length<contactCapacity){this.m_contacts[this.m_contacts.length]=null}
while(this.m_joints.length<jointCapacity){this.m_joints[this.m_joints.length]=null}
if(this.m_positions.length<bodyCapacity){var new_length=box2d.b2Max(this.m_positions.length*2,bodyCapacity);if(box2d.DEBUG){window.console.log("box2d.b2Island.m_positions: "+new_length)}
while(this.m_positions.length<new_length){this.m_positions[this.m_positions.length]=new box2d.b2Position()}}
if(this.m_velocities.length<bodyCapacity){var new_length=box2d.b2Max(this.m_velocities.length*2,bodyCapacity);if(box2d.DEBUG){window.console.log("box2d.b2Island.m_velocities: "+new_length)}
while(this.m_velocities.length<new_length){this.m_velocities[this.m_velocities.length]=new box2d.b2Velocity()}}}
box2d.b2Island.prototype.Clear=function(){this.m_bodyCount=0;this.m_contactCount=0;this.m_jointCount=0}
box2d.b2Island.prototype.AddBody=function(body){if(box2d.ENABLE_ASSERTS){box2d.b2Assert(this.m_bodyCount<this.m_bodyCapacity)}
body.m_islandIndex=this.m_bodyCount;this.m_bodies[this.m_bodyCount++]=body}
box2d.b2Island.prototype.AddContact=function(contact){if(box2d.ENABLE_ASSERTS){box2d.b2Assert(this.m_contactCount<this.m_contactCapacity)}
this.m_contacts[this.m_contactCount++]=contact}
box2d.b2Island.prototype.AddJoint=function(joint){if(box2d.ENABLE_ASSERTS){box2d.b2Assert(this.m_jointCount<this.m_jointCapacity)}
this.m_joints[this.m_jointCount++]=joint}
box2d.b2Island.prototype.Solve=function(profile,step,gravity,allowSleep){var timer=box2d.b2Island.s_timer.Reset();var h=step.dt;for(var i=0;i<this.m_bodyCount;++i){var b=this.m_bodies[i];var c=this.m_positions[i].c.Copy(b.m_sweep.c);var a=b.m_sweep.a;var v=this.m_velocities[i].v.Copy(b.m_linearVelocity);var w=b.m_angularVelocity;b.m_sweep.c0.Copy(b.m_sweep.c);b.m_sweep.a0=b.m_sweep.a;if(b.m_type===box2d.b2BodyType.b2_dynamicBody){v.x+=h*(b.m_gravityScale*gravity.x+b.m_invMass*b.m_force.x);v.y+=h*(b.m_gravityScale*gravity.y+b.m_invMass*b.m_force.y);w+=h*b.m_invI*b.m_torque;v.SelfMul(1.0/(1.0+h*b.m_linearDamping));w*=1.0/(1.0+h*b.m_angularDamping)}
this.m_positions[i].a=a;this.m_velocities[i].w=w}
timer.Reset();var solverData=box2d.b2Island.s_solverData;solverData.step.Copy(step);solverData.positions=this.m_positions;solverData.velocities=this.m_velocities;var contactSolverDef=box2d.b2Island.s_contactSolverDef;contactSolverDef.step.Copy(step);contactSolverDef.contacts=this.m_contacts;contactSolverDef.count=this.m_contactCount;contactSolverDef.positions=this.m_positions;contactSolverDef.velocities=this.m_velocities;contactSolverDef.allocator=this.m_allocator;var contactSolver=box2d.b2Island.s_contactSolver.Initialize(contactSolverDef);contactSolver.InitializeVelocityConstraints();if(step.warmStarting){contactSolver.WarmStart()}
for(var i=0;i<this.m_jointCount;++i){this.m_joints[i].InitVelocityConstraints(solverData)}
profile.solveInit=timer.GetMilliseconds();timer.Reset();for(var i=0;i<step.velocityIterations;++i){for(var j=0;j<this.m_jointCount;++j){this.m_joints[j].SolveVelocityConstraints(solverData)}
contactSolver.SolveVelocityConstraints()}
contactSolver.StoreImpulses();profile.solveVelocity=timer.GetMilliseconds();for(var i=0;i<this.m_bodyCount;++i){var c=this.m_positions[i].c;var a=this.m_positions[i].a;var v=this.m_velocities[i].v;var w=this.m_velocities[i].w;var translation=box2d.b2MulSV(h,v,box2d.b2Island.s_translation);if(box2d.b2DotVV(translation,translation)>box2d.b2_maxTranslationSquared){var ratio=box2d.b2_maxTranslation/translation.GetLength();v.SelfMul(ratio)}
var rotation=h*w;if(rotation*rotation>box2d.b2_maxRotationSquared){var ratio=box2d.b2_maxRotation/box2d.b2Abs(rotation);w*=ratio}
c.x+=h*v.x;c.y+=h*v.y;a+=h*w;this.m_positions[i].a=a;this.m_velocities[i].w=w}
timer.Reset();var positionSolved=!1;for(var i=0;i<step.positionIterations;++i){var contactsOkay=contactSolver.SolvePositionConstraints();var jointsOkay=!0;for(var j=0;j<this.m_jointCount;++j){var jointOkay=this.m_joints[j].SolvePositionConstraints(solverData);jointsOkay=jointsOkay&&jointOkay}
if(contactsOkay&&jointsOkay){positionSolved=!0;break}}
for(var i=0;i<this.m_bodyCount;++i){var body=this.m_bodies[i];body.m_sweep.c.Copy(this.m_positions[i].c);body.m_sweep.a=this.m_positions[i].a;body.m_linearVelocity.Copy(this.m_velocities[i].v);body.m_angularVelocity=this.m_velocities[i].w;body.SynchronizeTransform()}
profile.solvePosition=timer.GetMilliseconds();this.Report(contactSolver.m_velocityConstraints);if(allowSleep){var minSleepTime=box2d.b2_maxFloat;var linTolSqr=box2d.b2_linearSleepTolerance*box2d.b2_linearSleepTolerance;var angTolSqr=box2d.b2_angularSleepTolerance*box2d.b2_angularSleepTolerance;for(var i=0;i<this.m_bodyCount;++i){var b=this.m_bodies[i];if(b.GetType()===box2d.b2BodyType.b2_staticBody){continue}
if((b.m_flags&box2d.b2BodyFlag.e_autoSleepFlag)===0||b.m_angularVelocity*b.m_angularVelocity>angTolSqr||box2d.b2DotVV(b.m_linearVelocity,b.m_linearVelocity)>linTolSqr){b.m_sleepTime=0;minSleepTime=0}
else{b.m_sleepTime+=h;minSleepTime=box2d.b2Min(minSleepTime,b.m_sleepTime)}}
if(minSleepTime>=box2d.b2_timeToSleep&&positionSolved){for(var i=0;i<this.m_bodyCount;++i){var b=this.m_bodies[i];b.SetAwake(!1)}}}}
box2d.b2Island.prototype.SolveTOI=function(subStep,toiIndexA,toiIndexB){if(box2d.ENABLE_ASSERTS){box2d.b2Assert(toiIndexA<this.m_bodyCount)}
if(box2d.ENABLE_ASSERTS){box2d.b2Assert(toiIndexB<this.m_bodyCount)}
for(var i=0;i<this.m_bodyCount;++i){var b=this.m_bodies[i];this.m_positions[i].c.Copy(b.m_sweep.c);this.m_positions[i].a=b.m_sweep.a;this.m_velocities[i].v.Copy(b.m_linearVelocity);this.m_velocities[i].w=b.m_angularVelocity}
var contactSolverDef=box2d.b2Island.s_contactSolverDef;contactSolverDef.contacts=this.m_contacts;contactSolverDef.count=this.m_contactCount;contactSolverDef.allocator=this.m_allocator;contactSolverDef.step.Copy(subStep);contactSolverDef.positions=this.m_positions;contactSolverDef.velocities=this.m_velocities;var contactSolver=box2d.b2Island.s_contactSolver.Initialize(contactSolverDef);for(var i=0;i<subStep.positionIterations;++i){var contactsOkay=contactSolver.SolveTOIPositionConstraints(toiIndexA,toiIndexB);if(contactsOkay){break}}
this.m_bodies[toiIndexA].m_sweep.c0.Copy(this.m_positions[toiIndexA].c);this.m_bodies[toiIndexA].m_sweep.a0=this.m_positions[toiIndexA].a;this.m_bodies[toiIndexB].m_sweep.c0.Copy(this.m_positions[toiIndexB].c);this.m_bodies[toiIndexB].m_sweep.a0=this.m_positions[toiIndexB].a;contactSolver.InitializeVelocityConstraints();for(var i=0;i<subStep.velocityIterations;++i){contactSolver.SolveVelocityConstraints()}
var h=subStep.dt;for(var i=0;i<this.m_bodyCount;++i){var c=this.m_positions[i].c;var a=this.m_positions[i].a;var v=this.m_velocities[i].v;var w=this.m_velocities[i].w;var translation=box2d.b2MulSV(h,v,box2d.b2Island.s_translation);if(box2d.b2DotVV(translation,translation)>box2d.b2_maxTranslationSquared){var ratio=box2d.b2_maxTranslation/translation.GetLength();v.SelfMul(ratio)}
var rotation=h*w;if(rotation*rotation>box2d.b2_maxRotationSquared){var ratio=box2d.b2_maxRotation/box2d.b2Abs(rotation);w*=ratio}
c.SelfMulAdd(h,v);a+=h*w;this.m_positions[i].a=a;this.m_velocities[i].w=w;var body=this.m_bodies[i];body.m_sweep.c.Copy(c);body.m_sweep.a=a;body.m_linearVelocity.Copy(v);body.m_angularVelocity=w;body.SynchronizeTransform()}
this.Report(contactSolver.m_velocityConstraints)}
box2d.b2Island.prototype.Report=function(constraints){if(this.m_listener===null){return}
for(var i=0;i<this.m_contactCount;++i){var c=this.m_contacts[i];if(!c){continue}
var vc=constraints[i];var impulse=box2d.b2Island.s_impulse;impulse.count=vc.pointCount;for(var j=0;j<vc.pointCount;++j){impulse.normalImpulses[j]=vc.points[j].normalImpulse;impulse.tangentImpulses[j]=vc.points[j].tangentImpulse}
this.m_listener.PostSolve(c,impulse)}}
box2d.b2Island.s_timer=new box2d.b2Timer();box2d.b2Island.s_solverData=new box2d.b2SolverData();box2d.b2Island.s_contactSolverDef=new box2d.b2ContactSolverDef();box2d.b2Island.s_contactSolver=new box2d.b2ContactSolver();box2d.b2Island.s_translation=new box2d.b2Vec2();box2d.b2Island.s_impulse=new box2d.b2ContactImpulse();goog.provide('box2d.b2ContactFactory');goog.require('box2d.b2Settings');goog.require('box2d.b2Contact');box2d.b2ContactRegister=function(){};box2d.b2ContactRegister.prototype.createFcn=null;box2d.b2ContactRegister.prototype.destroyFcn=null;box2d.b2ContactRegister.prototype.primary=!1;box2d.b2ContactFactory=function(allocator){this.m_allocator=allocator;this.InitializeRegisters()}
box2d.b2ContactFactory.prototype.m_allocator=null;box2d.b2ContactFactory.prototype.AddType=function(createFcn,destroyFcn,type1,type2){if(!0){var pool=box2d.b2MakeArray(256,function(i){return createFcn()});var poolCreateFcn=function(allocator){if(pool.length>0){return pool.pop()}
return createFcn(allocator)}
var poolDestroyFcn=function(contact,allocator){pool.push(contact)}
this.m_registers[type1][type2].pool=pool;this.m_registers[type1][type2].createFcn=poolCreateFcn;this.m_registers[type1][type2].destroyFcn=poolDestroyFcn;this.m_registers[type1][type2].primary=!0;if(type1!==type2){this.m_registers[type2][type1].pool=pool;this.m_registers[type2][type1].createFcn=poolCreateFcn;this.m_registers[type2][type1].destroyFcn=poolDestroyFcn;this.m_registers[type2][type1].primary=!1}}}
box2d.b2ContactFactory.prototype.InitializeRegisters=function(){this.m_registers=new Array(box2d.b2ShapeType.e_shapeTypeCount);for(var i=0;i<box2d.b2ShapeType.e_shapeTypeCount;i++){this.m_registers[i]=new Array(box2d.b2ShapeType.e_shapeTypeCount);for(var j=0;j<box2d.b2ShapeType.e_shapeTypeCount;j++){this.m_registers[i][j]=new box2d.b2ContactRegister()}}
this.AddType(box2d.b2CircleContact.Create,box2d.b2CircleContact.Destroy,box2d.b2ShapeType.e_circleShape,box2d.b2ShapeType.e_circleShape);this.AddType(box2d.b2PolygonAndCircleContact.Create,box2d.b2PolygonAndCircleContact.Destroy,box2d.b2ShapeType.e_polygonShape,box2d.b2ShapeType.e_circleShape);this.AddType(box2d.b2PolygonContact.Create,box2d.b2PolygonContact.Destroy,box2d.b2ShapeType.e_polygonShape,box2d.b2ShapeType.e_polygonShape);this.AddType(box2d.b2EdgeAndCircleContact.Create,box2d.b2EdgeAndCircleContact.Destroy,box2d.b2ShapeType.e_edgeShape,box2d.b2ShapeType.e_circleShape);this.AddType(box2d.b2EdgeAndPolygonContact.Create,box2d.b2EdgeAndPolygonContact.Destroy,box2d.b2ShapeType.e_edgeShape,box2d.b2ShapeType.e_polygonShape);this.AddType(box2d.b2ChainAndCircleContact.Create,box2d.b2ChainAndCircleContact.Destroy,box2d.b2ShapeType.e_chainShape,box2d.b2ShapeType.e_circleShape);this.AddType(box2d.b2ChainAndPolygonContact.Create,box2d.b2ChainAndPolygonContact.Destroy,box2d.b2ShapeType.e_chainShape,box2d.b2ShapeType.e_polygonShape)}
box2d.b2ContactFactory.prototype.Create=function(fixtureA,indexA,fixtureB,indexB){var type1=fixtureA.GetType();var type2=fixtureB.GetType();if(box2d.ENABLE_ASSERTS){box2d.b2Assert(0<=type1&&type1<box2d.b2ShapeType.e_shapeTypeCount)}
if(box2d.ENABLE_ASSERTS){box2d.b2Assert(0<=type2&&type2<box2d.b2ShapeType.e_shapeTypeCount)}
var reg=this.m_registers[type1][type2];var createFcn=reg.createFcn;if(createFcn!==null){if(reg.primary){var c=createFcn(this.m_allocator);c.Reset(fixtureA,indexA,fixtureB,indexB);return c}
else{var c=createFcn(this.m_allocator);c.Reset(fixtureB,indexB,fixtureA,indexA);return c}}
else{return null}}
box2d.b2ContactFactory.prototype.Destroy=function(contact){var fixtureA=contact.m_fixtureA;var fixtureB=contact.m_fixtureB;if(contact.m_manifold.pointCount>0&&fixtureA.IsSensor()===!1&&fixtureB.IsSensor()===!1){fixtureA.GetBody().SetAwake(!0);fixtureB.GetBody().SetAwake(!0)}
var typeA=fixtureA.GetType();var typeB=fixtureB.GetType();if(box2d.ENABLE_ASSERTS){box2d.b2Assert(0<=typeA&&typeB<box2d.b2ShapeType.e_shapeTypeCount)}
if(box2d.ENABLE_ASSERTS){box2d.b2Assert(0<=typeA&&typeB<box2d.b2ShapeType.e_shapeTypeCount)}
var reg=this.m_registers[typeA][typeB];var destroyFcn=reg.destroyFcn;destroyFcn(contact,this.m_allocator)}
goog.provide('box2d.b2GrowableStack');goog.require('box2d.b2Settings');box2d.b2GrowableStack=function(N){this.m_stack=new Array(N)}
box2d.b2GrowableStack.prototype.m_stack=null;box2d.b2GrowableStack.prototype.m_count=0;box2d.b2GrowableStack.prototype.Reset=function(){this.m_count=0;return this}
box2d.b2GrowableStack.prototype.Push=function(element){this.m_stack[this.m_count]=element;++this.m_count}
box2d.b2GrowableStack.prototype.Pop=function(){if(box2d.ENABLE_ASSERTS){box2d.b2Assert(this.m_count>0)}
--this.m_count;var element=this.m_stack[this.m_count];this.m_stack[this.m_count]=null;return element}
box2d.b2GrowableStack.prototype.GetCount=function(){return this.m_count}
goog.provide('box2d.b2DynamicTree')
goog.require('box2d.b2Settings');goog.require('box2d.b2Collision');goog.require('box2d.b2GrowableStack');box2d.b2TreeNode=function(id){this.m_id=id||0;this.aabb=new box2d.b2AABB()};box2d.b2TreeNode.prototype.m_id=0;box2d.b2TreeNode.prototype.aabb=null;box2d.b2TreeNode.prototype.userData=null;box2d.b2TreeNode.prototype.parent=null;box2d.b2TreeNode.prototype.child1=null;box2d.b2TreeNode.prototype.child2=null;box2d.b2TreeNode.prototype.height=0;box2d.b2TreeNode.prototype.IsLeaf=function(){return this.child1===null}
box2d.b2DynamicTree=function(){}
box2d.b2DynamicTree.prototype.m_root=null;box2d.b2DynamicTree.prototype.m_freeList=null;box2d.b2DynamicTree.prototype.m_path=0;box2d.b2DynamicTree.prototype.m_insertionCount=0;box2d.b2DynamicTree.s_stack=new box2d.b2GrowableStack(256);box2d.b2DynamicTree.s_r=new box2d.b2Vec2();box2d.b2DynamicTree.s_v=new box2d.b2Vec2();box2d.b2DynamicTree.s_abs_v=new box2d.b2Vec2();box2d.b2DynamicTree.s_segmentAABB=new box2d.b2AABB();box2d.b2DynamicTree.s_subInput=new box2d.b2RayCastInput();box2d.b2DynamicTree.s_combinedAABB=new box2d.b2AABB();box2d.b2DynamicTree.s_aabb=new box2d.b2AABB();box2d.b2DynamicTree.prototype.GetUserData=function(proxy){if(box2d.ENABLE_ASSERTS){box2d.b2Assert(proxy!==null)}
return proxy.userData}
box2d.b2DynamicTree.prototype.GetFatAABB=function(proxy){if(box2d.ENABLE_ASSERTS){box2d.b2Assert(proxy!==null)}
return proxy.aabb}
box2d.b2DynamicTree.prototype.Query=function(callback,aabb){if(this.m_root===null)return;var stack=box2d.b2DynamicTree.s_stack.Reset();stack.Push(this.m_root);while(stack.GetCount()>0){var node=(stack.Pop());if(node===null){continue}
if(node.aabb.TestOverlap(aabb)){if(node.IsLeaf()){var proceed=callback(node);if(proceed===!1){return}}
else{stack.Push(node.child1);stack.Push(node.child2)}}}}
box2d.b2DynamicTree.prototype.RayCast=function(callback,input){if(this.m_root===null)return;var p1=input.p1;var p2=input.p2;var r=box2d.b2SubVV(p2,p1,box2d.b2DynamicTree.s_r);if(box2d.ENABLE_ASSERTS){box2d.b2Assert(r.GetLengthSquared()>0)}
r.Normalize();var v=box2d.b2CrossOneV(r,box2d.b2DynamicTree.s_v);var abs_v=box2d.b2AbsV(v,box2d.b2DynamicTree.s_abs_v);var maxFraction=input.maxFraction;var segmentAABB=box2d.b2DynamicTree.s_segmentAABB;var t_x=p1.x+maxFraction*(p2.x-p1.x);var t_y=p1.y+maxFraction*(p2.y-p1.y);segmentAABB.lowerBound.x=box2d.b2Min(p1.x,t_x);segmentAABB.lowerBound.y=box2d.b2Min(p1.y,t_y);segmentAABB.upperBound.x=box2d.b2Max(p1.x,t_x);segmentAABB.upperBound.y=box2d.b2Max(p1.y,t_y);var stack=box2d.b2DynamicTree.s_stack.Reset();stack.Push(this.m_root);while(stack.GetCount()>0){var node=(stack.Pop());if(node===null){continue}
if(box2d.b2TestOverlapAABB(node.aabb,segmentAABB)===!1){continue}
var c=node.aabb.GetCenter();var h=node.aabb.GetExtents();var separation=box2d.b2Abs(box2d.b2DotVV(v,box2d.b2SubVV(p1,c,box2d.b2Vec2.s_t0)))-box2d.b2DotVV(abs_v,h);if(separation>0){continue}
if(node.IsLeaf()){var subInput=box2d.b2DynamicTree.s_subInput;subInput.p1.Copy(input.p1);subInput.p2.Copy(input.p2);subInput.maxFraction=maxFraction;var value=callback(subInput,node);if(value===0){return}
if(value>0){maxFraction=value;t_x=p1.x+maxFraction*(p2.x-p1.x);t_y=p1.y+maxFraction*(p2.y-p1.y);segmentAABB.lowerBound.x=box2d.b2Min(p1.x,t_x);segmentAABB.lowerBound.y=box2d.b2Min(p1.y,t_y);segmentAABB.upperBound.x=box2d.b2Max(p1.x,t_x);segmentAABB.upperBound.y=box2d.b2Max(p1.y,t_y)}}
else{stack.Push(node.child1);stack.Push(node.child2)}}}
box2d.b2DynamicTree.prototype.AllocateNode=function(){if(this.m_freeList){var node=this.m_freeList;this.m_freeList=node.parent;node.parent=null;node.child1=null;node.child2=null;node.height=0;node.userData=null;return node}
return new box2d.b2TreeNode(box2d.b2DynamicTree.prototype.s_node_id++)}
box2d.b2DynamicTree.prototype.s_node_id=0;box2d.b2DynamicTree.prototype.FreeNode=function(node){node.parent=this.m_freeList;node.height=-1;this.m_freeList=node}
box2d.b2DynamicTree.prototype.CreateProxy=function(aabb,userData){var node=this.AllocateNode();var r_x=box2d.b2_aabbExtension;var r_y=box2d.b2_aabbExtension;node.aabb.lowerBound.x=aabb.lowerBound.x-r_x;node.aabb.lowerBound.y=aabb.lowerBound.y-r_y;node.aabb.upperBound.x=aabb.upperBound.x+r_x;node.aabb.upperBound.y=aabb.upperBound.y+r_y;node.userData=userData;node.height=0;this.InsertLeaf(node);return node}
box2d.b2DynamicTree.prototype.DestroyProxy=function(proxy){if(box2d.ENABLE_ASSERTS){box2d.b2Assert(proxy.IsLeaf())}
this.RemoveLeaf(proxy);this.FreeNode(proxy)}
box2d.b2DynamicTree.prototype.MoveProxy=function(proxy,aabb,displacement){if(box2d.ENABLE_ASSERTS){box2d.b2Assert(proxy.IsLeaf())}
if(proxy.aabb.Contains(aabb)){return !1}
this.RemoveLeaf(proxy);var r_x=box2d.b2_aabbExtension+box2d.b2_aabbMultiplier*(displacement.x>0?displacement.x:(-displacement.x));var r_y=box2d.b2_aabbExtension+box2d.b2_aabbMultiplier*(displacement.y>0?displacement.y:(-displacement.y));proxy.aabb.lowerBound.x=aabb.lowerBound.x-r_x;proxy.aabb.lowerBound.y=aabb.lowerBound.y-r_y;proxy.aabb.upperBound.x=aabb.upperBound.x+r_x;proxy.aabb.upperBound.y=aabb.upperBound.y+r_y;this.InsertLeaf(proxy);return !0}
box2d.b2DynamicTree.prototype.InsertLeaf=function(leaf){++this.m_insertionCount;if(this.m_root===null){this.m_root=leaf;this.m_root.parent=null;return}
var leafAABB=leaf.aabb;var center=leafAABB.GetCenter();var index=this.m_root;var child1;var child2;while(index.IsLeaf()===!1){child1=index.child1;child2=index.child2;var area=index.aabb.GetPerimeter();var combinedAABB=box2d.b2DynamicTree.s_combinedAABB;combinedAABB.Combine2(index.aabb,leafAABB);var combinedArea=combinedAABB.GetPerimeter();var cost=2*combinedArea;var inheritanceCost=2*(combinedArea-area);var cost1;var aabb=box2d.b2DynamicTree.s_aabb;var oldArea;var newArea;if(child1.IsLeaf()){aabb.Combine2(leafAABB,child1.aabb);cost1=aabb.GetPerimeter()+inheritanceCost}
else{aabb.Combine2(leafAABB,child1.aabb);oldArea=child1.aabb.GetPerimeter();newArea=aabb.GetPerimeter();cost1=(newArea-oldArea)+inheritanceCost}
var cost2;if(child2.IsLeaf()){aabb.Combine2(leafAABB,child2.aabb);cost2=aabb.GetPerimeter()+inheritanceCost}
else{aabb.Combine2(leafAABB,child2.aabb);oldArea=child2.aabb.GetPerimeter();newArea=aabb.GetPerimeter();cost2=newArea-oldArea+inheritanceCost}
if(cost<cost1&&cost<cost2){break}
if(cost1<cost2){index=child1}
else{index=child2}}
var sibling=index;var oldParent=sibling.parent;var newParent=this.AllocateNode();newParent.parent=oldParent;newParent.userData=null;newParent.aabb.Combine2(leafAABB,sibling.aabb);newParent.height=sibling.height+1;if(oldParent){if(oldParent.child1===sibling){oldParent.child1=newParent}
else{oldParent.child2=newParent}
newParent.child1=sibling;newParent.child2=leaf;sibling.parent=newParent;leaf.parent=newParent}
else{newParent.child1=sibling;newParent.child2=leaf;sibling.parent=newParent;leaf.parent=newParent;this.m_root=newParent}
index=leaf.parent;while(index!==null){index=this.Balance(index);child1=index.child1;child2=index.child2;if(box2d.ENABLE_ASSERTS){box2d.b2Assert(child1!==null)}
if(box2d.ENABLE_ASSERTS){box2d.b2Assert(child2!==null)}
index.height=1+box2d.b2Max(child1.height,child2.height);index.aabb.Combine2(child1.aabb,child2.aabb);index=index.parent}}
box2d.b2DynamicTree.prototype.RemoveLeaf=function(leaf){if(leaf===this.m_root){this.m_root=null;return}
var parent=leaf.parent;var grandParent=parent.parent;var sibling;if(parent.child1===leaf){sibling=parent.child2}
else{sibling=parent.child1}
if(grandParent){if(grandParent.child1===parent){grandParent.child1=sibling}
else{grandParent.child2=sibling}
sibling.parent=grandParent;this.FreeNode(parent);var index=grandParent;while(index){index=this.Balance(index);var child1=index.child1;var child2=index.child2;index.aabb.Combine2(child1.aabb,child2.aabb);index.height=1+box2d.b2Max(child1.height,child2.height);index=index.parent}}
else{this.m_root=sibling;sibling.parent=null;this.FreeNode(parent)}}
box2d.b2DynamicTree.prototype.Balance=function(A){if(box2d.ENABLE_ASSERTS){box2d.b2Assert(A!==null)}
if(A.IsLeaf()||A.height<2){return A}
var B=A.child1;var C=A.child2;var balance=C.height-B.height;if(balance>1){var F=C.child1;var G=C.child2;C.child1=A;C.parent=A.parent;A.parent=C;if(C.parent!==null){if(C.parent.child1===A){C.parent.child1=C}
else{if(box2d.ENABLE_ASSERTS){box2d.b2Assert(C.parent.child2===A)}
C.parent.child2=C}}
else{this.m_root=C}
if(F.height>G.height){C.child2=F;A.child2=G;G.parent=A;A.aabb.Combine2(B.aabb,G.aabb);C.aabb.Combine2(A.aabb,F.aabb);A.height=1+box2d.b2Max(B.height,G.height);C.height=1+box2d.b2Max(A.height,F.height)}
else{C.child2=G;A.child2=F;F.parent=A;A.aabb.Combine2(B.aabb,F.aabb);C.aabb.Combine2(A.aabb,G.aabb);A.height=1+box2d.b2Max(B.height,F.height);C.height=1+box2d.b2Max(A.height,G.height)}
return C}
if(balance<-1){var D=B.child1;var E=B.child2;B.child1=A;B.parent=A.parent;A.parent=B;if(B.parent!==null){if(B.parent.child1===A){B.parent.child1=B}
else{if(box2d.ENABLE_ASSERTS){box2d.b2Assert(B.parent.child2===A)}
B.parent.child2=B}}
else{this.m_root=B}
if(D.height>E.height){B.child2=D;A.child1=E;E.parent=A;A.aabb.Combine2(C.aabb,E.aabb);B.aabb.Combine2(A.aabb,D.aabb);A.height=1+box2d.b2Max(C.height,E.height);B.height=1+box2d.b2Max(A.height,D.height)}
else{B.child2=E;A.child1=D;D.parent=A;A.aabb.Combine2(C.aabb,D.aabb);B.aabb.Combine2(A.aabb,E.aabb);A.height=1+box2d.b2Max(C.height,D.height);B.height=1+box2d.b2Max(A.height,E.height)}
return B}
return A}
box2d.b2DynamicTree.prototype.GetHeight=function(){if(this.m_root===null){return 0}
return this.m_root.height}
box2d.b2DynamicTree.prototype.GetAreaRatio=function(){if(this.m_root===null){return 0}
var root=this.m_root;var rootArea=root.aabb.GetPerimeter();var GetAreaNode=function(node){if(node===null){return 0}
if(node.IsLeaf()){return 0}
var area=node.aabb.GetPerimeter();area+=GetAreaNode(node.child1);area+=GetAreaNode(node.child2);return area}
var totalArea=GetAreaNode(this.m_root);return totalArea/rootArea}
box2d.b2DynamicTree.prototype.ComputeHeightNode=function(node){if(node.IsLeaf()){return 0}
var height1=this.ComputeHeightNode(node.child1);var height2=this.ComputeHeightNode(node.child2);return 1+box2d.b2Max(height1,height2)}
box2d.b2DynamicTree.prototype.ComputeHeight=function(){var height=this.ComputeHeightNode(this.m_root);return height}
box2d.b2DynamicTree.prototype.ValidateStructure=function(index){if(index===null){return}
if(index===this.m_root){if(box2d.ENABLE_ASSERTS){box2d.b2Assert(index.parent===null)}}
var node=index;var child1=node.child1;var child2=node.child2;if(node.IsLeaf()){if(box2d.ENABLE_ASSERTS){box2d.b2Assert(child1===null)}
if(box2d.ENABLE_ASSERTS){box2d.b2Assert(child2===null)}
if(box2d.ENABLE_ASSERTS){box2d.b2Assert(node.height===0)}
return}
if(box2d.ENABLE_ASSERTS){box2d.b2Assert(child1.parent===index)}
if(box2d.ENABLE_ASSERTS){box2d.b2Assert(child2.parent===index)}
this.ValidateStructure(child1);this.ValidateStructure(child2)}
box2d.b2DynamicTree.prototype.ValidateMetrics=function(index){if(index===null){return}
var node=index;var child1=node.child1;var child2=node.child2;if(node.IsLeaf()){if(box2d.ENABLE_ASSERTS){box2d.b2Assert(child1===null)}
if(box2d.ENABLE_ASSERTS){box2d.b2Assert(child2===null)}
if(box2d.ENABLE_ASSERTS){box2d.b2Assert(node.height===0)}
return}
var height1=child1.height;var height2=child2.height;var height;height=1+box2d.b2Max(height1,height2);if(box2d.ENABLE_ASSERTS){box2d.b2Assert(node.height===height)}
var aabb=box2d.b2DynamicTree.s_aabb;aabb.Combine2(child1.aabb,child2.aabb);if(box2d.ENABLE_ASSERTS){box2d.b2Assert(aabb.lowerBound===node.aabb.lowerBound)}
if(box2d.ENABLE_ASSERTS){box2d.b2Assert(aabb.upperBound===node.aabb.upperBound)}
this.ValidateMetrics(child1);this.ValidateMetrics(child2)}
box2d.b2DynamicTree.prototype.Validate=function(){this.ValidateStructure(this.m_root);this.ValidateMetrics(this.m_root);var freeCount=0;var freeIndex=this.m_freeList;while(freeIndex!==null){freeIndex=freeIndex.parent;++freeCount}
if(box2d.ENABLE_ASSERTS){box2d.b2Assert(this.GetHeight()===this.ComputeHeight())}}
box2d.b2DynamicTree.prototype.GetMaxBalance=function(){var GetMaxBalanceNode=function(node,maxBalance){if(node===null){return maxBalance}
if(node.height<=1){return maxBalance}
if(box2d.ENABLE_ASSERTS){box2d.b2Assert(node.IsLeaf()===!1)}
var child1=node.child1;var child2=node.child2;var balance=box2d.b2Abs(child2.height-child1.height);return box2d.b2Max(maxBalance,balance)}
var maxBalance=GetMaxBalanceNode(this.m_root,0);return maxBalance}
box2d.b2DynamicTree.prototype.RebuildBottomUp=function(){this.Validate()}
box2d.b2DynamicTree.prototype.ShiftOrigin=function(newOrigin){var ShiftOriginNode=function(node,newOrigin){if(node===null){return}
if(node.height<=1){return}
if(box2d.ENABLE_ASSERTS){box2d.b2Assert(node.IsLeaf()===!1)}
var child1=node.child1;var child2=node.child2;ShiftOriginNode(child1,newOrigin);ShiftOriginNode(child2,newOrigin);node.aabb.lowerBound.SelfSub(newOrigin);node.aabb.upperBound.SelfSub(newOrigin)}
ShiftOriginNode(this.m_root,newOrigin)}
goog.provide('box2d.b2BroadPhase')
goog.require('box2d.b2Settings');goog.require('box2d.b2DynamicTree')
box2d.b2Pair=function(){};box2d.b2Pair.prototype.proxyA=null;box2d.b2Pair.prototype.proxyB=null;box2d.b2BroadPhase=function(){this.m_tree=new box2d.b2DynamicTree();this.m_moveBuffer=new Array();this.m_pairBuffer=new Array()};box2d.b2BroadPhase.prototype.m_tree=null;box2d.b2BroadPhase.prototype.m_proxyCount=0;box2d.b2BroadPhase.prototype.m_moveCount=0;box2d.b2BroadPhase.prototype.m_moveBuffer=null;box2d.b2BroadPhase.prototype.m_pairCount=0;box2d.b2BroadPhase.prototype.m_pairBuffer=null;box2d.b2BroadPhase.prototype.CreateProxy=function(aabb,userData){var proxy=this.m_tree.CreateProxy(aabb,userData);++this.m_proxyCount;this.BufferMove(proxy);return proxy}
box2d.b2BroadPhase.prototype.DestroyProxy=function(proxy){this.UnBufferMove(proxy);--this.m_proxyCount;this.m_tree.DestroyProxy(proxy)}
box2d.b2BroadPhase.prototype.MoveProxy=function(proxy,aabb,displacement){var buffer=this.m_tree.MoveProxy(proxy,aabb,displacement);if(buffer){this.BufferMove(proxy)}}
box2d.b2BroadPhase.prototype.TouchProxy=function(proxy){this.BufferMove(proxy)}
box2d.b2BroadPhase.prototype.GetFatAABB=function(proxy){return this.m_tree.GetFatAABB(proxy)}
box2d.b2BroadPhase.prototype.GetUserData=function(proxy){return this.m_tree.GetUserData(proxy)}
box2d.b2BroadPhase.prototype.TestOverlap=function(proxyA,proxyB){var aabbA=this.m_tree.GetFatAABB(proxyA);var aabbB=this.m_tree.GetFatAABB(proxyB);return box2d.b2TestOverlapAABB(aabbA,aabbB)}
box2d.b2BroadPhase.prototype.GetProxyCount=function(){return this.m_proxyCount}
box2d.b2BroadPhase.prototype.GetTreeHeight=function(){return this.m_tree.GetHeight()}
box2d.b2BroadPhase.prototype.GetTreeBalance=function(){return this.m_tree.GetMaxBalance()}
box2d.b2BroadPhase.prototype.GetTreeQuality=function(){return this.m_tree.GetAreaRatio()}
box2d.b2BroadPhase.prototype.ShiftOrigin=function(newOrigin){this.m_tree.ShiftOrigin(newOrigin)}
box2d.b2BroadPhase.prototype.UpdatePairs=function(contactManager){this.m_pairCount=0;for(var i=0;i<this.m_moveCount;++i){var queryProxy=this.m_moveBuffer[i];if(queryProxy===null){continue}
var that=this;var QueryCallback=function(proxy){if(proxy.m_id===queryProxy.m_id){return !0}
if(that.m_pairCount===that.m_pairBuffer.length){that.m_pairBuffer[that.m_pairCount]=new box2d.b2Pair()}
var pair=that.m_pairBuffer[that.m_pairCount];if(proxy.m_id<queryProxy.m_id){pair.proxyA=proxy;pair.proxyB=queryProxy}
else{pair.proxyA=queryProxy;pair.proxyB=proxy}
++that.m_pairCount;return !0};var fatAABB=this.m_tree.GetFatAABB(queryProxy);this.m_tree.Query(QueryCallback,fatAABB)}
this.m_moveCount=0;this.m_pairBuffer.length=this.m_pairCount;this.m_pairBuffer.sort(box2d.b2PairLessThan);var i=0;while(i<this.m_pairCount){var primaryPair=this.m_pairBuffer[i];var userDataA=this.m_tree.GetUserData(primaryPair.proxyA);var userDataB=this.m_tree.GetUserData(primaryPair.proxyB);contactManager.AddPair(userDataA,userDataB);++i;while(i<this.m_pairCount){var pair=this.m_pairBuffer[i];if(pair.proxyA.m_id!==primaryPair.proxyA.m_id||pair.proxyB.m_id!==primaryPair.proxyB.m_id){break}
++i}}}
box2d.b2BroadPhase.prototype.Query=function(callback,aabb){this.m_tree.Query(callback,aabb)}
box2d.b2BroadPhase.prototype.RayCast=function(callback,input){this.m_tree.RayCast(callback,input)}
box2d.b2BroadPhase.prototype.BufferMove=function(proxy){this.m_moveBuffer[this.m_moveCount]=proxy;++this.m_moveCount}
box2d.b2BroadPhase.prototype.UnBufferMove=function(proxy){var i=this.m_moveBuffer.indexOf(proxy);this.m_moveBuffer[i]=null}
box2d.b2PairLessThan=function(pair1,pair2){if(pair1.proxyA.m_id===pair2.proxyA.m_id){return pair1.proxyB.m_id-pair2.proxyB.m_id}
return pair1.proxyA.m_id-pair2.proxyA.m_id}
goog.provide('box2d.b2ContactManager');goog.require('box2d.b2Settings');goog.require('box2d.b2Math');goog.require('box2d.b2Collision');goog.require('box2d.b2BroadPhase');goog.require('box2d.b2ContactFactory');box2d.b2ContactManager=function(){this.m_broadPhase=new box2d.b2BroadPhase();this.m_contactFactory=new box2d.b2ContactFactory(this.m_allocator)}
box2d.b2ContactManager.prototype.m_broadPhase=null;box2d.b2ContactManager.prototype.m_contactList=null;box2d.b2ContactManager.prototype.m_contactCount=0;box2d.b2ContactManager.prototype.m_contactFilter=box2d.b2ContactFilter.b2_defaultFilter;box2d.b2ContactManager.prototype.m_contactListener=box2d.b2ContactListener.b2_defaultListener;box2d.b2ContactManager.prototype.m_allocator=null;box2d.b2ContactManager.prototype.m_contactFactory=null;box2d.b2ContactManager.prototype.Destroy=function(c){var fixtureA=c.GetFixtureA();var fixtureB=c.GetFixtureB();var bodyA=fixtureA.GetBody();var bodyB=fixtureB.GetBody();if(this.m_contactListener&&c.IsTouching()){this.m_contactListener.EndContact(c)}
if(c.m_prev){c.m_prev.m_next=c.m_next}
if(c.m_next){c.m_next.m_prev=c.m_prev}
if(c===this.m_contactList){this.m_contactList=c.m_next}
if(c.m_nodeA.prev){c.m_nodeA.prev.next=c.m_nodeA.next}
if(c.m_nodeA.next){c.m_nodeA.next.prev=c.m_nodeA.prev}
if(c.m_nodeA===bodyA.m_contactList){bodyA.m_contactList=c.m_nodeA.next}
if(c.m_nodeB.prev){c.m_nodeB.prev.next=c.m_nodeB.next}
if(c.m_nodeB.next){c.m_nodeB.next.prev=c.m_nodeB.prev}
if(c.m_nodeB===bodyB.m_contactList){bodyB.m_contactList=c.m_nodeB.next}
this.m_contactFactory.Destroy(c);--this.m_contactCount}
box2d.b2ContactManager.prototype.Collide=function(){var c=this.m_contactList;while(c){var fixtureA=c.GetFixtureA();var fixtureB=c.GetFixtureB();var indexA=c.GetChildIndexA();var indexB=c.GetChildIndexB();var bodyA=fixtureA.GetBody();var bodyB=fixtureB.GetBody();if(c.m_flags&box2d.b2ContactFlag.e_filterFlag){if(bodyB.ShouldCollide(bodyA)===!1){var cNuke=c;c=cNuke.m_next;this.Destroy(cNuke);continue}
if(this.m_contactFilter&&this.m_contactFilter.ShouldCollide(fixtureA,fixtureB)===!1){cNuke=c;c=cNuke.m_next;this.Destroy(cNuke);continue}
c.m_flags&=~box2d.b2ContactFlag.e_filterFlag}
var activeA=bodyA.IsAwake()&&bodyA.m_type!==box2d.b2BodyType.b2_staticBody;var activeB=bodyB.IsAwake()&&bodyB.m_type!==box2d.b2BodyType.b2_staticBody;if(activeA===!1&&activeB===!1){c=c.m_next;continue}
var proxyA=fixtureA.m_proxies[indexA].proxy;var proxyB=fixtureB.m_proxies[indexB].proxy;var overlap=this.m_broadPhase.TestOverlap(proxyA,proxyB);if(overlap===!1){cNuke=c;c=cNuke.m_next;this.Destroy(cNuke);continue}
c.Update(this.m_contactListener);c=c.m_next}}
box2d.b2ContactManager.prototype.FindNewContacts=function(){this.m_broadPhase.UpdatePairs(this)}
box2d.b2ContactManager.prototype.AddPair=function(proxyUserDataA,proxyUserDataB){if(box2d.ENABLE_ASSERTS){box2d.b2Assert(proxyUserDataA instanceof box2d.b2FixtureProxy)}
if(box2d.ENABLE_ASSERTS){box2d.b2Assert(proxyUserDataB instanceof box2d.b2FixtureProxy)}
var proxyA=proxyUserDataA;var proxyB=proxyUserDataB;var fixtureA=proxyA.fixture;var fixtureB=proxyB.fixture;var indexA=proxyA.childIndex;var indexB=proxyB.childIndex;var bodyA=fixtureA.GetBody();var bodyB=fixtureB.GetBody();if(bodyA===bodyB){return}
var edge=bodyB.GetContactList();while(edge){if(edge.other===bodyA){var fA=edge.contact.GetFixtureA();var fB=edge.contact.GetFixtureB();var iA=edge.contact.GetChildIndexA();var iB=edge.contact.GetChildIndexB();if(fA===fixtureA&&fB===fixtureB&&iA===indexA&&iB===indexB){return}
if(fA===fixtureB&&fB===fixtureA&&iA===indexB&&iB===indexA){return}}
edge=edge.next}
if(bodyB.ShouldCollide(bodyA)===!1){return}
if(this.m_contactFilter&&this.m_contactFilter.ShouldCollide(fixtureA,fixtureB)===!1){return}
var c=this.m_contactFactory.Create(fixtureA,indexA,fixtureB,indexB);if(c===null){return}
fixtureA=c.GetFixtureA();fixtureB=c.GetFixtureB();indexA=c.GetChildIndexA();indexB=c.GetChildIndexB();bodyA=fixtureA.m_body;bodyB=fixtureB.m_body;c.m_prev=null;c.m_next=this.m_contactList;if(this.m_contactList!==null){this.m_contactList.m_prev=c}
this.m_contactList=c;c.m_nodeA.contact=c;c.m_nodeA.other=bodyB;c.m_nodeA.prev=null;c.m_nodeA.next=bodyA.m_contactList;if(bodyA.m_contactList!==null){bodyA.m_contactList.prev=c.m_nodeA}
bodyA.m_contactList=c.m_nodeA;c.m_nodeB.contact=c;c.m_nodeB.other=bodyA;c.m_nodeB.prev=null;c.m_nodeB.next=bodyB.m_contactList;if(bodyB.m_contactList!==null){bodyB.m_contactList.prev=c.m_nodeB}
bodyB.m_contactList=c.m_nodeB;if(fixtureA.IsSensor()===!1&&fixtureB.IsSensor()===!1){bodyA.SetAwake(!0);bodyB.SetAwake(!0)}
++this.m_contactCount}
goog.provide('box2d.b2JointFactory');goog.require('box2d.b2Settings');goog.require('box2d.b2Math');goog.require('box2d.b2Joint');box2d.b2JointFactory.Create=function(def,allocator){var joint=null;switch(def.type){case box2d.b2JointType.e_distanceJoint:{joint=new box2d.b2DistanceJoint((def instanceof box2d.b2DistanceJointDef?def:null))}
break;case box2d.b2JointType.e_mouseJoint:{joint=new box2d.b2MouseJoint((def instanceof box2d.b2MouseJointDef?def:null))}
break;case box2d.b2JointType.e_prismaticJoint:{joint=new box2d.b2PrismaticJoint((def instanceof box2d.b2PrismaticJointDef?def:null))}
break;case box2d.b2JointType.e_revoluteJoint:{joint=new box2d.b2RevoluteJoint((def instanceof box2d.b2RevoluteJointDef?def:null))}
break;case box2d.b2JointType.e_pulleyJoint:{joint=new box2d.b2PulleyJoint((def instanceof box2d.b2PulleyJointDef?def:null))}
break;case box2d.b2JointType.e_gearJoint:{joint=new box2d.b2GearJoint((def instanceof box2d.b2GearJointDef?def:null))}
break;case box2d.b2JointType.e_wheelJoint:{joint=new box2d.b2WheelJoint((def instanceof box2d.b2WheelJointDef?def:null))}
break;case box2d.b2JointType.e_weldJoint:{joint=new box2d.b2WeldJoint((def instanceof box2d.b2WeldJointDef?def:null))}
break;case box2d.b2JointType.e_frictionJoint:{joint=new box2d.b2FrictionJoint((def instanceof box2d.b2FrictionJointDef?def:null))}
break;case box2d.b2JointType.e_ropeJoint:{joint=new box2d.b2RopeJoint((def instanceof box2d.b2RopeJointDef?def:null))}
break;case box2d.b2JointType.e_motorJoint:{joint=new box2d.b2MotorJoint((def instanceof box2d.b2MotorJointDef?def:null))}
break;case box2d.b2JointType.e_areaJoint:{joint=new box2d.b2AreaJoint((def instanceof box2d.b2AreaJointDef?def:null))}
break;default:if(box2d.ENABLE_ASSERTS){box2d.b2Assert(!1)}
break}
return joint}
box2d.b2JointFactory.Destroy=function(joint,allocator){}
goog.provide('box2d.b2Draw');goog.require('box2d.b2Settings');box2d.b2Color=function(rr,gg,bb){this.r=rr;this.g=gg;this.b=bb}
box2d.b2Color.prototype.r=0.5;box2d.b2Color.prototype.g=0.5;box2d.b2Color.prototype.b=0.5;box2d.b2Color.prototype.SetRGB=function(rr,gg,bb){this.r=rr;this.g=gg;this.b=bb;return this}
box2d.b2Color.prototype.MakeStyleString=function(alpha){var r=Math.round(Math.max(0,Math.min(255,this.r*255)));var g=Math.round(Math.max(0,Math.min(255,this.g*255)));var b=Math.round(Math.max(0,Math.min(255,this.b*255)));var a=(typeof(alpha)==='undefined')?(1.0):(Math.max(0,Math.min(1,alpha)));return box2d.b2Color.MakeStyleString(r,g,b,a)}
box2d.b2Color.MakeStyleString=function(r,g,b,a){if(a<1){return 'rgba('+r+','+g+','+b+','+a+')'}
else{return 'rgb('+r+','+g+','+b+')'}}
box2d.b2Color.RED=new box2d.b2Color(1,0,0);box2d.b2Color.GREEN=new box2d.b2Color(0,1,0);box2d.b2Color.BLUE=new box2d.b2Color(0,0,1);box2d.b2DrawFlags={e_none:0,e_shapeBit:0x0001,e_jointBit:0x0002,e_aabbBit:0x0004,e_pairBit:0x0008,e_centerOfMassBit:0x0010,e_controllerBit:0x0020,e_all:0x003f};goog.exportProperty(box2d.b2DrawFlags,'e_none',box2d.b2DrawFlags.e_none);goog.exportProperty(box2d.b2DrawFlags,'e_shapeBit',box2d.b2DrawFlags.e_shapeBit);goog.exportProperty(box2d.b2DrawFlags,'e_jointBit',box2d.b2DrawFlags.e_jointBit);goog.exportProperty(box2d.b2DrawFlags,'e_aabbBit',box2d.b2DrawFlags.e_aabbBit);goog.exportProperty(box2d.b2DrawFlags,'e_pairBit',box2d.b2DrawFlags.e_pairBit);goog.exportProperty(box2d.b2DrawFlags,'e_centerOfMassBit',box2d.b2DrawFlags.e_centerOfMassBit);goog.exportProperty(box2d.b2DrawFlags,'e_controllerBit',box2d.b2DrawFlags.e_controllerBit);goog.exportProperty(box2d.b2DrawFlags,'e_all',box2d.b2DrawFlags.e_all);box2d.b2Draw=function(){}
box2d.b2Draw.prototype.m_drawFlags=box2d.b2DrawFlags.e_none;box2d.b2Draw.prototype.SetFlags=function(flags){this.m_drawFlags=flags}
box2d.b2Draw.prototype.GetFlags=function(){return this.m_drawFlags}
box2d.b2Draw.prototype.AppendFlags=function(flags){this.m_drawFlags|=flags}
box2d.b2Draw.prototype.ClearFlags=function(flags){this.m_drawFlags&=~flags}
box2d.b2Draw.prototype.PushTransform=function(xf){}
box2d.b2Draw.prototype.PopTransform=function(xf){}
box2d.b2Draw.prototype.DrawPolygon=function(vertices,vertexCount,color){}
box2d.b2Draw.prototype.DrawSolidPolygon=function(vertices,vertexCount,color){}
box2d.b2Draw.prototype.DrawCircle=function(center,radius,color){}
box2d.b2Draw.prototype.DrawSolidCircle=function(center,radius,axis,color){}
box2d.b2Draw.prototype.DrawSegment=function(p1,p2,color){}
box2d.b2Draw.prototype.DrawTransform=function(xf){}
goog.provide('box2d.b2Fixture');goog.require('box2d.b2Settings');goog.require('box2d.b2Collision');goog.require('box2d.b2Shape');box2d.b2Filter=function(){};box2d.b2Filter.prototype.categoryBits=0x0001;box2d.b2Filter.prototype.maskBits=0xFFFF;box2d.b2Filter.prototype.groupIndex=0;box2d.b2Filter.prototype.Clone=function(){return new box2d.b2Filter().Copy(this)}
box2d.b2Filter.prototype.Copy=function(other){if(box2d.ENABLE_ASSERTS){box2d.b2Assert(this!==other)}
this.categoryBits=other.categoryBits;this.maskBits=other.maskBits;this.groupIndex=other.groupIndex;return this}
box2d.b2FixtureDef=function(){this.filter=new box2d.b2Filter()}
box2d.b2FixtureDef.prototype.shape=null;box2d.b2FixtureDef.prototype.userData=null;box2d.b2FixtureDef.prototype.friction=0.2;box2d.b2FixtureDef.prototype.restitution=0;box2d.b2FixtureDef.prototype.density=0;box2d.b2FixtureDef.prototype.isSensor=!1;box2d.b2FixtureDef.prototype.filter=null;box2d.b2FixtureProxy=function(){this.aabb=new box2d.b2AABB()};box2d.b2FixtureProxy.prototype.aabb=null;box2d.b2FixtureProxy.prototype.fixture=null;box2d.b2FixtureProxy.prototype.childIndex=0;box2d.b2FixtureProxy.prototype.proxy=null;box2d.b2FixtureProxy.MakeArray=function(length){return box2d.b2MakeArray(length,function(i){return new box2d.b2FixtureProxy()})}
box2d.b2Fixture=function(){this.m_proxyCount=0;this.m_filter=new box2d.b2Filter()}
box2d.b2Fixture.prototype.m_density=0;box2d.b2Fixture.prototype.m_next=null;box2d.b2Fixture.prototype.m_body=null;box2d.b2Fixture.prototype.m_shape=null;box2d.b2Fixture.prototype.m_friction=0;box2d.b2Fixture.prototype.m_restitution=0;box2d.b2Fixture.prototype.m_proxies=null;box2d.b2Fixture.prototype.m_proxyCount=0;box2d.b2Fixture.prototype.m_filter=null;box2d.b2Fixture.prototype.m_isSensor=!1;box2d.b2Fixture.prototype.m_userData=null;box2d.b2Fixture.prototype.GetType=function(){return this.m_shape.GetType()}
box2d.b2Fixture.prototype.GetShape=function(){return this.m_shape}
box2d.b2Fixture.prototype.IsSensor=function(){return this.m_isSensor}
box2d.b2Fixture.prototype.GetFilterData=function(){return this.m_filter}
box2d.b2Fixture.prototype.GetUserData=function(){return this.m_userData}
box2d.b2Fixture.prototype.SetUserData=function(data){this.m_userData=data}
box2d.b2Fixture.prototype.GetBody=function(){return this.m_body}
box2d.b2Fixture.prototype.GetNext=function(){return this.m_next}
box2d.b2Fixture.prototype.SetDensity=function(density){this.m_density=density}
box2d.b2Fixture.prototype.GetDensity=function(){return this.m_density}
box2d.b2Fixture.prototype.GetFriction=function(){return this.m_friction}
box2d.b2Fixture.prototype.SetFriction=function(friction){this.m_friction=friction}
box2d.b2Fixture.prototype.GetRestitution=function(){return this.m_restitution}
box2d.b2Fixture.prototype.SetRestitution=function(restitution){this.m_restitution=restitution}
box2d.b2Fixture.prototype.TestPoint=function(p){return this.m_shape.TestPoint(this.m_body.GetTransform(),p)}
box2d.b2Fixture.prototype.RayCast=function(output,input,childIndex){return this.m_shape.RayCast(output,input,this.m_body.GetTransform(),childIndex)}
box2d.b2Fixture.prototype.GetMassData=function(massData){massData=massData||new box2d.b2MassData();this.m_shape.ComputeMass(massData,this.m_density);return massData}
box2d.b2Fixture.prototype.GetAABB=function(childIndex){if(box2d.ENABLE_ASSERTS){box2d.b2Assert(0<=childIndex&&childIndex<this.m_proxyCount)}
return this.m_proxies[childIndex].aabb}
box2d.b2Fixture.prototype.Create=function(body,def){this.m_userData=def.userData;this.m_friction=def.friction;this.m_restitution=def.restitution;this.m_body=body;this.m_next=null;this.m_filter.Copy(def.filter);this.m_isSensor=def.isSensor;this.m_shape=def.shape.Clone();this.m_proxies=box2d.b2FixtureProxy.MakeArray(this.m_shape.GetChildCount());this.m_proxyCount=0;this.m_density=def.density}
box2d.b2Fixture.prototype.Destroy=function(){if(box2d.ENABLE_ASSERTS){box2d.b2Assert(this.m_proxyCount===0)}
this.m_shape=null}
box2d.b2Fixture.prototype.CreateProxies=function(broadPhase,xf){if(box2d.ENABLE_ASSERTS){box2d.b2Assert(this.m_proxyCount===0)}
this.m_proxyCount=this.m_shape.GetChildCount();for(var i=0;i<this.m_proxyCount;++i){var proxy=this.m_proxies[i];this.m_shape.ComputeAABB(proxy.aabb,xf,i);proxy.proxy=broadPhase.CreateProxy(proxy.aabb,proxy);proxy.fixture=this;proxy.childIndex=i}}
box2d.b2Fixture.prototype.DestroyProxies=function(broadPhase){for(var i=0;i<this.m_proxyCount;++i){var proxy=this.m_proxies[i];broadPhase.DestroyProxy(proxy.proxy);proxy.proxy=null}
this.m_proxyCount=0}
box2d.b2Fixture.prototype.Synchronize=function(broadPhase,transform1,transform2){if(this.m_proxyCount===0){return}
for(var i=0;i<this.m_proxyCount;++i){var proxy=this.m_proxies[i];var aabb1=box2d.b2Fixture.prototype.Synchronize.s_aabb1;var aabb2=box2d.b2Fixture.prototype.Synchronize.s_aabb2;this.m_shape.ComputeAABB(aabb1,transform1,i);this.m_shape.ComputeAABB(aabb2,transform2,i);proxy.aabb.Combine2(aabb1,aabb2);var displacement=box2d.b2SubVV(transform2.p,transform1.p,box2d.b2Fixture.prototype.Synchronize.s_displacement);broadPhase.MoveProxy(proxy.proxy,proxy.aabb,displacement)}}
box2d.b2Fixture.prototype.Synchronize.s_aabb1=new box2d.b2AABB();box2d.b2Fixture.prototype.Synchronize.s_aabb2=new box2d.b2AABB();box2d.b2Fixture.prototype.Synchronize.s_displacement=new box2d.b2Vec2();box2d.b2Fixture.prototype.SetFilterData=function(filter){this.m_filter.Copy(filter);this.Refilter()}
box2d.b2Fixture.prototype.Refilter=function(){if(this.m_body){return}
var edge=this.m_body.GetContactList();while(edge){var contact=edge.contact;var fixtureA=contact.GetFixtureA();var fixtureB=contact.GetFixtureB();if(fixtureA===this||fixtureB===this){contact.FlagForFiltering()}
edge=edge.next}
var world=this.m_body.GetWorld();if(world===null){return}
var broadPhase=world.m_contactManager.m_broadPhase;for(var i=0;i<this.m_proxyCount;++i){broadPhase.TouchProxy(this.m_proxies[i].proxy)}}
box2d.b2Fixture.prototype.SetSensor=function(sensor){if(sensor!==this.m_isSensor){this.m_body.SetAwake(!0);this.m_isSensor=sensor}}
box2d.b2Fixture.prototype.Dump=function(bodyIndex){if(box2d.DEBUG){box2d.b2Log("    /*box2d.b2FixtureDef*/ var fd = new box2d.b2FixtureDef();\n");box2d.b2Log("    fd.friction = %.15f;\n",this.m_friction);box2d.b2Log("    fd.restitution = %.15f;\n",this.m_restitution);box2d.b2Log("    fd.density = %.15f;\n",this.m_density);box2d.b2Log("    fd.isSensor = %s;\n",(this.m_isSensor)?('true'):('false'));box2d.b2Log("    fd.filter.categoryBits = %d;\n",this.m_filter.categoryBits);box2d.b2Log("    fd.filter.maskBits = %d;\n",this.m_filter.maskBits);box2d.b2Log("    fd.filter.groupIndex = %d;\n",this.m_filter.groupIndex);this.m_shape.Dump();box2d.b2Log("\n");box2d.b2Log("    fd.shape = shape;\n");box2d.b2Log("\n");box2d.b2Log("    bodies[%d].CreateFixture(fd);\n",bodyIndex)}}
goog.provide('box2d.b2Body');goog.require('box2d.b2Settings');goog.require('box2d.b2Math');goog.require('box2d.b2Fixture');box2d.b2BodyType={b2_unknown:-1,b2_staticBody:0,b2_kinematicBody:1,b2_dynamicBody:2,b2_bulletBody:3};goog.exportProperty(box2d.b2BodyType,'b2_unknown',box2d.b2BodyType.b2_unknown);goog.exportProperty(box2d.b2BodyType,'b2_staticBody',box2d.b2BodyType.b2_staticBody);goog.exportProperty(box2d.b2BodyType,'b2_kinematicBody',box2d.b2BodyType.b2_kinematicBody);goog.exportProperty(box2d.b2BodyType,'b2_dynamicBody',box2d.b2BodyType.b2_dynamicBody);goog.exportProperty(box2d.b2BodyType,'b2_bulletBody',box2d.b2BodyType.b2_bulletBody);box2d.b2BodyDef=function(){this.position=new box2d.b2Vec2(0,0);this.linearVelocity=new box2d.b2Vec2(0,0)}
box2d.b2BodyDef.prototype.type=box2d.b2BodyType.b2_staticBody;box2d.b2BodyDef.prototype.position=null;box2d.b2BodyDef.prototype.angle=0;box2d.b2BodyDef.prototype.linearVelocity=null;box2d.b2BodyDef.prototype.angularVelocity=0;box2d.b2BodyDef.prototype.linearDamping=0;box2d.b2BodyDef.prototype.angularDamping=0;box2d.b2BodyDef.prototype.allowSleep=!0;box2d.b2BodyDef.prototype.awake=!0;box2d.b2BodyDef.prototype.fixedRotation=!1;box2d.b2BodyDef.prototype.bullet=!1;box2d.b2BodyDef.prototype.active=!0;box2d.b2BodyDef.prototype.userData=null;box2d.b2BodyDef.prototype.gravityScale=1;box2d.b2BodyFlag={e_none:0,e_islandFlag:0x0001,e_awakeFlag:0x0002,e_autoSleepFlag:0x0004,e_bulletFlag:0x0008,e_fixedRotationFlag:0x0010,e_activeFlag:0x0020,e_toiFlag:0x0040};goog.exportProperty(box2d.b2BodyFlag,'e_none',box2d.b2BodyFlag.e_none);goog.exportProperty(box2d.b2BodyFlag,'e_islandFlag',box2d.b2BodyFlag.e_islandFlag);goog.exportProperty(box2d.b2BodyFlag,'e_awakeFlag',box2d.b2BodyFlag.e_awakeFlag);goog.exportProperty(box2d.b2BodyFlag,'e_autoSleepFlag',box2d.b2BodyFlag.e_autoSleepFlag);goog.exportProperty(box2d.b2BodyFlag,'e_bulletFlag',box2d.b2BodyFlag.e_bulletFlag);goog.exportProperty(box2d.b2BodyFlag,'e_fixedRotationFlag',box2d.b2BodyFlag.e_fixedRotationFlag);goog.exportProperty(box2d.b2BodyFlag,'e_activeFlag',box2d.b2BodyFlag.e_activeFlag);goog.exportProperty(box2d.b2BodyFlag,'e_toiFlag',box2d.b2BodyFlag.e_toiFlag);box2d.b2Body=function(bd,world){this.m_xf=new box2d.b2Transform();this.m_out_xf=new box2d.b2Transform();this.m_sweep=new box2d.b2Sweep();this.m_out_sweep=new box2d.b2Sweep();this.m_linearVelocity=new box2d.b2Vec2();this.m_out_linearVelocity=new box2d.b2Vec2();this.m_force=new box2d.b2Vec2();if(box2d.ENABLE_ASSERTS){box2d.b2Assert(bd.position.IsValid())}
if(box2d.ENABLE_ASSERTS){box2d.b2Assert(bd.linearVelocity.IsValid())}
if(box2d.ENABLE_ASSERTS){box2d.b2Assert(box2d.b2IsValid(bd.angle))}
if(box2d.ENABLE_ASSERTS){box2d.b2Assert(box2d.b2IsValid(bd.angularVelocity))}
if(box2d.ENABLE_ASSERTS){box2d.b2Assert(box2d.b2IsValid(bd.gravityScale)&&bd.gravityScale>=0)}
if(box2d.ENABLE_ASSERTS){box2d.b2Assert(box2d.b2IsValid(bd.angularDamping)&&bd.angularDamping>=0)}
if(box2d.ENABLE_ASSERTS){box2d.b2Assert(box2d.b2IsValid(bd.linearDamping)&&bd.linearDamping>=0)}
this.m_flags=box2d.b2BodyFlag.e_none;if(bd.bullet){this.m_flags|=box2d.b2BodyFlag.e_bulletFlag}
if(bd.fixedRotation){this.m_flags|=box2d.b2BodyFlag.e_fixedRotationFlag}
if(bd.allowSleep){this.m_flags|=box2d.b2BodyFlag.e_autoSleepFlag}
if(bd.awake){this.m_flags|=box2d.b2BodyFlag.e_awakeFlag}
if(bd.active){this.m_flags|=box2d.b2BodyFlag.e_activeFlag}
this.m_world=world;this.m_xf.p.Copy(bd.position);this.m_xf.q.SetAngleRadians(bd.angle);this.m_sweep.localCenter.SetZero();this.m_sweep.c0.Copy(this.m_xf.p);this.m_sweep.c.Copy(this.m_xf.p);this.m_sweep.a0=bd.angle;this.m_sweep.a=bd.angle;this.m_sweep.alpha0=0;this.m_linearVelocity.Copy(bd.linearVelocity);this.m_angularVelocity=bd.angularVelocity;this.m_linearDamping=bd.linearDamping;this.m_angularDamping=bd.angularDamping;this.m_gravityScale=bd.gravityScale;this.m_force.SetZero();this.m_torque=0;this.m_sleepTime=0;this.m_type=bd.type;if(bd.type===box2d.b2BodyType.b2_dynamicBody){this.m_mass=1;this.m_invMass=1}
else{this.m_mass=0;this.m_invMass=0}
this.m_I=0;this.m_invI=0;this.m_userData=bd.userData;this.m_fixtureList=null;this.m_fixtureCount=0;this.m_controllerList=null;this.m_controllerCount=0}
box2d.b2Body.prototype.m_flags=box2d.b2BodyFlag.e_none;box2d.b2Body.prototype.m_islandIndex=0;box2d.b2Body.prototype.m_world=null;box2d.b2Body.prototype.m_xf=null;box2d.b2Body.prototype.m_out_xf=null;box2d.b2Body.prototype.m_sweep=null;box2d.b2Body.prototype.m_out_sweep=null;box2d.b2Body.prototype.m_jointList=null;box2d.b2Body.prototype.m_contactList=null;box2d.b2Body.prototype.m_prev=null;box2d.b2Body.prototype.m_next=null;box2d.b2Body.prototype.m_linearVelocity=null;box2d.b2Body.prototype.m_out_linearVelocity=null;box2d.b2Body.prototype.m_angularVelocity=0;box2d.b2Body.prototype.m_linearDamping=0;box2d.b2Body.prototype.m_angularDamping=0;box2d.b2Body.prototype.m_gravityScale=1;box2d.b2Body.prototype.m_force=null;box2d.b2Body.prototype.m_torque=0;box2d.b2Body.prototype.m_sleepTime=0;box2d.b2Body.prototype.m_type=box2d.b2BodyType.b2_staticBody;box2d.b2Body.prototype.m_mass=1;box2d.b2Body.prototype.m_invMass=1;box2d.b2Body.prototype.m_I=0;box2d.b2Body.prototype.m_invI=0;box2d.b2Body.prototype.m_userData=null;box2d.b2Body.prototype.m_fixtureList=null;box2d.b2Body.prototype.m_fixtureCount=0;box2d.b2Body.prototype.m_controllerList=null;box2d.b2Body.prototype.m_controllerCount=0;box2d.b2Body.prototype.CreateFixture=function(def){if(box2d.ENABLE_ASSERTS){box2d.b2Assert(this.m_world.IsLocked()===!1)}
if(this.m_world.IsLocked()===!0){return null}
var fixture=new box2d.b2Fixture();fixture.Create(this,def);if(this.m_flags&box2d.b2BodyFlag.e_activeFlag){var broadPhase=this.m_world.m_contactManager.m_broadPhase;fixture.CreateProxies(broadPhase,this.m_xf)}
fixture.m_next=this.m_fixtureList;this.m_fixtureList=fixture;++this.m_fixtureCount;fixture.m_body=this;if(fixture.m_density>0){this.ResetMassData()}
this.m_world.m_flags|=box2d.b2WorldFlag.e_newFixture;return fixture}
box2d.b2Body.prototype.CreateFixture2=function(shape,density){if(density===undefined)density=0;var def=box2d.b2Body.prototype.CreateFixture2.s_def;def.shape=shape;def.density=density;return this.CreateFixture(def)}
box2d.b2Body.prototype.CreateFixture2.s_def=new box2d.b2FixtureDef();box2d.b2Body.prototype.DestroyFixture=function(fixture){if(box2d.ENABLE_ASSERTS){box2d.b2Assert(this.m_world.IsLocked()===!1)}
if(this.m_world.IsLocked()===!0){return}
if(box2d.ENABLE_ASSERTS){box2d.b2Assert(fixture.m_body===this)}
if(box2d.ENABLE_ASSERTS){box2d.b2Assert(this.m_fixtureCount>0)}
var node=this.m_fixtureList;var ppF=null;var found=!1;while(node!==null){if(node===fixture){if(ppF)
ppF.m_next=fixture.m_next;else this.m_fixtureList=fixture.m_next;found=!0;break}
ppF=node;node=node.m_next}
if(box2d.ENABLE_ASSERTS){box2d.b2Assert(found)}
var edge=this.m_contactList;while(edge){var c=edge.contact;edge=edge.next;var fixtureA=c.GetFixtureA();var fixtureB=c.GetFixtureB();if(fixture===fixtureA||fixture===fixtureB){this.m_world.m_contactManager.Destroy(c)}}
if(this.m_flags&box2d.b2BodyFlag.e_activeFlag){var broadPhase=this.m_world.m_contactManager.m_broadPhase;fixture.DestroyProxies(broadPhase)}
fixture.Destroy();fixture.m_body=null;fixture.m_next=null;--this.m_fixtureCount;this.ResetMassData()}
box2d.b2Body.prototype.SetTransformVecRadians=function(position,angle){this.SetTransformXYRadians(position.x,position.y,angle)}
box2d.b2Body.prototype.SetTransformXYRadians=function(x,y,angle){if(box2d.ENABLE_ASSERTS){box2d.b2Assert(this.m_world.IsLocked()===!1)}
if(this.m_world.IsLocked()===!0){return}
if((this.m_xf.p.x===x)&&(this.m_xf.p.y===y)&&(this.m_xf.q.GetAngleRadians())===angle){return}
this.m_xf.q.SetAngleRadians(angle);this.m_xf.p.SetXY(x,y);box2d.b2MulXV(this.m_xf,this.m_sweep.localCenter,this.m_sweep.c);this.m_sweep.a=angle;this.m_sweep.c0.Copy(this.m_sweep.c);this.m_sweep.a0=angle;var broadPhase=this.m_world.m_contactManager.m_broadPhase;for(var f=this.m_fixtureList;f;f=f.m_next){f.Synchronize(broadPhase,this.m_xf,this.m_xf)}}
box2d.b2Body.prototype.SetTransform=function(xf){this.SetTransformVecRadians(xf.p,xf.GetAngleRadians())}
box2d.b2Body.prototype.GetTransform=function(out){out=out||this.m_out_xf;return out.Copy(this.m_xf)}
box2d.b2Body.prototype.GetPosition=function(out){out=out||this.m_out_xf.p;return out.Copy(this.m_xf.p)}
box2d.b2Body.prototype.SetPosition=function(position){this.SetTransformVecRadians(position,this.GetAngleRadians())}
box2d.b2Body.prototype.SetPositionXY=function(x,y){this.SetTransformXYRadians(x,y,this.GetAngleRadians())}
box2d.b2Body.prototype.GetAngle=function(){return this.m_sweep.a}
box2d.b2Body.prototype.GetAngleRadians=box2d.b2Body.prototype.GetAngle;box2d.b2Body.prototype.GetAngleDegrees=function(){return box2d.b2RadToDeg(this.GetAngle())}
box2d.b2Body.prototype.SetAngle=function(angle){this.SetTransformVecRadians(this.GetPosition(),angle)}
box2d.b2Body.prototype.SetAngleRadians=box2d.b2Body.prototype.SetAngle;box2d.b2Body.prototype.SetAngleDegrees=function(angle){this.SetAngle(box2d.b2DegToRad(angle))}
box2d.b2Body.prototype.GetWorldCenter=function(out){out=out||this.m_out_sweep.c;return out.Copy(this.m_sweep.c)}
box2d.b2Body.prototype.GetLocalCenter=function(out){out=out||this.m_out_sweep.localCenter;return out.Copy(this.m_sweep.localCenter)}
box2d.b2Body.prototype.SetLinearVelocity=function(v){if(this.m_type===box2d.b2BodyType.b2_staticBody){return}
if(box2d.b2DotVV(v,v)>0){this.SetAwake(!0)}
this.m_linearVelocity.Copy(v)}
box2d.b2Body.prototype.GetLinearVelocity=function(out){out=out||this.m_out_linearVelocity;return out.Copy(this.m_linearVelocity)}
box2d.b2Body.prototype.SetAngularVelocity=function(w){if(this.m_type===box2d.b2BodyType.b2_staticBody){return}
if(w*w>0){this.SetAwake(!0)}
this.m_angularVelocity=w}
box2d.b2Body.prototype.GetAngularVelocity=function(){return this.m_angularVelocity}
box2d.b2Body.prototype.GetDefinition=function(bd){bd.type=this.GetType();bd.allowSleep=(this.m_flags&box2d.b2BodyFlag.e_autoSleepFlag)===box2d.b2BodyFlag.e_autoSleepFlag;bd.angle=this.GetAngleRadians();bd.angularDamping=this.m_angularDamping;bd.gravityScale=this.m_gravityScale;bd.angularVelocity=this.m_angularVelocity;bd.fixedRotation=(this.m_flags&box2d.b2BodyFlag.e_fixedRotationFlag)===box2d.b2BodyFlag.e_fixedRotationFlag;bd.bullet=(this.m_flags&box2d.b2BodyFlag.e_bulletFlag)===box2d.b2BodyFlag.e_bulletFlag;bd.awake=(this.m_flags&box2d.b2BodyFlag.e_awakeFlag)===box2d.b2BodyFlag.e_awakeFlag;bd.linearDamping=this.m_linearDamping;bd.linearVelocity.Copy(this.GetLinearVelocity());bd.position.Copy(this.GetPosition());bd.userData=this.GetUserData();return bd}
box2d.b2Body.prototype.ApplyForce=function(force,point,wake){wake=wake||!0;if(this.m_type!==box2d.b2BodyType.b2_dynamicBody){return}
if(wake&&(this.m_flags&box2d.b2BodyFlag.e_awakeFlag)===0){this.SetAwake(!0)}
if(this.m_flags&box2d.b2BodyFlag.e_awakeFlag){this.m_force.x+=force.x;this.m_force.y+=force.y;this.m_torque+=((point.x-this.m_sweep.c.x)*force.y-(point.y-this.m_sweep.c.y)*force.x)}}
box2d.b2Body.prototype.ApplyForceToCenter=function(force,wake){wake=wake||!0;if(this.m_type!==box2d.b2BodyType.b2_dynamicBody){return}
if(wake&&(this.m_flags&box2d.b2BodyFlag.e_awakeFlag)===0){this.SetAwake(!0)}
if(this.m_flags&box2d.b2BodyFlag.e_awakeFlag){this.m_force.x+=force.x;this.m_force.y+=force.y}}
box2d.b2Body.prototype.ApplyTorque=function(torque,wake){wake=wake||!0;if(this.m_type!==box2d.b2BodyType.b2_dynamicBody){return}
if(wake&&(this.m_flags&box2d.b2BodyFlag.e_awakeFlag)===0){this.SetAwake(!0)}
if(this.m_flags&box2d.b2BodyFlag.e_awakeFlag){this.m_torque+=torque}}
box2d.b2Body.prototype.ApplyLinearImpulse=function(impulse,point,wake){wake=wake||!0;if(this.m_type!==box2d.b2BodyType.b2_dynamicBody){return}
if(wake&&(this.m_flags&box2d.b2BodyFlag.e_awakeFlag)===0){this.SetAwake(!0)}
if(this.m_flags&box2d.b2BodyFlag.e_awakeFlag){this.m_linearVelocity.x+=this.m_invMass*impulse.x;this.m_linearVelocity.y+=this.m_invMass*impulse.y;this.m_angularVelocity+=this.m_invI*((point.x-this.m_sweep.c.x)*impulse.y-(point.y-this.m_sweep.c.y)*impulse.x)}}
box2d.b2Body.prototype.ApplyAngularImpulse=function(impulse,wake){wake=wake||!0;if(this.m_type!==box2d.b2BodyType.b2_dynamicBody){return}
if(wake&&(this.m_flags&box2d.b2BodyFlag.e_awakeFlag)===0){this.SetAwake(!0)}
if(this.m_flags&box2d.b2BodyFlag.e_awakeFlag){this.m_angularVelocity+=this.m_invI*impulse}}
box2d.b2Body.prototype.GetMass=function(){return this.m_mass}
box2d.b2Body.prototype.GetInertia=function(){return this.m_I+this.m_mass*box2d.b2DotVV(this.m_sweep.localCenter,this.m_sweep.localCenter)}
box2d.b2Body.prototype.GetMassData=function(data){data.mass=this.m_mass;data.I=this.m_I+this.m_mass*box2d.b2DotVV(this.m_sweep.localCenter,this.m_sweep.localCenter);data.center.Copy(this.m_sweep.localCenter);return data}
box2d.b2Body.prototype.SetMassData=function(massData){if(box2d.ENABLE_ASSERTS){box2d.b2Assert(this.m_world.IsLocked()===!1)}
if(this.m_world.IsLocked()===!0){return}
if(this.m_type!==box2d.b2BodyType.b2_dynamicBody){return}
this.m_invMass=0;this.m_I=0;this.m_invI=0;this.m_mass=massData.mass;if(this.m_mass<=0){this.m_mass=1}
this.m_invMass=1/this.m_mass;if(massData.I>0&&(this.m_flags&box2d.b2BodyFlag.e_fixedRotationFlag)===0){this.m_I=massData.I-this.m_mass*box2d.b2DotVV(massData.center,massData.center);if(box2d.ENABLE_ASSERTS){box2d.b2Assert(this.m_I>0)}
this.m_invI=1/this.m_I}
var oldCenter=box2d.b2Body.prototype.SetMassData.s_oldCenter.Copy(this.m_sweep.c);this.m_sweep.localCenter.Copy(massData.center);box2d.b2MulXV(this.m_xf,this.m_sweep.localCenter,this.m_sweep.c);this.m_sweep.c0.Copy(this.m_sweep.c);box2d.b2AddVCrossSV(this.m_linearVelocity,this.m_angularVelocity,box2d.b2SubVV(this.m_sweep.c,oldCenter,box2d.b2Vec2.s_t0),this.m_linearVelocity)}
box2d.b2Body.prototype.SetMassData.s_oldCenter=new box2d.b2Vec2();box2d.b2Body.prototype.ResetMassData=function(){this.m_mass=0;this.m_invMass=0;this.m_I=0;this.m_invI=0;this.m_sweep.localCenter.SetZero();if(this.m_type===box2d.b2BodyType.b2_staticBody||this.m_type===box2d.b2BodyType.b2_kinematicBody){this.m_sweep.c0.Copy(this.m_xf.p);this.m_sweep.c.Copy(this.m_xf.p);this.m_sweep.a0=this.m_sweep.a;return}
if(box2d.ENABLE_ASSERTS){box2d.b2Assert(this.m_type===box2d.b2BodyType.b2_dynamicBody)}
var localCenter=box2d.b2Body.prototype.ResetMassData.s_localCenter.SetZero();for(var f=this.m_fixtureList;f;f=f.m_next){if(f.m_density===0){continue}
var massData=f.GetMassData(box2d.b2Body.prototype.ResetMassData.s_massData);this.m_mass+=massData.mass;localCenter.x+=massData.center.x*massData.mass;localCenter.y+=massData.center.y*massData.mass;this.m_I+=massData.I}
if(this.m_mass>0){this.m_invMass=1/this.m_mass;localCenter.x*=this.m_invMass;localCenter.y*=this.m_invMass}
else{this.m_mass=1;this.m_invMass=1}
if(this.m_I>0&&(this.m_flags&box2d.b2BodyFlag.e_fixedRotationFlag)===0){this.m_I-=this.m_mass*box2d.b2DotVV(localCenter,localCenter);if(box2d.ENABLE_ASSERTS){box2d.b2Assert(this.m_I>0)}
this.m_invI=1/this.m_I}
else{this.m_I=0;this.m_invI=0}
var oldCenter=box2d.b2Body.prototype.ResetMassData.s_oldCenter.Copy(this.m_sweep.c);this.m_sweep.localCenter.Copy(localCenter);box2d.b2MulXV(this.m_xf,this.m_sweep.localCenter,this.m_sweep.c);this.m_sweep.c0.Copy(this.m_sweep.c);box2d.b2AddVCrossSV(this.m_linearVelocity,this.m_angularVelocity,box2d.b2SubVV(this.m_sweep.c,oldCenter,box2d.b2Vec2.s_t0),this.m_linearVelocity)}
box2d.b2Body.prototype.ResetMassData.s_localCenter=new box2d.b2Vec2();box2d.b2Body.prototype.ResetMassData.s_oldCenter=new box2d.b2Vec2();box2d.b2Body.prototype.ResetMassData.s_massData=new box2d.b2MassData();box2d.b2Body.prototype.GetWorldPoint=function(localPoint,out){return box2d.b2MulXV(this.m_xf,localPoint,out)}
box2d.b2Body.prototype.GetWorldVector=function(localVector,out){return box2d.b2MulRV(this.m_xf.q,localVector,out)}
box2d.b2Body.prototype.GetLocalPoint=function(worldPoint,out){return box2d.b2MulTXV(this.m_xf,worldPoint,out)}
box2d.b2Body.prototype.GetLocalVector=function(worldVector,out){return box2d.b2MulTRV(this.m_xf.q,worldVector,out)}
box2d.b2Body.prototype.GetLinearVelocityFromWorldPoint=function(worldPoint,out){return box2d.b2AddVCrossSV(this.m_linearVelocity,this.m_angularVelocity,box2d.b2SubVV(worldPoint,this.m_sweep.c,box2d.b2Vec2.s_t0),out)}
box2d.b2Body.prototype.GetLinearVelocityFromLocalPoint=function(localPoint,out){return this.GetLinearVelocityFromWorldPoint(this.GetWorldPoint(localPoint,out),out)}
box2d.b2Body.prototype.GetLinearDamping=function(){return this.m_linearDamping}
box2d.b2Body.prototype.SetLinearDamping=function(linearDamping){this.m_linearDamping=linearDamping}
box2d.b2Body.prototype.GetAngularDamping=function(){return this.m_angularDamping}
box2d.b2Body.prototype.SetAngularDamping=function(angularDamping){this.m_angularDamping=angularDamping}
box2d.b2Body.prototype.GetGravityScale=function(){return this.m_gravityScale}
box2d.b2Body.prototype.SetGravityScale=function(scale){this.m_gravityScale=scale}
box2d.b2Body.prototype.SetType=function(type){if(box2d.ENABLE_ASSERTS){box2d.b2Assert(this.m_world.IsLocked()===!1)}
if(this.m_world.IsLocked()===!0){return}
if(this.m_type===type){return}
this.m_type=type;this.ResetMassData();if(this.m_type===box2d.b2BodyType.b2_staticBody){this.m_linearVelocity.SetZero();this.m_angularVelocity=0;this.m_sweep.a0=this.m_sweep.a;this.m_sweep.c0.Copy(this.m_sweep.c);this.SynchronizeFixtures()}
this.SetAwake(!0);this.m_force.SetZero();this.m_torque=0;var ce=this.m_contactList;while(ce){var ce0=ce;ce=ce.next;this.m_world.m_contactManager.Destroy(ce0.contact)}
this.m_contactList=null;var broadPhase=this.m_world.m_contactManager.m_broadPhase;for(var f=this.m_fixtureList;f;f=f.m_next){var proxyCount=f.m_proxyCount;for(var i=0;i<proxyCount;++i){broadPhase.TouchProxy(f.m_proxies[i].proxy)}}}
box2d.b2Body.prototype.GetType=function(){return this.m_type}
box2d.b2Body.prototype.SetBullet=function(flag){if(flag){this.m_flags|=box2d.b2BodyFlag.e_bulletFlag}
else{this.m_flags&=~box2d.b2BodyFlag.e_bulletFlag}}
box2d.b2Body.prototype.IsBullet=function(){return(this.m_flags&box2d.b2BodyFlag.e_bulletFlag)===box2d.b2BodyFlag.e_bulletFlag}
box2d.b2Body.prototype.SetSleepingAllowed=function(flag){if(flag){this.m_flags|=box2d.b2BodyFlag.e_autoSleepFlag}
else{this.m_flags&=~box2d.b2BodyFlag.e_autoSleepFlag;this.SetAwake(!0)}}
box2d.b2Body.prototype.IsSleepingAllowed=function(){return(this.m_flags&box2d.b2BodyFlag.e_autoSleepFlag)===box2d.b2BodyFlag.e_autoSleepFlag}
box2d.b2Body.prototype.SetAwake=function(flag){if(flag){if((this.m_flags&box2d.b2BodyFlag.e_awakeFlag)===0){this.m_flags|=box2d.b2BodyFlag.e_awakeFlag;this.m_sleepTime=0}}
else{this.m_flags&=~box2d.b2BodyFlag.e_awakeFlag;this.m_sleepTime=0;this.m_linearVelocity.SetZero();this.m_angularVelocity=0;this.m_force.SetZero();this.m_torque=0}}
box2d.b2Body.prototype.IsAwake=function(){return(this.m_flags&box2d.b2BodyFlag.e_awakeFlag)===box2d.b2BodyFlag.e_awakeFlag}
box2d.b2Body.prototype.SetActive=function(flag){if(box2d.ENABLE_ASSERTS){box2d.b2Assert(this.m_world.IsLocked()===!1)}
if(flag===this.IsActive()){return}
if(flag){this.m_flags|=box2d.b2BodyFlag.e_activeFlag;var broadPhase=this.m_world.m_contactManager.m_broadPhase;for(var f=this.m_fixtureList;f;f=f.m_next){f.CreateProxies(broadPhase,this.m_xf)}}
else{this.m_flags&=~box2d.b2BodyFlag.e_activeFlag;var broadPhase=this.m_world.m_contactManager.m_broadPhase;for(var f=this.m_fixtureList;f;f=f.m_next){f.DestroyProxies(broadPhase)}
var ce=this.m_contactList;while(ce){var ce0=ce;ce=ce.next;this.m_world.m_contactManager.Destroy(ce0.contact)}
this.m_contactList=null}}
box2d.b2Body.prototype.IsActive=function(){return(this.m_flags&box2d.b2BodyFlag.e_activeFlag)===box2d.b2BodyFlag.e_activeFlag}
box2d.b2Body.prototype.SetFixedRotation=function(flag){var status=(this.m_flags&box2d.b2BodyFlag.e_fixedRotationFlag)===box2d.b2BodyFlag.e_fixedRotationFlag;if(status===flag){return}
if(flag){this.m_flags|=box2d.b2BodyFlag.e_fixedRotationFlag}
else{this.m_flags&=~box2d.b2BodyFlag.e_fixedRotationFlag}
this.m_angularVelocity=0;this.ResetMassData()}
box2d.b2Body.prototype.IsFixedRotation=function(){return(this.m_flags&box2d.b2BodyFlag.e_fixedRotationFlag)===box2d.b2BodyFlag.e_fixedRotationFlag}
box2d.b2Body.prototype.GetFixtureList=function(){return this.m_fixtureList}
box2d.b2Body.prototype.GetJointList=function(){return this.m_jointList}
box2d.b2Body.prototype.GetContactList=function(){return this.m_contactList}
box2d.b2Body.prototype.GetNext=function(){return this.m_next}
box2d.b2Body.prototype.GetUserData=function(){return this.m_userData}
box2d.b2Body.prototype.SetUserData=function(data){this.m_userData=data}
box2d.b2Body.prototype.GetWorld=function(){return this.m_world}
box2d.b2Body.prototype.SynchronizeFixtures=function(){var xf1=box2d.b2Body.prototype.SynchronizeFixtures.s_xf1;xf1.q.SetAngleRadians(this.m_sweep.a0);box2d.b2MulRV(xf1.q,this.m_sweep.localCenter,xf1.p);box2d.b2SubVV(this.m_sweep.c0,xf1.p,xf1.p);var broadPhase=this.m_world.m_contactManager.m_broadPhase;for(var f=this.m_fixtureList;f;f=f.m_next){f.Synchronize(broadPhase,xf1,this.m_xf)}}
box2d.b2Body.prototype.SynchronizeFixtures.s_xf1=new box2d.b2Transform();box2d.b2Body.prototype.SynchronizeTransform=function(){this.m_xf.q.SetAngleRadians(this.m_sweep.a);box2d.b2MulRV(this.m_xf.q,this.m_sweep.localCenter,this.m_xf.p);box2d.b2SubVV(this.m_sweep.c,this.m_xf.p,this.m_xf.p)}
box2d.b2Body.prototype.ShouldCollide=function(other){if(this.m_type!==box2d.b2BodyType.b2_dynamicBody&&other.m_type!==box2d.b2BodyType.b2_dynamicBody){return !1}
for(var jn=this.m_jointList;jn;jn=jn.next){if(jn.other===other){if(jn.joint.m_collideConnected===!1){return !1}}}
return !0}
box2d.b2Body.prototype.Advance=function(alpha){this.m_sweep.Advance(alpha);this.m_sweep.c.Copy(this.m_sweep.c0);this.m_sweep.a=this.m_sweep.a0;this.m_xf.q.SetAngleRadians(this.m_sweep.a);box2d.b2MulRV(this.m_xf.q,this.m_sweep.localCenter,this.m_xf.p);box2d.b2SubVV(this.m_sweep.c,this.m_xf.p,this.m_xf.p)}
box2d.b2Body.prototype.Dump=function(){if(box2d.DEBUG){var bodyIndex=this.m_islandIndex;box2d.b2Log("if (true)\n");box2d.b2Log("{\n");box2d.b2Log("  /*box2d.b2BodyDef*/ var bd = new box2d.b2BodyDef();\n");var type_str='';switch(this.m_type){case box2d.b2BodyType.b2_staticBody:type_str='box2d.b2BodyType.b2_staticBody';break;case box2d.b2BodyType.b2_kinematicBody:type_str='box2d.b2BodyType.b2_kinematicBody';break;case box2d.b2BodyType.b2_dynamicBody:type_str='box2d.b2BodyType.b2_dynamicBody';break;default:if(box2d.ENABLE_ASSERTS){box2d.b2Assert(!1)}
break}
box2d.b2Log("  bd.type = %s;\n",type_str);box2d.b2Log("  bd.position.SetXY(%.15f, %.15f);\n",this.m_xf.p.x,this.m_xf.p.y);box2d.b2Log("  bd.angle = %.15f;\n",this.m_sweep.a);box2d.b2Log("  bd.linearVelocity.SetXY(%.15f, %.15f);\n",this.m_linearVelocity.x,this.m_linearVelocity.y);box2d.b2Log("  bd.angularVelocity = %.15f;\n",this.m_angularVelocity);box2d.b2Log("  bd.linearDamping = %.15f;\n",this.m_linearDamping);box2d.b2Log("  bd.angularDamping = %.15f;\n",this.m_angularDamping);box2d.b2Log("  bd.allowSleep = %s;\n",(this.m_flags&box2d.b2BodyFlag.e_autoSleepFlag)?('true'):('false'));box2d.b2Log("  bd.awake = %s;\n",(this.m_flags&box2d.b2BodyFlag.e_awakeFlag)?('true'):('false'));box2d.b2Log("  bd.fixedRotation = %s;\n",(this.m_flags&box2d.b2BodyFlag.e_fixedRotationFlag)?('true'):('false'));box2d.b2Log("  bd.bullet = %s;\n",(this.m_flags&box2d.b2BodyFlag.e_bulletFlag)?('true'):('false'));box2d.b2Log("  bd.active = %s;\n",(this.m_flags&box2d.b2BodyFlag.e_activeFlag)?('true'):('false'));box2d.b2Log("  bd.gravityScale = %.15f;\n",this.m_gravityScale);box2d.b2Log("\n");box2d.b2Log("  bodies[%d] = this.m_world.CreateBody(bd);\n",this.m_islandIndex);box2d.b2Log("\n");for(var f=this.m_fixtureList;f;f=f.m_next){box2d.b2Log("  if (true)\n");box2d.b2Log("  {\n");f.Dump(bodyIndex);box2d.b2Log("  }\n")}
box2d.b2Log("}\n")}}
box2d.b2Body.prototype.GetControllerList=function(){return this.m_controllerList}
box2d.b2Body.prototype.GetControllerCount=function(){return this.m_controllerCount}
goog.provide('box2d.b2World');goog.require('box2d.b2Settings');goog.require('box2d.b2Draw');goog.require('box2d.b2ContactManager');goog.require('box2d.b2ContactSolver');goog.require('box2d.b2Island');goog.require('box2d.b2Body');goog.require('box2d.b2Math');goog.require('box2d.b2Collision');goog.require('box2d.b2TimeStep');goog.require('box2d.b2WorldCallbacks');goog.require('box2d.b2JointFactory');box2d.b2WorldFlag={e_none:0,e_newFixture:0x1,e_locked:0x2,e_clearForces:0x4};goog.exportProperty(box2d.b2WorldFlag,'e_none',box2d.b2WorldFlag.e_none);goog.exportProperty(box2d.b2WorldFlag,'e_newFixture',box2d.b2WorldFlag.e_newFixture);goog.exportProperty(box2d.b2WorldFlag,'e_locked',box2d.b2WorldFlag.e_locked);goog.exportProperty(box2d.b2WorldFlag,'e_clearForces',box2d.b2WorldFlag.e_clearForces);box2d.b2World=function(gravity){this.m_flags=box2d.b2WorldFlag.e_clearForces;this.m_contactManager=new box2d.b2ContactManager();this.m_gravity=gravity.Clone();this.m_out_gravity=new box2d.b2Vec2();this.m_allowSleep=!0;this.m_destructionListener=null;this.m_debugDraw=null;this.m_warmStarting=!0;this.m_continuousPhysics=!0;this.m_subStepping=!1;this.m_stepComplete=!0;this.m_profile=new box2d.b2Profile();this.m_island=new box2d.b2Island();this.s_stack=new Array()}
box2d.b2World.prototype.m_flags=box2d.b2WorldFlag.e_none;box2d.b2World.prototype.m_contactManager=null;box2d.b2World.prototype.m_bodyList=null;box2d.b2World.prototype.m_jointList=null;box2d.b2World.prototype.m_bodyCount=0;box2d.b2World.prototype.m_jointCount=0;box2d.b2World.prototype.m_gravity=null;box2d.b2World.prototype.m_out_gravity=null;box2d.b2World.prototype.m_allowSleep=!0;box2d.b2World.prototype.m_destructionListener=null;box2d.b2World.prototype.m_debugDraw=null;box2d.b2World.prototype.m_inv_dt0=0;box2d.b2World.prototype.m_warmStarting=!0;box2d.b2World.prototype.m_continuousPhysics=!0;box2d.b2World.prototype.m_subStepping=!1;box2d.b2World.prototype.m_stepComplete=!0;box2d.b2World.prototype.m_profile=null;box2d.b2World.prototype.m_island=null;box2d.b2World.prototype.s_stack=null;box2d.b2World.prototype.m_controllerList=null;box2d.b2World.prototype.m_controllerCount=0;box2d.b2World.prototype.SetAllowSleeping=function(flag){if(flag===this.m_allowSleep){return}
this.m_allowSleep=flag;if(this.m_allowSleep===!1){for(var b=this.m_bodyList;b;b=b.m_next){b.SetAwake(!0)}}}
box2d.b2World.prototype.GetAllowSleeping=function(){return this.m_allowSleep}
box2d.b2World.prototype.SetWarmStarting=function(flag){this.m_warmStarting=flag}
box2d.b2World.prototype.GetWarmStarting=function(){return this.m_warmStarting}
box2d.b2World.prototype.SetContinuousPhysics=function(flag){this.m_continuousPhysics=flag}
box2d.b2World.prototype.GetContinuousPhysics=function(){return this.m_continuousPhysics}
box2d.b2World.prototype.SetSubStepping=function(flag){this.m_subStepping=flag}
box2d.b2World.prototype.GetSubStepping=function(){return this.m_subStepping}
box2d.b2World.prototype.GetBodyList=function(){return this.m_bodyList}
box2d.b2World.prototype.GetJointList=function(){return this.m_jointList}
box2d.b2World.prototype.GetContactList=function(){return this.m_contactManager.m_contactList}
box2d.b2World.prototype.GetBodyCount=function(){return this.m_bodyCount}
box2d.b2World.prototype.GetJointCount=function(){return this.m_jointCount}
box2d.b2World.prototype.GetContactCount=function(){return this.m_contactManager.m_contactCount}
box2d.b2World.prototype.SetGravity=function(gravity,wake){wake=wake||!0;if((this.m_gravity.x!==gravity.x)||(this.m_gravity.y!==gravity.y)){this.m_gravity.Copy(gravity);if(wake){for(var b=this.m_bodyList;b;b=b.m_next){b.SetAwake(!0)}}}}
box2d.b2World.prototype.GetGravity=function(out){out=out||this.m_out_gravity;return out.Copy(this.m_gravity)}
box2d.b2World.prototype.IsLocked=function(){return(this.m_flags&box2d.b2WorldFlag.e_locked)>0}
box2d.b2World.prototype.SetAutoClearForces=function(flag){if(flag){this.m_flags|=box2d.b2WorldFlag.e_clearForces}
else{this.m_flags&=~box2d.b2WorldFlag.e_clearForces}}
box2d.b2World.prototype.GetAutoClearForces=function(){return(this.m_flags&box2d.b2WorldFlag.e_clearForces)===box2d.b2WorldFlag.e_clearForces}
box2d.b2World.prototype.GetContactManager=function(){return this.m_contactManager}
box2d.b2World.prototype.GetProfile=function(){return this.m_profile}
box2d.b2World.prototype.SetDestructionListener=function(listener){this.m_destructionListener=listener}
box2d.b2World.prototype.SetContactFilter=function(filter){this.m_contactManager.m_contactFilter=filter}
box2d.b2World.prototype.SetContactListener=function(listener){this.m_contactManager.m_contactListener=listener}
box2d.b2World.prototype.SetDebugDraw=function(debugDraw){this.m_debugDraw=debugDraw}
box2d.b2World.prototype.CreateBody=function(def){if(box2d.ENABLE_ASSERTS){box2d.b2Assert(this.IsLocked()===!1)}
if(this.IsLocked()){return null}
var b=new box2d.b2Body(def,this);b.m_prev=null;b.m_next=this.m_bodyList;if(this.m_bodyList){this.m_bodyList.m_prev=b}
this.m_bodyList=b;++this.m_bodyCount;return b}
box2d.b2World.prototype.DestroyBody=function(b){if(box2d.ENABLE_ASSERTS){box2d.b2Assert(this.m_bodyCount>0)}
if(box2d.ENABLE_ASSERTS){box2d.b2Assert(this.IsLocked()===!1)}
if(this.IsLocked()){return}
var je=b.m_jointList;while(je){var je0=je;je=je.next;if(this.m_destructionListener){this.m_destructionListener.SayGoodbyeJoint(je0.joint)}
this.DestroyJoint(je0.joint);b.m_jointList=je}
b.m_jointList=null;var coe=b.m_controllerList;while(coe){var coe0=coe;coe=coe.nextController;coe0.controller.RemoveBody(b)}
var ce=b.m_contactList;while(ce){var ce0=ce;ce=ce.next;this.m_contactManager.Destroy(ce0.contact)}
b.m_contactList=null;var f=b.m_fixtureList;while(f){var f0=f;f=f.m_next;if(this.m_destructionListener){this.m_destructionListener.SayGoodbyeFixture(f0)}
f0.DestroyProxies(this.m_contactManager.m_broadPhase);f0.Destroy();b.m_fixtureList=f;b.m_fixtureCount-=1}
b.m_fixtureList=null;b.m_fixtureCount=0;if(b.m_prev){b.m_prev.m_next=b.m_next}
if(b.m_next){b.m_next.m_prev=b.m_prev}
if(b===this.m_bodyList){this.m_bodyList=b.m_next}
--this.m_bodyCount}
box2d.b2World.prototype.CreateJoint=function(def){if(box2d.ENABLE_ASSERTS){box2d.b2Assert(this.IsLocked()===!1)}
if(this.IsLocked()){return null}
var j=box2d.b2JointFactory.Create(def,null);j.m_prev=null;j.m_next=this.m_jointList;if(this.m_jointList){this.m_jointList.m_prev=j}
this.m_jointList=j;++this.m_jointCount;j.m_edgeA.joint=j;j.m_edgeA.other=j.m_bodyB;j.m_edgeA.prev=null;j.m_edgeA.next=j.m_bodyA.m_jointList;if(j.m_bodyA.m_jointList)j.m_bodyA.m_jointList.prev=j.m_edgeA;j.m_bodyA.m_jointList=j.m_edgeA;j.m_edgeB.joint=j;j.m_edgeB.other=j.m_bodyA;j.m_edgeB.prev=null;j.m_edgeB.next=j.m_bodyB.m_jointList;if(j.m_bodyB.m_jointList)j.m_bodyB.m_jointList.prev=j.m_edgeB;j.m_bodyB.m_jointList=j.m_edgeB;var bodyA=def.bodyA;var bodyB=def.bodyB;if(def.collideConnected===!1){var edge=bodyB.GetContactList();while(edge){if(edge.other===bodyA){edge.contact.FlagForFiltering()}
edge=edge.next}}
return j}
box2d.b2World.prototype.DestroyJoint=function(j){if(box2d.ENABLE_ASSERTS){box2d.b2Assert(this.IsLocked()===!1)}
if(this.IsLocked()){return}
var collideConnected=j.m_collideConnected;if(j.m_prev){j.m_prev.m_next=j.m_next}
if(j.m_next){j.m_next.m_prev=j.m_prev}
if(j===this.m_jointList){this.m_jointList=j.m_next}
var bodyA=j.m_bodyA;var bodyB=j.m_bodyB;bodyA.SetAwake(!0);bodyB.SetAwake(!0);if(j.m_edgeA.prev){j.m_edgeA.prev.next=j.m_edgeA.next}
if(j.m_edgeA.next){j.m_edgeA.next.prev=j.m_edgeA.prev}
if(j.m_edgeA===bodyA.m_jointList){bodyA.m_jointList=j.m_edgeA.next}
j.m_edgeA.prev=null;j.m_edgeA.next=null;if(j.m_edgeB.prev){j.m_edgeB.prev.next=j.m_edgeB.next}
if(j.m_edgeB.next){j.m_edgeB.next.prev=j.m_edgeB.prev}
if(j.m_edgeB===bodyB.m_jointList){bodyB.m_jointList=j.m_edgeB.next}
j.m_edgeB.prev=null;j.m_edgeB.next=null;box2d.b2JointFactory.Destroy(j,null);if(box2d.ENABLE_ASSERTS){box2d.b2Assert(this.m_jointCount>0)}
--this.m_jointCount;if(collideConnected===!1){var edge=bodyB.GetContactList();while(edge){if(edge.other===bodyA){edge.contact.FlagForFiltering()}
edge=edge.next}}}
box2d.b2World.prototype.Solve=function(step){for(var controller=this.m_controllerList;controller;controller=controller.m_next){controller.Step(step)}
this.m_profile.solveInit=0;this.m_profile.solveVelocity=0;this.m_profile.solvePosition=0;var island=this.m_island;island.Initialize(this.m_bodyCount,this.m_contactManager.m_contactCount,this.m_jointCount,null,this.m_contactManager.m_contactListener);for(var b=this.m_bodyList;b;b=b.m_next){b.m_flags&=~box2d.b2BodyFlag.e_islandFlag}
for(var c=this.m_contactManager.m_contactList;c;c=c.m_next){c.m_flags&=~box2d.b2ContactFlag.e_islandFlag}
for(var j=this.m_jointList;j;j=j.m_next){j.m_islandFlag=!1}
var stackSize=this.m_bodyCount;var stack=this.s_stack;for(var seed=this.m_bodyList;seed;seed=seed.m_next){if(seed.m_flags&box2d.b2BodyFlag.e_islandFlag){continue}
if(seed.IsAwake()===!1||seed.IsActive()===!1){continue}
if(seed.GetType()===box2d.b2BodyType.b2_staticBody){continue}
island.Clear();var stackCount=0;stack[stackCount++]=seed;seed.m_flags|=box2d.b2BodyFlag.e_islandFlag;while(stackCount>0){var b=stack[--stackCount];if(box2d.ENABLE_ASSERTS){box2d.b2Assert(b.IsActive()===!0)}
island.AddBody(b);b.SetAwake(!0);if(b.GetType()===box2d.b2BodyType.b2_staticBody){continue}
for(var ce=b.m_contactList;ce;ce=ce.next){var contact=ce.contact;if(contact.m_flags&box2d.b2ContactFlag.e_islandFlag){continue}
if(contact.IsEnabled()===!1||contact.IsTouching()===!1){continue}
var sensorA=contact.m_fixtureA.m_isSensor;var sensorB=contact.m_fixtureB.m_isSensor;if(sensorA||sensorB){continue}
island.AddContact(contact);contact.m_flags|=box2d.b2ContactFlag.e_islandFlag;var other=ce.other;if(other.m_flags&box2d.b2BodyFlag.e_islandFlag){continue}
if(box2d.ENABLE_ASSERTS){box2d.b2Assert(stackCount<stackSize)}
stack[stackCount++]=other;other.m_flags|=box2d.b2BodyFlag.e_islandFlag}
for(var je=b.m_jointList;je;je=je.next){if(je.joint.m_islandFlag===!0){continue}
var other=je.other;if(other.IsActive()===!1){continue}
island.AddJoint(je.joint);je.joint.m_islandFlag=!0;if(other.m_flags&box2d.b2BodyFlag.e_islandFlag){continue}
if(box2d.ENABLE_ASSERTS){box2d.b2Assert(stackCount<stackSize)}
stack[stackCount++]=other;other.m_flags|=box2d.b2BodyFlag.e_islandFlag}}
var profile=new box2d.b2Profile();island.Solve(profile,step,this.m_gravity,this.m_allowSleep);this.m_profile.solveInit+=profile.solveInit;this.m_profile.solveVelocity+=profile.solveVelocity;this.m_profile.solvePosition+=profile.solvePosition;for(var i=0;i<island.m_bodyCount;++i){var b=island.m_bodies[i];if(b.GetType()===box2d.b2BodyType.b2_staticBody){b.m_flags&=~box2d.b2BodyFlag.e_islandFlag}}}
for(var i=0;i<stack.length;++i){if(!stack[i])break;stack[i]=null}{var timer=new box2d.b2Timer();for(var b=this.m_bodyList;b;b=b.m_next){if((b.m_flags&box2d.b2BodyFlag.e_islandFlag)===0){continue}
if(b.GetType()===box2d.b2BodyType.b2_staticBody){continue}
b.SynchronizeFixtures()}
this.m_contactManager.FindNewContacts();this.m_profile.broadphase=timer.GetMilliseconds()}}
box2d.b2World.prototype.SolveTOI=function(step){var island=this.m_island;island.Initialize(2*box2d.b2_maxTOIContacts,box2d.b2_maxTOIContacts,0,null,this.m_contactManager.m_contactListener);if(this.m_stepComplete){for(var b=this.m_bodyList;b;b=b.m_next){b.m_flags&=~box2d.b2BodyFlag.e_islandFlag;b.m_sweep.alpha0=0}
for(var c=this.m_contactManager.m_contactList;c;c=c.m_next){c.m_flags&=~(box2d.b2ContactFlag.e_toiFlag|box2d.b2ContactFlag.e_islandFlag);c.m_toiCount=0;c.m_toi=1}}
for(;;){var minContact=null;var minAlpha=1;for(var c=this.m_contactManager.m_contactList;c;c=c.m_next){if(c.IsEnabled()===!1){continue}
if(c.m_toiCount>box2d.b2_maxSubSteps){continue}
var alpha=1;if(c.m_flags&box2d.b2ContactFlag.e_toiFlag){alpha=c.m_toi}
else{var fA=c.GetFixtureA();var fB=c.GetFixtureB();if(fA.IsSensor()||fB.IsSensor()){continue}
var bA=fA.GetBody();var bB=fB.GetBody();var typeA=bA.m_type;var typeB=bB.m_type;if(box2d.ENABLE_ASSERTS){box2d.b2Assert(typeA===box2d.b2BodyType.b2_dynamicBody||typeB===box2d.b2BodyType.b2_dynamicBody)}
var activeA=bA.IsAwake()&&typeA!==box2d.b2BodyType.b2_staticBody;var activeB=bB.IsAwake()&&typeB!==box2d.b2BodyType.b2_staticBody;if(activeA===!1&&activeB===!1){continue}
var collideA=bA.IsBullet()||typeA!==box2d.b2BodyType.b2_dynamicBody;var collideB=bB.IsBullet()||typeB!==box2d.b2BodyType.b2_dynamicBody;if(collideA===!1&&collideB===!1){continue}
var alpha0=bA.m_sweep.alpha0;if(bA.m_sweep.alpha0<bB.m_sweep.alpha0){alpha0=bB.m_sweep.alpha0;bA.m_sweep.Advance(alpha0)}
else if(bB.m_sweep.alpha0<bA.m_sweep.alpha0){alpha0=bA.m_sweep.alpha0;bB.m_sweep.Advance(alpha0)}
if(box2d.ENABLE_ASSERTS){box2d.b2Assert(alpha0<1)}
var indexA=c.GetChildIndexA();var indexB=c.GetChildIndexB();var input=box2d.b2World.prototype.SolveTOI.s_toi_input;input.proxyA.SetShape(fA.GetShape(),indexA);input.proxyB.SetShape(fB.GetShape(),indexB);input.sweepA.Copy(bA.m_sweep);input.sweepB.Copy(bB.m_sweep);input.tMax=1;var output=box2d.b2World.prototype.SolveTOI.s_toi_output;box2d.b2TimeOfImpact(output,input);var beta=output.t;if(output.state===box2d.b2TOIOutputState.e_touching){alpha=box2d.b2Min(alpha0+(1-alpha0)*beta,1)}
else{alpha=1}
c.m_toi=alpha;c.m_flags|=box2d.b2ContactFlag.e_toiFlag}
if(alpha<minAlpha){minContact=c;minAlpha=alpha}}
if(minContact===null||1-10*box2d.b2_epsilon<minAlpha){this.m_stepComplete=!0;break}
var fA=minContact.GetFixtureA();var fB=minContact.GetFixtureB();var bA=fA.GetBody();var bB=fB.GetBody();var backup1=box2d.b2World.prototype.SolveTOI.s_backup1.Copy(bA.m_sweep);var backup2=box2d.b2World.prototype.SolveTOI.s_backup2.Copy(bB.m_sweep);bA.Advance(minAlpha);bB.Advance(minAlpha);minContact.Update(this.m_contactManager.m_contactListener);minContact.m_flags&=~box2d.b2ContactFlag.e_toiFlag;++minContact.m_toiCount;if(minContact.IsEnabled()===!1||minContact.IsTouching()===!1){minContact.SetEnabled(!1);bA.m_sweep.Copy(backup1);bB.m_sweep.Copy(backup2);bA.SynchronizeTransform();bB.SynchronizeTransform();continue}
bA.SetAwake(!0);bB.SetAwake(!0);island.Clear();island.AddBody(bA);island.AddBody(bB);island.AddContact(minContact);bA.m_flags|=box2d.b2BodyFlag.e_islandFlag;bB.m_flags|=box2d.b2BodyFlag.e_islandFlag;minContact.m_flags|=box2d.b2ContactFlag.e_islandFlag;for(var i=0;i<2;++i){var body=(i===0)?(bA):(bB);if(body.m_type===box2d.b2BodyType.b2_dynamicBody){for(var ce=body.m_contactList;ce;ce=ce.next){if(island.m_bodyCount===island.m_bodyCapacity){break}
if(island.m_contactCount===island.m_contactCapacity){break}
var contact=ce.contact;if(contact.m_flags&box2d.b2ContactFlag.e_islandFlag){continue}
var other=ce.other;if(other.m_type===box2d.b2BodyType.b2_dynamicBody&&body.IsBullet()===!1&&other.IsBullet()===!1){continue}
var sensorA=contact.m_fixtureA.m_isSensor;var sensorB=contact.m_fixtureB.m_isSensor;if(sensorA||sensorB){continue}
var backup=box2d.b2World.prototype.SolveTOI.s_backup.Copy(other.m_sweep);if((other.m_flags&box2d.b2BodyFlag.e_islandFlag)===0){other.Advance(minAlpha)}
contact.Update(this.m_contactManager.m_contactListener);if(contact.IsEnabled()===!1){other.m_sweep.Copy(backup);other.SynchronizeTransform();continue}
if(contact.IsTouching()===!1){other.m_sweep.Copy(backup);other.SynchronizeTransform();continue}
contact.m_flags|=box2d.b2ContactFlag.e_islandFlag;island.AddContact(contact);if(other.m_flags&box2d.b2BodyFlag.e_islandFlag){continue}
other.m_flags|=box2d.b2BodyFlag.e_islandFlag;if(other.m_type!==box2d.b2BodyType.b2_staticBody){other.SetAwake(!0)}
island.AddBody(other)}}}
var subStep=box2d.b2World.prototype.SolveTOI.s_subStep;subStep.dt=(1-minAlpha)*step.dt;subStep.inv_dt=1/subStep.dt;subStep.dtRatio=1;subStep.positionIterations=20;subStep.velocityIterations=step.velocityIterations;subStep.warmStarting=!1;island.SolveTOI(subStep,bA.m_islandIndex,bB.m_islandIndex);for(var i=0;i<island.m_bodyCount;++i){var body=island.m_bodies[i];body.m_flags&=~box2d.b2BodyFlag.e_islandFlag;if(body.m_type!==box2d.b2BodyType.b2_dynamicBody){continue}
body.SynchronizeFixtures();for(var ce=body.m_contactList;ce;ce=ce.next){ce.contact.m_flags&=~(box2d.b2ContactFlag.e_toiFlag|box2d.b2ContactFlag.e_islandFlag)}}
this.m_contactManager.FindNewContacts();if(this.m_subStepping){this.m_stepComplete=!1;break}}}
box2d.b2World.prototype.SolveTOI.s_subStep=new box2d.b2TimeStep();box2d.b2World.prototype.SolveTOI.s_backup=new box2d.b2Sweep();box2d.b2World.prototype.SolveTOI.s_backup1=new box2d.b2Sweep();box2d.b2World.prototype.SolveTOI.s_backup2=new box2d.b2Sweep();box2d.b2World.prototype.SolveTOI.s_toi_input=new box2d.b2TOIInput();box2d.b2World.prototype.SolveTOI.s_toi_output=new box2d.b2TOIOutput();box2d.b2World.prototype.Step=function(dt,velocityIterations,positionIterations){var stepTimer=new box2d.b2Timer();if(this.m_flags&box2d.b2WorldFlag.e_newFixture){try{this.m_contactManager.FindNewContacts()}catch(e){console.log(e)}
this.m_flags&=~box2d.b2WorldFlag.e_newFixture}
this.m_flags|=box2d.b2WorldFlag.e_locked;var step=box2d.b2World.prototype.Step.s_step;step.dt=dt;step.velocityIterations=velocityIterations;step.positionIterations=positionIterations;if(dt>0){step.inv_dt=1/dt}
else{step.inv_dt=0}
step.dtRatio=this.m_inv_dt0*dt;step.warmStarting=this.m_warmStarting;if(!0){var timer=new box2d.b2Timer();this.m_contactManager.Collide();this.m_profile.collide=timer.GetMilliseconds()}
if(this.m_stepComplete&&step.dt>0){var timer=new box2d.b2Timer();this.Solve(step);this.m_profile.solve=timer.GetMilliseconds()}
if(this.m_continuousPhysics&&step.dt>0){var timer=new box2d.b2Timer();this.SolveTOI(step);this.m_profile.solveTOI=timer.GetMilliseconds()}
if(step.dt>0){this.m_inv_dt0=step.inv_dt}
if(this.m_flags&box2d.b2WorldFlag.e_clearForces){this.ClearForces()}
this.m_flags&=~box2d.b2WorldFlag.e_locked;this.m_profile.step=stepTimer.GetMilliseconds()}
box2d.b2World.prototype.Step.s_step=new box2d.b2TimeStep();box2d.b2World.prototype.ClearForces=function(){for(var body=this.m_bodyList;body;body=body.m_next){body.m_force.SetZero();body.m_torque=0}}
box2d.b2World.prototype.QueryAABB=function(callback,aabb){var broadPhase=this.m_contactManager.m_broadPhase;var WorldQueryWrapper=function(proxy){var fixture_proxy=broadPhase.GetUserData(proxy);if(box2d.ENABLE_ASSERTS){box2d.b2Assert(fixture_proxy instanceof box2d.b2FixtureProxy)}
var fixture=fixture_proxy.fixture;var index=fixture_proxy.childIndex;if(callback instanceof box2d.b2QueryCallback){return callback.ReportFixture(fixture)}
else{return callback(fixture)}};broadPhase.Query(WorldQueryWrapper,aabb)}
box2d.b2World.prototype.QueryShape=function(callback,shape,transform){var broadPhase=this.m_contactManager.m_broadPhase;var WorldQueryWrapper=function(proxy){var fixture_proxy=broadPhase.GetUserData(proxy);if(box2d.ENABLE_ASSERTS){box2d.b2Assert(fixture_proxy instanceof box2d.b2FixtureProxy)}
var fixture=fixture_proxy.fixture;var index=fixture_proxy.childIndex;if(box2d.b2TestOverlapShape(shape,0,fixture.GetShape(),0,transform,fixture.GetBody().GetTransform())){if(callback instanceof box2d.b2QueryCallback){return callback.ReportFixture(fixture)}
else{return callback(fixture)}}
return !0};var aabb=box2d.b2World.prototype.QueryShape.s_aabb;shape.ComputeAABB(aabb,transform,0);broadPhase.Query(WorldQueryWrapper,aabb)}
box2d.b2World.prototype.QueryShape.s_aabb=new box2d.b2AABB();box2d.b2World.prototype.QueryPoint=function(callback,point){var broadPhase=this.m_contactManager.m_broadPhase;var WorldQueryWrapper=function(proxy){var fixture_proxy=broadPhase.GetUserData(proxy);if(box2d.ENABLE_ASSERTS){box2d.b2Assert(fixture_proxy instanceof box2d.b2FixtureProxy)}
var fixture=fixture_proxy.fixture;var index=fixture_proxy.childIndex;if(fixture.TestPoint(point)){if(callback instanceof box2d.b2QueryCallback){return callback.ReportFixture(fixture)}
else{return callback(fixture)}}
return !0};var aabb=box2d.b2World.prototype.QueryPoint.s_aabb;aabb.lowerBound.SetXY(point.x-box2d.b2_linearSlop,point.y-box2d.b2_linearSlop);aabb.upperBound.SetXY(point.x+box2d.b2_linearSlop,point.y+box2d.b2_linearSlop);broadPhase.Query(WorldQueryWrapper,aabb)}
box2d.b2World.prototype.QueryPoint.s_aabb=new box2d.b2AABB();box2d.b2World.prototype.RayCast=function(callback,point1,point2){var broadPhase=this.m_contactManager.m_broadPhase;var WorldRayCastWrapper=function(input,proxy){var fixture_proxy=broadPhase.GetUserData(proxy);if(box2d.ENABLE_ASSERTS){box2d.b2Assert(fixture_proxy instanceof box2d.b2FixtureProxy)}
var fixture=fixture_proxy.fixture;var index=fixture_proxy.childIndex;var output=box2d.b2World.prototype.RayCast.s_output;var hit=fixture.RayCast(output,input,index);if(hit){var fraction=output.fraction;var point=box2d.b2World.prototype.RayCast.s_point;point.SetXY((1-fraction)*point1.x+fraction*point2.x,(1-fraction)*point1.y+fraction*point2.y);if(callback instanceof box2d.b2RayCastCallback){return callback.ReportFixture(fixture,point,output.normal,fraction)}
else{return callback(fixture,point,output.normal,fraction)}}
return input.maxFraction};var input=box2d.b2World.prototype.RayCast.s_input;input.maxFraction=1;input.p1.Copy(point1);input.p2.Copy(point2);broadPhase.RayCast(WorldRayCastWrapper,input)}
box2d.b2World.prototype.RayCast.s_input=new box2d.b2RayCastInput();box2d.b2World.prototype.RayCast.s_output=new box2d.b2RayCastOutput();box2d.b2World.prototype.RayCast.s_point=new box2d.b2Vec2();box2d.b2World.prototype.RayCastOne=function(point1,point2){var result=null;var min_fraction=1;function WorldRayCastOneWrapper(fixture,point,normal,fraction){if(fraction<min_fraction){min_fraction=fraction;result=fixture}
return min_fraction};this.RayCast(WorldRayCastOneWrapper,point1,point2);return result}
box2d.b2World.prototype.RayCastAll=function(point1,point2,out){out.length=0;function WorldRayCastAllWrapper(fixture,point,normal,fraction){out.push(fixture);return 1};this.RayCast(WorldRayCastAllWrapper,point1,point2);return out}
box2d.b2World.prototype.DrawShape=function(fixture,color){var shape=fixture.GetShape();switch(shape.m_type){case box2d.b2ShapeType.e_circleShape:{var circle=((shape instanceof box2d.b2CircleShape?shape:null));var center=circle.m_p;var radius=circle.m_radius;var axis=box2d.b2Vec2.UNITX;this.m_debugDraw.DrawSolidCircle(center,radius,axis,color)}
break;case box2d.b2ShapeType.e_edgeShape:{var edge=((shape instanceof box2d.b2EdgeShape?shape:null));var v1=edge.m_vertex1;var v2=edge.m_vertex2;this.m_debugDraw.DrawSegment(v1,v2,color)}
break;case box2d.b2ShapeType.e_chainShape:{var chain=((shape instanceof box2d.b2ChainShape?shape:null));var count=chain.m_count;var vertices=chain.m_vertices;var v1=vertices[0];for(var i=0;i<count;++i){var v2=vertices[i];this.m_debugDraw.DrawSegment(v1,v2,color);this.m_debugDraw.DrawCircle(v2,0.05,color);v1=v2}}
break;case box2d.b2ShapeType.e_polygonShape:{var poly=((shape instanceof box2d.b2PolygonShape?shape:null));var vertexCount=poly.m_count;var vertices=poly.m_vertices;this.m_debugDraw.DrawSolidPolygon(vertices,vertexCount,color)}
break}}
box2d.b2World.prototype.DrawJoint=function(joint){var bodyA=joint.GetBodyA();var bodyB=joint.GetBodyB();var xf1=bodyA.m_xf;var xf2=bodyB.m_xf;var x1=xf1.p;var x2=xf2.p;var p1=joint.GetAnchorA(box2d.b2World.prototype.DrawJoint.s_p1);var p2=joint.GetAnchorB(box2d.b2World.prototype.DrawJoint.s_p2);var color=box2d.b2World.prototype.DrawJoint.s_color.SetRGB(0.5,0.8,0.8);switch(joint.m_type){case box2d.b2JointType.e_distanceJoint:this.m_debugDraw.DrawSegment(p1,p2,color);break;case box2d.b2JointType.e_pulleyJoint:{var pulley=((joint instanceof box2d.b2PulleyJoint?joint:null));var s1=pulley.GetGroundAnchorA(box2d.b2World.prototype.DrawJoint.s_s1);var s2=pulley.GetGroundAnchorB(box2d.b2World.prototype.DrawJoint.s_s2);this.m_debugDraw.DrawSegment(s1,p1,color);this.m_debugDraw.DrawSegment(s2,p2,color);this.m_debugDraw.DrawSegment(s1,s2,color)}
break;case box2d.b2JointType.e_mouseJoint:this.m_debugDraw.DrawSegment(p1,p2,color);break;default:this.m_debugDraw.DrawSegment(x1,p1,color);this.m_debugDraw.DrawSegment(p1,p2,color);this.m_debugDraw.DrawSegment(x2,p2,color)}}
box2d.b2World.prototype.DrawJoint.s_p1=new box2d.b2Vec2();box2d.b2World.prototype.DrawJoint.s_p2=new box2d.b2Vec2();box2d.b2World.prototype.DrawJoint.s_color=new box2d.b2Color(0.5,0.8,0.8);box2d.b2World.prototype.DrawJoint.s_s1=new box2d.b2Vec2();box2d.b2World.prototype.DrawJoint.s_s2=new box2d.b2Vec2();box2d.b2World.prototype.DrawDebugData=function(){if(this.m_debugDraw===null){return}
var flags=this.m_debugDraw.GetFlags();var color=box2d.b2World.prototype.DrawDebugData.s_color.SetRGB(0,0,0);if(flags&box2d.b2DrawFlags.e_shapeBit){for(var b=this.m_bodyList;b;b=b.m_next){var xf=b.m_xf;this.m_debugDraw.PushTransform(xf);for(var f=b.GetFixtureList();f;f=f.m_next){if(b.IsActive()===!1){color.SetRGB(0.5,0.5,0.3);this.DrawShape(f,color)}
else if(b.GetType()===box2d.b2BodyType.b2_staticBody){color.SetRGB(0.5,0.9,0.5);this.DrawShape(f,color)}
else if(b.GetType()===box2d.b2BodyType.b2_kinematicBody){color.SetRGB(0.5,0.5,0.9);this.DrawShape(f,color)}
else if(b.IsAwake()===!1){color.SetRGB(0.6,0.6,0.6);this.DrawShape(f,color)}
else{color.SetRGB(0.9,0.7,0.7);this.DrawShape(f,color)}}
this.m_debugDraw.PopTransform(xf)}}
if(flags&box2d.b2DrawFlags.e_jointBit){for(var j=this.m_jointList;j;j=j.m_next){this.DrawJoint(j)}}
if(flags&box2d.b2DrawFlags.e_aabbBit){color.SetRGB(0.9,0.3,0.9);var bp=this.m_contactManager.m_broadPhase;var vs=box2d.b2World.prototype.DrawDebugData.s_vs;for(var b=this.m_bodyList;b;b=b.m_next){if(b.IsActive()===!1){continue}
for(var f=b.GetFixtureList();f;f=f.m_next){for(var i=0;i<f.m_proxyCount;++i){var proxy=f.m_proxies[i];var aabb=bp.GetFatAABB(proxy.proxy);vs[0].SetXY(aabb.lowerBound.x,aabb.lowerBound.y);vs[1].SetXY(aabb.upperBound.x,aabb.lowerBound.y);vs[2].SetXY(aabb.upperBound.x,aabb.upperBound.y);vs[3].SetXY(aabb.lowerBound.x,aabb.upperBound.y);this.m_debugDraw.DrawPolygon(vs,4,color)}}}}
if(flags&box2d.b2DrawFlags.e_centerOfMassBit){for(var b=this.m_bodyList;b;b=b.m_next){var xf=box2d.b2World.prototype.DrawDebugData.s_xf;xf.q.Copy(b.m_xf.q);xf.p.Copy(b.GetWorldCenter());this.m_debugDraw.DrawTransform(xf)}}
if(flags&box2d.b2DrawFlags.e_controllerBit){for(var c=this.m_controllerList;c;c=c.m_next){c.Draw(this.m_debugDraw)}}}
box2d.b2World.prototype.DrawDebugData.s_color=new box2d.b2Color(0,0,0);box2d.b2World.prototype.DrawDebugData.s_vs=box2d.b2Vec2.MakeArray(4);box2d.b2World.prototype.DrawDebugData.s_xf=new box2d.b2Transform();box2d.b2World.prototype.SetBroadPhase=function(broadPhase){var oldBroadPhase=this.m_contactManager.m_broadPhase;this.m_contactManager.m_broadPhase=broadPhase;for(var b=this.m_bodyList;b;b=b.m_next){for(var f=b.m_fixtureList;f;f=f.m_next){f.m_proxy=broadPhase.CreateProxy(oldBroadPhase.GetFatAABB(f.m_proxy),f)}}}
box2d.b2World.prototype.GetProxyCount=function(){return this.m_contactManager.m_broadPhase.GetProxyCount()}
box2d.b2World.prototype.GetTreeHeight=function(){return this.m_contactManager.m_broadPhase.GetTreeHeight()}
box2d.b2World.prototype.GetTreeBalance=function(){return this.m_contactManager.m_broadPhase.GetTreeBalance()}
box2d.b2World.prototype.GetTreeQuality=function(){return this.m_contactManager.m_broadPhase.GetTreeQuality()}
box2d.b2World.prototype.ShiftOrigin=function(newOrigin){if(box2d.ENABLE_ASSERTS){box2d.b2Assert(this.IsLocked()===!1)}
if(this.IsLocked()){return}
for(var b=this.m_bodyList;b;b=b.m_next){b.m_xf.p.SelfSub(newOrigin);b.m_sweep.c0.SelfSub(newOrigin);b.m_sweep.c.SelfSub(newOrigin)}
for(var j=this.m_jointList;j;j=j.m_next){j.ShiftOrigin(newOrigin)}
this.m_contactManager.m_broadPhase.ShiftOrigin(newOrigin)}
box2d.b2World.prototype.Dump=function(){if(box2d.DEBUG){if((this.m_flags&box2d.b2WorldFlag.e_locked)===box2d.b2WorldFlag.e_locked){return}
box2d.b2Log("/** @type {box2d.b2Vec2} */ var g = new box2d.b2Vec2(%.15f, %.15f);\n",this.m_gravity.x,this.m_gravity.y);box2d.b2Log("this.m_world.SetGravity(g);\n");box2d.b2Log("/** @type {Array.<box2d.b2Body>} */ var bodies = new Array(%d);\n",this.m_bodyCount);box2d.b2Log("/** @type {Array.<box2d.b2Joint>} */ var joints = new Array(%d);\n",this.m_jointCount);var i=0;for(var b=this.m_bodyList;b;b=b.m_next){b.m_islandIndex=i;b.Dump();++i}
i=0;for(var j=this.m_jointList;j;j=j.m_next){j.m_index=i;++i}
for(var j=this.m_jointList;j;j=j.m_next){if(j.m_type===box2d.b2JointType.e_gearJoint){continue}
box2d.b2Log("if (true)\n");box2d.b2Log("{\n");j.Dump();box2d.b2Log("}\n")}
for(var j=this.m_jointList;j;j=j.m_next){if(j.m_type!==box2d.b2JointType.e_gearJoint){continue}
box2d.b2Log("if (true)\n");box2d.b2Log("{\n");j.Dump();box2d.b2Log("}\n")}}}
box2d.b2World.prototype.AddController=function(controller){if(box2d.ENABLE_ASSERTS){box2d.b2Assert(controller.m_world===null,"Controller can only be a member of one world")}
controller.m_world=this;controller.m_next=this.m_controllerList;controller.m_prev=null;if(this.m_controllerList)
this.m_controllerList.m_prev=controller;this.m_controllerList=controller;++this.m_controllerCount;return controller}
box2d.b2World.prototype.RemoveController=function(controller){if(box2d.ENABLE_ASSERTS){box2d.b2Assert(controller.m_world===this,"Controller is not a member of this world")}
if(controller.m_prev)
controller.m_prev.m_next=controller.m_next;if(controller.m_next)
controller.m_next.m_prev=controller.m_prev;if(this.m_controllerList===controller)
this.m_controllerList=controller.m_next;--this.m_controllerCount;controller.m_prev=null;controller.m_next=null;controller.m_world=null}
goog.provide('box2d.b2AreaJoint');goog.require('box2d.b2Settings');goog.require('box2d.b2Joint');goog.require('box2d.b2Math');box2d.b2AreaJointDef=function(){goog.base(this,box2d.b2JointType.e_areaJoint);this.bodies=new Array()}
goog.inherits(box2d.b2AreaJointDef,box2d.b2JointDef);box2d.b2AreaJointDef.prototype.world=null;box2d.b2AreaJointDef.prototype.bodies=null;box2d.b2AreaJointDef.prototype.frequencyHz=0;box2d.b2AreaJointDef.prototype.dampingRatio=0;box2d.b2AreaJointDef.prototype.AddBody=function(body){this.bodies.push(body);if(this.bodies.length===1){this.bodyA=body}
else if(this.bodies.length===2){this.bodyB=body}}
box2d.b2AreaJoint=function(def){goog.base(this,def);if(box2d.ENABLE_ASSERTS){box2d.b2Assert(def.bodies.length>=3,"You cannot create an area joint with less than three bodies.")}
this.m_bodies=def.bodies;this.m_frequencyHz=def.frequencyHz;this.m_dampingRatio=def.dampingRatio;this.m_targetLengths=box2d.b2MakeNumberArray(def.bodies.length);this.m_normals=box2d.b2Vec2.MakeArray(def.bodies.length);this.m_joints=new Array(def.bodies.length);this.m_deltas=box2d.b2Vec2.MakeArray(def.bodies.length);this.m_delta=new box2d.b2Vec2();var djd=new box2d.b2DistanceJointDef();djd.frequencyHz=def.frequencyHz;djd.dampingRatio=def.dampingRatio;this.m_targetArea=0;for(var i=0,ict=this.m_bodies.length;i<ict;++i){var body=this.m_bodies[i];var next=this.m_bodies[(i+1)%ict];var body_c=body.GetWorldCenter();var next_c=next.GetWorldCenter();this.m_targetLengths[i]=box2d.b2DistanceVV(body_c,next_c);this.m_targetArea+=box2d.b2CrossVV(body_c,next_c);djd.Initialize(body,next,body_c,next_c);this.m_joints[i]=def.world.CreateJoint(djd)}
this.m_targetArea*=0.5}
goog.inherits(box2d.b2AreaJoint,box2d.b2Joint);box2d.b2AreaJoint.prototype.m_bodies=null;box2d.b2AreaJoint.prototype.m_frequencyHz=0;box2d.b2AreaJoint.prototype.m_dampingRatio=0;box2d.b2AreaJoint.prototype.m_impulse=0;box2d.b2AreaJoint.prototype.m_targetLengths=null;box2d.b2AreaJoint.prototype.m_targetArea=0;box2d.b2AreaJoint.prototype.m_normals=null;box2d.b2AreaJoint.prototype.m_joints=null;box2d.b2AreaJoint.prototype.m_deltas=null;box2d.b2AreaJoint.prototype.m_delta=null;box2d.b2AreaJoint.prototype.GetAnchorA=function(out){return out.SetZero()}
box2d.b2AreaJoint.prototype.GetAnchorB=function(out){return out.SetZero()}
box2d.b2AreaJoint.prototype.GetReactionForce=function(inv_dt,out){return out.SetZero()}
box2d.b2AreaJoint.prototype.GetReactionTorque=function(inv_dt){return 0}
box2d.b2AreaJoint.prototype.SetFrequency=function(hz){this.m_frequencyHz=hz;for(var i=0,ict=this.m_joints.length;i<ict;++i){this.m_joints[i].SetFrequency(hz)}}
box2d.b2AreaJoint.prototype.GetFrequency=function(){return this.m_frequencyHz}
box2d.b2AreaJoint.prototype.SetDampingRatio=function(ratio){this.m_dampingRatio=ratio;for(var i=0,ict=this.m_joints.length;i<ict;++i){this.m_joints[i].SetDampingRatio(ratio)}}
box2d.b2AreaJoint.prototype.GetDampingRatio=function(){return this.m_dampingRatio}
box2d.b2AreaJoint.prototype.Dump=function(){if(box2d.DEBUG){box2d.b2Log("Area joint dumping is not supported.\n")}}
box2d.b2AreaJoint.prototype.InitVelocityConstraints=function(data){for(var i=0,ict=this.m_bodies.length;i<ict;++i){var prev=this.m_bodies[(i+ict-1)%ict];var next=this.m_bodies[(i+1)%ict];var prev_c=data.positions[prev.m_islandIndex].c;var next_c=data.positions[next.m_islandIndex].c;var delta=this.m_deltas[i];box2d.b2SubVV(next_c,prev_c,delta)}
if(data.step.warmStarting){this.m_impulse*=data.step.dtRatio;for(var i=0,ict=this.m_bodies.length;i<ict;++i){var body=this.m_bodies[i];var body_v=data.velocities[body.m_islandIndex].v;var delta=this.m_deltas[i];body_v.x+=body.m_invMass*delta.y*0.5*this.m_impulse;body_v.y+=body.m_invMass*-delta.x*0.5*this.m_impulse}}
else{this.m_impulse=0}}
box2d.b2AreaJoint.prototype.SolveVelocityConstraints=function(data){var dotMassSum=0;var crossMassSum=0;for(var i=0,ict=this.m_bodies.length;i<ict;++i){var body=this.m_bodies[i];var body_v=data.velocities[body.m_islandIndex].v;var delta=this.m_deltas[i];dotMassSum+=delta.GetLengthSquared()/body.GetMass();crossMassSum+=box2d.b2CrossVV(body_v,delta)}
var lambda=-2*crossMassSum/dotMassSum;this.m_impulse+=lambda;for(var i=0,ict=this.m_bodies.length;i<ict;++i){var body=this.m_bodies[i];var body_v=data.velocities[body.m_islandIndex].v;var delta=this.m_deltas[i];body_v.x+=body.m_invMass*delta.y*0.5*lambda;body_v.y+=body.m_invMass*-delta.x*0.5*lambda}}
box2d.b2AreaJoint.prototype.SolvePositionConstraints=function(data){var perimeter=0;var area=0;for(var i=0,ict=this.m_bodies.length;i<ict;++i){var body=this.m_bodies[i];var next=this.m_bodies[(i+1)%ict];var body_c=data.positions[body.m_islandIndex].c;var next_c=data.positions[next.m_islandIndex].c;var delta=box2d.b2SubVV(next_c,body_c,this.m_delta);var dist=delta.GetLength();if(dist<box2d.b2_epsilon){dist=1}
this.m_normals[i].x=delta.y/dist;this.m_normals[i].y=-delta.x/dist;perimeter+=dist;area+=box2d.b2CrossVV(body_c,next_c)}
area*=0.5;var deltaArea=this.m_targetArea-area;var toExtrude=0.5*deltaArea/perimeter;var done=!0;for(var i=0,ict=this.m_bodies.length;i<ict;++i){var body=this.m_bodies[i];var body_c=data.positions[body.m_islandIndex].c;var next_i=(i+1)%ict;var delta=box2d.b2AddVV(this.m_normals[i],this.m_normals[next_i],this.m_delta);delta.SelfMul(toExtrude);var norm_sq=delta.GetLengthSquared();if(norm_sq>box2d.b2Sq(box2d.b2_maxLinearCorrection)){delta.SelfMul(box2d.b2_maxLinearCorrection/box2d.b2Sqrt(norm_sq))}
if(norm_sq>box2d.b2Sq(box2d.b2_linearSlop)){done=!1}
body_c.x+=delta.x;body_c.y+=delta.y}
return done}
goog.provide('box2d.b2BuoyancyController');goog.require('box2d.b2Settings');goog.require('box2d.b2Controller');goog.require('box2d.b2Math');goog.require('box2d.b2WorldCallbacks');box2d.b2BuoyancyController=function(){goog.base(this);this.normal=new box2d.b2Vec2(0,1);this.velocity=new box2d.b2Vec2(0,0);this.gravity=new box2d.b2Vec2(0,0)};goog.inherits(box2d.b2BuoyancyController,box2d.b2Controller);box2d.b2BuoyancyController.prototype.normal=null;box2d.b2BuoyancyController.prototype.offset=0;box2d.b2BuoyancyController.prototype.density=0;box2d.b2BuoyancyController.prototype.velocity=null;box2d.b2BuoyancyController.prototype.linearDrag=0;box2d.b2BuoyancyController.prototype.angularDrag=0;box2d.b2BuoyancyController.prototype.useDensity=!1;box2d.b2BuoyancyController.prototype.useWorldGravity=!0;box2d.b2BuoyancyController.prototype.gravity=null;box2d.b2BuoyancyController.prototype.Step=function(step){if(!this.m_bodyList)
return;if(this.useWorldGravity){this.gravity.Copy(this.GetWorld().GetGravity())}
for(var i=this.m_bodyList;i;i=i.nextBody){var body=i.body;if(body.IsAwake()===!1){continue}
var areac=new box2d.b2Vec2();var massc=new box2d.b2Vec2();var area=0;var mass=0;for(var fixture=body.GetFixtureList();fixture;fixture=fixture.m_next){var sc=new box2d.b2Vec2();var sarea=fixture.GetShape().ComputeSubmergedArea(this.normal,this.offset,body.GetTransform(),sc);area+=sarea;areac.x+=sarea*sc.x;areac.y+=sarea*sc.y;var shapeDensity=0;if(this.useDensity){shapeDensity=fixture.GetDensity()}
else{shapeDensity=1}
mass+=sarea*shapeDensity;massc.x+=sarea*sc.x*shapeDensity;massc.y+=sarea*sc.y*shapeDensity}
areac.x/=area;areac.y/=area;massc.x/=mass;massc.y/=mass;if(area<box2d.b2_epsilon)
continue;var buoyancyForce=box2d.b2NegV(this.gravity,new box2d.b2Vec2());buoyancyForce.SelfMul(this.density*area);body.ApplyForce(buoyancyForce,massc);var dragForce=body.GetLinearVelocityFromWorldPoint(areac,new box2d.b2Vec2());dragForce.SelfSub(this.velocity);dragForce.SelfMul((-this.linearDrag*area));body.ApplyForce(dragForce,areac);body.ApplyTorque((-body.GetInertia()/body.GetMass()*area*body.GetAngularVelocity()*this.angularDrag))}}
box2d.b2BuoyancyController.prototype.Draw=function(debugDraw){var r=100;var p1=new box2d.b2Vec2();var p2=new box2d.b2Vec2();p1.x=this.normal.x*this.offset+this.normal.y*r;p1.y=this.normal.y*this.offset-this.normal.x*r;p2.x=this.normal.x*this.offset-this.normal.y*r;p2.y=this.normal.y*this.offset+this.normal.x*r;var color=new box2d.b2Color(0,0,0.8);debugDraw.DrawSegment(p1,p2,color)}
goog.provide('box2d.b2TensorDampingController');goog.require('box2d.b2Settings');goog.require('box2d.b2Controller');goog.require('box2d.b2Math');box2d.b2TensorDampingController=function(){goog.base(this);this.T=new box2d.b2Mat22();this.maxTimestep=0};goog.inherits(box2d.b2TensorDampingController,box2d.b2Controller);box2d.b2TensorDampingController.prototype.T=new box2d.b2Mat22();box2d.b2TensorDampingController.prototype.maxTimestep=0;box2d.b2TensorDampingController.prototype.Step=function(step){var timestep=step.dt;if(timestep<=box2d.b2_epsilon)
return;if(timestep>this.maxTimestep&&this.maxTimestep>0)
timestep=this.maxTimestep;for(var i=this.m_bodyList;i;i=i.nextBody){var body=i.body;if(!body.IsAwake())
continue;var damping=body.GetWorldVector(box2d.b2MulMV(this.T,body.GetLocalVector(body.GetLinearVelocity(),box2d.b2Vec2.s_t0),box2d.b2Vec2.s_t1),box2d.b2TensorDampingController.prototype.Step.s_damping);body.SetLinearVelocity(box2d.b2AddVV(body.GetLinearVelocity(),box2d.b2MulSV(timestep,damping,box2d.b2Vec2.s_t0),box2d.b2Vec2.s_t1))}}
box2d.b2TensorDampingController.prototype.Step.s_damping=new box2d.b2Vec2();box2d.b2TensorDampingController.prototype.SetAxisAligned=function(xDamping,yDamping){this.T.ex.x=(-xDamping);this.T.ex.y=0;this.T.ey.x=0;this.T.ey.y=(-yDamping);if(xDamping>0||yDamping>0){this.maxTimestep=1/box2d.b2Max(xDamping,yDamping)}
else{this.maxTimestep=0}}
goog.provide('box2d.b2DistanceJoint');goog.require('box2d.b2Settings');goog.require('box2d.b2Joint');goog.require('box2d.b2Math');box2d.b2DistanceJointDef=function(){goog.base(this,box2d.b2JointType.e_distanceJoint);this.localAnchorA=new box2d.b2Vec2();this.localAnchorB=new box2d.b2Vec2()}
goog.inherits(box2d.b2DistanceJointDef,box2d.b2JointDef);box2d.b2DistanceJointDef.prototype.localAnchorA=null;box2d.b2DistanceJointDef.prototype.localAnchorB=null;box2d.b2DistanceJointDef.prototype.length=1;box2d.b2DistanceJointDef.prototype.frequencyHz=0;box2d.b2DistanceJointDef.prototype.dampingRatio=0;box2d.b2DistanceJointDef.prototype.Initialize=function(b1,b2,anchor1,anchor2){this.bodyA=b1;this.bodyB=b2;this.bodyA.GetLocalPoint(anchor1,this.localAnchorA);this.bodyB.GetLocalPoint(anchor2,this.localAnchorB);this.length=box2d.b2DistanceVV(anchor1,anchor2);this.frequencyHz=0;this.dampingRatio=0}
box2d.b2DistanceJoint=function(def){goog.base(this,def);this.m_u=new box2d.b2Vec2();this.m_rA=new box2d.b2Vec2();this.m_rB=new box2d.b2Vec2();this.m_localCenterA=new box2d.b2Vec2();this.m_localCenterB=new box2d.b2Vec2();this.m_qA=new box2d.b2Rot();this.m_qB=new box2d.b2Rot();this.m_lalcA=new box2d.b2Vec2();this.m_lalcB=new box2d.b2Vec2();this.m_frequencyHz=def.frequencyHz;this.m_dampingRatio=def.dampingRatio;this.m_localAnchorA=def.localAnchorA.Clone();this.m_localAnchorB=def.localAnchorB.Clone();this.m_length=def.length}
goog.inherits(box2d.b2DistanceJoint,box2d.b2Joint);box2d.b2DistanceJoint.prototype.m_frequencyHz=0;box2d.b2DistanceJoint.prototype.m_dampingRatio=0;box2d.b2DistanceJoint.prototype.m_bias=0;box2d.b2DistanceJoint.prototype.m_localAnchorA=null;box2d.b2DistanceJoint.prototype.m_localAnchorB=null;box2d.b2DistanceJoint.prototype.m_gamma=0;box2d.b2DistanceJoint.prototype.m_impulse=0;box2d.b2DistanceJoint.prototype.m_length=0;box2d.b2DistanceJoint.prototype.m_indexA=0;box2d.b2DistanceJoint.prototype.m_indexB=0;box2d.b2DistanceJoint.prototype.m_u=null;box2d.b2DistanceJoint.prototype.m_rA=null;box2d.b2DistanceJoint.prototype.m_rB=null;box2d.b2DistanceJoint.prototype.m_localCenterA=null;box2d.b2DistanceJoint.prototype.m_localCenterB=null;box2d.b2DistanceJoint.prototype.m_invMassA=0;box2d.b2DistanceJoint.prototype.m_invMassB=0;box2d.b2DistanceJoint.prototype.m_invIA=0;box2d.b2DistanceJoint.prototype.m_invIB=0;box2d.b2DistanceJoint.prototype.m_mass=0;box2d.b2DistanceJoint.prototype.m_qA=null;box2d.b2DistanceJoint.prototype.m_qB=null;box2d.b2DistanceJoint.prototype.m_lalcA=null;box2d.b2DistanceJoint.prototype.m_lalcB=null;box2d.b2DistanceJoint.prototype.GetAnchorA=function(out){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,out)}
box2d.b2DistanceJoint.prototype.GetAnchorB=function(out){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,out)}
box2d.b2DistanceJoint.prototype.GetReactionForce=function(inv_dt,out){return out.SetXY(inv_dt*this.m_impulse*this.m_u.x,inv_dt*this.m_impulse*this.m_u.y)}
box2d.b2DistanceJoint.prototype.GetReactionTorque=function(inv_dt){return 0}
box2d.b2DistanceJoint.prototype.GetLocalAnchorA=function(out){return out.Copy(this.m_localAnchorA)}
box2d.b2DistanceJoint.prototype.GetLocalAnchorB=function(out){return out.Copy(this.m_localAnchorB)}
box2d.b2DistanceJoint.prototype.SetLength=function(length){this.m_length=length}
box2d.b2DistanceJoint.prototype.GetLength=function(){return this.m_length}
box2d.b2DistanceJoint.prototype.SetFrequency=function(hz){this.m_frequencyHz=hz}
box2d.b2DistanceJoint.prototype.GetFrequency=function(){return this.m_frequencyHz}
box2d.b2DistanceJoint.prototype.SetDampingRatio=function(ratio){this.m_dampingRatio=ratio}
box2d.b2DistanceJoint.prototype.GetDampingRatio=function(){return this.m_dampingRatio}
box2d.b2DistanceJoint.prototype.Dump=function(){if(box2d.DEBUG){var indexA=this.m_bodyA.m_islandIndex;var indexB=this.m_bodyB.m_islandIndex;box2d.b2Log("  /*box2d.b2DistanceJointDef*/ var jd = new box2d.b2DistanceJointDef();\n");box2d.b2Log("  jd.bodyA = bodies[%d];\n",indexA);box2d.b2Log("  jd.bodyB = bodies[%d];\n",indexB);box2d.b2Log("  jd.collideConnected = %s;\n",(this.m_collideConnected)?('true'):('false'));box2d.b2Log("  jd.localAnchorA.SetXY(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y);box2d.b2Log("  jd.localAnchorB.SetXY(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y);box2d.b2Log("  jd.length = %.15f;\n",this.m_length);box2d.b2Log("  jd.frequencyHz = %.15f;\n",this.m_frequencyHz);box2d.b2Log("  jd.dampingRatio = %.15f;\n",this.m_dampingRatio);box2d.b2Log("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)}}
box2d.b2DistanceJoint.prototype.InitVelocityConstraints=function(data){this.m_indexA=this.m_bodyA.m_islandIndex;this.m_indexB=this.m_bodyB.m_islandIndex;this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter);this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter);this.m_invMassA=this.m_bodyA.m_invMass;this.m_invMassB=this.m_bodyB.m_invMass;this.m_invIA=this.m_bodyA.m_invI;this.m_invIB=this.m_bodyB.m_invI;var cA=data.positions[this.m_indexA].c;var aA=data.positions[this.m_indexA].a;var vA=data.velocities[this.m_indexA].v;var wA=data.velocities[this.m_indexA].w;var cB=data.positions[this.m_indexB].c;var aB=data.positions[this.m_indexB].a;var vB=data.velocities[this.m_indexB].v;var wB=data.velocities[this.m_indexB].w;var qA=this.m_qA.SetAngleRadians(aA),qB=this.m_qB.SetAngleRadians(aB);box2d.b2SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);box2d.b2MulRV(qA,this.m_lalcA,this.m_rA);box2d.b2SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);box2d.b2MulRV(qB,this.m_lalcB,this.m_rB);this.m_u.x=cB.x+this.m_rB.x-cA.x-this.m_rA.x;this.m_u.y=cB.y+this.m_rB.y-cA.y-this.m_rA.y;var length=this.m_u.GetLength();if(length>box2d.b2_linearSlop){this.m_u.SelfMul(1/length)}
else{this.m_u.SetZero()}
var crAu=box2d.b2CrossVV(this.m_rA,this.m_u);var crBu=box2d.b2CrossVV(this.m_rB,this.m_u);var invMass=this.m_invMassA+this.m_invIA*crAu*crAu+this.m_invMassB+this.m_invIB*crBu*crBu;this.m_mass=invMass!==0?1/invMass:0;if(this.m_frequencyHz>0){var C=length-this.m_length;var omega=2*box2d.b2_pi*this.m_frequencyHz;var d=2*this.m_mass*this.m_dampingRatio*omega;var k=this.m_mass*omega*omega;var h=data.step.dt;this.m_gamma=h*(d+h*k);this.m_gamma=this.m_gamma!==0?1/this.m_gamma:0;this.m_bias=C*h*k*this.m_gamma;invMass+=this.m_gamma;this.m_mass=invMass!==0?1/invMass:0}
else{this.m_gamma=0;this.m_bias=0}
if(data.step.warmStarting){this.m_impulse*=data.step.dtRatio;var P=box2d.b2MulSV(this.m_impulse,this.m_u,box2d.b2DistanceJoint.prototype.InitVelocityConstraints.s_P);vA.SelfMulSub(this.m_invMassA,P);wA-=this.m_invIA*box2d.b2CrossVV(this.m_rA,P);vB.SelfMulAdd(this.m_invMassB,P);wB+=this.m_invIB*box2d.b2CrossVV(this.m_rB,P)}
else{this.m_impulse=0}
data.velocities[this.m_indexA].w=wA;data.velocities[this.m_indexB].w=wB}
box2d.b2DistanceJoint.prototype.InitVelocityConstraints.s_P=new box2d.b2Vec2();box2d.b2DistanceJoint.prototype.SolveVelocityConstraints=function(data){var vA=data.velocities[this.m_indexA].v;var wA=data.velocities[this.m_indexA].w;var vB=data.velocities[this.m_indexB].v;var wB=data.velocities[this.m_indexB].w;var vpA=box2d.b2AddVCrossSV(vA,wA,this.m_rA,box2d.b2DistanceJoint.prototype.SolveVelocityConstraints.s_vpA);var vpB=box2d.b2AddVCrossSV(vB,wB,this.m_rB,box2d.b2DistanceJoint.prototype.SolveVelocityConstraints.s_vpB);var Cdot=box2d.b2DotVV(this.m_u,box2d.b2SubVV(vpB,vpA,box2d.b2Vec2.s_t0));var impulse=(-this.m_mass*(Cdot+this.m_bias+this.m_gamma*this.m_impulse));this.m_impulse+=impulse;var P=box2d.b2MulSV(impulse,this.m_u,box2d.b2DistanceJoint.prototype.SolveVelocityConstraints.s_P);vA.SelfMulSub(this.m_invMassA,P);wA-=this.m_invIA*box2d.b2CrossVV(this.m_rA,P);vB.SelfMulAdd(this.m_invMassB,P);wB+=this.m_invIB*box2d.b2CrossVV(this.m_rB,P);data.velocities[this.m_indexA].w=wA;data.velocities[this.m_indexB].w=wB}
box2d.b2DistanceJoint.prototype.SolveVelocityConstraints.s_vpA=new box2d.b2Vec2();box2d.b2DistanceJoint.prototype.SolveVelocityConstraints.s_vpB=new box2d.b2Vec2();box2d.b2DistanceJoint.prototype.SolveVelocityConstraints.s_P=new box2d.b2Vec2();box2d.b2DistanceJoint.prototype.SolvePositionConstraints=function(data){if(this.m_frequencyHz>0){return !0}
var cA=data.positions[this.m_indexA].c;var aA=data.positions[this.m_indexA].a;var cB=data.positions[this.m_indexB].c;var aB=data.positions[this.m_indexB].a;var qA=this.m_qA.SetAngleRadians(aA),qB=this.m_qB.SetAngleRadians(aB);var rA=box2d.b2MulRV(this.m_qA,this.m_lalcA,this.m_rA);var rB=box2d.b2MulRV(this.m_qB,this.m_lalcB,this.m_rB);var u=this.m_u;u.x=cB.x+rB.x-cA.x-rA.x;u.y=cB.y+rB.y-cA.y-rA.y;var length=this.m_u.Normalize();var C=length-this.m_length;C=box2d.b2Clamp(C,(-box2d.b2_maxLinearCorrection),box2d.b2_maxLinearCorrection);var impulse=(-this.m_mass*C);var P=box2d.b2MulSV(impulse,u,box2d.b2DistanceJoint.prototype.SolvePositionConstraints.s_P);cA.SelfMulSub(this.m_invMassA,P);aA-=this.m_invIA*box2d.b2CrossVV(rA,P);cB.SelfMulAdd(this.m_invMassB,P);aB+=this.m_invIB*box2d.b2CrossVV(rB,P);data.positions[this.m_indexA].a=aA;data.positions[this.m_indexB].a=aB;return box2d.b2Abs(C)<box2d.b2_linearSlop}
box2d.b2DistanceJoint.prototype.SolvePositionConstraints.s_P=new box2d.b2Vec2();goog.provide('box2d.b2FrictionJoint');goog.require('box2d.b2Settings');goog.require('box2d.b2Joint');goog.require('box2d.b2Math');box2d.b2FrictionJointDef=function(){goog.base(this,box2d.b2JointType.e_frictionJoint);this.localAnchorA=new box2d.b2Vec2();this.localAnchorB=new box2d.b2Vec2()}
goog.inherits(box2d.b2FrictionJointDef,box2d.b2JointDef);box2d.b2FrictionJointDef.prototype.localAnchorA=null;box2d.b2FrictionJointDef.prototype.localAnchorB=null;box2d.b2FrictionJointDef.prototype.maxForce=0;box2d.b2FrictionJointDef.prototype.maxTorque=0;box2d.b2FrictionJointDef.prototype.Initialize=function(bA,bB,anchor){this.bodyA=bA;this.bodyB=bB;this.bodyA.GetLocalPoint(anchor,this.localAnchorA);this.bodyB.GetLocalPoint(anchor,this.localAnchorB)}
box2d.b2FrictionJoint=function(def){goog.base(this,def);this.m_localAnchorA=def.localAnchorA.Clone();this.m_localAnchorB=def.localAnchorB.Clone();this.m_linearImpulse=new box2d.b2Vec2().SetZero();this.m_maxForce=def.maxForce;this.m_maxTorque=def.maxTorque;this.m_rA=new box2d.b2Vec2();this.m_rB=new box2d.b2Vec2();this.m_localCenterA=new box2d.b2Vec2();this.m_localCenterB=new box2d.b2Vec2();this.m_linearMass=new box2d.b2Mat22().SetZero();this.m_qA=new box2d.b2Rot();this.m_qB=new box2d.b2Rot();this.m_lalcA=new box2d.b2Vec2();this.m_lalcB=new box2d.b2Vec2();this.m_K=new box2d.b2Mat22()}
goog.inherits(box2d.b2FrictionJoint,box2d.b2Joint);box2d.b2FrictionJoint.prototype.m_localAnchorA=null;box2d.b2FrictionJoint.prototype.m_localAnchorB=null;box2d.b2FrictionJoint.prototype.m_linearImpulse=null;box2d.b2FrictionJoint.prototype.m_angularImpulse=0;box2d.b2FrictionJoint.prototype.m_maxForce=0;box2d.b2FrictionJoint.prototype.m_maxTorque=0;box2d.b2FrictionJoint.prototype.m_indexA=0;box2d.b2FrictionJoint.prototype.m_indexB=0;box2d.b2FrictionJoint.prototype.m_rA=null;box2d.b2FrictionJoint.prototype.m_rB=null;box2d.b2FrictionJoint.prototype.m_localCenterA=null;box2d.b2FrictionJoint.prototype.m_localCenterB=null;box2d.b2FrictionJoint.prototype.m_invMassA=0;box2d.b2FrictionJoint.prototype.m_invMassB=0;box2d.b2FrictionJoint.prototype.m_invIA=0;box2d.b2FrictionJoint.prototype.m_invIB=0;box2d.b2FrictionJoint.prototype.m_linearMass=null;box2d.b2FrictionJoint.prototype.m_angularMass=0;box2d.b2FrictionJoint.prototype.m_qA=null;box2d.b2FrictionJoint.prototype.m_qB=null;box2d.b2FrictionJoint.prototype.m_lalcA=null;box2d.b2FrictionJoint.prototype.m_lalcB=null;box2d.b2FrictionJoint.prototype.m_K=null;box2d.b2FrictionJoint.prototype.InitVelocityConstraints=function(data){this.m_indexA=this.m_bodyA.m_islandIndex;this.m_indexB=this.m_bodyB.m_islandIndex;this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter);this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter);this.m_invMassA=this.m_bodyA.m_invMass;this.m_invMassB=this.m_bodyB.m_invMass;this.m_invIA=this.m_bodyA.m_invI;this.m_invIB=this.m_bodyB.m_invI;var aA=data.positions[this.m_indexA].a;var vA=data.velocities[this.m_indexA].v;var wA=data.velocities[this.m_indexA].w;var aB=data.positions[this.m_indexB].a;var vB=data.velocities[this.m_indexB].v;var wB=data.velocities[this.m_indexB].w;var qA=this.m_qA.SetAngleRadians(aA),qB=this.m_qB.SetAngleRadians(aB);box2d.b2SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);var rA=box2d.b2MulRV(qA,this.m_lalcA,this.m_rA);box2d.b2SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);var rB=box2d.b2MulRV(qB,this.m_lalcB,this.m_rB);var mA=this.m_invMassA,mB=this.m_invMassB;var iA=this.m_invIA,iB=this.m_invIB;var K=this.m_K;K.ex.x=mA+mB+iA*rA.y*rA.y+iB*rB.y*rB.y;K.ex.y=-iA*rA.x*rA.y-iB*rB.x*rB.y;K.ey.x=K.ex.y;K.ey.y=mA+mB+iA*rA.x*rA.x+iB*rB.x*rB.x;K.GetInverse(this.m_linearMass);this.m_angularMass=iA+iB;if(this.m_angularMass>0){this.m_angularMass=1/this.m_angularMass}
if(data.step.warmStarting){this.m_linearImpulse.SelfMul(data.step.dtRatio);this.m_angularImpulse*=data.step.dtRatio;var P=this.m_linearImpulse;vA.SelfMulSub(mA,P);wA-=iA*(box2d.b2CrossVV(this.m_rA,P)+this.m_angularImpulse);vB.SelfMulAdd(mB,P);wB+=iB*(box2d.b2CrossVV(this.m_rB,P)+this.m_angularImpulse)}
else{this.m_linearImpulse.SetZero();this.m_angularImpulse=0}
data.velocities[this.m_indexA].w=wA;data.velocities[this.m_indexB].w=wB}
box2d.b2FrictionJoint.prototype.SolveVelocityConstraints=function(data){var vA=data.velocities[this.m_indexA].v;var wA=data.velocities[this.m_indexA].w;var vB=data.velocities[this.m_indexB].v;var wB=data.velocities[this.m_indexB].w;var mA=this.m_invMassA,mB=this.m_invMassB;var iA=this.m_invIA,iB=this.m_invIB;var h=data.step.dt;if(!0){var Cdot=wB-wA;var impulse=(-this.m_angularMass*Cdot);var oldImpulse=this.m_angularImpulse;var maxImpulse=h*this.m_maxTorque;this.m_angularImpulse=box2d.b2Clamp(this.m_angularImpulse+impulse,(-maxImpulse),maxImpulse);impulse=this.m_angularImpulse-oldImpulse;wA-=iA*impulse;wB+=iB*impulse}
if(!0){var Cdot=box2d.b2SubVV(box2d.b2AddVCrossSV(vB,wB,this.m_rB,box2d.b2Vec2.s_t0),box2d.b2AddVCrossSV(vA,wA,this.m_rA,box2d.b2Vec2.s_t1),box2d.b2FrictionJoint.prototype.SolveVelocityConstraints.s_Cdot);var impulseV=box2d.b2MulMV(this.m_linearMass,Cdot,box2d.b2FrictionJoint.prototype.SolveVelocityConstraints.s_impulseV).SelfNeg();var oldImpulseV=box2d.b2FrictionJoint.prototype.SolveVelocityConstraints.s_oldImpulseV.Copy(this.m_linearImpulse);this.m_linearImpulse.SelfAdd(impulseV);var maxImpulse=h*this.m_maxForce;if(this.m_linearImpulse.GetLengthSquared()>maxImpulse*maxImpulse){this.m_linearImpulse.Normalize();this.m_linearImpulse.SelfMul(maxImpulse)}
box2d.b2SubVV(this.m_linearImpulse,oldImpulseV,impulseV);vA.SelfMulSub(mA,impulseV);wA-=iA*box2d.b2CrossVV(this.m_rA,impulseV);vB.SelfMulAdd(mB,impulseV);wB+=iB*box2d.b2CrossVV(this.m_rB,impulseV)}
data.velocities[this.m_indexA].w=wA;data.velocities[this.m_indexB].w=wB}
box2d.b2FrictionJoint.prototype.SolveVelocityConstraints.s_Cdot=new box2d.b2Vec2();box2d.b2FrictionJoint.prototype.SolveVelocityConstraints.s_impulseV=new box2d.b2Vec2();box2d.b2FrictionJoint.prototype.SolveVelocityConstraints.s_oldImpulseV=new box2d.b2Vec2();box2d.b2FrictionJoint.prototype.SolvePositionConstraints=function(data){return !0}
box2d.b2FrictionJoint.prototype.GetAnchorA=function(out){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,out)}
box2d.b2FrictionJoint.prototype.GetAnchorB=function(out){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,out)}
box2d.b2FrictionJoint.prototype.GetReactionForce=function(inv_dt,out){return out.SetXY(inv_dt*this.m_linearImpulse.x,inv_dt*this.m_linearImpulse.y)}
box2d.b2FrictionJoint.prototype.GetReactionTorque=function(inv_dt){return inv_dt*this.m_angularImpulse}
box2d.b2FrictionJoint.prototype.GetLocalAnchorA=function(out){return out.Copy(this.m_localAnchorA)}
box2d.b2FrictionJoint.prototype.GetLocalAnchorB=function(out){return out.Copy(this.m_localAnchorB)}
box2d.b2FrictionJoint.prototype.SetMaxForce=function(force){this.m_maxForce=force}
box2d.b2FrictionJoint.prototype.GetMaxForce=function(){return this.m_maxForce}
box2d.b2FrictionJoint.prototype.SetMaxTorque=function(torque){this.m_maxTorque=torque}
box2d.b2FrictionJoint.prototype.GetMaxTorque=function(){return this.m_maxTorque}
box2d.b2FrictionJoint.prototype.Dump=function(){if(box2d.DEBUG){var indexA=this.m_bodyA.m_islandIndex;var indexB=this.m_bodyB.m_islandIndex;box2d.b2Log("  /*box2d.b2FrictionJointDef*/ var jd = new box2d.b2FrictionJointDef();\n");box2d.b2Log("  jd.bodyA = bodies[%d];\n",indexA);box2d.b2Log("  jd.bodyB = bodies[%d];\n",indexB);box2d.b2Log("  jd.collideConnected = %s;\n",(this.m_collideConnected)?('true'):('false'));box2d.b2Log("  jd.localAnchorA.SetXY(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y);box2d.b2Log("  jd.localAnchorB.SetXY(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y);box2d.b2Log("  jd.maxForce = %.15f;\n",this.m_maxForce);box2d.b2Log("  jd.maxTorque = %.15f;\n",this.m_maxTorque);box2d.b2Log("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)}}
goog.provide('box2d.b2MouseJoint');goog.require('box2d.b2Settings');goog.require('box2d.b2Joint');goog.require('box2d.b2Math');box2d.b2MouseJointDef=function(){goog.base(this,box2d.b2JointType.e_mouseJoint);this.target=new box2d.b2Vec2()}
goog.inherits(box2d.b2MouseJointDef,box2d.b2JointDef);box2d.b2MouseJointDef.prototype.target=null;box2d.b2MouseJointDef.prototype.maxForce=0;box2d.b2MouseJointDef.prototype.frequencyHz=5;box2d.b2MouseJointDef.prototype.dampingRatio=0.7;box2d.b2MouseJoint=function(def){goog.base(this,def);this.m_localAnchorB=new box2d.b2Vec2();this.m_targetA=new box2d.b2Vec2();this.m_impulse=new box2d.b2Vec2();this.m_rB=new box2d.b2Vec2();this.m_localCenterB=new box2d.b2Vec2();this.m_mass=new box2d.b2Mat22();this.m_C=new box2d.b2Vec2();this.m_qB=new box2d.b2Rot();this.m_lalcB=new box2d.b2Vec2();this.m_K=new box2d.b2Mat22();if(box2d.ENABLE_ASSERTS){box2d.b2Assert(def.target.IsValid())}
if(box2d.ENABLE_ASSERTS){box2d.b2Assert(box2d.b2IsValid(def.maxForce)&&def.maxForce>=0)}
if(box2d.ENABLE_ASSERTS){box2d.b2Assert(box2d.b2IsValid(def.frequencyHz)&&def.frequencyHz>=0)}
if(box2d.ENABLE_ASSERTS){box2d.b2Assert(box2d.b2IsValid(def.dampingRatio)&&def.dampingRatio>=0)}
this.m_targetA.Copy(def.target);box2d.b2MulTXV(this.m_bodyB.GetTransform(),this.m_targetA,this.m_localAnchorB);this.m_maxForce=def.maxForce;this.m_impulse.SetZero();this.m_frequencyHz=def.frequencyHz;this.m_dampingRatio=def.dampingRatio;this.m_beta=0;this.m_gamma=0}
goog.inherits(box2d.b2MouseJoint,box2d.b2Joint);box2d.b2MouseJoint.prototype.m_localAnchorB=null;box2d.b2MouseJoint.prototype.m_targetA=null;box2d.b2MouseJoint.prototype.m_frequencyHz=0;box2d.b2MouseJoint.prototype.m_dampingRatio=0;box2d.b2MouseJoint.prototype.m_beta=0;box2d.b2MouseJoint.prototype.m_impulse=null;box2d.b2MouseJoint.prototype.m_maxForce=0;box2d.b2MouseJoint.prototype.m_gamma=0;box2d.b2MouseJoint.prototype.m_indexA=0;box2d.b2MouseJoint.prototype.m_indexB=0;box2d.b2MouseJoint.prototype.m_rB=null;box2d.b2MouseJoint.prototype.m_localCenterB=null;box2d.b2MouseJoint.prototype.m_invMassB=0;box2d.b2MouseJoint.prototype.m_invIB=0;box2d.b2MouseJoint.prototype.m_mass=null;box2d.b2MouseJoint.prototype.m_C=null;box2d.b2MouseJoint.prototype.m_qB=null;box2d.b2MouseJoint.prototype.m_lalcB=null;box2d.b2MouseJoint.prototype.m_K=null;box2d.b2MouseJoint.prototype.SetTarget=function(target){if(this.m_bodyB.IsAwake()===!1){this.m_bodyB.SetAwake(!0)}
this.m_targetA.Copy(target)}
box2d.b2MouseJoint.prototype.GetTarget=function(out){return out.Copy(this.m_targetA)}
box2d.b2MouseJoint.prototype.SetMaxForce=function(maxForce){this.m_maxForce=maxForce}
box2d.b2MouseJoint.prototype.GetMaxForce=function(){return this.m_maxForce}
box2d.b2MouseJoint.prototype.SetFrequency=function(hz){this.m_frequencyHz=hz}
box2d.b2MouseJoint.prototype.GetFrequency=function(){return this.m_frequencyHz}
box2d.b2MouseJoint.prototype.SetDampingRatio=function(ratio){this.m_dampingRatio=ratio}
box2d.b2MouseJoint.prototype.GetDampingRatio=function(){return this.m_dampingRatio}
box2d.b2MouseJoint.prototype.InitVelocityConstraints=function(data){this.m_indexB=this.m_bodyB.m_islandIndex;this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter);this.m_invMassB=this.m_bodyB.m_invMass;this.m_invIB=this.m_bodyB.m_invI;var cB=data.positions[this.m_indexB].c;var aB=data.positions[this.m_indexB].a;var vB=data.velocities[this.m_indexB].v;var wB=data.velocities[this.m_indexB].w;var qB=this.m_qB.SetAngleRadians(aB);var mass=this.m_bodyB.GetMass();var omega=2*box2d.b2_pi*this.m_frequencyHz;var d=2*mass*this.m_dampingRatio*omega;var k=mass*(omega*omega);var h=data.step.dt;if(box2d.ENABLE_ASSERTS){box2d.b2Assert(d+h*k>box2d.b2_epsilon)}
this.m_gamma=h*(d+h*k);if(this.m_gamma!==0){this.m_gamma=1/this.m_gamma}
this.m_beta=h*k*this.m_gamma;box2d.b2SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);box2d.b2MulRV(qB,this.m_lalcB,this.m_rB);var K=this.m_K;K.ex.x=this.m_invMassB+this.m_invIB*this.m_rB.y*this.m_rB.y+this.m_gamma;K.ex.y=-this.m_invIB*this.m_rB.x*this.m_rB.y;K.ey.x=K.ex.y;K.ey.y=this.m_invMassB+this.m_invIB*this.m_rB.x*this.m_rB.x+this.m_gamma;K.GetInverse(this.m_mass);this.m_C.x=cB.x+this.m_rB.x-this.m_targetA.x;this.m_C.y=cB.y+this.m_rB.y-this.m_targetA.y;this.m_C.SelfMul(this.m_beta);wB*=0.98;if(data.step.warmStarting){this.m_impulse.SelfMul(data.step.dtRatio);vB.x+=this.m_invMassB*this.m_impulse.x;vB.y+=this.m_invMassB*this.m_impulse.y;wB+=this.m_invIB*box2d.b2CrossVV(this.m_rB,this.m_impulse)}
else{this.m_impulse.SetZero()}
data.velocities[this.m_indexB].w=wB}
box2d.b2MouseJoint.prototype.SolveVelocityConstraints=function(data){var vB=data.velocities[this.m_indexB].v;var wB=data.velocities[this.m_indexB].w;var Cdot=box2d.b2AddVCrossSV(vB,wB,this.m_rB,box2d.b2MouseJoint.prototype.SolveVelocityConstraints.s_Cdot);var impulse=box2d.b2MulMV(this.m_mass,box2d.b2AddVV(Cdot,box2d.b2AddVV(this.m_C,box2d.b2MulSV(this.m_gamma,this.m_impulse,box2d.b2Vec2.s_t0),box2d.b2Vec2.s_t0),box2d.b2Vec2.s_t0).SelfNeg(),box2d.b2MouseJoint.prototype.SolveVelocityConstraints.s_impulse);var oldImpulse=box2d.b2MouseJoint.prototype.SolveVelocityConstraints.s_oldImpulse.Copy(this.m_impulse);this.m_impulse.SelfAdd(impulse);var maxImpulse=data.step.dt*this.m_maxForce;if(this.m_impulse.GetLengthSquared()>maxImpulse*maxImpulse){this.m_impulse.SelfMul(maxImpulse/this.m_impulse.GetLength())}
box2d.b2SubVV(this.m_impulse,oldImpulse,impulse);vB.SelfMulAdd(this.m_invMassB,impulse);wB+=this.m_invIB*box2d.b2CrossVV(this.m_rB,impulse);data.velocities[this.m_indexB].w=wB}
box2d.b2MouseJoint.prototype.SolveVelocityConstraints.s_Cdot=new box2d.b2Vec2();box2d.b2MouseJoint.prototype.SolveVelocityConstraints.s_impulse=new box2d.b2Vec2();box2d.b2MouseJoint.prototype.SolveVelocityConstraints.s_oldImpulse=new box2d.b2Vec2();box2d.b2MouseJoint.prototype.SolvePositionConstraints=function(data){return !0}
box2d.b2MouseJoint.prototype.GetAnchorA=function(out){return out.Copy(this.m_targetA)}
box2d.b2MouseJoint.prototype.GetAnchorB=function(out){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,out)}
box2d.b2MouseJoint.prototype.GetReactionForce=function(inv_dt,out){return box2d.b2MulSV(inv_dt,this.m_impulse,out)}
box2d.b2MouseJoint.prototype.GetReactionTorque=function(inv_dt){return 0}
box2d.b2MouseJoint.prototype.Dump=function(){if(box2d.DEBUG){box2d.b2Log("Mouse joint dumping is not supported.\n")}}
box2d.b2MouseJoint.prototype.ShiftOrigin=function(newOrigin){this.m_targetA.SelfSub(newOrigin)}
goog.provide('box2d.b2ConstantForceController');goog.require('box2d.b2Settings');goog.require('box2d.b2Controller');goog.require('box2d.b2Math');box2d.b2ConstantForceController=function(){goog.base(this);this.F=new box2d.b2Vec2(0,0)};goog.inherits(box2d.b2ConstantForceController,box2d.b2Controller);box2d.b2ConstantAccelController.prototype.F=null;box2d.b2ConstantForceController.prototype.Step=function(step){for(var i=this.m_bodyList;i;i=i.nextBody){var body=i.body;if(!body.IsAwake())
continue;body.ApplyForce(this.F,body.GetWorldCenter())}}
goog.provide('box2d.b2PulleyJoint');goog.require('box2d.b2Settings');goog.require('box2d.b2Joint');goog.require('box2d.b2Math');box2d.b2_minPulleyLength=2;box2d.b2PulleyJointDef=function(){goog.base(this,box2d.b2JointType.e_pulleyJoint);this.collideConnected=!0;this.groundAnchorA=new box2d.b2Vec2(-1,1);this.groundAnchorB=new box2d.b2Vec2(1,1);this.localAnchorA=new box2d.b2Vec2(-1,0);this.localAnchorB=new box2d.b2Vec2(1,0)}
goog.inherits(box2d.b2PulleyJointDef,box2d.b2JointDef);box2d.b2PulleyJointDef.prototype.groundAnchorA=null;box2d.b2PulleyJointDef.prototype.groundAnchorB=null;box2d.b2PulleyJointDef.prototype.localAnchorA=null;box2d.b2PulleyJointDef.prototype.localAnchorB=null;box2d.b2PulleyJointDef.prototype.lengthA=0;box2d.b2PulleyJointDef.prototype.lengthB=0;box2d.b2PulleyJointDef.prototype.ratio=1;box2d.b2PulleyJointDef.prototype.Initialize=function(bA,bB,groundA,groundB,anchorA,anchorB,r){this.bodyA=bA;this.bodyB=bB;this.groundAnchorA.Copy(groundA);this.groundAnchorB.Copy(groundB);this.bodyA.GetLocalPoint(anchorA,this.localAnchorA);this.bodyB.GetLocalPoint(anchorB,this.localAnchorB);this.lengthA=box2d.b2DistanceVV(anchorA,groundA);this.lengthB=box2d.b2DistanceVV(anchorB,groundB);this.ratio=r;if(box2d.ENABLE_ASSERTS){box2d.b2Assert(this.ratio>box2d.b2_epsilon)}}
box2d.b2PulleyJoint=function(def){goog.base(this,def);this.m_groundAnchorA=new box2d.b2Vec2();this.m_groundAnchorB=new box2d.b2Vec2();this.m_localAnchorA=new box2d.b2Vec2();this.m_localAnchorB=new box2d.b2Vec2();this.m_uA=new box2d.b2Vec2();this.m_uB=new box2d.b2Vec2();this.m_rA=new box2d.b2Vec2();this.m_rB=new box2d.b2Vec2();this.m_localCenterA=new box2d.b2Vec2();this.m_localCenterB=new box2d.b2Vec2();this.m_qA=new box2d.b2Rot();this.m_qB=new box2d.b2Rot();this.m_lalcA=new box2d.b2Vec2();this.m_lalcB=new box2d.b2Vec2();this.m_groundAnchorA.Copy(def.groundAnchorA);this.m_groundAnchorB.Copy(def.groundAnchorB);this.m_localAnchorA.Copy(def.localAnchorA);this.m_localAnchorB.Copy(def.localAnchorB);this.m_lengthA=def.lengthA;this.m_lengthB=def.lengthB;if(box2d.ENABLE_ASSERTS){box2d.b2Assert(def.ratio!==0)}
this.m_ratio=def.ratio;this.m_constant=def.lengthA+this.m_ratio*def.lengthB;this.m_impulse=0}
goog.inherits(box2d.b2PulleyJoint,box2d.b2Joint);box2d.b2PulleyJoint.prototype.m_groundAnchorA=null;box2d.b2PulleyJoint.prototype.m_groundAnchorB=null;box2d.b2PulleyJoint.prototype.m_lengthA=0;box2d.b2PulleyJoint.prototype.m_lengthB=0;box2d.b2PulleyJoint.prototype.m_localAnchorA=null;box2d.b2PulleyJoint.prototype.m_localAnchorB=null;box2d.b2PulleyJoint.prototype.m_constant=0;box2d.b2PulleyJoint.prototype.m_ratio=0;box2d.b2PulleyJoint.prototype.m_impulse=0;box2d.b2PulleyJoint.prototype.m_indexA=0;box2d.b2PulleyJoint.prototype.m_indexB=0;box2d.b2PulleyJoint.prototype.m_uA=null;box2d.b2PulleyJoint.prototype.m_uB=null;box2d.b2PulleyJoint.prototype.m_rA=null;box2d.b2PulleyJoint.prototype.m_rB=null;box2d.b2PulleyJoint.prototype.m_localCenterA=null;box2d.b2PulleyJoint.prototype.m_localCenterB=null;box2d.b2PulleyJoint.prototype.m_invMassA=0;box2d.b2PulleyJoint.prototype.m_invMassB=0;box2d.b2PulleyJoint.prototype.m_invIA=0;box2d.b2PulleyJoint.prototype.m_invIB=0;box2d.b2PulleyJoint.prototype.m_mass=0;box2d.b2PulleyJoint.prototype.m_qA=null;box2d.b2PulleyJoint.prototype.m_qB=null;box2d.b2PulleyJoint.prototype.m_lalcA=null;box2d.b2PulleyJoint.prototype.m_lalcB=null;box2d.b2PulleyJoint.prototype.InitVelocityConstraints=function(data){this.m_indexA=this.m_bodyA.m_islandIndex;this.m_indexB=this.m_bodyB.m_islandIndex;this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter);this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter);this.m_invMassA=this.m_bodyA.m_invMass;this.m_invMassB=this.m_bodyB.m_invMass;this.m_invIA=this.m_bodyA.m_invI;this.m_invIB=this.m_bodyB.m_invI;var cA=data.positions[this.m_indexA].c;var aA=data.positions[this.m_indexA].a;var vA=data.velocities[this.m_indexA].v;var wA=data.velocities[this.m_indexA].w;var cB=data.positions[this.m_indexB].c;var aB=data.positions[this.m_indexB].a;var vB=data.velocities[this.m_indexB].v;var wB=data.velocities[this.m_indexB].w;var qA=this.m_qA.SetAngleRadians(aA),qB=this.m_qB.SetAngleRadians(aB);box2d.b2SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);box2d.b2MulRV(qA,this.m_lalcA,this.m_rA);box2d.b2SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);box2d.b2MulRV(qB,this.m_lalcB,this.m_rB);this.m_uA.Copy(cA).SelfAdd(this.m_rA).SelfSub(this.m_groundAnchorA);this.m_uB.Copy(cB).SelfAdd(this.m_rB).SelfSub(this.m_groundAnchorB);var lengthA=this.m_uA.GetLength();var lengthB=this.m_uB.GetLength();if(lengthA>10*box2d.b2_linearSlop){this.m_uA.SelfMul(1/lengthA)}
else{this.m_uA.SetZero()}
if(lengthB>10*box2d.b2_linearSlop){this.m_uB.SelfMul(1/lengthB)}
else{this.m_uB.SetZero()}
var ruA=box2d.b2CrossVV(this.m_rA,this.m_uA);var ruB=box2d.b2CrossVV(this.m_rB,this.m_uB);var mA=this.m_invMassA+this.m_invIA*ruA*ruA;var mB=this.m_invMassB+this.m_invIB*ruB*ruB;this.m_mass=mA+this.m_ratio*this.m_ratio*mB;if(this.m_mass>0){this.m_mass=1/this.m_mass}
if(data.step.warmStarting){this.m_impulse*=data.step.dtRatio;var PA=box2d.b2MulSV(-(this.m_impulse),this.m_uA,box2d.b2PulleyJoint.prototype.InitVelocityConstraints.s_PA);var PB=box2d.b2MulSV((-this.m_ratio*this.m_impulse),this.m_uB,box2d.b2PulleyJoint.prototype.InitVelocityConstraints.s_PB);vA.SelfMulAdd(this.m_invMassA,PA);wA+=this.m_invIA*box2d.b2CrossVV(this.m_rA,PA);vB.SelfMulAdd(this.m_invMassB,PB);wB+=this.m_invIB*box2d.b2CrossVV(this.m_rB,PB)}
else{this.m_impulse=0}
data.velocities[this.m_indexA].w=wA;data.velocities[this.m_indexB].w=wB}
box2d.b2PulleyJoint.prototype.InitVelocityConstraints.s_PA=new box2d.b2Vec2();box2d.b2PulleyJoint.prototype.InitVelocityConstraints.s_PB=new box2d.b2Vec2();box2d.b2PulleyJoint.prototype.SolveVelocityConstraints=function(data){var vA=data.velocities[this.m_indexA].v;var wA=data.velocities[this.m_indexA].w;var vB=data.velocities[this.m_indexB].v;var wB=data.velocities[this.m_indexB].w;var vpA=box2d.b2AddVCrossSV(vA,wA,this.m_rA,box2d.b2PulleyJoint.prototype.SolveVelocityConstraints.s_vpA);var vpB=box2d.b2AddVCrossSV(vB,wB,this.m_rB,box2d.b2PulleyJoint.prototype.SolveVelocityConstraints.s_vpB);var Cdot=-box2d.b2DotVV(this.m_uA,vpA)-this.m_ratio*box2d.b2DotVV(this.m_uB,vpB);var impulse=-this.m_mass*Cdot;this.m_impulse+=impulse;var PA=box2d.b2MulSV(-impulse,this.m_uA,box2d.b2PulleyJoint.prototype.SolveVelocityConstraints.s_PA);var PB=box2d.b2MulSV(-this.m_ratio*impulse,this.m_uB,box2d.b2PulleyJoint.prototype.SolveVelocityConstraints.s_PB);vA.SelfMulAdd(this.m_invMassA,PA);wA+=this.m_invIA*box2d.b2CrossVV(this.m_rA,PA);vB.SelfMulAdd(this.m_invMassB,PB);wB+=this.m_invIB*box2d.b2CrossVV(this.m_rB,PB);data.velocities[this.m_indexA].w=wA;data.velocities[this.m_indexB].w=wB}
box2d.b2PulleyJoint.prototype.SolveVelocityConstraints.s_vpA=new box2d.b2Vec2();box2d.b2PulleyJoint.prototype.SolveVelocityConstraints.s_vpB=new box2d.b2Vec2();box2d.b2PulleyJoint.prototype.SolveVelocityConstraints.s_PA=new box2d.b2Vec2();box2d.b2PulleyJoint.prototype.SolveVelocityConstraints.s_PB=new box2d.b2Vec2();box2d.b2PulleyJoint.prototype.SolvePositionConstraints=function(data){var cA=data.positions[this.m_indexA].c;var aA=data.positions[this.m_indexA].a;var cB=data.positions[this.m_indexB].c;var aB=data.positions[this.m_indexB].a;var qA=this.m_qA.SetAngleRadians(aA),qB=this.m_qB.SetAngleRadians(aB);box2d.b2SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);var rA=box2d.b2MulRV(qA,this.m_lalcA,this.m_rA);box2d.b2SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);var rB=box2d.b2MulRV(qB,this.m_lalcB,this.m_rB);var uA=this.m_uA.Copy(cA).SelfAdd(rA).SelfSub(this.m_groundAnchorA);var uB=this.m_uB.Copy(cB).SelfAdd(rB).SelfSub(this.m_groundAnchorB);var lengthA=uA.GetLength();var lengthB=uB.GetLength();if(lengthA>10*box2d.b2_linearSlop){uA.SelfMul(1/lengthA)}
else{uA.SetZero()}
if(lengthB>10*box2d.b2_linearSlop){uB.SelfMul(1/lengthB)}
else{uB.SetZero()}
var ruA=box2d.b2CrossVV(rA,uA);var ruB=box2d.b2CrossVV(rB,uB);var mA=this.m_invMassA+this.m_invIA*ruA*ruA;var mB=this.m_invMassB+this.m_invIB*ruB*ruB;var mass=mA+this.m_ratio*this.m_ratio*mB;if(mass>0){mass=1/mass}
var C=this.m_constant-lengthA-this.m_ratio*lengthB;var linearError=box2d.b2Abs(C);var impulse=-mass*C;var PA=box2d.b2MulSV(-impulse,uA,box2d.b2PulleyJoint.prototype.SolvePositionConstraints.s_PA);var PB=box2d.b2MulSV(-this.m_ratio*impulse,uB,box2d.b2PulleyJoint.prototype.SolvePositionConstraints.s_PB);cA.SelfMulAdd(this.m_invMassA,PA);aA+=this.m_invIA*box2d.b2CrossVV(rA,PA);cB.SelfMulAdd(this.m_invMassB,PB);aB+=this.m_invIB*box2d.b2CrossVV(rB,PB);data.positions[this.m_indexA].a=aA;data.positions[this.m_indexB].a=aB;return linearError<box2d.b2_linearSlop}
box2d.b2PulleyJoint.prototype.SolvePositionConstraints.s_PA=new box2d.b2Vec2();box2d.b2PulleyJoint.prototype.SolvePositionConstraints.s_PB=new box2d.b2Vec2();box2d.b2PulleyJoint.prototype.GetAnchorA=function(out){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,out)}
box2d.b2PulleyJoint.prototype.GetAnchorB=function(out){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,out)}
box2d.b2PulleyJoint.prototype.GetReactionForce=function(inv_dt,out){return out.SetXY(inv_dt*this.m_impulse*this.m_uB.x,inv_dt*this.m_impulse*this.m_uB.y)}
box2d.b2PulleyJoint.prototype.GetReactionTorque=function(inv_dt){return 0}
box2d.b2PulleyJoint.prototype.GetGroundAnchorA=function(out){return out.Copy(this.m_groundAnchorA)}
box2d.b2PulleyJoint.prototype.GetGroundAnchorB=function(out){return out.Copy(this.m_groundAnchorB)}
box2d.b2PulleyJoint.prototype.GetLengthA=function(){return this.m_lengthA}
box2d.b2PulleyJoint.prototype.GetLengthB=function(){return this.m_lengthB}
box2d.b2PulleyJoint.prototype.GetRatio=function(){return this.m_ratio}
box2d.b2PulleyJoint.prototype.GetCurrentLengthA=function(){var p=this.m_bodyA.GetWorldPoint(this.m_localAnchorA,box2d.b2PulleyJoint.prototype.GetCurrentLengthA.s_p);var s=this.m_groundAnchorA;return box2d.b2DistanceVV(p,s)}
box2d.b2PulleyJoint.prototype.GetCurrentLengthA.s_p=new box2d.b2Vec2();box2d.b2PulleyJoint.prototype.GetCurrentLengthB=function(){var p=this.m_bodyB.GetWorldPoint(this.m_localAnchorB,box2d.b2PulleyJoint.prototype.GetCurrentLengthB.s_p);var s=this.m_groundAnchorB;return box2d.b2DistanceVV(p,s)}
box2d.b2PulleyJoint.prototype.GetCurrentLengthB.s_p=new box2d.b2Vec2();box2d.b2PulleyJoint.prototype.Dump=function(){if(box2d.DEBUG){var indexA=this.m_bodyA.m_islandIndex;var indexB=this.m_bodyB.m_islandIndex;box2d.b2Log("  /*box2d.b2PulleyJointDef*/ var jd = new box2d.b2PulleyJointDef();\n");box2d.b2Log("  jd.bodyA = bodies[%d];\n",indexA);box2d.b2Log("  jd.bodyB = bodies[%d];\n",indexB);box2d.b2Log("  jd.collideConnected = %s;\n",(this.m_collideConnected)?('true'):('false'));box2d.b2Log("  jd.groundAnchorA.SetXY(%.15f, %.15f);\n",this.m_groundAnchorA.x,this.m_groundAnchorA.y);box2d.b2Log("  jd.groundAnchorB.SetXY(%.15f, %.15f);\n",this.m_groundAnchorB.x,this.m_groundAnchorB.y);box2d.b2Log("  jd.localAnchorA.SetXY(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y);box2d.b2Log("  jd.localAnchorB.SetXY(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y);box2d.b2Log("  jd.lengthA = %.15f;\n",this.m_lengthA);box2d.b2Log("  jd.lengthB = %.15f;\n",this.m_lengthB);box2d.b2Log("  jd.ratio = %.15f;\n",this.m_ratio);box2d.b2Log("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)}}
box2d.b2PulleyJoint.prototype.ShiftOrigin=function(newOrigin){this.m_groundAnchorA.SelfSub(newOrigin);this.m_groundAnchorB.SelfSub(newOrigin)}
goog.provide('box2d.b2CircleShape');goog.require('box2d.b2Shape');box2d.b2CircleShape=function(radius){goog.base(this,box2d.b2ShapeType.e_circleShape,radius||0);this.m_p=new box2d.b2Vec2()}
goog.inherits(box2d.b2CircleShape,box2d.b2Shape);box2d.b2CircleShape.prototype.m_p=null;box2d.b2CircleShape.prototype.Clone=function(){return new box2d.b2CircleShape().Copy(this)}
box2d.b2CircleShape.prototype.Copy=function(other){goog.base(this,'Copy',other);if(box2d.ENABLE_ASSERTS){box2d.b2Assert(other instanceof box2d.b2CircleShape)}
this.m_p.Copy(other.m_p);return this}
box2d.b2CircleShape.prototype.GetChildCount=function(){return 1}
box2d.b2CircleShape.prototype.TestPoint=function(transform,p){var center=box2d.b2MulXV(transform,this.m_p,box2d.b2CircleShape.prototype.TestPoint.s_center);var d=box2d.b2SubVV(p,center,box2d.b2CircleShape.prototype.TestPoint.s_d);return box2d.b2DotVV(d,d)<=box2d.b2Sq(this.m_radius)}
box2d.b2CircleShape.prototype.TestPoint.s_center=new box2d.b2Vec2();box2d.b2CircleShape.prototype.TestPoint.s_d=new box2d.b2Vec2();box2d.b2CircleShape.prototype.RayCast=function(output,input,transform,childIndex){var position=box2d.b2MulXV(transform,this.m_p,box2d.b2CircleShape.prototype.RayCast.s_position);var s=box2d.b2SubVV(input.p1,position,box2d.b2CircleShape.prototype.RayCast.s_s);var b=box2d.b2DotVV(s,s)-box2d.b2Sq(this.m_radius);var r=box2d.b2SubVV(input.p2,input.p1,box2d.b2CircleShape.prototype.RayCast.s_r);var c=box2d.b2DotVV(s,r);var rr=box2d.b2DotVV(r,r);var sigma=c*c-rr*b;if(sigma<0||rr<box2d.b2_epsilon){return !1}
var a=(-(c+box2d.b2Sqrt(sigma)));if(0<=a&&a<=input.maxFraction*rr){a/=rr;output.fraction=a;box2d.b2AddVMulSV(s,a,r,output.normal).SelfNormalize();return !0}
return !1}
box2d.b2CircleShape.prototype.RayCast.s_position=new box2d.b2Vec2();box2d.b2CircleShape.prototype.RayCast.s_s=new box2d.b2Vec2();box2d.b2CircleShape.prototype.RayCast.s_r=new box2d.b2Vec2();box2d.b2CircleShape.prototype.ComputeAABB=function(aabb,transform,childIndex){var p=box2d.b2MulXV(transform,this.m_p,box2d.b2CircleShape.prototype.ComputeAABB.s_p);aabb.lowerBound.SetXY(p.x-this.m_radius,p.y-this.m_radius);aabb.upperBound.SetXY(p.x+this.m_radius,p.y+this.m_radius)}
box2d.b2CircleShape.prototype.ComputeAABB.s_p=new box2d.b2Vec2();box2d.b2CircleShape.prototype.ComputeMass=function(massData,density){var radius_sq=box2d.b2Sq(this.m_radius);massData.mass=density*box2d.b2_pi*radius_sq;massData.center.Copy(this.m_p);massData.I=massData.mass*(0.5*radius_sq+box2d.b2DotVV(this.m_p,this.m_p))}
box2d.b2CircleShape.prototype.SetupDistanceProxy=function(proxy,index){proxy.m_vertices=new Array(1,!0);proxy.m_vertices[0]=this.m_p;proxy.m_count=1;proxy.m_radius=this.m_radius}
box2d.b2CircleShape.prototype.ComputeSubmergedArea=function(normal,offset,xf,c){var p=box2d.b2MulXV(xf,this.m_p,new box2d.b2Vec2());var l=(-(box2d.b2DotVV(normal,p)-offset));if(l<(-this.m_radius)+box2d.b2_epsilon){return 0}
if(l>this.m_radius){c.Copy(p);return box2d.b2_pi*this.m_radius*this.m_radius}
var r2=this.m_radius*this.m_radius;var l2=l*l;var area=r2*(box2d.b2Asin(l/this.m_radius)+box2d.b2_pi/2)+l*box2d.b2Sqrt(r2-l2);var com=(-2/3*box2d.b2Pow(r2-l2,1.5)/area);c.x=p.x+normal.x*com;c.y=p.y+normal.y*com;return area}
box2d.b2CircleShape.prototype.Dump=function(){box2d.b2Log("    /*box2d.b2CircleShape*/ var shape = new box2d.b2CircleShape();\n");box2d.b2Log("    shape.m_radius = %.15f;\n",this.m_radius);box2d.b2Log("    shape.m_p.SetXY(%.15f, %.15f);\n",this.m_p.x,this.m_p.y)}
goog.provide('box2d.b2Rope');goog.require('box2d.b2Math');goog.require('box2d.b2Draw');box2d.b2RopeDef=function(){this.vertices=new Array();this.masses=new Array();this.gravity=new box2d.b2Vec2()};box2d.b2RopeDef.prototype.vertices=null;box2d.b2RopeDef.prototype.count=0;box2d.b2RopeDef.prototype.masses=null;box2d.b2RopeDef.prototype.gravity=null;box2d.b2RopeDef.prototype.damping=0.1;box2d.b2RopeDef.prototype.k2=0.9;box2d.b2RopeDef.prototype.k3=0.1;box2d.b2Rope=function(){this.m_gravity=new box2d.b2Vec2()};box2d.b2Rope.prototype.m_count=0;box2d.b2Rope.prototype.m_ps=null;box2d.b2Rope.prototype.m_p0s=null;box2d.b2Rope.prototype.m_vs=null;box2d.b2Rope.prototype.m_ims=null;box2d.b2Rope.prototype.m_Ls=null;box2d.b2Rope.prototype.m_as=null;box2d.b2Rope.prototype.m_gravity=null;box2d.b2Rope.prototype.m_damping=0;box2d.b2Rope.prototype.m_k2=1;box2d.b2Rope.prototype.m_k3=0.1;box2d.b2Rope.prototype.GetVertexCount=function(){return this.m_count}
box2d.b2Rope.prototype.GetVertices=function(){return this.m_ps}
box2d.b2Rope.prototype.Initialize=function(def){if(box2d.ENABLE_ASSERTS){box2d.b2Assert(def.count>=3)}
this.m_count=def.count;this.m_ps=box2d.b2Vec2.MakeArray(this.m_count);this.m_p0s=box2d.b2Vec2.MakeArray(this.m_count);this.m_vs=box2d.b2Vec2.MakeArray(this.m_count);this.m_ims=box2d.b2MakeNumberArray(this.m_count);for(var i=0;i<this.m_count;++i){this.m_ps[i].Copy(def.vertices[i]);this.m_p0s[i].Copy(def.vertices[i]);this.m_vs[i].SetZero();var m=def.masses[i];if(m>0){this.m_ims[i]=1/m}
else{this.m_ims[i]=0}}
var count2=this.m_count-1;var count3=this.m_count-2;this.m_Ls=box2d.b2MakeNumberArray(count2);this.m_as=box2d.b2MakeNumberArray(count3);for(var i=0;i<count2;++i){var p1=this.m_ps[i];var p2=this.m_ps[i+1];this.m_Ls[i]=box2d.b2DistanceVV(p1,p2)}
for(var i=0;i<count3;++i){var p1=this.m_ps[i];var p2=this.m_ps[i+1];var p3=this.m_ps[i+2];var d1=box2d.b2SubVV(p2,p1,box2d.b2Vec2.s_t0);var d2=box2d.b2SubVV(p3,p2,box2d.b2Vec2.s_t1);var a=box2d.b2CrossVV(d1,d2);var b=box2d.b2DotVV(d1,d2);this.m_as[i]=box2d.b2Atan2(a,b)}
this.m_gravity.Copy(def.gravity);this.m_damping=def.damping;this.m_k2=def.k2;this.m_k3=def.k3}
box2d.b2Rope.prototype.Step=function(h,iterations){if(h===0){return}
var d=Math.exp(-h*this.m_damping);for(var i=0;i<this.m_count;++i){this.m_p0s[i].Copy(this.m_ps[i]);if(this.m_ims[i]>0){this.m_vs[i].SelfMulAdd(h,this.m_gravity)}
this.m_vs[i].SelfMul(d);this.m_ps[i].SelfMulAdd(h,this.m_vs[i])}
for(var i=0;i<iterations;++i){this.SolveC2();this.SolveC3();this.SolveC2()}
var inv_h=1/h;for(var i=0;i<this.m_count;++i){box2d.b2MulSV(inv_h,box2d.b2SubVV(this.m_ps[i],this.m_p0s[i],box2d.b2Vec2.s_t0),this.m_vs[i])}}
box2d.b2Rope.prototype.SolveC2=function(){var count2=this.m_count-1;for(var i=0;i<count2;++i){var p1=this.m_ps[i];var p2=this.m_ps[i+1];var d=box2d.b2SubVV(p2,p1,box2d.b2Rope.s_d);var L=d.Normalize();var im1=this.m_ims[i];var im2=this.m_ims[i+1];if(im1+im2===0){continue}
var s1=im1/(im1+im2);var s2=im2/(im1+im2);p1.SelfMulSub(this.m_k2*s1*(this.m_Ls[i]-L),d);p2.SelfMulAdd(this.m_k2*s2*(this.m_Ls[i]-L),d)}}
box2d.b2Rope.s_d=new box2d.b2Vec2();box2d.b2Rope.prototype.SetAngleRadians=function(angle){var count3=this.m_count-2;for(var i=0;i<count3;++i){this.m_as[i]=angle}}
box2d.b2Rope.prototype.SolveC3=function(){var count3=this.m_count-2;for(var i=0;i<count3;++i){var p1=this.m_ps[i];var p2=this.m_ps[i+1];var p3=this.m_ps[i+2];var m1=this.m_ims[i];var m2=this.m_ims[i+1];var m3=this.m_ims[i+2];var d1=box2d.b2SubVV(p2,p1,box2d.b2Rope.s_d1);var d2=box2d.b2SubVV(p3,p2,box2d.b2Rope.s_d2);var L1sqr=d1.GetLengthSquared();var L2sqr=d2.GetLengthSquared();if(L1sqr*L2sqr===0){continue}
var a=box2d.b2CrossVV(d1,d2);var b=box2d.b2DotVV(d1,d2);var angle=box2d.b2Atan2(a,b);var Jd1=box2d.b2MulSV((-1/L1sqr),d1.SelfSkew(),box2d.b2Rope.s_Jd1);var Jd2=box2d.b2MulSV((1/L2sqr),d2.SelfSkew(),box2d.b2Rope.s_Jd2);var J1=box2d.b2NegV(Jd1,box2d.b2Rope.s_J1);var J2=box2d.b2SubVV(Jd1,Jd2,box2d.b2Rope.s_J2);var J3=Jd2;var mass=m1*box2d.b2DotVV(J1,J1)+m2*box2d.b2DotVV(J2,J2)+m3*box2d.b2DotVV(J3,J3);if(mass===0){continue}
mass=1/mass;var C=angle-this.m_as[i];while(C>box2d.b2_pi){angle-=2*box2d.b2_pi;C=angle-this.m_as[i]}
while(C<-box2d.b2_pi){angle+=2*box2d.b2_pi;C=angle-this.m_as[i]}
var impulse=-this.m_k3*mass*C;p1.SelfMulAdd((m1*impulse),J1);p2.SelfMulAdd((m2*impulse),J2);p3.SelfMulAdd((m3*impulse),J3)}}
box2d.b2Rope.s_d1=new box2d.b2Vec2();box2d.b2Rope.s_d2=new box2d.b2Vec2();box2d.b2Rope.s_Jd1=new box2d.b2Vec2();box2d.b2Rope.s_Jd2=new box2d.b2Vec2();box2d.b2Rope.s_J1=new box2d.b2Vec2();box2d.b2Rope.s_J2=new box2d.b2Vec2();box2d.b2Rope.prototype.Draw=function(draw){var c=new box2d.b2Color(0.4,0.5,0.7);for(var i=0;i<this.m_count-1;++i){draw.DrawSegment(this.m_ps[i],this.m_ps[i+1],c)}}
goog.provide('box2d.b2WheelJoint');goog.require('box2d.b2Settings');goog.require('box2d.b2Math');box2d.b2WheelJointDef=function(){goog.base(this,box2d.b2JointType.e_wheelJoint);this.localAnchorA=new box2d.b2Vec2(0,0);this.localAnchorB=new box2d.b2Vec2(0,0);this.localAxisA=new box2d.b2Vec2(1,0)}
goog.inherits(box2d.b2WheelJointDef,box2d.b2JointDef);box2d.b2WheelJointDef.prototype.localAnchorA=null;box2d.b2WheelJointDef.prototype.localAnchorB=null;box2d.b2WheelJointDef.prototype.localAxisA=null;box2d.b2WheelJointDef.prototype.enableMotor=!1;box2d.b2WheelJointDef.prototype.maxMotorTorque=0;box2d.b2WheelJointDef.prototype.motorSpeed=0;box2d.b2WheelJointDef.prototype.frequencyHz=2;box2d.b2WheelJointDef.prototype.dampingRatio=0.7;box2d.b2WheelJointDef.prototype.Initialize=function(bA,bB,anchor,axis){this.bodyA=bA;this.bodyB=bB;this.bodyA.GetLocalPoint(anchor,this.localAnchorA);this.bodyB.GetLocalPoint(anchor,this.localAnchorB);this.bodyA.GetLocalVector(axis,this.localAxisA)}
box2d.b2WheelJoint=function(def){goog.base(this,def);this.m_frequencyHz=def.frequencyHz;this.m_dampingRatio=def.dampingRatio;this.m_localAnchorA=def.localAnchorA.Clone();this.m_localAnchorB=def.localAnchorB.Clone();this.m_localXAxisA=def.localAxisA.Clone();this.m_localYAxisA=box2d.b2CrossOneV(this.m_localXAxisA,new box2d.b2Vec2());this.m_maxMotorTorque=def.maxMotorTorque;this.m_motorSpeed=def.motorSpeed;this.m_enableMotor=def.enableMotor;this.m_localCenterA=new box2d.b2Vec2();this.m_localCenterB=new box2d.b2Vec2();this.m_ax=new box2d.b2Vec2(),this.m_ay=new box2d.b2Vec2();this.m_qA=new box2d.b2Rot();this.m_qB=new box2d.b2Rot();this.m_lalcA=new box2d.b2Vec2();this.m_lalcB=new box2d.b2Vec2();this.m_rA=new box2d.b2Vec2();this.m_rB=new box2d.b2Vec2();this.m_ax.SetZero();this.m_ay.SetZero()}
goog.inherits(box2d.b2WheelJoint,box2d.b2Joint);box2d.b2WheelJoint.prototype.m_frequencyHz=0;box2d.b2WheelJoint.prototype.m_dampingRatio=0;box2d.b2WheelJoint.prototype.m_localAnchorA=null;box2d.b2WheelJoint.prototype.m_localAnchorB=null;box2d.b2WheelJoint.prototype.m_localXAxisA=null;box2d.b2WheelJoint.prototype.m_localYAxisA=null;box2d.b2WheelJoint.prototype.m_impulse=0;box2d.b2WheelJoint.prototype.m_motorImpulse=0;box2d.b2WheelJoint.prototype.m_springImpulse=0;box2d.b2WheelJoint.prototype.m_maxMotorTorque=0;box2d.b2WheelJoint.prototype.m_motorSpeed=0;box2d.b2WheelJoint.prototype.m_enableMotor=!1;box2d.b2WheelJoint.prototype.m_indexA=0;box2d.b2WheelJoint.prototype.m_indexB=0;box2d.b2WheelJoint.prototype.m_localCenterA=null;box2d.b2WheelJoint.prototype.m_localCenterB=null;box2d.b2WheelJoint.prototype.m_invMassA=0;box2d.b2WheelJoint.prototype.m_invMassB=0;box2d.b2WheelJoint.prototype.m_invIA=0;box2d.b2WheelJoint.prototype.m_invIB=0;box2d.b2WheelJoint.prototype.m_ax=null;box2d.b2WheelJoint.prototype.m_ay=null;box2d.b2WheelJoint.prototype.m_sAx=0;box2d.b2WheelJoint.prototype.m_sBx=0;box2d.b2WheelJoint.prototype.m_sAy=0;box2d.b2WheelJoint.prototype.m_sBy=0;box2d.b2WheelJoint.prototype.m_mass=0;box2d.b2WheelJoint.prototype.m_motorMass=0;box2d.b2WheelJoint.prototype.m_springMass=0;box2d.b2WheelJoint.prototype.m_bias=0;box2d.b2WheelJoint.prototype.m_gamma=0;box2d.b2WheelJoint.prototype.m_qA=null;box2d.b2WheelJoint.prototype.m_qB=null;box2d.b2WheelJoint.prototype.m_lalcA=null;box2d.b2WheelJoint.prototype.m_lalcB=null;box2d.b2WheelJoint.prototype.m_rA=null;box2d.b2WheelJoint.prototype.m_rB=null;box2d.b2WheelJoint.prototype.GetMotorSpeed=function(){return this.m_motorSpeed}
box2d.b2WheelJoint.prototype.GetMaxMotorTorque=function(){return this.m_maxMotorTorque}
box2d.b2WheelJoint.prototype.SetSpringFrequencyHz=function(hz){this.m_frequencyHz=hz}
box2d.b2WheelJoint.prototype.GetSpringFrequencyHz=function(){return this.m_frequencyHz}
box2d.b2WheelJoint.prototype.SetSpringDampingRatio=function(ratio){this.m_dampingRatio=ratio}
box2d.b2WheelJoint.prototype.GetSpringDampingRatio=function(){return this.m_dampingRatio}
box2d.b2WheelJoint.prototype.InitVelocityConstraints=function(data){this.m_indexA=this.m_bodyA.m_islandIndex;this.m_indexB=this.m_bodyB.m_islandIndex;this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter);this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter);this.m_invMassA=this.m_bodyA.m_invMass;this.m_invMassB=this.m_bodyB.m_invMass;this.m_invIA=this.m_bodyA.m_invI;this.m_invIB=this.m_bodyB.m_invI;var mA=this.m_invMassA,mB=this.m_invMassB;var iA=this.m_invIA,iB=this.m_invIB;var cA=data.positions[this.m_indexA].c;var aA=data.positions[this.m_indexA].a;var vA=data.velocities[this.m_indexA].v;var wA=data.velocities[this.m_indexA].w;var cB=data.positions[this.m_indexB].c;var aB=data.positions[this.m_indexB].a;var vB=data.velocities[this.m_indexB].v;var wB=data.velocities[this.m_indexB].w;var qA=this.m_qA.SetAngleRadians(aA),qB=this.m_qB.SetAngleRadians(aB);box2d.b2SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);var rA=box2d.b2MulRV(qA,this.m_lalcA,this.m_rA);box2d.b2SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);var rB=box2d.b2MulRV(qB,this.m_lalcB,this.m_rB);var d=box2d.b2SubVV(box2d.b2AddVV(cB,rB,box2d.b2Vec2.s_t0),box2d.b2AddVV(cA,rA,box2d.b2Vec2.s_t1),box2d.b2WheelJoint.prototype.InitVelocityConstraints.s_d);{box2d.b2MulRV(qA,this.m_localYAxisA,this.m_ay);this.m_sAy=box2d.b2CrossVV(box2d.b2AddVV(d,rA,box2d.b2Vec2.s_t0),this.m_ay);this.m_sBy=box2d.b2CrossVV(rB,this.m_ay);this.m_mass=mA+mB+iA*this.m_sAy*this.m_sAy+iB*this.m_sBy*this.m_sBy;if(this.m_mass>0){this.m_mass=1/this.m_mass}}
this.m_springMass=0;this.m_bias=0;this.m_gamma=0;if(this.m_frequencyHz>0){box2d.b2MulRV(qA,this.m_localXAxisA,this.m_ax);this.m_sAx=box2d.b2CrossVV(box2d.b2AddVV(d,rA,box2d.b2Vec2.s_t0),this.m_ax);this.m_sBx=box2d.b2CrossVV(rB,this.m_ax);var invMass=mA+mB+iA*this.m_sAx*this.m_sAx+iB*this.m_sBx*this.m_sBx;if(invMass>0){this.m_springMass=1/invMass;var C=box2d.b2DotVV(d,this.m_ax);var omega=2*box2d.b2_pi*this.m_frequencyHz;var dc=2*this.m_springMass*this.m_dampingRatio*omega;var k=this.m_springMass*omega*omega;var h=data.step.dt;this.m_gamma=h*(dc+h*k);if(this.m_gamma>0){this.m_gamma=1/this.m_gamma}
this.m_bias=C*h*k*this.m_gamma;this.m_springMass=invMass+this.m_gamma;if(this.m_springMass>0){this.m_springMass=1/this.m_springMass}}}
else{this.m_springImpulse=0}
if(this.m_enableMotor){this.m_motorMass=iA+iB;if(this.m_motorMass>0){this.m_motorMass=1/this.m_motorMass}}
else{this.m_motorMass=0;this.m_motorImpulse=0}
if(data.step.warmStarting){this.m_impulse*=data.step.dtRatio;this.m_springImpulse*=data.step.dtRatio;this.m_motorImpulse*=data.step.dtRatio;var P=box2d.b2AddVV(box2d.b2MulSV(this.m_impulse,this.m_ay,box2d.b2Vec2.s_t0),box2d.b2MulSV(this.m_springImpulse,this.m_ax,box2d.b2Vec2.s_t1),box2d.b2WheelJoint.prototype.InitVelocityConstraints.s_P);var LA=this.m_impulse*this.m_sAy+this.m_springImpulse*this.m_sAx+this.m_motorImpulse;var LB=this.m_impulse*this.m_sBy+this.m_springImpulse*this.m_sBx+this.m_motorImpulse;vA.SelfMulSub(this.m_invMassA,P);wA-=this.m_invIA*LA;vB.SelfMulAdd(this.m_invMassB,P);wB+=this.m_invIB*LB}
else{this.m_impulse=0;this.m_springImpulse=0;this.m_motorImpulse=0}
data.velocities[this.m_indexA].w=wA;data.velocities[this.m_indexB].w=wB}
box2d.b2WheelJoint.prototype.InitVelocityConstraints.s_d=new box2d.b2Vec2();box2d.b2WheelJoint.prototype.InitVelocityConstraints.s_P=new box2d.b2Vec2();box2d.b2WheelJoint.prototype.SolveVelocityConstraints=function(data){var mA=this.m_invMassA,mB=this.m_invMassB;var iA=this.m_invIA,iB=this.m_invIB;var vA=data.velocities[this.m_indexA].v;var wA=data.velocities[this.m_indexA].w;var vB=data.velocities[this.m_indexB].v;var wB=data.velocities[this.m_indexB].w;if(!0){var Cdot=box2d.b2DotVV(this.m_ax,box2d.b2SubVV(vB,vA,box2d.b2Vec2.s_t0))+this.m_sBx*wB-this.m_sAx*wA;var impulse=-this.m_springMass*(Cdot+this.m_bias+this.m_gamma*this.m_springImpulse);this.m_springImpulse+=impulse;var P=box2d.b2MulSV(impulse,this.m_ax,box2d.b2WheelJoint.prototype.SolveVelocityConstraints.s_P);var LA=impulse*this.m_sAx;var LB=impulse*this.m_sBx;vA.SelfMulSub(mA,P);wA-=iA*LA;vB.SelfMulAdd(mB,P);wB+=iB*LB}
if(!0){var Cdot=wB-wA-this.m_motorSpeed;var impulse=-this.m_motorMass*Cdot;var oldImpulse=this.m_motorImpulse;var maxImpulse=data.step.dt*this.m_maxMotorTorque;this.m_motorImpulse=box2d.b2Clamp(this.m_motorImpulse+impulse,-maxImpulse,maxImpulse);impulse=this.m_motorImpulse-oldImpulse;wA-=iA*impulse;wB+=iB*impulse}
if(!0){var Cdot=box2d.b2DotVV(this.m_ay,box2d.b2SubVV(vB,vA,box2d.b2Vec2.s_t0))+this.m_sBy*wB-this.m_sAy*wA;var impulse=-this.m_mass*Cdot;this.m_impulse+=impulse;var P=box2d.b2MulSV(impulse,this.m_ay,box2d.b2WheelJoint.prototype.SolveVelocityConstraints.s_P);var LA=impulse*this.m_sAy;var LB=impulse*this.m_sBy;vA.SelfMulSub(mA,P);wA-=iA*LA;vB.SelfMulAdd(mB,P);wB+=iB*LB}
data.velocities[this.m_indexA].w=wA;data.velocities[this.m_indexB].w=wB}
box2d.b2WheelJoint.prototype.SolveVelocityConstraints.s_P=new box2d.b2Vec2();box2d.b2WheelJoint.prototype.SolvePositionConstraints=function(data){var cA=data.positions[this.m_indexA].c;var aA=data.positions[this.m_indexA].a;var cB=data.positions[this.m_indexB].c;var aB=data.positions[this.m_indexB].a;var qA=this.m_qA.SetAngleRadians(aA),qB=this.m_qB.SetAngleRadians(aB);box2d.b2SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);var rA=box2d.b2MulRV(qA,this.m_lalcA,this.m_rA);box2d.b2SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);var rB=box2d.b2MulRV(qB,this.m_lalcB,this.m_rB);var d=box2d.b2AddVV(box2d.b2SubVV(cB,cA,box2d.b2Vec2.s_t0),box2d.b2SubVV(rB,rA,box2d.b2Vec2.s_t1),box2d.b2WheelJoint.prototype.SolvePositionConstraints.s_d);var ay=box2d.b2MulRV(qA,this.m_localYAxisA,this.m_ay);var sAy=box2d.b2CrossVV(box2d.b2AddVV(d,rA,box2d.b2Vec2.s_t0),ay);var sBy=box2d.b2CrossVV(rB,ay);var C=box2d.b2DotVV(d,this.m_ay);var k=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_sAy*this.m_sAy+this.m_invIB*this.m_sBy*this.m_sBy;var impulse;if(k!==0){impulse=-C/k}
else{impulse=0}
var P=box2d.b2MulSV(impulse,ay,box2d.b2WheelJoint.prototype.SolvePositionConstraints.s_P);var LA=impulse*sAy;var LB=impulse*sBy;cA.SelfMulSub(this.m_invMassA,P);aA-=this.m_invIA*LA;cB.SelfMulAdd(this.m_invMassB,P);aB+=this.m_invIB*LB;data.positions[this.m_indexA].a=aA;data.positions[this.m_indexB].a=aB;return box2d.b2Abs(C)<=box2d.b2_linearSlop}
box2d.b2WheelJoint.prototype.SolvePositionConstraints.s_d=new box2d.b2Vec2();box2d.b2WheelJoint.prototype.SolvePositionConstraints.s_P=new box2d.b2Vec2();box2d.b2WheelJoint.prototype.GetDefinition=function(def){if(box2d.ENABLE_ASSERTS){box2d.b2Assert(!1)}
return def}
box2d.b2WheelJoint.prototype.GetAnchorA=function(out){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,out)}
box2d.b2WheelJoint.prototype.GetAnchorB=function(out){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,out)}
box2d.b2WheelJoint.prototype.GetReactionForce=function(inv_dt,out){out.x=inv_dt*(this.m_impulse*this.m_ay.x+this.m_springImpulse*this.m_ax.x);out.y=inv_dt*(this.m_impulse*this.m_ay.y+this.m_springImpulse*this.m_ax.y);return out}
box2d.b2WheelJoint.prototype.GetReactionTorque=function(inv_dt){return inv_dt*this.m_motorImpulse}
box2d.b2WheelJoint.prototype.GetLocalAnchorA=function(out){return out.Copy(this.m_localAnchorA)}
box2d.b2WheelJoint.prototype.GetLocalAnchorB=function(out){return out.Copy(this.m_localAnchorB)}
box2d.b2WheelJoint.prototype.GetLocalAxisA=function(out){return out.Copy(this.m_localXAxisA)}
box2d.b2WheelJoint.prototype.GetJointTranslation=function(){var bA=this.m_bodyA;var bB=this.m_bodyB;var pA=bA.GetWorldPoint(this.m_localAnchorA,new box2d.b2Vec2());var pB=bB.GetWorldPoint(this.m_localAnchorB,new box2d.b2Vec2());var d=box2d.b2SubVV(pB,pA,new box2d.b2Vec2());var axis=bA.GetWorldVector(this.m_localXAxisA,new box2d.b2Vec2());var translation=box2d.b2DotVV(d,axis);return translation}
box2d.b2WheelJoint.prototype.GetJointSpeed=function(){var wA=this.m_bodyA.m_angularVelocity;var wB=this.m_bodyB.m_angularVelocity;return wB-wA}
box2d.b2WheelJoint.prototype.IsMotorEnabled=function(){return this.m_enableMotor}
box2d.b2WheelJoint.prototype.EnableMotor=function(flag){this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);this.m_enableMotor=flag}
box2d.b2WheelJoint.prototype.SetMotorSpeed=function(speed){this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);this.m_motorSpeed=speed}
box2d.b2WheelJoint.prototype.SetMaxMotorTorque=function(force){this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);this.m_maxMotorTorque=force}
box2d.b2WheelJoint.prototype.GetMotorTorque=function(inv_dt){return inv_dt*this.m_motorImpulse}
box2d.b2WheelJoint.prototype.Dump=function(){if(box2d.DEBUG){var indexA=this.m_bodyA.m_islandIndex;var indexB=this.m_bodyB.m_islandIndex;box2d.b2Log("  /*box2d.b2WheelJointDef*/ var jd = new box2d.b2WheelJointDef();\n");box2d.b2Log("  jd.bodyA = bodies[%d];\n",indexA);box2d.b2Log("  jd.bodyB = bodies[%d];\n",indexB);box2d.b2Log("  jd.collideConnected = %s;\n",(this.m_collideConnected)?('true'):('false'));box2d.b2Log("  jd.localAnchorA.SetXY(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y);box2d.b2Log("  jd.localAnchorB.SetXY(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y);box2d.b2Log("  jd.localAxisA.Set(%.15f, %.15f);\n",this.m_localXAxisA.x,this.m_localXAxisA.y);box2d.b2Log("  jd.enableMotor = %s;\n",(this.m_enableMotor)?('true'):('false'));box2d.b2Log("  jd.motorSpeed = %.15f;\n",this.m_motorSpeed);box2d.b2Log("  jd.maxMotorTorque = %.15f;\n",this.m_maxMotorTorque);box2d.b2Log("  jd.frequencyHz = %.15f;\n",this.m_frequencyHz);box2d.b2Log("  jd.dampingRatio = %.15f;\n",this.m_dampingRatio);box2d.b2Log("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)}}
goog.provide('box2d.b2MotorJoint');goog.require('box2d.b2Settings');goog.require('box2d.b2Math');box2d.b2MotorJointDef=function(){goog.base(this,box2d.b2JointType.e_motorJoint);this.linearOffset=new box2d.b2Vec2(0,0)}
goog.inherits(box2d.b2MotorJointDef,box2d.b2JointDef);box2d.b2MotorJointDef.prototype.linearOffset=null;box2d.b2MotorJointDef.prototype.angularOffset=0;box2d.b2MotorJointDef.prototype.maxForce=1;box2d.b2MotorJointDef.prototype.maxTorque=1;box2d.b2MotorJointDef.prototype.correctionFactor=0.3;box2d.b2MotorJointDef.prototype.Initialize=function(bA,bB){this.bodyA=bA;this.bodyB=bB;this.bodyA.GetLocalPoint(this.bodyB.GetPosition(),this.linearOffset);var angleA=this.bodyA.GetAngleRadians();var angleB=this.bodyB.GetAngleRadians();this.angularOffset=angleB-angleA}
box2d.b2MotorJoint=function(def){goog.base(this,def);this.m_linearOffset=def.linearOffset.Clone();this.m_linearImpulse=new box2d.b2Vec2(0,0);this.m_maxForce=def.maxForce;this.m_maxTorque=def.maxTorque;this.m_correctionFactor=def.correctionFactor;this.m_rA=new box2d.b2Vec2(0,0);this.m_rB=new box2d.b2Vec2(0,0);this.m_localCenterA=new box2d.b2Vec2(0,0);this.m_localCenterB=new box2d.b2Vec2(0,0);this.m_linearError=new box2d.b2Vec2(0,0);this.m_linearMass=new box2d.b2Mat22();this.m_qA=new box2d.b2Rot();this.m_qB=new box2d.b2Rot();this.m_K=new box2d.b2Mat22()}
goog.inherits(box2d.b2MotorJoint,box2d.b2Joint);box2d.b2MotorJoint.prototype.m_linearOffset=null;box2d.b2MotorJoint.prototype.m_angularOffset=0;box2d.b2MotorJoint.prototype.m_linearImpulse=null;box2d.b2MotorJoint.prototype.m_angularImpulse=0;box2d.b2MotorJoint.prototype.m_maxForce=0;box2d.b2MotorJoint.prototype.m_maxTorque=0;box2d.b2MotorJoint.prototype.m_correctionFactor=0.3;box2d.b2MotorJoint.prototype.m_indexA=0;box2d.b2MotorJoint.prototype.m_indexB=0;box2d.b2MotorJoint.prototype.m_rA=null;box2d.b2MotorJoint.prototype.m_rB=null;box2d.b2MotorJoint.prototype.m_localCenterA=null;box2d.b2MotorJoint.prototype.m_localCenterB=null;box2d.b2MotorJoint.prototype.m_linearError=null;box2d.b2MotorJoint.prototype.m_angularError=0;box2d.b2MotorJoint.prototype.m_invMassA=0;box2d.b2MotorJoint.prototype.m_invMassB=0;box2d.b2MotorJoint.prototype.m_invIA=0;box2d.b2MotorJoint.prototype.m_invIB=0;box2d.b2MotorJoint.prototype.m_linearMass=null;box2d.b2MotorJoint.prototype.m_angularMass=0;box2d.b2MotorJoint.prototype.m_qA=null;box2d.b2MotorJoint.prototype.m_qB=null;box2d.b2MotorJoint.prototype.m_K=null;box2d.b2MotorJoint.prototype.GetAnchorA=function(out){return this.m_bodyA.GetPosition(out)}
box2d.b2MotorJoint.prototype.GetAnchorB=function(out){return this.m_bodyB.GetPosition(out)}
box2d.b2MotorJoint.prototype.GetReactionForce=function(inv_dt,out){return box2d.b2MulSV(inv_dt,this.m_linearImpulse,out)}
box2d.b2MotorJoint.prototype.GetReactionTorque=function(inv_dt){return inv_dt*this.m_angularImpulse}
box2d.b2MotorJoint.prototype.SetCorrectionFactor=function(factor){if(box2d.ENABLE_ASSERTS){box2d.b2Assert(box2d.b2IsValid(factor)&&0.0<=factor&&factor<=1.0)};this._correctionFactor=factor}
box2d.b2MotorJoint.prototype.GetCorrectionFactor=function(){return this.m_correctionFactor}
box2d.b2MotorJoint.prototype.SetLinearOffset=function(linearOffset){if(!box2d.b2IsEqualToV(linearOffset,this.m_linearOffset)){this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);this.m_linearOffset.Copy(linearOffset)}}
box2d.b2MotorJoint.prototype.GetLinearOffset=function(out){return out.Copy(this.m_linearOffset)}
box2d.b2MotorJoint.prototype.SetAngularOffset=function(angularOffset){if(angularOffset!==this.m_angularOffset){this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);this.m_angularOffset=angularOffset}}
box2d.b2MotorJoint.prototype.GetAngularOffset=function(){return this.m_angularOffset}
box2d.b2MotorJoint.prototype.SetMaxForce=function(force){if(box2d.ENABLE_ASSERTS){box2d.b2Assert(box2d.b2IsValid(force)&&force>=0)}
this.m_maxForce=force}
box2d.b2MotorJoint.prototype.GetMaxForce=function(){return this.m_maxForce}
box2d.b2MotorJoint.prototype.SetMaxTorque=function(torque){if(box2d.ENABLE_ASSERTS){box2d.b2Assert(box2d.b2IsValid(torque)&&torque>=0)}
this.m_maxTorque=torque}
box2d.b2MotorJoint.prototype.GetMaxTorque=function(){return this.m_maxTorque}
box2d.b2MotorJoint.prototype.InitVelocityConstraints=function(data){this.m_indexA=this.m_bodyA.m_islandIndex;this.m_indexB=this.m_bodyB.m_islandIndex;this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter);this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter);this.m_invMassA=this.m_bodyA.m_invMass;this.m_invMassB=this.m_bodyB.m_invMass;this.m_invIA=this.m_bodyA.m_invI;this.m_invIB=this.m_bodyB.m_invI;var cA=data.positions[this.m_indexA].c;var aA=data.positions[this.m_indexA].a;var vA=data.velocities[this.m_indexA].v;var wA=data.velocities[this.m_indexA].w;var cB=data.positions[this.m_indexB].c;var aB=data.positions[this.m_indexB].a;var vB=data.velocities[this.m_indexB].v;var wB=data.velocities[this.m_indexB].w;var qA=this.m_qA.SetAngleRadians(aA),qB=this.m_qB.SetAngleRadians(aB);var rA=box2d.b2MulRV(qA,box2d.b2NegV(this.m_localCenterA,box2d.b2Vec2.s_t0),this.m_rA);var rB=box2d.b2MulRV(qB,box2d.b2NegV(this.m_localCenterB,box2d.b2Vec2.s_t0),this.m_rB);var mA=this.m_invMassA,mB=this.m_invMassB;var iA=this.m_invIA,iB=this.m_invIB;var K=this.m_K;K.ex.x=mA+mB+iA*rA.y*rA.y+iB*rB.y*rB.y;K.ex.y=-iA*rA.x*rA.y-iB*rB.x*rB.y;K.ey.x=K.ex.y;K.ey.y=mA+mB+iA*rA.x*rA.x+iB*rB.x*rB.x;K.GetInverse(this.m_linearMass);this.m_angularMass=iA+iB;if(this.m_angularMass>0){this.m_angularMass=1/this.m_angularMass}
box2d.b2SubVV(box2d.b2SubVV(box2d.b2AddVV(cB,rB,box2d.b2Vec2.s_t0),box2d.b2AddVV(cA,rA,box2d.b2Vec2.s_t1),box2d.b2Vec2.s_t2),box2d.b2MulRV(qA,this.m_linearOffset,box2d.b2Vec2.s_t3),this.m_linearError);this.m_angularError=aB-aA-this.m_angularOffset;if(data.step.warmStarting){this.m_linearImpulse.SelfMul(data.step.dtRatio);this.m_angularImpulse*=data.step.dtRatio;var P=this.m_linearImpulse;vA.SelfMulSub(mA,P);wA-=iA*(box2d.b2CrossVV(rA,P)+this.m_angularImpulse);vB.SelfMulAdd(mB,P);wB+=iB*(box2d.b2CrossVV(rB,P)+this.m_angularImpulse)}
else{this.m_linearImpulse.SetZero();this.m_angularImpulse=0}
data.velocities[this.m_indexA].w=wA;data.velocities[this.m_indexB].w=wB}
box2d.b2MotorJoint.prototype.SolveVelocityConstraints=function(data){var vA=data.velocities[this.m_indexA].v;var wA=data.velocities[this.m_indexA].w;var vB=data.velocities[this.m_indexB].v;var wB=data.velocities[this.m_indexB].w;var mA=this.m_invMassA,mB=this.m_invMassB;var iA=this.m_invIA,iB=this.m_invIB;var h=data.step.dt;var inv_h=data.step.inv_dt;{var Cdot=wB-wA+inv_h*this.m_correctionFactor*this.m_angularError;var impulse=-this.m_angularMass*Cdot;var oldImpulse=this.m_angularImpulse;var maxImpulse=h*this.m_maxTorque;this.m_angularImpulse=box2d.b2Clamp(this.m_angularImpulse+impulse,-maxImpulse,maxImpulse);impulse=this.m_angularImpulse-oldImpulse;wA-=iA*impulse;wB+=iB*impulse}{var rA=this.m_rA;var rB=this.m_rB;var Cdot=box2d.b2AddVV(box2d.b2SubVV(box2d.b2AddVV(vB,box2d.b2CrossSV(wB,rB,box2d.b2Vec2.s_t0),box2d.b2Vec2.s_t0),box2d.b2AddVV(vA,box2d.b2CrossSV(wA,rA,box2d.b2Vec2.s_t1),box2d.b2Vec2.s_t1),box2d.b2Vec2.s_t2),box2d.b2MulSV(inv_h*this.m_correctionFactor,this.m_linearError,box2d.b2Vec2.s_t3),box2d.b2MotorJoint.prototype.SolveVelocityConstraints.s_Cdot);var impulse=box2d.b2MulMV(this.m_linearMass,Cdot,box2d.b2MotorJoint.prototype.SolveVelocityConstraints.s_impulse).SelfNeg();var oldImpulse=box2d.b2MotorJoint.prototype.SolveVelocityConstraints.s_oldImpulse.Copy(this.m_linearImpulse);this.m_linearImpulse.SelfAdd(impulse);var maxImpulse=h*this.m_maxForce;if(this.m_linearImpulse.GetLengthSquared()>maxImpulse*maxImpulse){this.m_linearImpulse.Normalize();this.m_linearImpulse.SelfMul(maxImpulse)}
box2d.b2SubVV(this.m_linearImpulse,oldImpulse,impulse);vA.SelfMulSub(mA,impulse);wA-=iA*box2d.b2CrossVV(rA,impulse);vB.SelfMulAdd(mB,impulse);wB+=iB*box2d.b2CrossVV(rB,impulse)}
data.velocities[this.m_indexA].w=wA;data.velocities[this.m_indexB].w=wB}
box2d.b2MotorJoint.prototype.SolveVelocityConstraints.s_Cdot=new box2d.b2Vec2();box2d.b2MotorJoint.prototype.SolveVelocityConstraints.s_impulse=new box2d.b2Vec2();box2d.b2MotorJoint.prototype.SolveVelocityConstraints.s_oldImpulse=new box2d.b2Vec2();box2d.b2MotorJoint.prototype.SolvePositionConstraints=function(data){return !0}
box2d.b2MotorJoint.prototype.Dump=function(){if(box2d.DEBUG){var indexA=this.m_bodyA.m_islandIndex;var indexB=this.m_bodyB.m_islandIndex;box2d.b2Log("  /*box2d.b2MotorJointDef*/ var jd = new box2d.b2MotorJointDef();\n");box2d.b2Log("  jd.bodyA = bodies[%d];\n",indexA);box2d.b2Log("  jd.bodyB = bodies[%d];\n",indexB);box2d.b2Log("  jd.collideConnected = %s;\n",(this.m_collideConnected)?('true'):('false'));box2d.b2Log("  jd.linearOffset.SetXY(%.15f, %.15f);\n",this.m_linearOffset.x,this.m_linearOffset.y);box2d.b2Log("  jd.angularOffset = %.15f;\n",this.m_angularOffset);box2d.b2Log("  jd.maxForce = %.15f;\n",this.m_maxForce);box2d.b2Log("  jd.maxTorque = %.15f;\n",this.m_maxTorque);box2d.b2Log("  jd.correctionFactor = %.15f;\n",this.m_correctionFactor);box2d.b2Log("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)}}
goog.provide('box2d');goog.require('box2d.b2Settings');goog.require('box2d.b2Draw');goog.require('box2d.b2Timer');goog.require('box2d.b2CircleShape');goog.require('box2d.b2EdgeShape');goog.require('box2d.b2ChainShape');goog.require('box2d.b2PolygonShape');goog.require('box2d.b2BroadPhase');goog.require('box2d.b2Distance');goog.require('box2d.b2DynamicTree');goog.require('box2d.b2TimeOfImpact');goog.require('box2d.b2Body');goog.require('box2d.b2Fixture');goog.require('box2d.b2WorldCallbacks');goog.require('box2d.b2TimeStep');goog.require('box2d.b2World');goog.require('box2d.b2Contact');goog.require('box2d.b2AreaJoint');goog.require('box2d.b2DistanceJoint');goog.require('box2d.b2FrictionJoint');goog.require('box2d.b2GearJoint');goog.require('box2d.b2MotorJoint');goog.require('box2d.b2MouseJoint');goog.require('box2d.b2PrismaticJoint');goog.require('box2d.b2PulleyJoint');goog.require('box2d.b2RevoluteJoint');goog.require('box2d.b2RopeJoint');goog.require('box2d.b2WeldJoint');goog.require('box2d.b2WheelJoint');goog.require('box2d.b2Rope');goog.require('box2d.b2BuoyancyController');goog.require('box2d.b2ConstantAccelController');goog.require('box2d.b2ConstantForceController');goog.require('box2d.b2GravityController');goog.require('box2d.b2TensorDampingController');Phaser.Physics.Box2D=function(game,config){this.game=game;this.version='1.0.2';this.ptmRatio=50;this.world=new box2d.b2World(new box2d.b2Vec2(0,0));this.debugDraw=new Phaser.Physics.Box2D.DefaultDebugDraw(this.mpx(1));this.world.SetDebugDraw(this.debugDraw);this.contactListener=new Phaser.Physics.Box2D.DefaultContactListener();this.world.SetContactListener(this.contactListener);this.nextBodyId=0;this.nextFixtureId=0;this.gravity=new Phaser.Physics.Box2D.PointProxy(this,this.world,this.world.GetGravity,this.world.SetGravity);this.friction=0.2;this.restitution=0.0;this.density=1.0;this.frameRate=1/60;this.velocityIterations=8;this.positionIterations=3;this.useElapsedTime=!1;this.paused=!1;this.particleSystem=null;var bd=new box2d.b2BodyDef();this.mouseJointBody=this.world.CreateBody(bd);this.mouseJoint=null;if(config.hasOwnProperty('mpx')&&config.hasOwnProperty('pxm')){this.mpx=config.mpx;this.pxm=config.pxm}
this.walls={left:null,right:null,top:null,bottom:null};this.onBodyAdded=new Phaser.Signal();this.onBodyRemoved=new Phaser.Signal();this._toRemove=[]};Phaser.Physics.Box2D.worldBoundsFilterCategory=0x8000;Phaser.Physics.Box2D.prototype={getNextBodyId:function(){var id=this.nextBodyId;this.nextBodyId+=1;return id},getNextFixtureId:function(){var id=this.nextFixtureId;this.nextFixtureId+=1;return id},removeBodyNextStep:function(body){this._toRemove.push(body)},preUpdate:function(){var i=this._toRemove.length;while(i--){this.removeBody(this._toRemove[i])}
this._toRemove.length=0},enable:function(object,children){if(typeof children==='undefined'){children=!0}
var i=1;if(Array.isArray(object)){i=object.length;while(i--){if(object[i]instanceof Phaser.Group){this.enable(object[i].children,children)}
else{this.enableBody(object[i]);if(children&&object[i].hasOwnProperty('children')&&object[i].children.length>0){this.enable(object[i],!0)}}}}
else{if(object instanceof Phaser.Group){this.enable(object.children,children)}
else{this.enableBody(object);if(children&&object.hasOwnProperty('children')&&object.children.length>0){this.enable(object.children,!0)}}}},enableBody:function(object){if(object.hasOwnProperty('body')&&object.body===null){object.body=new Phaser.Physics.Box2D.Body(this.game,object,object.x,object.y,2);object.anchor.set(0.5)}},setBoundsToWorld:function(left,right,top,bottom,collisionCategory,collisionMask){if(typeof left==='undefined'){left=!0}
if(typeof right==='undefined'){right=!0}
if(typeof top==='undefined'){top=!0}
if(typeof bottom==='undefined'){bottom=!0}
if(typeof collisionCategory==='undefined'){collisionCategory=1}
if(typeof collisionMask==='undefined'){collisionCategory=0xFFFFFFFF}
this.setBounds(this.game.world.bounds.x,this.game.world.bounds.y,this.game.world.bounds.width,this.game.world.bounds.height,left,right,top,bottom,collisionCategory,collisionMask)},setBounds:function(x,y,width,height,left,right,top,bottom,collisionCategory,collisionMask){if(typeof left==='undefined'){left=!0}
if(typeof right==='undefined'){right=!0}
if(typeof top==='undefined'){top=!0}
if(typeof bottom==='undefined'){bottom=!0}
if(typeof collisionCategory==='undefined'){collisionCategory=1}
if(typeof collisionMask==='undefined'){collisionMask=0xFFFFFFFF}
if(this.walls.left){this.removeBody(this.walls.left)}
if(this.walls.right){this.removeBody(this.walls.right)}
if(this.walls.top){this.removeBody(this.walls.top)}
if(this.walls.bottom){this.removeBody(this.walls.bottom)}
var polygonShape=new box2d.b2PolygonShape();var fixtureDef=new box2d.b2FixtureDef();fixtureDef.shape=polygonShape;fixtureDef.filter.categoryBits=Phaser.Physics.Box2D.worldBoundsFilterCategory;fixtureDef.filter.maskBits=0xFFFF;var boundThickness=this.pxm(100);var bounds=this.game.world.bounds;if(left){this.walls.left=this.createBody(0,0,0);polygonShape.SetAsOrientedBox(boundThickness,this.pxm(bounds.height)+boundThickness,new box2d.b2Vec2(boundThickness,0),0);var f=this.walls.left.data.CreateFixture(fixtureDef);f.id=this.getNextFixtureId()}
if(right){this.walls.right=this.createBody(0,0,0);polygonShape.SetAsOrientedBox(boundThickness,this.pxm(bounds.height)+boundThickness,new box2d.b2Vec2(this.pxm(-bounds.width)-boundThickness,0),0);var f=this.walls.right.data.CreateFixture(fixtureDef);f.id=this.getNextFixtureId()}
if(top){this.walls.top=this.createBody(0,0,0);polygonShape.SetAsOrientedBox(this.pxm(bounds.width)+boundThickness,boundThickness,new box2d.b2Vec2(0,boundThickness),0);var f=this.walls.top.data.CreateFixture(fixtureDef);f.id=this.getNextFixtureId()}
if(bottom){this.walls.bottom=this.createBody(0,0,0);polygonShape.SetAsOrientedBox(this.pxm(bounds.width)+boundThickness,boundThickness,new box2d.b2Vec2(0,this.pxm(-bounds.height)-boundThickness),0);var f=this.walls.bottom.data.CreateFixture(fixtureDef);f.id=this.getNextFixtureId()}},pause:function(){this.paused=!0},resume:function(){this.paused=!1},update:function(){if(this.paused){return}
if(this.useElapsedTime){this.world.Step(this.game.time.physicsElapsed,this.velocityIterations,this.positionIterations)}
else{this.world.Step(this.frameRate,this.velocityIterations,this.positionIterations)}},reset:function(){this.clear()},clear:function(){var gravity=this.world.GetGravity().Clone();this.world=new box2d.b2World(gravity);this.world.SetDebugDraw(this.debugDraw);this.world.SetContactListener(this.contactListener);this._toRemove=[]},destroy:function(){this.clear();this.gravity=null;this.world=null;this.game=null},createBody:function(x,y,density){var body=new Phaser.Physics.Box2D.Body(this.game,null,x,y,density,this);return body},createCircle:function(x,y,radius,offsetX,offsetY){var body=this.createBody(x,y,2);return body.setCircle(radius,offsetX,offsetY)},createRectangle:function(x,y,width,height,offsetX,offsetY,rotation){var body=this.createBody(x,y,2);return body.setRectangle(width,height,offsetX,offsetY,rotation)},createPolygon:function(x,y,vertices,firstIndex,count){var body=this.createBody(x,y,2);return body.setPolygon(vertices,firstIndex,count)},addBody:function(body){if(body.data.world){return !1}
else{body.data=this.world.CreateBody(body.bodyDef);body.data.world=this.world;body.data.parent=body;this.onBodyAdded.dispatch(body);return !0}},removeBody:function(body){if(body.data.world==this.world){this.world.DestroyBody(body.data);this.onBodyRemoved.dispatch(body)}
return body},getBodies:function(){var output=[];for(var b=this.world.GetBodyList();b;b=b.GetNext()){output.push(b)}
return output},getBody:function(object){if(object instanceof box2d.b2Body){return object}
else if(object instanceof Phaser.Physics.Box2D.Body){return object.data}
else if(object.body&&object.body.type===Phaser.Physics.BOX2D){return object.body.data}
return null},toJSON:function(){return this.world.toJSON()},mpx:function(v){return v*=this.ptmRatio},pxm:function(v){return v/this.ptmRatio},renderDebugDraw:function(context){if(!this.game.physics.box2d){return}
var world=this.game.physics.box2d;world.debugDraw.start(context);world.world.DrawDebugData();world.debugDraw.stop()},renderBodyInfo:function(debug,body){debug.line('Position: x: '+body.x.toFixed(3)+' y: '+body.y.toFixed(3));debug.line('Rotation: '+body.rotation.toFixed(3)+' degrees');debug.line('Velocity: x: '+body.velocity.x.toFixed(3)+' y: '+body.velocity.y.toFixed(3));debug.line('Angular velocity: '+body.angularVelocity.toFixed(3)+' degrees/sec')},getFixturesAtPoint:function(x,y,onlyOne,onlyDynamic){if(typeof onlyOne==='undefined'){onlyOne=!1}
if(typeof onlyDynamic==='undefined'){onlyDynamic=!1}
var worldx=this.pxm(-x);var worldy=this.pxm(-y);var worldPoint=new box2d.b2Vec2(worldx,worldy);var aabb=new box2d.b2AABB();var d=new box2d.b2Vec2();d.SetXY(0.001,0.001);box2d.b2SubVV(worldPoint,d,aabb.lowerBound);box2d.b2AddVV(worldPoint,d,aabb.upperBound);var hitFixtures=[];var callback=function(fixture){if(onlyDynamic&&fixture.GetBody().GetType()!==box2d.b2BodyType.b2_dynamicBody){return !0}
if(fixture.TestPoint(worldPoint)){hitFixtures.push(fixture);return !onlyOne}
return !0};this.world.QueryAABB(callback,aabb);return hitFixtures},getBodiesAtPoint:function(x,y,onlyOne,onlyDynamic){if(typeof onlyOne==='undefined'){onlyOne=!1}
if(typeof onlyDynamic==='undefined'){onlyDynamic=!1}
var fixtures=this.getFixturesAtPoint(x,y,onlyOne,onlyDynamic);if(fixtures.length<1){return fixtures}
var bodies=[];for(var i=0;i<fixtures.length;i++){bodies.push(fixtures[i].GetBody().parent)}
bodies.filter(function(elem,pos){return bodies.indexOf(elem)===pos});return bodies},mouseDragStart:function(point){this.mouseDragEnd();var fixturesAtPoint=this.getFixturesAtPoint(point.x,point.y,!0,!0);if(fixturesAtPoint.length<1){return}
var worldx=this.pxm(-point.x);var worldy=this.pxm(-point.y);var worldPoint=new box2d.b2Vec2(worldx,worldy);var jd=new box2d.b2MouseJointDef();jd.bodyA=this.mouseJointBody;jd.bodyB=fixturesAtPoint[0].GetBody();jd.target.Copy(worldPoint);jd.maxForce=1000*jd.bodyB.GetMass();this.mouseJoint=this.world.CreateJoint(jd);jd.bodyB.SetAwake(!0)},mouseDragMove:function(point){if(!this.mouseJoint){return}
var worldx=this.pxm(-point.x);var worldy=this.pxm(-point.y);var worldPoint=new box2d.b2Vec2(worldx,worldy);this.mouseJoint.SetTarget(worldPoint)},mouseDragEnd:function(){if(this.mouseJoint){this.world.DestroyJoint(this.mouseJoint);this.mouseJoint=null}},distanceJoint:function(bodyA,bodyB,length,ax,ay,bx,by,frequency,damping){if(typeof ax==='undefined'){ax=0}
if(typeof ay==='undefined'){ay=0}
if(typeof bx==='undefined'){bx=0}
if(typeof by==='undefined'){by=0}
if(typeof frequency==='undefined'){frequency=0}
if(typeof damping==='undefined'){damping=0}
ax=this.pxm(-ax);ay=this.pxm(-ay);bx=this.pxm(-bx);by=this.pxm(-by);if(bodyA.body){bodyA=bodyA.body}
if(bodyB.body){bodyB=bodyB.body}
var jd=new box2d.b2DistanceJointDef();jd.bodyA=bodyA.data;jd.bodyB=bodyB.data;jd.localAnchorA.SetXY(ax,ay);jd.localAnchorB.SetXY(bx,by);if(length===null||typeof length==='undefined'){var worldAnchorA=new box2d.b2Vec2();var worldAnchorB=new box2d.b2Vec2();jd.bodyA.GetWorldPoint(jd.localAnchorA,worldAnchorA);jd.bodyB.GetWorldPoint(jd.localAnchorB,worldAnchorB);worldAnchorA.SelfSub(worldAnchorB);length=worldAnchorA.Length()}
else{length=this.pxm(length)}
jd.length=length;jd.frequencyHz=frequency;jd.dampingRatio=damping;return this.world.CreateJoint(jd)},ropeJoint:function(bodyA,bodyB,length,ax,ay,bx,by){if(typeof ax==='undefined'){ax=0}
if(typeof ay==='undefined'){ay=0}
if(typeof bx==='undefined'){bx=0}
if(typeof by==='undefined'){by=0}
ax=this.pxm(-ax);ay=this.pxm(-ay);bx=this.pxm(-bx);by=this.pxm(-by);if(bodyA.body){bodyA=bodyA.body}
if(bodyB.body){bodyB=bodyB.body}
var jd=new box2d.b2RopeJointDef();jd.bodyA=bodyA.data;jd.bodyB=bodyB.data;jd.localAnchorA.SetXY(ax,ay);jd.localAnchorB.SetXY(bx,by);if(length===null||typeof length==='undefined'){var worldAnchorA=new box2d.b2Vec2();var worldAnchorB=new box2d.b2Vec2();jd.bodyA.GetWorldPoint(jd.localAnchorA,worldAnchorA);jd.bodyB.GetWorldPoint(jd.localAnchorB,worldAnchorB);worldAnchorA.SelfSub(worldAnchorB);length=worldAnchorA.Length()}
else{length=this.pxm(length)}
jd.maxLength=length;return this.world.CreateJoint(jd)},revoluteJoint:function(bodyA,bodyB,ax,ay,bx,by,motorSpeed,motorTorque,motorEnabled,lowerLimit,upperLimit,limitEnabled){if(typeof ax==='undefined'){ax=0}
if(typeof ay==='undefined'){ay=0}
if(typeof bx==='undefined'){bx=0}
if(typeof by==='undefined'){by=0}
if(typeof motorSpeed==='undefined'){motorSpeed=0}
if(typeof motorTorque==='undefined'){motorTorque=0}
if(typeof motorEnabled==='undefined'){motorEnabled=!1}
if(typeof lowerLimit==='undefined'){lowerLimit=0}
if(typeof upperLimit==='undefined'){upperLimit=0}
if(typeof limitEnabled==='undefined'){limitEnabled=!1}
ax=this.pxm(-ax);ay=this.pxm(-ay);bx=this.pxm(-bx);by=this.pxm(-by);if(bodyA.body){bodyA=bodyA.body}
if(bodyB.body){bodyB=bodyB.body}
var jd=new box2d.b2RevoluteJointDef();jd.bodyA=bodyA.data;jd.bodyB=bodyB.data;jd.localAnchorA.SetXY(ax,ay);jd.localAnchorB.SetXY(bx,by);jd.motorSpeed=Phaser.Math.degToRad(-motorSpeed);jd.maxMotorTorque=motorTorque;jd.enableMotor=motorEnabled;jd.lowerAngle=Phaser.Math.degToRad(lowerLimit);jd.upperAngle=Phaser.Math.degToRad(upperLimit);jd.enableLimit=limitEnabled;return this.world.CreateJoint(jd)},prismaticJoint:function(bodyA,bodyB,axisX,axisY,ax,ay,bx,by,motorSpeed,motorForce,motorEnabled,lowerLimit,upperLimit,limitEnabled,offsetAngle){if(typeof axisX==='undefined'){axisX=1}
if(typeof axisY==='undefined'){axisY=0}
if(typeof ax==='undefined'){ax=0}
if(typeof ay==='undefined'){ay=0}
if(typeof bx==='undefined'){bx=0}
if(typeof by==='undefined'){by=0}
if(typeof motorSpeed==='undefined'){motorSpeed=0}
if(typeof motorForce==='undefined'){motorForce=0}
if(typeof lowerLimit==='undefined'){lowerLimit=0}
if(typeof upperLimit==='undefined'){upperLimit=0}
if(typeof limitEnabled==='undefined'){limitEnabled=!1}
if(typeof motorEnabled==='undefined'){motorEnabled=!1}
if(typeof offsetAngle==='undefined'){offsetAngle=0}
axisX*=-1;axisY*=-1;ax=this.pxm(-ax);ay=this.pxm(-ay);bx=this.pxm(-bx);by=this.pxm(-by);motorSpeed=this.pxm(motorSpeed);lowerLimit=this.pxm(lowerLimit);upperLimit=this.pxm(upperLimit);if(bodyA.body){bodyA=bodyA.body}
if(bodyB.body){bodyB=bodyB.body}
var jd=new box2d.b2PrismaticJointDef();jd.bodyA=bodyA.data;jd.bodyB=bodyB.data;jd.localAxisA.SetXY(axisX,axisY);jd.localAnchorA.SetXY(ax,ay);jd.localAnchorB.SetXY(bx,by);jd.motorSpeed=motorSpeed;jd.maxMotorForce=motorForce;jd.enableMotor=motorEnabled;jd.lowerTranslation=lowerLimit;jd.upperTranslation=upperLimit;jd.enableLimit=limitEnabled;jd.referenceAngle=Phaser.Math.degToRad(-offsetAngle);return this.world.CreateJoint(jd)},frictionJoint:function(bodyA,bodyB,maxForce,maxTorque,ax,ay,bx,by){if(typeof ax==='undefined'){ax=0}
if(typeof ay==='undefined'){ay=0}
if(typeof bx==='undefined'){bx=0}
if(typeof by==='undefined'){by=0}
if(typeof maxForce==='undefined'){maxForce=0}
if(typeof maxTorque==='undefined'){maxTorque=0}
ax=this.pxm(-ax);ay=this.pxm(-ay);bx=this.pxm(-bx);by=this.pxm(-by);if(bodyA.body){bodyA=bodyA.body}
if(bodyB.body){bodyB=bodyB.body}
var jd=new box2d.b2FrictionJointDef();jd.bodyA=bodyA.data;jd.bodyB=bodyB.data;jd.localAnchorA.SetXY(ax,ay);jd.localAnchorB.SetXY(bx,by);jd.maxForce=maxForce;jd.maxTorque=maxTorque;return this.world.CreateJoint(jd)},weldJoint:function(bodyA,bodyB,ax,ay,bx,by,frequency,damping){if(typeof ax==='undefined'){ax=0}
if(typeof ay==='undefined'){ay=0}
if(typeof bx==='undefined'){bx=0}
if(typeof by==='undefined'){by=0}
if(typeof frequency==='undefined'){frequency=0}
if(typeof damping==='undefined'){damping=0}
ax=this.pxm(-ax);ay=this.pxm(-ay);bx=this.pxm(-bx);by=this.pxm(-by);if(bodyA.body){bodyA=bodyA.body}
if(bodyB.body){bodyB=bodyB.body}
var jd=new box2d.b2WeldJointDef();jd.bodyA=bodyA.data;jd.bodyB=bodyB.data;jd.localAnchorA.SetXY(ax,ay);jd.localAnchorB.SetXY(bx,by);jd.frequencyHz=frequency;jd.dampingRatio=damping;return this.world.CreateJoint(jd)},motorJoint:function(bodyA,bodyB,maxForce,maxTorque,correctionFactor,offsetX,offsetY,offsetAngle){if(typeof offsetX==='undefined'){offsetX=0}
if(typeof offsetY==='undefined'){offsetY=0}
if(typeof offsetAngle==='undefined'){offsetAngle=0}
if(typeof maxForce==='undefined'){maxForce=0}
if(typeof maxTorque==='undefined'){maxTorque=0}
if(typeof correctionFactor==='undefined'){correctionFactor=1}
offsetX=this.pxm(-offsetX);offsetY=this.pxm(-offsetY);if(bodyA.body){bodyA=bodyA.body}
if(bodyB.body){bodyB=bodyB.body}
var jd=new box2d.b2MotorJointDef();jd.bodyA=bodyA.data;jd.bodyB=bodyB.data;jd.linearOffset.SetXY(offsetX,offsetY);jd.maxForce=maxForce;jd.maxTorque=maxTorque;jd.angularOffset=Phaser.Math.degToRad(-offsetAngle);jd.correctionFactor=correctionFactor;return this.world.CreateJoint(jd)},wheelJoint:function(bodyA,bodyB,ax,ay,bx,by,axisX,axisY,frequency,damping,motorSpeed,motorTorque,motorEnabled){if(typeof axisX==='undefined'){axisX=0}
if(typeof axisY==='undefined'){axisY=1}
if(typeof ax==='undefined'){ax=0}
if(typeof ay==='undefined'){ay=0}
if(typeof bx==='undefined'){bx=0}
if(typeof by==='undefined'){by=0}
if(typeof motorSpeed==='undefined'){motorSpeed=0}
if(typeof motorTorque==='undefined'){motorTorque=0}
if(typeof motorEnabled==='undefined'){motorEnabled=!1}
if(typeof frequency==='undefined'){frequency=0}
if(typeof damping==='undefined'){damping=0}
axisX*=-1;axisY*=-1;ax=this.pxm(-ax);ay=this.pxm(-ay);bx=this.pxm(-bx);by=this.pxm(-by);if(bodyA.body){bodyA=bodyA.body}
if(bodyB.body){bodyB=bodyB.body}
var jd=new box2d.b2WheelJointDef();jd.bodyA=bodyA.data;jd.bodyB=bodyB.data;jd.localAxisA.SetXY(axisX,axisY);jd.localAnchorA.SetXY(ax,ay);jd.localAnchorB.SetXY(bx,by);jd.motorSpeed=Phaser.Math.degToRad(-motorSpeed);jd.maxMotorTorque=motorTorque;jd.enableMotor=motorEnabled;jd.frequencyHz=frequency;jd.dampingRatio=damping;return this.world.CreateJoint(jd)},pulleyJoint:function(bodyA,bodyB,ax,ay,bx,by,gax,gay,gbx,gby,ratio,lengthA,lengthB){if(typeof ax==='undefined'){ax=0}
if(typeof ay==='undefined'){ay=0}
if(typeof bx==='undefined'){bx=0}
if(typeof by==='undefined'){by=0}
if(typeof gax==='undefined'){gax=0}
if(typeof gay==='undefined'){gay=0}
if(typeof gbx==='undefined'){gbx=0}
if(typeof gby==='undefined'){gby=0}
if(typeof ratio==='undefined'){ratio=1}
if(typeof lengthA==='undefined'){lengthA=100}
if(typeof lengthB==='undefined'){lengthB=100}
ax=this.pxm(-ax);ay=this.pxm(-ay);bx=this.pxm(-bx);by=this.pxm(-by);gax=this.pxm(-gax);gay=this.pxm(-gay);gbx=this.pxm(-gbx);gby=this.pxm(-gby);lengthA=this.pxm(lengthA);lengthB=this.pxm(lengthB);if(bodyA.body){bodyA=bodyA.body}
if(bodyB.body){bodyB=bodyB.body}
var jd=new box2d.b2PulleyJointDef();jd.bodyA=bodyA.data;jd.bodyB=bodyB.data;jd.localAnchorA.SetXY(ax,ay);jd.localAnchorB.SetXY(bx,by);jd.groundAnchorA.SetXY(gax,gay);jd.groundAnchorB.SetXY(gbx,gby);jd.lengthA=lengthA;jd.lengthB=lengthB;jd.ratio=ratio;return this.world.CreateJoint(jd)},gearJoint:function(joint1,joint2,ratio){if(typeof ratio==='undefined'){ratio=1}
var jd=new box2d.b2GearJointDef();jd.joint1=joint1;jd.joint2=joint2;jd.ratio=-ratio;jd.bodyA=joint1.GetBodyA();jd.bodyB=joint2.GetBodyB();return this.world.CreateJoint(jd)},clearTilemapLayerBodies:function(map,layer){layer=map.getLayer(layer);var i=map.layers[layer].bodies.length;while(i--){map.layers[layer].bodies[i].destroy()}
map.layers[layer].bodies.length=0},convertTilemap:function(map,layer,addToWorld,optimize){layer=map.getLayer(layer);if(typeof addToWorld==='undefined'){addToWorld=!0}
if(typeof optimize==='undefined'){optimize=!0}
this.clearTilemapLayerBodies(map,layer);var width=0;var sx=0;var sy=0;for(var y=0,h=map.layers[layer].height;y<h;y++){width=0;for(var x=0,w=map.layers[layer].width;x<w;x++){var tile=map.layers[layer].data[y][x];if(tile&&tile.index>-1&&tile.collides){if(optimize){var right=map.getTileRight(layer,x,y);if(width===0){sx=tile.x*tile.width;sy=tile.y*tile.height;width=tile.width}
if(right&&right.collides){width+=tile.width}
else{var body=new Phaser.Physics.Box2D.Body(this.game,null,sx,sy,0);body.addRectangle(width,tile.height,width/2,tile.height/2,0);if(addToWorld){this.addBody(body)}
map.layers[layer].bodies.push(body);width=0}}
else{var body=this.createBody(tile.x*tile.width,tile.y*tile.height,0,!1);body.addRectangle(tile.width,tile.height,tile.width/2,tile.height/2,0);if(addToWorld){this.addBody(body)}
map.layers[layer].bodies.push(body)}}}}
return map.layers[layer].bodies},raycast:function(x1,y1,x2,y2,closestHitOnly,filterFunction){if(typeof closestHitOnly==='undefined'){closestHitOnly=!0}
if(typeof filterFunction==='undefined'){filterFunction=null}
x1=this.pxm(-x1);y1=this.pxm(-y1);x2=this.pxm(-x2);y2=this.pxm(-y2);var point1=new box2d.b2Vec2(x1,y1);var point2=new box2d.b2Vec2(x2,y2);var output=[];var callback=new Phaser.Physics.Box2D.RayCastCallback(this,closestHitOnly,filterFunction);this.world.RayCast(callback,point1,point2);for(var i=0;i<callback.hits.length;i++){var hit=callback.hits[i];hit.point={x:this.mpx(-hit.point.x),y:this.mpx(-hit.point.y)};hit.normal={x:-hit.normal.x,y:-hit.normal.y};output.push(hit)}
return output},queryAABB:function(x,y,width,height){x=this.pxm(-x);y=this.pxm(-y);width=this.pxm(width);height=this.pxm(height);var aabb=new box2d.b2AABB();aabb.lowerBound.SetXY(x-width,y-height);aabb.upperBound.SetXY(x,y);var callback=new Phaser.Physics.Box2D.QueryCallback(this);this.world.QueryAABB(callback,aabb);return callback.hits},queryFixture:function(fixture){var callback=new Phaser.Physics.Box2D.QueryCallback(this);this.world.QueryShape(callback,fixture.GetShape(),fixture.GetBody().GetTransform());return callback.hits},setPTMRatio:function(newRatio){this.ptmRatio=newRatio;this.debugDraw=new Phaser.Physics.Box2D.DefaultDebugDraw(this.ptmRatio);this.world.SetDebugDraw(this.debugDraw)}};Phaser.Physics.Box2D.RayCastCallback=function(world,closestHitOnly,filterFunction){this.world=world;this.closestHitOnly=closestHitOnly;this.filterFunction=filterFunction;this.hits=[]};goog.inherits(Phaser.Physics.Box2D.RayCastCallback,box2d.b2RayCastCallback);Phaser.Physics.Box2D.RayCastCallback.prototype.ReportFixture=function(fixture,point,normal,fraction){if(this.filterFunction!==null){var pxPoint={x:this.world.mpx(-point.x),y:this.world.mpx(-point.y)};var pxNormal={x:-normal.x,y:-normal.y};var body=fixture.GetBody().parent;if(!this.filterFunction.call(this,body,fixture,pxPoint,pxNormal)){return-1}}
if(this.closestHitOnly){this.hits=[]}
var hit={};hit.body=fixture.GetBody().parent;hit.fixture=fixture;hit.point={x:point.x,y:point.y};hit.normal={x:normal.x,y:normal.y};this.hits.push(hit);if(this.closestHitOnly){return fraction}
else{return 1}};Phaser.Physics.Box2D.QueryCallback=function(world){this.world=world;this.hits=[]};goog.inherits(Phaser.Physics.Box2D.QueryCallback,box2d.b2QueryCallback);Phaser.Physics.Box2D.QueryCallback.prototype.ReportFixture=function(fixture){var hit={};hit.body=fixture.GetBody().parent;hit.fixture=fixture;this.hits.push(hit);return !0};Phaser.Physics.Box2D.renderBody=function(context,body,color,filled){color=color||'rgb(255,255,255)';if(typeof filled==='undefined'){filled=!0}
var b=body.data;var xf=b.GetTransform();var world=body.world;xf.p.x+=-body.game.camera.x/world.ptmRatio;xf.p.y-=-body.game.camera.y/world.ptmRatio;world.debugDraw.start(context);world.debugDraw.PushTransform(xf);var rgbcolor=Phaser.Color.webToColor(color);var b2color=world.debugDraw.color;b2color.r=rgbcolor.r/255;b2color.g=rgbcolor.g/255;b2color.b=rgbcolor.b/255;for(var f=b.GetFixtureList();f;f=f.GetNext()){world.world.DrawShape(f,b2color)}
world.debugDraw.PopTransform();world.debugDraw.stop()};Phaser.Physics.Box2D.Body=function(game,sprite,x,y,density,world){if(typeof sprite==='undefined'){sprite=null}
if(typeof x==='undefined'){x=0}
if(typeof y==='undefined'){y=0}
if(typeof density==='undefined'){density=2}
if(typeof world==='undefined'){world=game.physics.box2d}
this.game=game;this.world=world;this.id=this.world.getNextBodyId();this.sprite=sprite;this.type=Phaser.Physics.BOX2D;this.offset=new Phaser.Point();this.bodyDef=new box2d.b2BodyDef();this.bodyDef.position.SetXY(-this.world.pxm(x),-this.world.pxm(y));if(density===0){this.bodyDef.type=box2d.b2BodyType.b2_staticBody}
else if(density===1){this.bodyDef.type=box2d.b2BodyType.b2_kinematicBody}
else if(density===2){this.bodyDef.type=box2d.b2BodyType.b2_dynamicBody}
else if(density===3){this.bodyDef.type=box2d.b2BodyType.b2_bulletBody}
this.data=this.world.world.CreateBody(this.bodyDef);this.data.world=this.world.world;this.data.parent=this;this.velocity=new Phaser.Physics.Box2D.PointProxy(this.world,this.data,this.data.GetLinearVelocity,this.data.SetLinearVelocity);this.removeNextStep=!1;this._fixtureContactCallbacks={};this._fixtureContactCallbackContext={};this._bodyContactCallbacks={};this._bodyContactCallbackContext={};this._categoryContactCallbacks={};this._categoryContactCallbackContext={};this._fixturePresolveCallbacks={};this._fixturePresolveCallbackContext={};this._bodyPresolveCallbacks={};this._bodyPresolveCallbackContext={};this._categoryPresolveCallbacks={};this._categoryPresolveCallbackContext={};this._fixturePostsolveCallbacks={};this._fixturePostsolveCallbackContext={};this._bodyPostsolveCallbacks={};this._bodyPostsolveCallbackContext={};this._categoryPostsolveCallbacks={};this._categoryPostsolveCallbackContext={};if(sprite){this.setRectangleFromSprite(sprite)}};Phaser.Physics.Box2D.Body.prototype={setBodyContactCallback:function(object,callback,callbackContext){var id=-1;if(object.id){id=object.id}
else if(object.body){id=object.body.id}
if(id>-1){if(callback===null){delete(this._bodyContactCallbacks[id]);delete(this._bodyContactCallbackContext[id])}
else{this._bodyContactCallbacks[id]=callback;this._bodyContactCallbackContext[id]=callbackContext}}},setFixtureContactCallback:function(fixture,callback,callbackContext){var id=fixture.id;if(id>-1){if(callback===null){delete(this._fixtureContactCallbacks[id]);delete(this._fixtureContactCallbackContext[id])}
else{this._fixtureContactCallbacks[id]=callback;this._fixtureContactCallbackContext[id]=callbackContext}}},setCategoryContactCallback:function(category,callback,callbackContext){if(callback===null){delete(this._categoryContactCallbacks[category]);delete(this._categoryContactCallbacksContext[category])}
else{this._categoryContactCallbacks[category]=callback;this._categoryContactCallbackContext[category]=callbackContext}},setBodyPresolveCallback:function(object,callback,callbackContext){var id=-1;if(object.id){id=object.id}
else if(object.body){id=object.body.id}
if(id>-1){if(callback===null){delete(this._bodyPresolveCallbacks[id]);delete(this._bodyPresolveCallbackContext[id])}
else{this._bodyPresolveCallbacks[id]=callback;this._bodyPresolveCallbackContext[id]=callbackContext}}},setFixturePresolveCallback:function(fixture,callback,callbackContext){var id=fixture.id;if(id>-1){if(callback===null){delete(this._fixturePresolveCallbacks[id]);delete(this._fixturePresolveCallbackContext[id])}
else{this._fixturePresolveCallbacks[id]=callback;this._fixturePresolveCallbackContext[id]=callbackContext}}},setCategoryPresolveCallback:function(category,callback,callbackContext){if(callback===null){delete(this._categoryPresolveCallbacks[category]);delete(this._categoryPresolveCallbacksContext[category])}
else{this._categoryPresolveCallbacks[category]=callback;this._categoryPresolveCallbackContext[category]=callbackContext}},setBodyPostsolveCallback:function(object,callback,callbackContext){var id=-1;if(object.id){id=object.id}
else if(object.body){id=object.body.id}
if(id>-1){if(callback===null){delete(this._bodyPostsolveCallbacks[id]);delete(this._bodyPostsolveCallbackContext[id])}
else{this._bodyPostsolveCallbacks[id]=callback;this._bodyPostsolveCallbackContext[id]=callbackContext}}},setFixturePostsolveCallback:function(fixture,callback,callbackContext){var id=fixture.id;if(id>-1){if(callback===null){delete(this._fixturePostsolveCallbacks[id]);delete(this._fixturePostsolveCallbackContext[id])}
else{this._fixturePostsolveCallbacks[id]=callback;this._fixturePostsolveCallbackContext[id]=callbackContext}}},setCategoryPostsolveCallback:function(category,callback,callbackContext){if(callback===null){delete(this._categoryPostsolveCallbacks[category]);delete(this._categoryPostsolveCallbacksContext[category])}
else{this._categoryPostsolveCallbacks[category]=callback;this._categoryPostsolveCallbackContext[category]=callbackContext}},setCollisionCategory:function(category,fixture){if(typeof fixture==='undefined'){for(var f=this.data.GetFixtureList();f;f=f.GetNext()){var filter=f.GetFilterData();filter.categoryBits=category}}
else{var filter=fixture.GetFilterData();filter.categoryBits=category}},setCollisionMask:function(mask,fixture){if(typeof fixture==='undefined'){for(var f=this.data.GetFixtureList();f;f=f.GetNext()){var filter=f.GetFilterData();filter.maskBits=mask}}
else{var filter=fixture.GetFilterData();filter.maskBits=mask}},applyForce:function(x,y){this.data.ApplyForce(new box2d.b2Vec2(-x,-y),this.data.GetWorldCenter(),!0)},setZeroRotation:function(){this.data.SetAngularVelocity(0)},setZeroVelocity:function(){this.data.SetLinearVelocity(box2d.b2Vec2.ZERO)},setZeroDamping:function(){this.data.SetLinearDamping(0);this.data.SetAngularDamping(0)},toLocalPoint:function(out,worldPoint){out.x=this.world.pxm(-worldPoint.x);out.y=this.world.pxm(-worldPoint.y);this.data.GetLocalPoint(out,out);out.x=this.world.mpx(-out.x);out.y=this.world.mpx(-out.y);return out},toWorldPoint:function(out,localPoint){out.x=this.world.pxm(-localPoint.x);out.y=this.world.pxm(-localPoint.y);this.data.GetWorldPoint(out,out);out.x=this.world.mpx(-out.x);out.y=this.world.mpx(-out.y);return out},toLocalVector:function(out,worldVector){out.x=this.world.pxm(-worldVector.x);out.y=this.world.pxm(-worldVector.y);this.data.GetLocalVector(out,out);out.x=this.world.mpx(-out.x);out.y=this.world.mpx(-out.y);return out},toWorldVector:function(out,localVector){out.x=this.world.pxm(-localVector.x);out.y=this.world.pxm(-localVector.y);this.data.GetWorldVector(out,out);out.x=this.world.mpx(-out.x);out.y=this.world.mpx(-out.y)},rotateLeft:function(speed){this.data.SetAngularVelocity(this.world.pxm(-speed))},rotateRight:function(speed){this.data.SetAngularVelocity(this.world.pxm(speed))},moveForward:function(speed){var magnitude=this.world.pxm(speed);var direction=new box2d.b2Vec2();this.toWorldVector(direction,{x:0,y:magnitude});this.data.SetLinearVelocity(direction)},moveBackward:function(speed){var magnitude=this.world.pxm(-speed);var direction=new box2d.b2Vec2();this.toWorldVector(direction,{x:0,y:magnitude});this.data.SetLinearVelocity(direction)},thrust:function(power){var magnitude=this.world.pxm(power)*this.data.GetMass();var force=new box2d.b2Vec2();this.toWorldVector(force,{x:0,y:magnitude});this.data.ApplyForce(force,this.data.GetWorldCenter(),!0)},reverse:function(power){var magnitude=-this.world.pxm(power)*this.data.GetMass();var force=new box2d.b2Vec2();this.toWorldVector(force,{x:0,y:magnitude});this.data.ApplyForce(force,this.data.GetWorldCenter(),!0)},moveLeft:function(speed){this.velocity.x=-speed},moveRight:function(speed){this.velocity.x=speed},moveUp:function(speed){this.velocity.y=-speed},moveDown:function(speed){this.velocity.y=speed},preUpdate:function(){if(this.removeNextStep){this.removeFromWorld();this.removeNextStep=!1}},postUpdate:function(){if(this.sprite){this.sprite.x=this.world.mpx(-this.data.GetPosition().x);this.sprite.y=this.world.mpx(-this.data.GetPosition().y);this.sprite.rotation=this.data.GetAngle()}},kill:function(){this.data.SetActive(!1)},reset:function(x,y){this.data.SetPositionXY(this.world.pxm(-x),this.world.pxm(-y));this.data.SetActive(!0)},removeFromWorld:function(){if(this.data.world===this.game.physics.box2d.world){this.game.physics.box2d.removeBodyNextStep(this)}},destroy:function(){this.removeFromWorld();this._bodyCallbacks={};this._bodyCallbackContext={};this._categoryCallbacks={};this._categoryCallbackContext={};this.sprite=null},clearFixtures:function(){var fixtures=[];for(var f=this.data.GetFixtureList();f;f=f.GetNext()){fixtures.push(f)}
var i=fixtures.length;while(i--){this.data.DestroyFixture(fixtures[i])}},addCircle:function(radius,offsetX,offsetY){var circleShape=new box2d.b2CircleShape(this.world.pxm(radius));circleShape.m_p.SetXY(this.world.pxm(-offsetX),this.world.pxm(-offsetY));var fixtureDef=new box2d.b2FixtureDef();fixtureDef.shape=circleShape;fixtureDef.friction=this.world.friction;fixtureDef.restitution=this.world.restitution;fixtureDef.density=this.world.density;var f=this.data.CreateFixture(fixtureDef);f.id=this.world.getNextFixtureId();return f},addRectangle:function(width,height,offsetX,offsetY,rotation){if(typeof width==='undefined'){width=16}
if(typeof height==='undefined'){height=16}
if(typeof offsetX==='undefined'){offsetX=0}
if(typeof offsetY==='undefined'){offsetY=0}
if(typeof rotation==='undefined'){rotation=0}
width=this.world.pxm(width);height=this.world.pxm(height);var polygonShape=new box2d.b2PolygonShape();polygonShape.SetAsOrientedBox(0.5*width,0.5*height,new box2d.b2Vec2(this.world.pxm(-offsetX),this.world.pxm(-offsetY)),rotation);var fixtureDef=new box2d.b2FixtureDef();fixtureDef.shape=polygonShape;fixtureDef.friction=this.world.friction;fixtureDef.restitution=this.world.restitution;fixtureDef.density=this.world.density;var f=this.data.CreateFixture(fixtureDef);f.id=this.world.getNextFixtureId();return f},addEdge:function(x1,y1,x2,y2){var edgeShape=new box2d.b2EdgeShape();edgeShape.Set(new box2d.b2Vec2(this.world.pxm(-x1),this.world.pxm(-y1)),new box2d.b2Vec2(this.world.pxm(-x2),this.world.pxm(-y2)));var fixtureDef=new box2d.b2FixtureDef();fixtureDef.shape=edgeShape;fixtureDef.friction=this.world.friction;fixtureDef.restitution=this.world.restitution;fixtureDef.density=this.world.density;var f=this.data.CreateFixture(fixtureDef);f.id=this.world.getNextFixtureId();return f},addChain:function(vertices,firstIndex,count,loop){if(typeof vertices==='undefined'){return null}
if(vertices.length<4){return null}
if(typeof firstIndex==='undefined'){firstIndex=0}
if(typeof count==='undefined'){count=(vertices.length-firstIndex)/2}
var b2Vertices=[];for(var i=firstIndex;i<(firstIndex+count);i++){b2Vertices.push(new box2d.b2Vec2(this.world.pxm(-vertices[2*i]),this.world.pxm(-vertices[2*i+1])))}
var chainShape=new box2d.b2ChainShape();if(loop){chainShape.CreateLoop(b2Vertices,b2Vertices.length)}
else{chainShape.CreateChain(b2Vertices,b2Vertices.length)}
var fixtureDef=new box2d.b2FixtureDef();fixtureDef.shape=chainShape;fixtureDef.friction=this.world.friction;fixtureDef.restitution=this.world.restitution;fixtureDef.density=this.world.density;var f=this.data.CreateFixture(fixtureDef);f.id=this.world.getNextFixtureId();return f},addLoop:function(vertices,firstIndex,count){return this.addChain(vertices,firstIndex,count,!0)},addPolygon:function(vertices,firstIndex,count){if(typeof vertices==='undefined'){return null}
if(vertices.length<6){return null}
if(typeof firstIndex==='undefined'){firstIndex=0}
if(typeof count==='undefined'){count=(vertices.length-firstIndex)/2}
var b2Vertices=[];for(var i=firstIndex;i<(firstIndex+count);i++){b2Vertices.push({x:this.world.pxm(-vertices[2*i]),y:this.world.pxm(-vertices[2*i+1])})}
var poly=new Phaser.Physics.Box2D.Polygon();poly.setFromXYObjects(b2Vertices);var convexPolygons=poly.decompose(b2Vertices);var lastFixture=null;for(var i=0;i<convexPolygons.length;i++){var polygonShape=new box2d.b2PolygonShape();polygonShape.Set(convexPolygons[i],convexPolygons[i].length);var fixtureDef=new box2d.b2FixtureDef();fixtureDef.shape=polygonShape;fixtureDef.friction=this.world.friction;fixtureDef.restitution=this.world.restitution;fixtureDef.density=this.world.density;lastFixture=this.data.CreateFixture(fixtureDef);lastFixture.id=this.world.getNextFixtureId()}
return lastFixture},removeFixture:function(fixture){if(fixture.GetBody()!=this.data){return !1}
this.data.DestroyFixture(fixture);return !0},setCircle:function(radius,offsetX,offsetY){if(typeof radius==='undefined'){radius=32}
if(typeof offsetX==='undefined'){offsetX=0}
if(typeof offsetY==='undefined'){offsetY=0}
this.clearFixtures();return this.addCircle(radius,offsetX,offsetY)},setRectangle:function(width,height,offsetX,offsetY,rotation){this.clearFixtures();return this.addRectangle(width,height,offsetX,offsetY,rotation)},setRectangleFromSprite:function(sprite){if(typeof sprite==='undefined'){sprite=this.sprite}
this.clearFixtures();return this.addRectangle(sprite.width,sprite.height,0,0,sprite.rotation)},setEdge:function(x1,y1,x2,y2){if(typeof x1==='undefined'){x1=0}
if(typeof y1==='undefined'){y1=0}
if(typeof x2==='undefined'){x2=0}
if(typeof y2==='undefined'){y2=0}
this.clearFixtures();return this.addEdge(x1,y1,x2,y2)},setChain:function(vertices,firstIndex,count,loop){if(typeof vertices==='undefined'){return null}
if(vertices.length<4){return null}
if(typeof firstIndex==='undefined'){firstIndex=0}
if(typeof count==='undefined'){count=(vertices.length-firstIndex)/2}
this.clearFixtures();return this.addChain(vertices,firstIndex,count,loop)},setLoop:function(vertices,firstIndex,count){return this.setChain(vertices,firstIndex,count,!0)},setPolygon:function(vertices,firstIndex,count){if(typeof vertices==='undefined'){return null}
if(vertices.length<4){return null}
if(typeof firstIndex==='undefined'){firstIndex=0}
if(typeof count==='undefined'){count=(vertices.length-firstIndex)/2}
this.clearFixtures();return this.addPolygon(vertices,firstIndex,count)},loadPolygon:function(key,object,sprite){if(typeof sprite==='undefined'){sprite=null}
var data=this.game.cache.getPhysicsData(key,object);for(var i=0;i<data.length;i++){var vertices=[];for(var s=0;s<data[i].shape.length;s+=2){vertices.push(new box2d.b2Vec2(this.world.pxm(-data[i].shape[s]),this.world.pxm(-data[i].shape[s+1])))}
if(sprite){var offsetx=this.world.pxm(-0.5*sprite.width);var offsety=this.world.pxm(-0.5*sprite.height);for(var k=0;k<vertices.length;k++){vertices[k].x-=offsetx;vertices[k].y-=offsety}}
var polygonShape=new box2d.b2PolygonShape();polygonShape.Set(vertices,vertices.length);var fixtureDef=new box2d.b2FixtureDef();fixtureDef.shape=polygonShape;fixtureDef.friction=data[i].friction;fixtureDef.restitution=data[i].bounce;fixtureDef.density=data[i].density;fixtureDef.filter.categoryBits=data[i].filter.categoryBits;fixtureDef.filter.maskBits=data[i].filter.maskBits;var f=this.data.CreateFixture(fixtureDef);f.id=this.world.getNextFixtureId()}
return !0},containsPoint:function(point){var worldx=this.world.pxm(-point.x);var worldy=this.world.pxm(-point.y);var worldPoint=new box2d.b2Vec2(worldx,worldy);for(var f=this.data.GetFixtureList();f;f=f.GetNext()){if(f.TestPoint(worldPoint)){return !0}}
return !1}};Phaser.Physics.Box2D.Body.prototype.constructor=Phaser.Physics.Box2D.Body;Object.defineProperty(Phaser.Physics.Box2D.Body.prototype,"static",{get:function(){return(this.data.GetType()===box2d.b2BodyType.b2_staticBody)},set:function(value){if(value&&this.data.GetType()!==box2d.b2BodyType.b2_staticBody){this.data.SetType(box2d.b2BodyType.b2_staticBody)}
else if(!value&&this.data.GetType()===box2d.b2BodyType.b2_staticBody){this.data.SetType(box2d.b2BodyType.b2_dynamicBody)}}});Object.defineProperty(Phaser.Physics.Box2D.Body.prototype,"dynamic",{get:function(){return(this.data.GetType()===box2d.b2BodyType.b2_dynamicBody)},set:function(value){if(value&&this.data.GetType()!==box2d.b2BodyType.b2_dynamicBody){this.data.SetType(box2d.b2BodyType.b2_dynamicBody)}
else if(!value&&this.data.GetType()===box2d.b2BodyType.b2_dynamicBody){this.data.SetType(box2d.b2BodyType.b2_staticBody)}}});Object.defineProperty(Phaser.Physics.Box2D.Body.prototype,"kinematic",{get:function(){return(this.data.GetType()===box2d.b2BodyType.b2_kinematicBody)},set:function(value){if(value&&this.data.GetType()!==box2d.b2BodyType.b2_kinematicBody){this.data.SetType(box2d.b2BodyType.b2_kinematicBody)}
else if(!value&&this.data.GetType()===box2d.b2BodyType.b2_kinematicBody){this.data.SetType(box2d.b2BodyType.b2_staticBody)}}});Object.defineProperty(Phaser.Physics.Box2D.Body.prototype,"angle",{get:function(){return Phaser.Math.wrapAngle(Phaser.Math.radToDeg(this.data.GetAngle()))},set:function(value){this.data.SetAngle(Phaser.Math.degToRad(Phaser.Math.wrapAngle(value)))}});Object.defineProperty(Phaser.Physics.Box2D.Body.prototype,"linearDamping",{get:function(){return this.data.GetLinearDamping()},set:function(value){this.data.SetLinearDamping(value)}});Object.defineProperty(Phaser.Physics.Box2D.Body.prototype,"angularDamping",{get:function(){return this.data.GetAngularDamping()},set:function(value){this.data.SetAngularDamping(value)}});Object.defineProperty(Phaser.Physics.Box2D.Body.prototype,"angularVelocity",{get:function(){return this.data.GetAngularVelocity()},set:function(value){this.data.SetAngularVelocity(value)}});Object.defineProperty(Phaser.Physics.Box2D.Body.prototype,"fixedRotation",{get:function(){return this.data.IsFixedRotation()},set:function(value){this.data.SetFixedRotation(value)}});Object.defineProperty(Phaser.Physics.Box2D.Body.prototype,"gravityScale",{get:function(){return this.data.GetGravityScale()},set:function(value){this.data.SetGravityScale(value)}});Object.defineProperty(Phaser.Physics.Box2D.Body.prototype,"friction",{get:function(){var fixture=this.data.GetFixtureList();if(fixture){return fixture.GetFriction()}
return 0},set:function(value){for(var f=this.data.GetFixtureList();f;f=f.GetNext()){f.SetFriction(value);f.Refilter()}}});Object.defineProperty(Phaser.Physics.Box2D.Body.prototype,"restitution",{get:function(){var fixture=this.data.GetFixtureList();if(fixture){return fixture.GetRestitution()}
return 0},set:function(value){for(var f=this.data.GetFixtureList();f;f=f.GetNext()){f.SetRestitution(value);f.Refilter()}}});Object.defineProperty(Phaser.Physics.Box2D.Body.prototype,"sensor",{get:function(){var fixture=this.data.GetFixtureList();if(fixture){return fixture.IsSensor()}
return 0},set:function(value){for(var f=this.data.GetFixtureList();f;f=f.GetNext()){f.SetSensor(value);f.Refilter()}}});Object.defineProperty(Phaser.Physics.Box2D.Body.prototype,"bullet",{get:function(){return this.data.IsBullet()},set:function(value){this.data.SetBullet(value)}});Object.defineProperty(Phaser.Physics.Box2D.Body.prototype,"mass",{get:function(){return this.data.GetMass()},set:function(value){if(value===0){this.data.SetType(box2d.b2BodyType.b2_staticBody)}
else{if(this.data.GetType()!==box2d.b2BodyType.b2_dynamicBody){this.data.SetType(box2d.b2BodyType.b2_dynamicBody)}
var oldMass=this.data.GetMass();var scaleby=value/oldMass;for(var f=this.data.GetFixtureList();f;f=f.GetNext()){var oldDensity=f.GetDensity();f.SetDensity(oldDensity*scaleby)}
this.data.ResetMassData()}}});Object.defineProperty(Phaser.Physics.Box2D.Body.prototype,"rotation",{get:function(){return this.data.GetAngle()},set:function(value){this.data.SetAngle(value)}});Object.defineProperty(Phaser.Physics.Box2D.Body.prototype,"x",{get:function(){return this.world.mpx(-this.data.GetPosition().x)},set:function(value){this.data.SetPositionXY(this.world.pxm(-value),this.data.GetPosition().y)}});Object.defineProperty(Phaser.Physics.Box2D.Body.prototype,"y",{get:function(){return this.world.mpx(-this.data.GetPosition().y)},set:function(value){this.data.SetPositionXY(this.data.GetPosition().x,this.world.pxm(-value))}});Object.defineProperty(Phaser.Physics.Box2D.Body.prototype,"collideWorldBounds",{get:function(){for(var f=this.data.GetFixtureList();f;f=f.GetNext()){var filter=f.GetFilterData();if(filter.maskBits&Phaser.Physics.Box2D.worldBoundsFilterCategory){return !0}}
return !1},set:function(value){for(var f=this.data.GetFixtureList();f;f=f.GetNext()){var filter=f.GetFilterData();if(value){filter.maskBits|=Phaser.Physics.Box2D.worldBoundsFilterCategory}
else{filter.maskBits&=~Phaser.Physics.Box2D.worldBoundsFilterCategory}}}});Phaser.Physics.Box2D.PointProxy=function(world,object,gettor,settor){this.world=world;this.object=object;this.gettor=gettor;this.settor=settor};Phaser.Physics.Box2D.PointProxy.prototype.constructor=Phaser.Physics.Box2D.PointProxy;Object.defineProperty(Phaser.Physics.Box2D.PointProxy.prototype,"x",{get:function(){return this.world.mpx(-this.gettor.call(this.object).x)},set:function(value){var v=this.gettor.call(this.object);v.x=this.world.pxm(-value);this.settor.call(this.object,v)}});Object.defineProperty(Phaser.Physics.Box2D.PointProxy.prototype,"y",{get:function(){return this.world.mpx(-this.gettor.call(this.object).y)},set:function(value){var v=this.gettor.call(this.object);v.y=this.world.pxm(-value);this.settor.call(this.object,v)}});Phaser.Physics.Box2D.DefaultDebugDraw=function(pixelsPerMeter){this.context=null;this.pixelsPerMeter=pixelsPerMeter;this.flags=box2d.b2DrawFlags.e_shapeBit};Phaser.Physics.Box2D.DefaultDebugDraw.prototype.color=new box2d.b2Color(1,1,1);Phaser.Physics.Box2D.DefaultDebugDraw.prototype.SetFlags=function(flags){this.flags=flags};Phaser.Physics.Box2D.DefaultDebugDraw.prototype.GetFlags=function(){return this.flags};Phaser.Physics.Box2D.DefaultDebugDraw.prototype.start=function(context){this.context=context;this.context.save();this.context.scale(-1,-1);this.context.scale(this.pixelsPerMeter,this.pixelsPerMeter)};Phaser.Physics.Box2D.DefaultDebugDraw.prototype.stop=function(){this.context.restore()};Phaser.Physics.Box2D.DefaultDebugDraw.prototype.PushTransform=function(xf){var ctx=this.context;ctx.save();ctx.translate(xf.p.x,xf.p.y);ctx.rotate(xf.q.GetAngleRadians())};Phaser.Physics.Box2D.DefaultDebugDraw.prototype.PopTransform=function(){var ctx=this.context;ctx.restore()};Phaser.Physics.Box2D.DefaultDebugDraw.prototype.DrawPolygon=function(vertices,vertexCount,color){if(!vertexCount){return}
var ctx=this.context;ctx.lineWidth=1/this.pixelsPerMeter;ctx.beginPath();ctx.moveTo(vertices[0].x,vertices[0].y);for(var i=1;i<vertexCount;i++){ctx.lineTo(vertices[i].x,vertices[i].y)}
ctx.closePath();ctx.strokeStyle=color.MakeStyleString(1);ctx.stroke()};Phaser.Physics.Box2D.DefaultDebugDraw.prototype.DrawSolidPolygon=function(vertices,vertexCount,color){if(!vertexCount){return}
var ctx=this.context;ctx.lineWidth=1/this.pixelsPerMeter;ctx.beginPath();ctx.moveTo(vertices[0].x,vertices[0].y);for(var i=1;i<vertexCount;i++){ctx.lineTo(vertices[i].x,vertices[i].y)}
ctx.closePath();ctx.fillStyle=color.MakeStyleString(0.5);ctx.fill();ctx.strokeStyle=color.MakeStyleString(1);ctx.stroke()};Phaser.Physics.Box2D.DefaultDebugDraw.prototype.DrawCircle=function(center,radius,color){if(!radius){return}
var ctx=this.context;ctx.beginPath();ctx.arc(center.x,center.y,radius,0,Math.PI*2,!0);ctx.strokeStyle=color.MakeStyleString(1);ctx.stroke()};Phaser.Physics.Box2D.DefaultDebugDraw.prototype.DrawSolidCircle=function(center,radius,axis,color){if(!radius){return}
var ctx=this.context;ctx.lineWidth=1/this.pixelsPerMeter;var cx=center.x;var cy=center.y;ctx.beginPath();ctx.arc(cx,cy,radius,0,Math.PI*2,!0);ctx.moveTo(cx,cy);ctx.lineTo((cx+axis.x*radius),(cy+axis.y*radius));ctx.fillStyle=color.MakeStyleString(0.5);ctx.fill();ctx.strokeStyle=color.MakeStyleString(1);ctx.stroke()};Phaser.Physics.Box2D.DefaultDebugDraw.prototype.DrawSegment=function(p1,p2,color){var ctx=this.context;ctx.lineWidth=1/this.pixelsPerMeter;ctx.beginPath();ctx.moveTo(p1.x,p1.y);ctx.lineTo(p2.x,p2.y);ctx.strokeStyle=color.MakeStyleString(1);ctx.stroke()};Phaser.Physics.Box2D.DefaultDebugDraw.prototype.DrawTransform=function(xf){var ctx=this.context;ctx.lineWidth=1/this.pixelsPerMeter;this.PushTransform(xf);ctx.beginPath();ctx.moveTo(0,0);ctx.lineTo(1,0);ctx.strokeStyle=box2d.b2Color.RED.MakeStyleString(1);ctx.stroke();ctx.beginPath();ctx.moveTo(0,0);ctx.lineTo(0,1);ctx.strokeStyle=box2d.b2Color.GREEN.MakeStyleString(1);ctx.stroke();this.PopTransform(xf)};Phaser.Physics.Box2D.DefaultDebugDraw.prototype.DrawPoint=function(p,size,color){var ctx=this.context;ctx.fillStyle=color.MakeStyleString();var hsize=size/2;ctx.fillRect(p.x-hsize,p.y-hsize,size,size)};Phaser.Physics.Box2D.DefaultDebugDraw.prototype.DrawAABB=function(aabb,color){var ctx=this.context;ctx.strokeStyle=color.MakeStyleString();var x=aabb.lowerBound.x;var y=aabb.lowerBound.y;var w=aabb.upperBound.x-aabb.lowerBound.x;var h=aabb.upperBound.y-aabb.lowerBound.y;ctx.strokeRect(x,y,w,h)};Object.defineProperty(Phaser.Physics.Box2D.DefaultDebugDraw.prototype,"shapes",{get:function(){return this.flags&box2d.b2DrawFlags.e_shapeBit},set:function(value){if(value){this.flags|=box2d.b2DrawFlags.e_shapeBit}
else{this.flags&=~box2d.b2DrawFlags.e_shapeBit}}});Object.defineProperty(Phaser.Physics.Box2D.DefaultDebugDraw.prototype,"joints",{get:function(){return this.flags&box2d.b2DrawFlags.e_jointBit},set:function(value){if(value){this.flags|=box2d.b2DrawFlags.e_jointBit}
else{this.flags&=~box2d.b2DrawFlags.e_jointBit}}});Object.defineProperty(Phaser.Physics.Box2D.DefaultDebugDraw.prototype,"aabbs",{get:function(){return this.flags&box2d.b2DrawFlags.e_aabbBit},set:function(value){if(value){this.flags|=box2d.b2DrawFlags.e_aabbBit}
else{this.flags&=~box2d.b2DrawFlags.e_aabbBit}}});Object.defineProperty(Phaser.Physics.Box2D.DefaultDebugDraw.prototype,"pairs",{get:function(){return this.flags&box2d.b2DrawFlags.e_pairBit},set:function(value){if(value){this.flags|=box2d.b2DrawFlags.e_pairBit}
else{this.flags&=~box2d.b2DrawFlags.e_pairBit}}});Object.defineProperty(Phaser.Physics.Box2D.DefaultDebugDraw.prototype,"centerOfMass",{get:function(){return this.flags&box2d.b2DrawFlags.e_centerOfMassBit},set:function(value){if(value){this.flags|=box2d.b2DrawFlags.e_centerOfMassBit}
else{this.flags&=~box2d.b2DrawFlags.e_centerOfMassBit}}});Phaser.Physics.Box2D.DefaultContactListener=function(){};Phaser.Physics.Box2D.DefaultContactListener.prototype.BeginContact=function(contact){this.handleContactBeginOrEnd(contact,!0)};Phaser.Physics.Box2D.DefaultContactListener.prototype.EndContact=function(contact){this.handleContactBeginOrEnd(contact,!1)};Phaser.Physics.Box2D.DefaultContactListener.prototype.handleContactBeginOrEnd=function(contact,begin){var fA=contact.GetFixtureA();var fB=contact.GetFixtureB();var bA=fA.GetBody();var bB=fB.GetBody();var catA=fA.GetFilterData().categoryBits;var catB=fB.GetFilterData().categoryBits;var pA=bA.parent;var pB=bB.parent;if(pA===void 0||pB===void 0){return}
var idA=pA.id;var idB=pB.id;if(pA._bodyContactCallbacks[idB]){pA._bodyContactCallbacks[idB].call(pA._bodyContactCallbackContext[idB],pA,pB,fA,fB,begin,contact)}
if(pB._bodyContactCallbacks[idA]){pB._bodyContactCallbacks[idA].call(pB._bodyContactCallbackContext[idA],pB,pA,fB,fA,begin,contact)}
if(pA._fixtureContactCallbacks[fB.id]){pA._fixtureContactCallbacks[fB.id].call(pA._fixtureContactCallbackContext[fB.id],pA,pB,fA,fB,begin,contact)}
if(pB._fixtureContactCallbacks[fA.id]){pB._fixtureContactCallbacks[fA.id].call(pB._fixtureContactCallbackContext[fA.id],pB,pA,fB,fA,begin,contact)}
if(pA._fixtureContactCallbacks[fA.id]){pA._fixtureContactCallbacks[fA.id].call(pA._fixtureContactCallbackContext[fA.id],pA,pB,fA,fB,begin,contact)}
if(pB._fixtureContactCallbacks[fB.id]){pB._fixtureContactCallbacks[fB.id].call(pB._fixtureContactCallbackContext[fB.id],pB,pA,fB,fA,begin,contact)}
if(pA._categoryContactCallbacks[catB]){pA._categoryContactCallbacks[catB].call(pA._categoryContactCallbackContext[catB],pA,pB,fA,fB,begin,contact)}
if(pB._categoryContactCallbacks[catA]){pB._categoryContactCallbacks[catA].call(pB._categoryContactCallbackContext[catA],pB,pA,fB,fA,begin,contact)}
if(pA._categoryContactCallbacks[catA]){pA._categoryContactCallbacks[catA].call(pA._categoryContactCallbackContext[catA],pA,pB,fA,fB,begin,contact)}
if(pB._categoryContactCallbacks[catB]){pB._categoryContactCallbacks[catB].call(pB._categoryContactCallbackContext[catB],pB,pA,fB,fA,begin,contact)}};Phaser.Physics.Box2D.DefaultContactListener.prototype.PreSolve=function(contact,oldManifold){var fA=contact.GetFixtureA();var fB=contact.GetFixtureB();var bA=fA.GetBody();var bB=fB.GetBody();var catA=fA.GetFilterData().categoryBits;var catB=fB.GetFilterData().categoryBits;var pA=bA.parent;var pB=bB.parent;if(pA===void 0||pB===void 0){return}
var idA=pA.id;var idB=pB.id;if(pA._bodyPresolveCallbacks[idB]){pA._bodyPresolveCallbacks[idB].call(pA._bodyPresolveCallbackContext[idB],pA,pB,fA,fB,contact,oldManifold)}
if(pB._bodyPresolveCallbacks[idA]){pB._bodyPresolveCallbacks[idA].call(pB._bodyPresolveCallbackContext[idA],pB,pA,fB,fA,contact,oldManifold)}
if(pA._fixturePresolveCallbacks[fB.id]){pA._fixturePresolveCallbacks[fB.id].call(pA._fixturePresolveCallbackContext[fB.id],pA,pB,fA,fB,contact,oldManifold)}
if(pB._fixturePresolveCallbacks[fA.id]){pB._fixturePresolveCallbacks[fA.id].call(pB._fixturePresolveCallbackContext[fA.id],pB,pA,fB,fA,contact,oldManifold)}
if(pA._categoryPresolveCallbacks[catB]){pA._categoryPresolveCallbacks[catB].call(pA._categoryPresolveCallbackContext[catB],pA,pB,fA,fB,contact,oldManifold)}
if(pB._categoryPresolveCallbacks[catA]){pB._categoryPresolveCallbacks[catA].call(pB._categoryPresolveCallbackContext[catA],pB,pA,fB,fA,contact,oldManifold)}};Phaser.Physics.Box2D.DefaultContactListener.prototype.PostSolve=function(contact,impulse){var fA=contact.GetFixtureA();var fB=contact.GetFixtureB();var bA=fA.GetBody();var bB=fB.GetBody();var catA=fA.GetFilterData().categoryBits;var catB=fB.GetFilterData().categoryBits;var pA=bA.parent;var pB=bB.parent;if(pA===void 0||pB===void 0){return}
var idA=pA.id;var idB=pB.id;if(pA._bodyPostsolveCallbacks[idB]){pA._bodyPostsolveCallbacks[idB].call(pA._bodyPostsolveCallbackContext[idB],pA,pB,fA,fB,contact,impulse)}
if(pB._bodyPostsolveCallbacks[idA]){pB._bodyPostsolveCallbacks[idA].call(pB._bodyPostsolveCallbackContext[idA],pB,pA,fB,fA,contact,impulse)}
if(pA._fixturePostsolveCallbacks[fB.id]){pA._fixturePostsolveCallbacks[fB.id].call(pA._fixturePostsolveCallbackContext[fB.id],pA,pB,fA,fB,contact,impulse)}
if(pB._fixturePostsolveCallbacks[fA.id]){pB._fixturePostsolveCallbacks[fA.id].call(pB._fixturePostsolveCallbackContext[fA.id],pB,pA,fB,fA,contact,impulse)}
if(pA._categoryPostsolveCallbacks[catB]){pA._categoryPostsolveCallbacks[catB].call(pA._categoryPostsolveCallbackContext[catB],pA,pB,fA,fB,contact,impulse)}
if(pB._categoryPostsolveCallbacks[catA]){pB._categoryPostsolveCallbacks[catA].call(pB._categoryPostsolveCallbackContext[catA],pB,pA,fB,fA,contact,impulse)}};Phaser.Physics.Box2D.Polygon=function(){this.vertices=[]};Phaser.Physics.Box2D.Polygon.prototype.setFromFlatXYCoords=function(flatXYCoords){this.vertices=[];for(var i=0;i<flatXYCoords.length/2;i++){this.vertices.push({x:flatXYCoords[2*i],y:flatXYCoords[2*i+1]})}};Phaser.Physics.Box2D.Polygon.prototype.setFromXYObjects=function(xyObjects){this.vertices=xyObjects.concat()};Phaser.Physics.Box2D.Polygon.prototype.addVertex=function(vertex){this.vertices.push(vertex)};Phaser.Physics.Box2D.Polygon.prototype.at=function(i){var s=this.vertices.length;return this.vertices[i<0?i%s+s:i%s]};Phaser.Physics.Box2D.Polygon.prototype.indicesAreAdjacent=function(a,b){a=a%this.vertices.length;b=b%this.vertices.length;if(a==b){return !0}
var diff=Math.abs(a-b);if(diff<2){return !0}
if(diff==this.vertices.length-1){return !0}
return !1};Phaser.Physics.Box2D.Polygon.prototype.areaInTriangle=function(a,b,c){a=this.at(a);b=this.at(b);c=this.at(c);return(((b.x-a.x)*(c.y-a.y))-((c.x-a.x)*(b.y-a.y)))*0.5};Phaser.Physics.Box2D.Polygon.prototype.left=function(a,b,c){return this.areaInTriangle(a,b,c)>0};Phaser.Physics.Box2D.Polygon.prototype.leftOn=function(a,b,c){return this.areaInTriangle(a,b,c)>=0};Phaser.Physics.Box2D.Polygon.prototype.right=function(a,b,c){return this.areaInTriangle(a,b,c)<0};Phaser.Physics.Box2D.Polygon.prototype.rightOn=function(a,b,c){return this.areaInTriangle(a,b,c)<=0};Phaser.Physics.Box2D.Polygon.sqdist=function(a,b){var dx=b.x-a.x;var dy=b.y-a.y;return dx*dx+dy*dy};Phaser.Physics.Box2D.Polygon.prototype.makeCCW=function(){var br=0;for(var i=1,len=this.vertices.length;i<len;i++){if(this.at(i).y<this.at(br).y||(this.at(i).y===this.at(br).y&&this.at(i).x>this.at(br).x)){br=i}}
if(!this.left(br-1,br,br+1)){this.vertices.reverse();return !0}
return !1};Phaser.Physics.Box2D.Polygon.prototype.isConvex=function(){var havePositive=!1;var haveNegative=!1;for(var i=0,len=this.vertices.length;i<len;i++){var i0=i;var i1=(i+1)%len;var i2=(i+2)%len;if(this.areaInTriangle(this.vertices[i0],this.vertices[i1],this.vertices[i2])>0){havePositive=!0}
else{haveNegative=!0}}
return haveNegative^havePositive};Phaser.Physics.Box2D.Polygon.prototype.isReflex=function(i){return this.right(i-1,i,i+1)};Phaser.Physics.Box2D.Polygon.areVecsEqual=function(v0,v1){return v0.x==v1.x&&v0.y==v1.y};Phaser.Physics.Box2D.Polygon.linesCross=function(v0,v1,t0,t1){if(Phaser.Physics.Box2D.Polygon.areVecsEqual(v1,t0)||Phaser.Physics.Box2D.Polygon.areVecsEqual(v0,t0)||Phaser.Physics.Box2D.Polygon.areVecsEqual(v1,t1)||Phaser.Physics.Box2D.Polygon.areVecsEqual(v0,t1)){return null}
var vnormal={};box2d.b2SubVV(v1,v0,vnormal);box2d.b2CrossVS(vnormal,1,vnormal);var v0d=box2d.b2DotVV(vnormal,v0);var t0d=box2d.b2DotVV(vnormal,t0);var t1d=box2d.b2DotVV(vnormal,t1);if(t0d>v0d&&t1d>v0d){return null}
if(t0d<v0d&&t1d<v0d){return null}
var tnormal={};box2d.b2SubVV(t1,t0,tnormal);box2d.b2CrossVS(tnormal,1,tnormal);var t0d=box2d.b2DotVV(tnormal,t0);var v0d=box2d.b2DotVV(tnormal,v0);var v1d=box2d.b2DotVV(tnormal,v1);if(v0d>t0d&&v1d>t0d){return null}
if(v0d<t0d&&v1d<t0d){return null}
var f=(t0d-v0d)/(v1d-v0d);var intersectionPoint={x:v0.x+f*(v1.x-v0.x),y:v0.y+f*(v1.y-v0.y)};return intersectionPoint};Phaser.Physics.Box2D.Polygon.prototype.canSee=function(a,b){if(this.indicesAreAdjacent(a,b)){return !1}
if(this.leftOn(a+1,a,b)&&this.rightOn(a-1,a,b)){return !1}
for(var i=0;i<this.vertices.length;++i){if((i+1)%this.vertices.length==a||i==a){continue}
if(this.leftOn(a,b,i+1)&&this.rightOn(a,b,i)){if(Phaser.Physics.Box2D.Polygon.linesCross(this.at(a),this.at(b),this.at(i),this.at(i+1))){return !1}}}
return !0};Phaser.Physics.Box2D.Polygon.prototype.subPolygon=function(i,j){var p=new Phaser.Physics.Box2D.Polygon();if(i<j){for(var n=i;n<j+1;n++){p.addVertex(this.at(n))}}
else{for(var n=i;n<this.vertices.length;n++){p.addVertex(this.at(n))}
for(var n=0;n<j+1;n++){p.addVertex(this.at(n))}}
return p};Phaser.Physics.Box2D.Polygon.prototype.decomposeOptimal=function(level){if(typeof level==='undefined'){level=0}
if(level>1){return this.vertices}
this.makeCCW();var min=[];var tmp1=[];var tmp2=[];var nDiags=Number.MAX_VALUE;for(var i=0;i<this.vertices.length;i++){if(this.isReflex(i)){for(var j=0;j<this.vertices.length;j++){if(this.canSee(i,j)){tmp1=this.subPolygon(i,j).decompose(level+1);tmp2=this.subPolygon(j,i).decompose(level+1);if(tmp1.length+tmp2.length<nDiags){min=tmp1.concat(tmp2);nDiags=min.length}}}}}
if(min.length===0){min.push(this.vertices)}
return min};Phaser.Physics.Box2D.Polygon.prototype.decompose=function(level){if(typeof level==='undefined'){level=0}
this.makeCCW();var min=[];var bestDivision=Number.MAX_VALUE;var bestI;var bestJ;var foundReflex=!1;for(var i=0;i<this.vertices.length;i++){if(this.isReflex(i)){foundReflex=!0;var v0=this.at(i);for(var j=0;j<this.vertices.length;j++){if(this.canSee(i,j)){var v1=this.at(j);var dx=v1.x-v0.x;var dy=v1.y-v0.y;var distanceSquared=(dx*dx)*(dy*dy);if(distanceSquared<bestDivision){bestI=i;bestJ=j;bestDivision=distanceSquared}}}}}
if(!foundReflex&&this.vertices.length>8){bestI=0;bestJ=Math.floor(this.vertices.length/2);foundReflex=!0}
if(foundReflex){var tmp1=this.subPolygon(bestI,bestJ).decompose(level+1);var tmp2=this.subPolygon(bestJ,bestI).decompose(level+1);min=tmp1.concat(tmp2)}
if(min.length===0){min.push(this.vertices)}
return min}